const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BCePGpr6.js","assets/monaco-editor-CFPSNTTf.js","assets/monaco-editor-CpN8rtOO.css"])))=>i.map(i=>d[i]);
var Xp=Object.defineProperty;var Zp=(t,e,n)=>e in t?Xp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var G=(t,e,n)=>Zp(t,typeof e!="symbol"?e+"":e,n);import{r as O,_ as cd,F as ef,R as dd}from"./monaco-editor-CFPSNTTf.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var hd={exports:{}},Yl={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tf=O,nf=Symbol.for("react.element"),rf=Symbol.for("react.fragment"),sf=Object.prototype.hasOwnProperty,lf=tf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,of={key:!0,ref:!0,__self:!0,__source:!0};function pd(t,e,n){var r,s={},i=null,l=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)sf.call(e,r)&&!of.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:nf,type:t,key:i,ref:l,props:s,_owner:lf.current}}Yl.Fragment=rf;Yl.jsx=pd;Yl.jsxs=pd;hd.exports=Yl;var d=hd.exports,Go={},fd={exports:{}},Ye={},md={exports:{}},yd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(L,$){var q=L.length;L.push($);e:for(;0<q;){var ae=q-1>>>1,xe=L[ae];if(0<s(xe,$))L[ae]=$,L[q]=xe,q=ae;else break e}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var $=L[0],q=L.pop();if(q!==$){L[0]=q;e:for(var ae=0,xe=L.length,Vi=xe>>>1;ae<Vi;){var jn=2*(ae+1)-1,Co=L[jn],Rn=jn+1,Ki=L[Rn];if(0>s(Co,q))Rn<xe&&0>s(Ki,Co)?(L[ae]=Ki,L[Rn]=q,ae=Rn):(L[ae]=Co,L[jn]=q,ae=jn);else if(Rn<xe&&0>s(Ki,q))L[ae]=Ki,L[Rn]=q,ae=Rn;else break e}}return $}function s(L,$){var q=L.sortIndex-$.sortIndex;return q!==0?q:L.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var a=[],u=[],c=1,m=null,h=3,w=!1,C=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(L){for(var $=n(u);$!==null;){if($.callback===null)r(u);else if($.startTime<=L)r(u),$.sortIndex=$.expirationTime,e(a,$);else break;$=n(u)}}function x(L){if(g=!1,y(L),!C)if(n(a)!==null)C=!0,Fe(N);else{var $=n(u);$!==null&&yt(x,$.startTime-L)}}function N(L,$){C=!1,g&&(g=!1,p(T),T=-1),w=!0;var q=h;try{for(y($),m=n(a);m!==null&&(!(m.expirationTime>$)||L&&!ve());){var ae=m.callback;if(typeof ae=="function"){m.callback=null,h=m.priorityLevel;var xe=ae(m.expirationTime<=$);$=t.unstable_now(),typeof xe=="function"?m.callback=xe:m===n(a)&&r(a),y($)}else r(a);m=n(a)}if(m!==null)var Vi=!0;else{var jn=n(u);jn!==null&&yt(x,jn.startTime-$),Vi=!1}return Vi}finally{m=null,h=q,w=!1}}var b=!1,E=null,T=-1,j=5,F=-1;function ve(){return!(t.unstable_now()-F<j)}function z(){if(E!==null){var L=t.unstable_now();F=L;var $=!0;try{$=E(!0,L)}finally{$?ie():(b=!1,E=null)}}else b=!1}var ie;if(typeof f=="function")ie=function(){f(z)};else if(typeof MessageChannel<"u"){var Te=new MessageChannel,me=Te.port2;Te.port1.onmessage=z,ie=function(){me.postMessage(null)}}else ie=function(){v(z,0)};function Fe(L){E=L,b||(b=!0,ie())}function yt(L,$){T=v(function(){L(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){C||w||(C=!0,Fe(N))},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(a)},t.unstable_next=function(L){switch(h){case 1:case 2:case 3:var $=3;break;default:$=h}var q=h;h=$;try{return L()}finally{h=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,$){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var q=h;h=L;try{return $()}finally{h=q}},t.unstable_scheduleCallback=function(L,$,q){var ae=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ae+q:ae):q=ae,L){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=q+xe,L={id:c++,callback:$,priorityLevel:L,startTime:q,expirationTime:xe,sortIndex:-1},q>ae?(L.sortIndex=q,e(u,L),n(a)===null&&L===n(u)&&(g?(p(T),T=-1):g=!0,yt(x,q-ae))):(L.sortIndex=xe,e(a,L),C||w||(C=!0,Fe(N))),L},t.unstable_shouldYield=ve,t.unstable_wrapCallback=function(L){var $=h;return function(){var q=h;h=$;try{return L.apply(this,arguments)}finally{h=q}}}})(yd);md.exports=yd;var af=md.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uf=O,Je=af;function I(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var wd=new Set,Ei={};function tr(t,e){_s(t,e),_s(t+"Capture",e)}function _s(t,e){for(Ei[t]=e,t=0;t<e.length;t++)wd.add(e[t])}var Wt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ho=Object.prototype.hasOwnProperty,cf=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Yu={},Xu={};function df(t){return Ho.call(Xu,t)?!0:Ho.call(Yu,t)?!1:cf.test(t)?Xu[t]=!0:(Yu[t]=!0,!1)}function hf(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function pf(t,e,n,r){if(e===null||typeof e>"u"||hf(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function De(t,e,n,r,s,i,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=l}var Oe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Oe[t]=new De(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Oe[e]=new De(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Oe[t]=new De(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Oe[t]=new De(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Oe[t]=new De(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Oe[t]=new De(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Oe[t]=new De(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Oe[t]=new De(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Oe[t]=new De(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ja=/[\-:]([a-z])/g;function Ya(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ja,Ya);Oe[e]=new De(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ja,Ya);Oe[e]=new De(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ja,Ya);Oe[e]=new De(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Oe[t]=new De(t,1,!1,t.toLowerCase(),null,!1,!1)});Oe.xlinkHref=new De("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Oe[t]=new De(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xa(t,e,n,r){var s=Oe.hasOwnProperty(e)?Oe[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(pf(e,n,s,r)&&(n=null),r||s===null?df(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var en=uf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gi=Symbol.for("react.element"),or=Symbol.for("react.portal"),ar=Symbol.for("react.fragment"),Za=Symbol.for("react.strict_mode"),Jo=Symbol.for("react.profiler"),gd=Symbol.for("react.provider"),vd=Symbol.for("react.context"),eu=Symbol.for("react.forward_ref"),Yo=Symbol.for("react.suspense"),Xo=Symbol.for("react.suspense_list"),tu=Symbol.for("react.memo"),nn=Symbol.for("react.lazy"),xd=Symbol.for("react.offscreen"),Zu=Symbol.iterator;function Zs(t){return t===null||typeof t!="object"?null:(t=Zu&&t[Zu]||t["@@iterator"],typeof t=="function"?t:null)}var se=Object.assign,So;function oi(t){if(So===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);So=e&&e[1]||""}return`
`+So+t}var Eo=!1;function ko(t,e){if(!t||Eo)return"";Eo=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),l=s.length-1,o=i.length-1;1<=l&&0<=o&&s[l]!==i[o];)o--;for(;1<=l&&0<=o;l--,o--)if(s[l]!==i[o]){if(l!==1||o!==1)do if(l--,o--,0>o||s[l]!==i[o]){var a=`
`+s[l].replace(" at new "," at ");return t.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",t.displayName)),a}while(1<=l&&0<=o);break}}}finally{Eo=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?oi(t):""}function ff(t){switch(t.tag){case 5:return oi(t.type);case 16:return oi("Lazy");case 13:return oi("Suspense");case 19:return oi("SuspenseList");case 0:case 2:case 15:return t=ko(t.type,!1),t;case 11:return t=ko(t.type.render,!1),t;case 1:return t=ko(t.type,!0),t;default:return""}}function Zo(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ar:return"Fragment";case or:return"Portal";case Jo:return"Profiler";case Za:return"StrictMode";case Yo:return"Suspense";case Xo:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case vd:return(t.displayName||"Context")+".Consumer";case gd:return(t._context.displayName||"Context")+".Provider";case eu:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case tu:return e=t.displayName||null,e!==null?e:Zo(t.type)||"Memo";case nn:e=t._payload,t=t._init;try{return Zo(t(e))}catch{}}return null}function mf(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zo(e);case 8:return e===Za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function vn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Cd(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function yf(t){var e=Cd(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(l){r=""+l,i.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Hi(t){t._valueTracker||(t._valueTracker=yf(t))}function Sd(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Cd(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function El(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ea(t,e){var n=e.checked;return se({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ec(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=vn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Ed(t,e){e=e.checked,e!=null&&Xa(t,"checked",e,!1)}function ta(t,e){Ed(t,e);var n=vn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?na(t,e.type,n):e.hasOwnProperty("defaultValue")&&na(t,e.type,vn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tc(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function na(t,e,n){(e!=="number"||El(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ai=Array.isArray;function vr(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+vn(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function ra(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(I(91));return se({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function nc(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(I(92));if(ai(n)){if(1<n.length)throw Error(I(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:vn(n)}}function kd(t,e){var n=vn(e.value),r=vn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function rc(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Td(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sa(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Td(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ji,Nd=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ji=Ji||document.createElement("div"),Ji.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ji.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ki(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var pi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wf=["Webkit","ms","Moz","O"];Object.keys(pi).forEach(function(t){wf.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pi[e]=pi[t]})});function bd(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||pi.hasOwnProperty(t)&&pi[t]?(""+e).trim():e+"px"}function Id(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=bd(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var gf=se({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ia(t,e){if(e){if(gf[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(I(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(I(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(I(61))}if(e.style!=null&&typeof e.style!="object")throw Error(I(62))}}function la(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oa=null;function nu(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var aa=null,xr=null,Cr=null;function sc(t){if(t=Qi(t)){if(typeof aa!="function")throw Error(I(280));var e=t.stateNode;e&&(e=no(e),aa(t.stateNode,t.type,e))}}function Od(t){xr?Cr?Cr.push(t):Cr=[t]:xr=t}function Fd(){if(xr){var t=xr,e=Cr;if(Cr=xr=null,sc(t),e)for(t=0;t<e.length;t++)sc(e[t])}}function Ld(t,e){return t(e)}function Pd(){}var To=!1;function jd(t,e,n){if(To)return t(e,n);To=!0;try{return Ld(t,e,n)}finally{To=!1,(xr!==null||Cr!==null)&&(Pd(),Fd())}}function Ti(t,e){var n=t.stateNode;if(n===null)return null;var r=no(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(I(231,e,typeof n));return n}var ua=!1;if(Wt)try{var ei={};Object.defineProperty(ei,"passive",{get:function(){ua=!0}}),window.addEventListener("test",ei,ei),window.removeEventListener("test",ei,ei)}catch{ua=!1}function vf(t,e,n,r,s,i,l,o,a){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var fi=!1,kl=null,Tl=!1,ca=null,xf={onError:function(t){fi=!0,kl=t}};function Cf(t,e,n,r,s,i,l,o,a){fi=!1,kl=null,vf.apply(xf,arguments)}function Sf(t,e,n,r,s,i,l,o,a){if(Cf.apply(this,arguments),fi){if(fi){var u=kl;fi=!1,kl=null}else throw Error(I(198));Tl||(Tl=!0,ca=u)}}function nr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Rd(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ic(t){if(nr(t)!==t)throw Error(I(188))}function Ef(t){var e=t.alternate;if(!e){if(e=nr(t),e===null)throw Error(I(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return ic(s),t;if(i===r)return ic(s),e;i=i.sibling}throw Error(I(188))}if(n.return!==r.return)n=s,r=i;else{for(var l=!1,o=s.child;o;){if(o===n){l=!0,n=s,r=i;break}if(o===r){l=!0,r=s,n=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===n){l=!0,n=i,r=s;break}if(o===r){l=!0,r=i,n=s;break}o=o.sibling}if(!l)throw Error(I(189))}}if(n.alternate!==r)throw Error(I(190))}if(n.tag!==3)throw Error(I(188));return n.stateNode.current===n?t:e}function Ad(t){return t=Ef(t),t!==null?Md(t):null}function Md(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Md(t);if(e!==null)return e;t=t.sibling}return null}var $d=Je.unstable_scheduleCallback,lc=Je.unstable_cancelCallback,kf=Je.unstable_shouldYield,Tf=Je.unstable_requestPaint,ue=Je.unstable_now,Nf=Je.unstable_getCurrentPriorityLevel,ru=Je.unstable_ImmediatePriority,Dd=Je.unstable_UserBlockingPriority,Nl=Je.unstable_NormalPriority,bf=Je.unstable_LowPriority,_d=Je.unstable_IdlePriority,Xl=null,St=null;function If(t){if(St&&typeof St.onCommitFiberRoot=="function")try{St.onCommitFiberRoot(Xl,t,void 0,(t.current.flags&128)===128)}catch{}}var ht=Math.clz32?Math.clz32:Lf,Of=Math.log,Ff=Math.LN2;function Lf(t){return t>>>=0,t===0?32:31-(Of(t)/Ff|0)|0}var Yi=64,Xi=4194304;function ui(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function bl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,l=n&268435455;if(l!==0){var o=l&~s;o!==0?r=ui(o):(i&=l,i!==0&&(r=ui(i)))}else l=n&~s,l!==0?r=ui(l):i!==0&&(r=ui(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-ht(e),s=1<<n,r|=t[n],e&=~s;return r}function Pf(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jf(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var l=31-ht(i),o=1<<l,a=s[l];a===-1?(!(o&n)||o&r)&&(s[l]=Pf(o,e)):a<=e&&(t.expiredLanes|=o),i&=~o}}function da(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function qd(){var t=Yi;return Yi<<=1,!(Yi&4194240)&&(Yi=64),t}function No(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Bi(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ht(e),t[e]=n}function Rf(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-ht(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function su(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-ht(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var V=0;function Bd(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Ud,iu,Qd,Wd,zd,ha=!1,Zi=[],un=null,cn=null,dn=null,Ni=new Map,bi=new Map,sn=[],Af="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function oc(t,e){switch(t){case"focusin":case"focusout":un=null;break;case"dragenter":case"dragleave":cn=null;break;case"mouseover":case"mouseout":dn=null;break;case"pointerover":case"pointerout":Ni.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":bi.delete(e.pointerId)}}function ti(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Qi(e),e!==null&&iu(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Mf(t,e,n,r,s){switch(e){case"focusin":return un=ti(un,t,e,n,r,s),!0;case"dragenter":return cn=ti(cn,t,e,n,r,s),!0;case"mouseover":return dn=ti(dn,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ni.set(i,ti(Ni.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,bi.set(i,ti(bi.get(i)||null,t,e,n,r,s)),!0}return!1}function Vd(t){var e=$n(t.target);if(e!==null){var n=nr(e);if(n!==null){if(e=n.tag,e===13){if(e=Rd(n),e!==null){t.blockedOn=e,zd(t.priority,function(){Qd(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function dl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=pa(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);oa=r,n.target.dispatchEvent(r),oa=null}else return e=Qi(n),e!==null&&iu(e),t.blockedOn=n,!1;e.shift()}return!0}function ac(t,e,n){dl(t)&&n.delete(e)}function $f(){ha=!1,un!==null&&dl(un)&&(un=null),cn!==null&&dl(cn)&&(cn=null),dn!==null&&dl(dn)&&(dn=null),Ni.forEach(ac),bi.forEach(ac)}function ni(t,e){t.blockedOn===e&&(t.blockedOn=null,ha||(ha=!0,Je.unstable_scheduleCallback(Je.unstable_NormalPriority,$f)))}function Ii(t){function e(s){return ni(s,t)}if(0<Zi.length){ni(Zi[0],t);for(var n=1;n<Zi.length;n++){var r=Zi[n];r.blockedOn===t&&(r.blockedOn=null)}}for(un!==null&&ni(un,t),cn!==null&&ni(cn,t),dn!==null&&ni(dn,t),Ni.forEach(e),bi.forEach(e),n=0;n<sn.length;n++)r=sn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<sn.length&&(n=sn[0],n.blockedOn===null);)Vd(n),n.blockedOn===null&&sn.shift()}var Sr=en.ReactCurrentBatchConfig,Il=!0;function Df(t,e,n,r){var s=V,i=Sr.transition;Sr.transition=null;try{V=1,lu(t,e,n,r)}finally{V=s,Sr.transition=i}}function _f(t,e,n,r){var s=V,i=Sr.transition;Sr.transition=null;try{V=4,lu(t,e,n,r)}finally{V=s,Sr.transition=i}}function lu(t,e,n,r){if(Il){var s=pa(t,e,n,r);if(s===null)Mo(t,e,r,Ol,n),oc(t,r);else if(Mf(s,t,e,n,r))r.stopPropagation();else if(oc(t,r),e&4&&-1<Af.indexOf(t)){for(;s!==null;){var i=Qi(s);if(i!==null&&Ud(i),i=pa(t,e,n,r),i===null&&Mo(t,e,r,Ol,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Mo(t,e,r,null,n)}}var Ol=null;function pa(t,e,n,r){if(Ol=null,t=nu(r),t=$n(t),t!==null)if(e=nr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Rd(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ol=t,null}function Kd(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Nf()){case ru:return 1;case Dd:return 4;case Nl:case bf:return 16;case _d:return 536870912;default:return 16}default:return 16}}var on=null,ou=null,hl=null;function Gd(){if(hl)return hl;var t,e=ou,n=e.length,r,s="value"in on?on.value:on.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var l=n-t;for(r=1;r<=l&&e[n-r]===s[i-r];r++);return hl=s.slice(t,1<r?1-r:void 0)}function pl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function el(){return!0}function uc(){return!1}function Xe(t){function e(n,r,s,i,l){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?el:uc,this.isPropagationStopped=uc,this}return se(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),e}var Js={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},au=Xe(Js),Ui=se({},Js,{view:0,detail:0}),qf=Xe(Ui),bo,Io,ri,Zl=se({},Ui,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uu,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ri&&(ri&&t.type==="mousemove"?(bo=t.screenX-ri.screenX,Io=t.screenY-ri.screenY):Io=bo=0,ri=t),bo)},movementY:function(t){return"movementY"in t?t.movementY:Io}}),cc=Xe(Zl),Bf=se({},Zl,{dataTransfer:0}),Uf=Xe(Bf),Qf=se({},Ui,{relatedTarget:0}),Oo=Xe(Qf),Wf=se({},Js,{animationName:0,elapsedTime:0,pseudoElement:0}),zf=Xe(Wf),Vf=se({},Js,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Kf=Xe(Vf),Gf=se({},Js,{data:0}),dc=Xe(Gf),Hf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xf(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Yf[t])?!!e[t]:!1}function uu(){return Xf}var Zf=se({},Ui,{key:function(t){if(t.key){var e=Hf[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=pl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Jf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uu,charCode:function(t){return t.type==="keypress"?pl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?pl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),em=Xe(Zf),tm=se({},Zl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hc=Xe(tm),nm=se({},Ui,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uu}),rm=Xe(nm),sm=se({},Js,{propertyName:0,elapsedTime:0,pseudoElement:0}),im=Xe(sm),lm=se({},Zl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),om=Xe(lm),am=[9,13,27,32],cu=Wt&&"CompositionEvent"in window,mi=null;Wt&&"documentMode"in document&&(mi=document.documentMode);var um=Wt&&"TextEvent"in window&&!mi,Hd=Wt&&(!cu||mi&&8<mi&&11>=mi),pc=" ",fc=!1;function Jd(t,e){switch(t){case"keyup":return am.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yd(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ur=!1;function cm(t,e){switch(t){case"compositionend":return Yd(e);case"keypress":return e.which!==32?null:(fc=!0,pc);case"textInput":return t=e.data,t===pc&&fc?null:t;default:return null}}function dm(t,e){if(ur)return t==="compositionend"||!cu&&Jd(t,e)?(t=Gd(),hl=ou=on=null,ur=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Hd&&e.locale!=="ko"?null:e.data;default:return null}}var hm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mc(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!hm[t.type]:e==="textarea"}function Xd(t,e,n,r){Od(r),e=Fl(e,"onChange"),0<e.length&&(n=new au("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var yi=null,Oi=null;function pm(t){uh(t,0)}function eo(t){var e=hr(t);if(Sd(e))return t}function fm(t,e){if(t==="change")return e}var Zd=!1;if(Wt){var Fo;if(Wt){var Lo="oninput"in document;if(!Lo){var yc=document.createElement("div");yc.setAttribute("oninput","return;"),Lo=typeof yc.oninput=="function"}Fo=Lo}else Fo=!1;Zd=Fo&&(!document.documentMode||9<document.documentMode)}function wc(){yi&&(yi.detachEvent("onpropertychange",eh),Oi=yi=null)}function eh(t){if(t.propertyName==="value"&&eo(Oi)){var e=[];Xd(e,Oi,t,nu(t)),jd(pm,e)}}function mm(t,e,n){t==="focusin"?(wc(),yi=e,Oi=n,yi.attachEvent("onpropertychange",eh)):t==="focusout"&&wc()}function ym(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return eo(Oi)}function wm(t,e){if(t==="click")return eo(e)}function gm(t,e){if(t==="input"||t==="change")return eo(e)}function vm(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ft=typeof Object.is=="function"?Object.is:vm;function Fi(t,e){if(ft(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Ho.call(e,s)||!ft(t[s],e[s]))return!1}return!0}function gc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function vc(t,e){var n=gc(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=gc(n)}}function th(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?th(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function nh(){for(var t=window,e=El();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=El(t.document)}return e}function du(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function xm(t){var e=nh(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&th(n.ownerDocument.documentElement,n)){if(r!==null&&du(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=vc(n,i);var l=vc(n,r);s&&l&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Cm=Wt&&"documentMode"in document&&11>=document.documentMode,cr=null,fa=null,wi=null,ma=!1;function xc(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ma||cr==null||cr!==El(r)||(r=cr,"selectionStart"in r&&du(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),wi&&Fi(wi,r)||(wi=r,r=Fl(fa,"onSelect"),0<r.length&&(e=new au("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=cr)))}function tl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var dr={animationend:tl("Animation","AnimationEnd"),animationiteration:tl("Animation","AnimationIteration"),animationstart:tl("Animation","AnimationStart"),transitionend:tl("Transition","TransitionEnd")},Po={},rh={};Wt&&(rh=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);function to(t){if(Po[t])return Po[t];if(!dr[t])return t;var e=dr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in rh)return Po[t]=e[n];return t}var sh=to("animationend"),ih=to("animationiteration"),lh=to("animationstart"),oh=to("transitionend"),ah=new Map,Cc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fn(t,e){ah.set(t,e),tr(e,[t])}for(var jo=0;jo<Cc.length;jo++){var Ro=Cc[jo],Sm=Ro.toLowerCase(),Em=Ro[0].toUpperCase()+Ro.slice(1);Fn(Sm,"on"+Em)}Fn(sh,"onAnimationEnd");Fn(ih,"onAnimationIteration");Fn(lh,"onAnimationStart");Fn("dblclick","onDoubleClick");Fn("focusin","onFocus");Fn("focusout","onBlur");Fn(oh,"onTransitionEnd");_s("onMouseEnter",["mouseout","mouseover"]);_s("onMouseLeave",["mouseout","mouseover"]);_s("onPointerEnter",["pointerout","pointerover"]);_s("onPointerLeave",["pointerout","pointerover"]);tr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tr("onBeforeInput",["compositionend","keypress","textInput","paste"]);tr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ci="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),km=new Set("cancel close invalid load scroll toggle".split(" ").concat(ci));function Sc(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Sf(r,e,void 0,t),t.currentTarget=null}function uh(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var l=r.length-1;0<=l;l--){var o=r[l],a=o.instance,u=o.currentTarget;if(o=o.listener,a!==i&&s.isPropagationStopped())break e;Sc(s,o,u),i=a}else for(l=0;l<r.length;l++){if(o=r[l],a=o.instance,u=o.currentTarget,o=o.listener,a!==i&&s.isPropagationStopped())break e;Sc(s,o,u),i=a}}}if(Tl)throw t=ca,Tl=!1,ca=null,t}function J(t,e){var n=e[xa];n===void 0&&(n=e[xa]=new Set);var r=t+"__bubble";n.has(r)||(ch(e,t,2,!1),n.add(r))}function Ao(t,e,n){var r=0;e&&(r|=4),ch(n,t,r,e)}var nl="_reactListening"+Math.random().toString(36).slice(2);function Li(t){if(!t[nl]){t[nl]=!0,wd.forEach(function(n){n!=="selectionchange"&&(km.has(n)||Ao(n,!1,t),Ao(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[nl]||(e[nl]=!0,Ao("selectionchange",!1,e))}}function ch(t,e,n,r){switch(Kd(e)){case 1:var s=Df;break;case 4:s=_f;break;default:s=lu}n=s.bind(null,e,n,t),s=void 0,!ua||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Mo(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(l===4)for(l=r.return;l!==null;){var a=l.tag;if((a===3||a===4)&&(a=l.stateNode.containerInfo,a===s||a.nodeType===8&&a.parentNode===s))return;l=l.return}for(;o!==null;){if(l=$n(o),l===null)return;if(a=l.tag,a===5||a===6){r=i=l;continue e}o=o.parentNode}}r=r.return}jd(function(){var u=i,c=nu(n),m=[];e:{var h=ah.get(t);if(h!==void 0){var w=au,C=t;switch(t){case"keypress":if(pl(n)===0)break e;case"keydown":case"keyup":w=em;break;case"focusin":C="focus",w=Oo;break;case"focusout":C="blur",w=Oo;break;case"beforeblur":case"afterblur":w=Oo;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=cc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=Uf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=rm;break;case sh:case ih:case lh:w=zf;break;case oh:w=im;break;case"scroll":w=qf;break;case"wheel":w=om;break;case"copy":case"cut":case"paste":w=Kf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=hc}var g=(e&4)!==0,v=!g&&t==="scroll",p=g?h!==null?h+"Capture":null:h;g=[];for(var f=u,y;f!==null;){y=f;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,p!==null&&(x=Ti(f,p),x!=null&&g.push(Pi(f,x,y)))),v)break;f=f.return}0<g.length&&(h=new w(h,C,null,n,c),m.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",w=t==="mouseout"||t==="pointerout",h&&n!==oa&&(C=n.relatedTarget||n.fromElement)&&($n(C)||C[zt]))break e;if((w||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,w?(C=n.relatedTarget||n.toElement,w=u,C=C?$n(C):null,C!==null&&(v=nr(C),C!==v||C.tag!==5&&C.tag!==6)&&(C=null)):(w=null,C=u),w!==C)){if(g=cc,x="onMouseLeave",p="onMouseEnter",f="mouse",(t==="pointerout"||t==="pointerover")&&(g=hc,x="onPointerLeave",p="onPointerEnter",f="pointer"),v=w==null?h:hr(w),y=C==null?h:hr(C),h=new g(x,f+"leave",w,n,c),h.target=v,h.relatedTarget=y,x=null,$n(c)===u&&(g=new g(p,f+"enter",C,n,c),g.target=y,g.relatedTarget=v,x=g),v=x,w&&C)t:{for(g=w,p=C,f=0,y=g;y;y=ir(y))f++;for(y=0,x=p;x;x=ir(x))y++;for(;0<f-y;)g=ir(g),f--;for(;0<y-f;)p=ir(p),y--;for(;f--;){if(g===p||p!==null&&g===p.alternate)break t;g=ir(g),p=ir(p)}g=null}else g=null;w!==null&&Ec(m,h,w,g,!1),C!==null&&v!==null&&Ec(m,v,C,g,!0)}}e:{if(h=u?hr(u):window,w=h.nodeName&&h.nodeName.toLowerCase(),w==="select"||w==="input"&&h.type==="file")var N=fm;else if(mc(h))if(Zd)N=gm;else{N=ym;var b=mm}else(w=h.nodeName)&&w.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(N=wm);if(N&&(N=N(t,u))){Xd(m,N,n,c);break e}b&&b(t,h,u),t==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&na(h,"number",h.value)}switch(b=u?hr(u):window,t){case"focusin":(mc(b)||b.contentEditable==="true")&&(cr=b,fa=u,wi=null);break;case"focusout":wi=fa=cr=null;break;case"mousedown":ma=!0;break;case"contextmenu":case"mouseup":case"dragend":ma=!1,xc(m,n,c);break;case"selectionchange":if(Cm)break;case"keydown":case"keyup":xc(m,n,c)}var E;if(cu)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else ur?Jd(t,n)&&(T="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(Hd&&n.locale!=="ko"&&(ur||T!=="onCompositionStart"?T==="onCompositionEnd"&&ur&&(E=Gd()):(on=c,ou="value"in on?on.value:on.textContent,ur=!0)),b=Fl(u,T),0<b.length&&(T=new dc(T,t,null,n,c),m.push({event:T,listeners:b}),E?T.data=E:(E=Yd(n),E!==null&&(T.data=E)))),(E=um?cm(t,n):dm(t,n))&&(u=Fl(u,"onBeforeInput"),0<u.length&&(c=new dc("onBeforeInput","beforeinput",null,n,c),m.push({event:c,listeners:u}),c.data=E))}uh(m,e)})}function Pi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fl(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Ti(t,n),i!=null&&r.unshift(Pi(t,i,s)),i=Ti(t,e),i!=null&&r.push(Pi(t,i,s))),t=t.return}return r}function ir(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ec(t,e,n,r,s){for(var i=e._reactName,l=[];n!==null&&n!==r;){var o=n,a=o.alternate,u=o.stateNode;if(a!==null&&a===r)break;o.tag===5&&u!==null&&(o=u,s?(a=Ti(n,i),a!=null&&l.unshift(Pi(n,a,o))):s||(a=Ti(n,i),a!=null&&l.push(Pi(n,a,o)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var Tm=/\r\n?/g,Nm=/\u0000|\uFFFD/g;function kc(t){return(typeof t=="string"?t:""+t).replace(Tm,`
`).replace(Nm,"")}function rl(t,e,n){if(e=kc(e),kc(t)!==e&&n)throw Error(I(425))}function Ll(){}var ya=null,wa=null;function ga(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var va=typeof setTimeout=="function"?setTimeout:void 0,bm=typeof clearTimeout=="function"?clearTimeout:void 0,Tc=typeof Promise=="function"?Promise:void 0,Im=typeof queueMicrotask=="function"?queueMicrotask:typeof Tc<"u"?function(t){return Tc.resolve(null).then(t).catch(Om)}:va;function Om(t){setTimeout(function(){throw t})}function $o(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Ii(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Ii(e)}function hn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Nc(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ys=Math.random().toString(36).slice(2),xt="__reactFiber$"+Ys,ji="__reactProps$"+Ys,zt="__reactContainer$"+Ys,xa="__reactEvents$"+Ys,Fm="__reactListeners$"+Ys,Lm="__reactHandles$"+Ys;function $n(t){var e=t[xt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[zt]||n[xt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Nc(t);t!==null;){if(n=t[xt])return n;t=Nc(t)}return e}t=n,n=t.parentNode}return null}function Qi(t){return t=t[xt]||t[zt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function hr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(I(33))}function no(t){return t[ji]||null}var Ca=[],pr=-1;function Ln(t){return{current:t}}function Y(t){0>pr||(t.current=Ca[pr],Ca[pr]=null,pr--)}function H(t,e){pr++,Ca[pr]=t.current,t.current=e}var xn={},Re=Ln(xn),Ue=Ln(!1),Wn=xn;function qs(t,e){var n=t.type.contextTypes;if(!n)return xn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Qe(t){return t=t.childContextTypes,t!=null}function Pl(){Y(Ue),Y(Re)}function bc(t,e,n){if(Re.current!==xn)throw Error(I(168));H(Re,e),H(Ue,n)}function dh(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(I(108,mf(t)||"Unknown",s));return se({},n,r)}function jl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||xn,Wn=Re.current,H(Re,t),H(Ue,Ue.current),!0}function Ic(t,e,n){var r=t.stateNode;if(!r)throw Error(I(169));n?(t=dh(t,e,Wn),r.__reactInternalMemoizedMergedChildContext=t,Y(Ue),Y(Re),H(Re,t)):Y(Ue),H(Ue,n)}var jt=null,ro=!1,Do=!1;function hh(t){jt===null?jt=[t]:jt.push(t)}function Pm(t){ro=!0,hh(t)}function Pn(){if(!Do&&jt!==null){Do=!0;var t=0,e=V;try{var n=jt;for(V=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}jt=null,ro=!1}catch(s){throw jt!==null&&(jt=jt.slice(t+1)),$d(ru,Pn),s}finally{V=e,Do=!1}}return null}var fr=[],mr=0,Rl=null,Al=0,Ze=[],et=0,zn=null,At=1,Mt="";function An(t,e){fr[mr++]=Al,fr[mr++]=Rl,Rl=t,Al=e}function ph(t,e,n){Ze[et++]=At,Ze[et++]=Mt,Ze[et++]=zn,zn=t;var r=At;t=Mt;var s=32-ht(r)-1;r&=~(1<<s),n+=1;var i=32-ht(e)+s;if(30<i){var l=s-s%5;i=(r&(1<<l)-1).toString(32),r>>=l,s-=l,At=1<<32-ht(e)+s|n<<s|r,Mt=i+t}else At=1<<i|n<<s|r,Mt=t}function hu(t){t.return!==null&&(An(t,1),ph(t,1,0))}function pu(t){for(;t===Rl;)Rl=fr[--mr],fr[mr]=null,Al=fr[--mr],fr[mr]=null;for(;t===zn;)zn=Ze[--et],Ze[et]=null,Mt=Ze[--et],Ze[et]=null,At=Ze[--et],Ze[et]=null}var He=null,Ke=null,Z=!1,ct=null;function fh(t,e){var n=nt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Oc(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,He=t,Ke=hn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,He=t,Ke=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=zn!==null?{id:At,overflow:Mt}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=nt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,He=t,Ke=null,!0):!1;default:return!1}}function Sa(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ea(t){if(Z){var e=Ke;if(e){var n=e;if(!Oc(t,e)){if(Sa(t))throw Error(I(418));e=hn(n.nextSibling);var r=He;e&&Oc(t,e)?fh(r,n):(t.flags=t.flags&-4097|2,Z=!1,He=t)}}else{if(Sa(t))throw Error(I(418));t.flags=t.flags&-4097|2,Z=!1,He=t}}}function Fc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;He=t}function sl(t){if(t!==He)return!1;if(!Z)return Fc(t),Z=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!ga(t.type,t.memoizedProps)),e&&(e=Ke)){if(Sa(t))throw mh(),Error(I(418));for(;e;)fh(t,e),e=hn(e.nextSibling)}if(Fc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(I(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ke=hn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ke=null}}else Ke=He?hn(t.stateNode.nextSibling):null;return!0}function mh(){for(var t=Ke;t;)t=hn(t.nextSibling)}function Bs(){Ke=He=null,Z=!1}function fu(t){ct===null?ct=[t]:ct.push(t)}var jm=en.ReactCurrentBatchConfig;function si(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(I(309));var r=n.stateNode}if(!r)throw Error(I(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(l){var o=s.refs;l===null?delete o[i]:o[i]=l},e._stringRef=i,e)}if(typeof t!="string")throw Error(I(284));if(!n._owner)throw Error(I(290,t))}return t}function il(t,e){throw t=Object.prototype.toString.call(e),Error(I(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Lc(t){var e=t._init;return e(t._payload)}function yh(t){function e(p,f){if(t){var y=p.deletions;y===null?(p.deletions=[f],p.flags|=16):y.push(f)}}function n(p,f){if(!t)return null;for(;f!==null;)e(p,f),f=f.sibling;return null}function r(p,f){for(p=new Map;f!==null;)f.key!==null?p.set(f.key,f):p.set(f.index,f),f=f.sibling;return p}function s(p,f){return p=yn(p,f),p.index=0,p.sibling=null,p}function i(p,f,y){return p.index=y,t?(y=p.alternate,y!==null?(y=y.index,y<f?(p.flags|=2,f):y):(p.flags|=2,f)):(p.flags|=1048576,f)}function l(p){return t&&p.alternate===null&&(p.flags|=2),p}function o(p,f,y,x){return f===null||f.tag!==6?(f=zo(y,p.mode,x),f.return=p,f):(f=s(f,y),f.return=p,f)}function a(p,f,y,x){var N=y.type;return N===ar?c(p,f,y.props.children,x,y.key):f!==null&&(f.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===nn&&Lc(N)===f.type)?(x=s(f,y.props),x.ref=si(p,f,y),x.return=p,x):(x=xl(y.type,y.key,y.props,null,p.mode,x),x.ref=si(p,f,y),x.return=p,x)}function u(p,f,y,x){return f===null||f.tag!==4||f.stateNode.containerInfo!==y.containerInfo||f.stateNode.implementation!==y.implementation?(f=Vo(y,p.mode,x),f.return=p,f):(f=s(f,y.children||[]),f.return=p,f)}function c(p,f,y,x,N){return f===null||f.tag!==7?(f=Bn(y,p.mode,x,N),f.return=p,f):(f=s(f,y),f.return=p,f)}function m(p,f,y){if(typeof f=="string"&&f!==""||typeof f=="number")return f=zo(""+f,p.mode,y),f.return=p,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case Gi:return y=xl(f.type,f.key,f.props,null,p.mode,y),y.ref=si(p,null,f),y.return=p,y;case or:return f=Vo(f,p.mode,y),f.return=p,f;case nn:var x=f._init;return m(p,x(f._payload),y)}if(ai(f)||Zs(f))return f=Bn(f,p.mode,y,null),f.return=p,f;il(p,f)}return null}function h(p,f,y,x){var N=f!==null?f.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return N!==null?null:o(p,f,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Gi:return y.key===N?a(p,f,y,x):null;case or:return y.key===N?u(p,f,y,x):null;case nn:return N=y._init,h(p,f,N(y._payload),x)}if(ai(y)||Zs(y))return N!==null?null:c(p,f,y,x,null);il(p,y)}return null}function w(p,f,y,x,N){if(typeof x=="string"&&x!==""||typeof x=="number")return p=p.get(y)||null,o(f,p,""+x,N);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Gi:return p=p.get(x.key===null?y:x.key)||null,a(f,p,x,N);case or:return p=p.get(x.key===null?y:x.key)||null,u(f,p,x,N);case nn:var b=x._init;return w(p,f,y,b(x._payload),N)}if(ai(x)||Zs(x))return p=p.get(y)||null,c(f,p,x,N,null);il(f,x)}return null}function C(p,f,y,x){for(var N=null,b=null,E=f,T=f=0,j=null;E!==null&&T<y.length;T++){E.index>T?(j=E,E=null):j=E.sibling;var F=h(p,E,y[T],x);if(F===null){E===null&&(E=j);break}t&&E&&F.alternate===null&&e(p,E),f=i(F,f,T),b===null?N=F:b.sibling=F,b=F,E=j}if(T===y.length)return n(p,E),Z&&An(p,T),N;if(E===null){for(;T<y.length;T++)E=m(p,y[T],x),E!==null&&(f=i(E,f,T),b===null?N=E:b.sibling=E,b=E);return Z&&An(p,T),N}for(E=r(p,E);T<y.length;T++)j=w(E,p,T,y[T],x),j!==null&&(t&&j.alternate!==null&&E.delete(j.key===null?T:j.key),f=i(j,f,T),b===null?N=j:b.sibling=j,b=j);return t&&E.forEach(function(ve){return e(p,ve)}),Z&&An(p,T),N}function g(p,f,y,x){var N=Zs(y);if(typeof N!="function")throw Error(I(150));if(y=N.call(y),y==null)throw Error(I(151));for(var b=N=null,E=f,T=f=0,j=null,F=y.next();E!==null&&!F.done;T++,F=y.next()){E.index>T?(j=E,E=null):j=E.sibling;var ve=h(p,E,F.value,x);if(ve===null){E===null&&(E=j);break}t&&E&&ve.alternate===null&&e(p,E),f=i(ve,f,T),b===null?N=ve:b.sibling=ve,b=ve,E=j}if(F.done)return n(p,E),Z&&An(p,T),N;if(E===null){for(;!F.done;T++,F=y.next())F=m(p,F.value,x),F!==null&&(f=i(F,f,T),b===null?N=F:b.sibling=F,b=F);return Z&&An(p,T),N}for(E=r(p,E);!F.done;T++,F=y.next())F=w(E,p,T,F.value,x),F!==null&&(t&&F.alternate!==null&&E.delete(F.key===null?T:F.key),f=i(F,f,T),b===null?N=F:b.sibling=F,b=F);return t&&E.forEach(function(z){return e(p,z)}),Z&&An(p,T),N}function v(p,f,y,x){if(typeof y=="object"&&y!==null&&y.type===ar&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Gi:e:{for(var N=y.key,b=f;b!==null;){if(b.key===N){if(N=y.type,N===ar){if(b.tag===7){n(p,b.sibling),f=s(b,y.props.children),f.return=p,p=f;break e}}else if(b.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===nn&&Lc(N)===b.type){n(p,b.sibling),f=s(b,y.props),f.ref=si(p,b,y),f.return=p,p=f;break e}n(p,b);break}else e(p,b);b=b.sibling}y.type===ar?(f=Bn(y.props.children,p.mode,x,y.key),f.return=p,p=f):(x=xl(y.type,y.key,y.props,null,p.mode,x),x.ref=si(p,f,y),x.return=p,p=x)}return l(p);case or:e:{for(b=y.key;f!==null;){if(f.key===b)if(f.tag===4&&f.stateNode.containerInfo===y.containerInfo&&f.stateNode.implementation===y.implementation){n(p,f.sibling),f=s(f,y.children||[]),f.return=p,p=f;break e}else{n(p,f);break}else e(p,f);f=f.sibling}f=Vo(y,p.mode,x),f.return=p,p=f}return l(p);case nn:return b=y._init,v(p,f,b(y._payload),x)}if(ai(y))return C(p,f,y,x);if(Zs(y))return g(p,f,y,x);il(p,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,f!==null&&f.tag===6?(n(p,f.sibling),f=s(f,y),f.return=p,p=f):(n(p,f),f=zo(y,p.mode,x),f.return=p,p=f),l(p)):n(p,f)}return v}var Us=yh(!0),wh=yh(!1),Ml=Ln(null),$l=null,yr=null,mu=null;function yu(){mu=yr=$l=null}function wu(t){var e=Ml.current;Y(Ml),t._currentValue=e}function ka(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Er(t,e){$l=t,mu=yr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Be=!0),t.firstContext=null)}function it(t){var e=t._currentValue;if(mu!==t)if(t={context:t,memoizedValue:e,next:null},yr===null){if($l===null)throw Error(I(308));yr=t,$l.dependencies={lanes:0,firstContext:t}}else yr=yr.next=t;return e}var Dn=null;function gu(t){Dn===null?Dn=[t]:Dn.push(t)}function gh(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,gu(e)):(n.next=s.next,s.next=n),e.interleaved=n,Vt(t,r)}function Vt(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var rn=!1;function vu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vh(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _t(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function pn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,W&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Vt(t,n)}return s=r.interleaved,s===null?(e.next=e,gu(r)):(e.next=s.next,s.next=e),r.interleaved=e,Vt(t,n)}function fl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,su(t,n)}}function Pc(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=l:i=i.next=l,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Dl(t,e,n,r){var s=t.updateQueue;rn=!1;var i=s.firstBaseUpdate,l=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var a=o,u=a.next;a.next=null,l===null?i=u:l.next=u,l=a;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==l&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=a))}if(i!==null){var m=s.baseState;l=0,c=u=a=null,o=i;do{var h=o.lane,w=o.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:w,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var C=t,g=o;switch(h=e,w=n,g.tag){case 1:if(C=g.payload,typeof C=="function"){m=C.call(w,m,h);break e}m=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=g.payload,h=typeof C=="function"?C.call(w,m,h):C,h==null)break e;m=se({},m,h);break e;case 2:rn=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[o]:h.push(o))}else w={eventTime:w,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=w,a=m):c=c.next=w,l|=h;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;h=o,o=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(c===null&&(a=m),s.baseState=a,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do l|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Kn|=l,t.lanes=l,t.memoizedState=m}}function jc(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(I(191,s));s.call(r)}}}var Wi={},Et=Ln(Wi),Ri=Ln(Wi),Ai=Ln(Wi);function _n(t){if(t===Wi)throw Error(I(174));return t}function xu(t,e){switch(H(Ai,e),H(Ri,t),H(Et,Wi),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:sa(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=sa(e,t)}Y(Et),H(Et,e)}function Qs(){Y(Et),Y(Ri),Y(Ai)}function xh(t){_n(Ai.current);var e=_n(Et.current),n=sa(e,t.type);e!==n&&(H(Ri,t),H(Et,n))}function Cu(t){Ri.current===t&&(Y(Et),Y(Ri))}var ne=Ln(0);function _l(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _o=[];function Su(){for(var t=0;t<_o.length;t++)_o[t]._workInProgressVersionPrimary=null;_o.length=0}var ml=en.ReactCurrentDispatcher,qo=en.ReactCurrentBatchConfig,Vn=0,re=null,we=null,Ce=null,ql=!1,gi=!1,Mi=0,Rm=0;function Le(){throw Error(I(321))}function Eu(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ft(t[n],e[n]))return!1;return!0}function ku(t,e,n,r,s,i){if(Vn=i,re=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ml.current=t===null||t.memoizedState===null?Dm:_m,t=n(r,s),gi){i=0;do{if(gi=!1,Mi=0,25<=i)throw Error(I(301));i+=1,Ce=we=null,e.updateQueue=null,ml.current=qm,t=n(r,s)}while(gi)}if(ml.current=Bl,e=we!==null&&we.next!==null,Vn=0,Ce=we=re=null,ql=!1,e)throw Error(I(300));return t}function Tu(){var t=Mi!==0;return Mi=0,t}function vt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ce===null?re.memoizedState=Ce=t:Ce=Ce.next=t,Ce}function lt(){if(we===null){var t=re.alternate;t=t!==null?t.memoizedState:null}else t=we.next;var e=Ce===null?re.memoizedState:Ce.next;if(e!==null)Ce=e,we=t;else{if(t===null)throw Error(I(310));we=t,t={memoizedState:we.memoizedState,baseState:we.baseState,baseQueue:we.baseQueue,queue:we.queue,next:null},Ce===null?re.memoizedState=Ce=t:Ce=Ce.next=t}return Ce}function $i(t,e){return typeof e=="function"?e(t):e}function Bo(t){var e=lt(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var r=we,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var l=s.next;s.next=i.next,i.next=l}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=l=null,a=null,u=i;do{var c=u.lane;if((Vn&c)===c)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var m={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(o=a=m,l=r):a=a.next=m,re.lanes|=c,Kn|=c}u=u.next}while(u!==null&&u!==i);a===null?l=r:a.next=o,ft(r,e.memoizedState)||(Be=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=a,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,re.lanes|=i,Kn|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Uo(t){var e=lt(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var l=s=s.next;do i=t(i,l.action),l=l.next;while(l!==s);ft(i,e.memoizedState)||(Be=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Ch(){}function Sh(t,e){var n=re,r=lt(),s=e(),i=!ft(r.memoizedState,s);if(i&&(r.memoizedState=s,Be=!0),r=r.queue,Nu(Th.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Ce!==null&&Ce.memoizedState.tag&1){if(n.flags|=2048,Di(9,kh.bind(null,n,r,s,e),void 0,null),Ee===null)throw Error(I(349));Vn&30||Eh(n,e,s)}return s}function Eh(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=re.updateQueue,e===null?(e={lastEffect:null,stores:null},re.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function kh(t,e,n,r){e.value=n,e.getSnapshot=r,Nh(e)&&bh(t)}function Th(t,e,n){return n(function(){Nh(e)&&bh(t)})}function Nh(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ft(t,n)}catch{return!0}}function bh(t){var e=Vt(t,1);e!==null&&pt(e,t,1,-1)}function Rc(t){var e=vt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$i,lastRenderedState:t},e.queue=t,t=t.dispatch=$m.bind(null,re,t),[e.memoizedState,t]}function Di(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=re.updateQueue,e===null?(e={lastEffect:null,stores:null},re.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Ih(){return lt().memoizedState}function yl(t,e,n,r){var s=vt();re.flags|=t,s.memoizedState=Di(1|e,n,void 0,r===void 0?null:r)}function so(t,e,n,r){var s=lt();r=r===void 0?null:r;var i=void 0;if(we!==null){var l=we.memoizedState;if(i=l.destroy,r!==null&&Eu(r,l.deps)){s.memoizedState=Di(e,n,i,r);return}}re.flags|=t,s.memoizedState=Di(1|e,n,i,r)}function Ac(t,e){return yl(8390656,8,t,e)}function Nu(t,e){return so(2048,8,t,e)}function Oh(t,e){return so(4,2,t,e)}function Fh(t,e){return so(4,4,t,e)}function Lh(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Ph(t,e,n){return n=n!=null?n.concat([t]):null,so(4,4,Lh.bind(null,e,t),n)}function bu(){}function jh(t,e){var n=lt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Eu(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Rh(t,e){var n=lt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Eu(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ah(t,e,n){return Vn&21?(ft(n,e)||(n=qd(),re.lanes|=n,Kn|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Be=!0),t.memoizedState=n)}function Am(t,e){var n=V;V=n!==0&&4>n?n:4,t(!0);var r=qo.transition;qo.transition={};try{t(!1),e()}finally{V=n,qo.transition=r}}function Mh(){return lt().memoizedState}function Mm(t,e,n){var r=mn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},$h(t))Dh(e,n);else if(n=gh(t,e,n,r),n!==null){var s=Me();pt(n,t,r,s),_h(n,e,r)}}function $m(t,e,n){var r=mn(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if($h(t))Dh(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var l=e.lastRenderedState,o=i(l,n);if(s.hasEagerState=!0,s.eagerState=o,ft(o,l)){var a=e.interleaved;a===null?(s.next=s,gu(e)):(s.next=a.next,a.next=s),e.interleaved=s;return}}catch{}finally{}n=gh(t,e,s,r),n!==null&&(s=Me(),pt(n,t,r,s),_h(n,e,r))}}function $h(t){var e=t.alternate;return t===re||e!==null&&e===re}function Dh(t,e){gi=ql=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function _h(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,su(t,n)}}var Bl={readContext:it,useCallback:Le,useContext:Le,useEffect:Le,useImperativeHandle:Le,useInsertionEffect:Le,useLayoutEffect:Le,useMemo:Le,useReducer:Le,useRef:Le,useState:Le,useDebugValue:Le,useDeferredValue:Le,useTransition:Le,useMutableSource:Le,useSyncExternalStore:Le,useId:Le,unstable_isNewReconciler:!1},Dm={readContext:it,useCallback:function(t,e){return vt().memoizedState=[t,e===void 0?null:e],t},useContext:it,useEffect:Ac,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,yl(4194308,4,Lh.bind(null,e,t),n)},useLayoutEffect:function(t,e){return yl(4194308,4,t,e)},useInsertionEffect:function(t,e){return yl(4,2,t,e)},useMemo:function(t,e){var n=vt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=vt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Mm.bind(null,re,t),[r.memoizedState,t]},useRef:function(t){var e=vt();return t={current:t},e.memoizedState=t},useState:Rc,useDebugValue:bu,useDeferredValue:function(t){return vt().memoizedState=t},useTransition:function(){var t=Rc(!1),e=t[0];return t=Am.bind(null,t[1]),vt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=re,s=vt();if(Z){if(n===void 0)throw Error(I(407));n=n()}else{if(n=e(),Ee===null)throw Error(I(349));Vn&30||Eh(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Ac(Th.bind(null,r,i,t),[t]),r.flags|=2048,Di(9,kh.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=vt(),e=Ee.identifierPrefix;if(Z){var n=Mt,r=At;n=(r&~(1<<32-ht(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Mi++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Rm++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_m={readContext:it,useCallback:jh,useContext:it,useEffect:Nu,useImperativeHandle:Ph,useInsertionEffect:Oh,useLayoutEffect:Fh,useMemo:Rh,useReducer:Bo,useRef:Ih,useState:function(){return Bo($i)},useDebugValue:bu,useDeferredValue:function(t){var e=lt();return Ah(e,we.memoizedState,t)},useTransition:function(){var t=Bo($i)[0],e=lt().memoizedState;return[t,e]},useMutableSource:Ch,useSyncExternalStore:Sh,useId:Mh,unstable_isNewReconciler:!1},qm={readContext:it,useCallback:jh,useContext:it,useEffect:Nu,useImperativeHandle:Ph,useInsertionEffect:Oh,useLayoutEffect:Fh,useMemo:Rh,useReducer:Uo,useRef:Ih,useState:function(){return Uo($i)},useDebugValue:bu,useDeferredValue:function(t){var e=lt();return we===null?e.memoizedState=t:Ah(e,we.memoizedState,t)},useTransition:function(){var t=Uo($i)[0],e=lt().memoizedState;return[t,e]},useMutableSource:Ch,useSyncExternalStore:Sh,useId:Mh,unstable_isNewReconciler:!1};function at(t,e){if(t&&t.defaultProps){e=se({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Ta(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:se({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var io={isMounted:function(t){return(t=t._reactInternals)?nr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Me(),s=mn(t),i=_t(r,s);i.payload=e,n!=null&&(i.callback=n),e=pn(t,i,s),e!==null&&(pt(e,t,s,r),fl(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Me(),s=mn(t),i=_t(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=pn(t,i,s),e!==null&&(pt(e,t,s,r),fl(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Me(),r=mn(t),s=_t(n,r);s.tag=2,e!=null&&(s.callback=e),e=pn(t,s,r),e!==null&&(pt(e,t,r,n),fl(e,t,r))}};function Mc(t,e,n,r,s,i,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,l):e.prototype&&e.prototype.isPureReactComponent?!Fi(n,r)||!Fi(s,i):!0}function qh(t,e,n){var r=!1,s=xn,i=e.contextType;return typeof i=="object"&&i!==null?i=it(i):(s=Qe(e)?Wn:Re.current,r=e.contextTypes,i=(r=r!=null)?qs(t,s):xn),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=io,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function $c(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&io.enqueueReplaceState(e,e.state,null)}function Na(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},vu(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=it(i):(i=Qe(e)?Wn:Re.current,s.context=qs(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Ta(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&io.enqueueReplaceState(s,s.state,null),Dl(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ws(t,e){try{var n="",r=e;do n+=ff(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Qo(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ba(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Bm=typeof WeakMap=="function"?WeakMap:Map;function Bh(t,e,n){n=_t(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ql||(Ql=!0,$a=r),ba(t,e)},n}function Uh(t,e,n){n=_t(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){ba(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){ba(t,e),typeof r!="function"&&(fn===null?fn=new Set([this]):fn.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function Dc(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Bm;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=ty.bind(null,t,e,n),e.then(t,t))}function _c(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function qc(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_t(-1,1),e.tag=2,pn(n,e,1))),n.lanes|=1),t)}var Um=en.ReactCurrentOwner,Be=!1;function Ae(t,e,n,r){e.child=t===null?wh(e,null,n,r):Us(e,t.child,n,r)}function Bc(t,e,n,r,s){n=n.render;var i=e.ref;return Er(e,s),r=ku(t,e,n,r,i,s),n=Tu(),t!==null&&!Be?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Kt(t,e,s)):(Z&&n&&hu(e),e.flags|=1,Ae(t,e,r,s),e.child)}function Uc(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Au(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Qh(t,e,i,r,s)):(t=xl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var l=i.memoizedProps;if(n=n.compare,n=n!==null?n:Fi,n(l,r)&&t.ref===e.ref)return Kt(t,e,s)}return e.flags|=1,t=yn(i,r),t.ref=e.ref,t.return=e,e.child=t}function Qh(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Fi(i,r)&&t.ref===e.ref)if(Be=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Be=!0);else return e.lanes=t.lanes,Kt(t,e,s)}return Ia(t,e,n,r,s)}function Wh(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},H(gr,Ve),Ve|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,H(gr,Ve),Ve|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,H(gr,Ve),Ve|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,H(gr,Ve),Ve|=r;return Ae(t,e,s,n),e.child}function zh(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ia(t,e,n,r,s){var i=Qe(n)?Wn:Re.current;return i=qs(e,i),Er(e,s),n=ku(t,e,n,r,i,s),r=Tu(),t!==null&&!Be?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Kt(t,e,s)):(Z&&r&&hu(e),e.flags|=1,Ae(t,e,n,s),e.child)}function Qc(t,e,n,r,s){if(Qe(n)){var i=!0;jl(e)}else i=!1;if(Er(e,s),e.stateNode===null)wl(t,e),qh(e,n,r),Na(e,n,r,s),r=!0;else if(t===null){var l=e.stateNode,o=e.memoizedProps;l.props=o;var a=l.context,u=n.contextType;typeof u=="object"&&u!==null?u=it(u):(u=Qe(n)?Wn:Re.current,u=qs(e,u));var c=n.getDerivedStateFromProps,m=typeof c=="function"||typeof l.getSnapshotBeforeUpdate=="function";m||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==r||a!==u)&&$c(e,l,r,u),rn=!1;var h=e.memoizedState;l.state=h,Dl(e,r,l,s),a=e.memoizedState,o!==r||h!==a||Ue.current||rn?(typeof c=="function"&&(Ta(e,n,c,r),a=e.memoizedState),(o=rn||Mc(e,n,o,r,h,a,u))?(m||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=a),l.props=r,l.state=a,l.context=u,r=o):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{l=e.stateNode,vh(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:at(e.type,o),l.props=u,m=e.pendingProps,h=l.context,a=n.contextType,typeof a=="object"&&a!==null?a=it(a):(a=Qe(n)?Wn:Re.current,a=qs(e,a));var w=n.getDerivedStateFromProps;(c=typeof w=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==m||h!==a)&&$c(e,l,r,a),rn=!1,h=e.memoizedState,l.state=h,Dl(e,r,l,s);var C=e.memoizedState;o!==m||h!==C||Ue.current||rn?(typeof w=="function"&&(Ta(e,n,w,r),C=e.memoizedState),(u=rn||Mc(e,n,u,r,h,C,a)||!1)?(c||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,C,a),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,C,a)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),l.props=r,l.state=C,l.context=a,r=u):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Oa(t,e,n,r,i,s)}function Oa(t,e,n,r,s,i){zh(t,e);var l=(e.flags&128)!==0;if(!r&&!l)return s&&Ic(e,n,!1),Kt(t,e,i);r=e.stateNode,Um.current=e;var o=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&l?(e.child=Us(e,t.child,null,i),e.child=Us(e,null,o,i)):Ae(t,e,o,i),e.memoizedState=r.state,s&&Ic(e,n,!0),e.child}function Vh(t){var e=t.stateNode;e.pendingContext?bc(t,e.pendingContext,e.pendingContext!==e.context):e.context&&bc(t,e.context,!1),xu(t,e.containerInfo)}function Wc(t,e,n,r,s){return Bs(),fu(s),e.flags|=256,Ae(t,e,n,r),e.child}var Fa={dehydrated:null,treeContext:null,retryLane:0};function La(t){return{baseLanes:t,cachePool:null,transitions:null}}function Kh(t,e,n){var r=e.pendingProps,s=ne.current,i=!1,l=(e.flags&128)!==0,o;if((o=l)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),H(ne,s&1),t===null)return Ea(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,t=r.fallback,i?(r=e.mode,i=e.child,l={mode:"hidden",children:l},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=ao(l,r,0,null),t=Bn(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=La(n),e.memoizedState=Fa,t):Iu(e,l));if(s=t.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return Qm(t,e,l,r,o,s,n);if(i){i=r.fallback,l=e.mode,s=t.child,o=s.sibling;var a={mode:"hidden",children:r.children};return!(l&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=a,e.deletions=null):(r=yn(s,a),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=yn(o,i):(i=Bn(i,l,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,l=t.child.memoizedState,l=l===null?La(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=t.childLanes&~n,e.memoizedState=Fa,r}return i=t.child,t=i.sibling,r=yn(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Iu(t,e){return e=ao({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ll(t,e,n,r){return r!==null&&fu(r),Us(e,t.child,null,n),t=Iu(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Qm(t,e,n,r,s,i,l){if(n)return e.flags&256?(e.flags&=-257,r=Qo(Error(I(422))),ll(t,e,l,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=ao({mode:"visible",children:r.children},s,0,null),i=Bn(i,s,l,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Us(e,t.child,null,l),e.child.memoizedState=La(l),e.memoizedState=Fa,i);if(!(e.mode&1))return ll(t,e,l,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(I(419)),r=Qo(i,r,void 0),ll(t,e,l,r)}if(o=(l&t.childLanes)!==0,Be||o){if(r=Ee,r!==null){switch(l&-l){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|l)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Vt(t,s),pt(r,t,s,-1))}return Ru(),r=Qo(Error(I(421))),ll(t,e,l,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=ny.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Ke=hn(s.nextSibling),He=e,Z=!0,ct=null,t!==null&&(Ze[et++]=At,Ze[et++]=Mt,Ze[et++]=zn,At=t.id,Mt=t.overflow,zn=e),e=Iu(e,r.children),e.flags|=4096,e)}function zc(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),ka(t.return,e,n)}function Wo(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Gh(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Ae(t,e,r.children,n),r=ne.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&zc(t,n,e);else if(t.tag===19)zc(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(H(ne,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&_l(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Wo(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&_l(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Wo(e,!0,n,null,i);break;case"together":Wo(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function wl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Kt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Kn|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(I(153));if(e.child!==null){for(t=e.child,n=yn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=yn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Wm(t,e,n){switch(e.tag){case 3:Vh(e),Bs();break;case 5:xh(e);break;case 1:Qe(e.type)&&jl(e);break;case 4:xu(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;H(Ml,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(H(ne,ne.current&1),e.flags|=128,null):n&e.child.childLanes?Kh(t,e,n):(H(ne,ne.current&1),t=Kt(t,e,n),t!==null?t.sibling:null);H(ne,ne.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Gh(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),H(ne,ne.current),r)break;return null;case 22:case 23:return e.lanes=0,Wh(t,e,n)}return Kt(t,e,n)}var Hh,Pa,Jh,Yh;Hh=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Pa=function(){};Jh=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,_n(Et.current);var i=null;switch(n){case"input":s=ea(t,s),r=ea(t,r),i=[];break;case"select":s=se({},s,{value:void 0}),r=se({},r,{value:void 0}),i=[];break;case"textarea":s=ra(t,s),r=ra(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ll)}ia(n,r);var l;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(l in o)o.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ei.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var a=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&a!==o&&(a!=null||o!=null))if(u==="style")if(o){for(l in o)!o.hasOwnProperty(l)||a&&a.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in a)a.hasOwnProperty(l)&&o[l]!==a[l]&&(n||(n={}),n[l]=a[l])}else n||(i||(i=[]),i.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,o=o?o.__html:void 0,a!=null&&o!==a&&(i=i||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(i=i||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ei.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&J("scroll",t),i||o===a||(i=[])):(i=i||[]).push(u,a))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};Yh=function(t,e,n,r){n!==r&&(e.flags|=4)};function ii(t,e){if(!Z)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Pe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function zm(t,e,n){var r=e.pendingProps;switch(pu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pe(e),null;case 1:return Qe(e.type)&&Pl(),Pe(e),null;case 3:return r=e.stateNode,Qs(),Y(Ue),Y(Re),Su(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(sl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ct!==null&&(qa(ct),ct=null))),Pa(t,e),Pe(e),null;case 5:Cu(e);var s=_n(Ai.current);if(n=e.type,t!==null&&e.stateNode!=null)Jh(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(I(166));return Pe(e),null}if(t=_n(Et.current),sl(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[xt]=e,r[ji]=i,t=(e.mode&1)!==0,n){case"dialog":J("cancel",r),J("close",r);break;case"iframe":case"object":case"embed":J("load",r);break;case"video":case"audio":for(s=0;s<ci.length;s++)J(ci[s],r);break;case"source":J("error",r);break;case"img":case"image":case"link":J("error",r),J("load",r);break;case"details":J("toggle",r);break;case"input":ec(r,i),J("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},J("invalid",r);break;case"textarea":nc(r,i),J("invalid",r)}ia(n,i),s=null;for(var l in i)if(i.hasOwnProperty(l)){var o=i[l];l==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&rl(r.textContent,o,t),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&rl(r.textContent,o,t),s=["children",""+o]):Ei.hasOwnProperty(l)&&o!=null&&l==="onScroll"&&J("scroll",r)}switch(n){case"input":Hi(r),tc(r,i,!0);break;case"textarea":Hi(r),rc(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ll)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{l=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Td(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),n==="select"&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[xt]=e,t[ji]=r,Hh(t,e,!1,!1),e.stateNode=t;e:{switch(l=la(n,r),n){case"dialog":J("cancel",t),J("close",t),s=r;break;case"iframe":case"object":case"embed":J("load",t),s=r;break;case"video":case"audio":for(s=0;s<ci.length;s++)J(ci[s],t);s=r;break;case"source":J("error",t),s=r;break;case"img":case"image":case"link":J("error",t),J("load",t),s=r;break;case"details":J("toggle",t),s=r;break;case"input":ec(t,r),s=ea(t,r),J("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=se({},r,{value:void 0}),J("invalid",t);break;case"textarea":nc(t,r),s=ra(t,r),J("invalid",t);break;default:s=r}ia(n,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var a=o[i];i==="style"?Id(t,a):i==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&Nd(t,a)):i==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&ki(t,a):typeof a=="number"&&ki(t,""+a):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ei.hasOwnProperty(i)?a!=null&&i==="onScroll"&&J("scroll",t):a!=null&&Xa(t,i,a,l))}switch(n){case"input":Hi(t),tc(t,r,!1);break;case"textarea":Hi(t),rc(t);break;case"option":r.value!=null&&t.setAttribute("value",""+vn(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?vr(t,!!r.multiple,i,!1):r.defaultValue!=null&&vr(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Ll)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Pe(e),null;case 6:if(t&&e.stateNode!=null)Yh(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(I(166));if(n=_n(Ai.current),_n(Et.current),sl(e)){if(r=e.stateNode,n=e.memoizedProps,r[xt]=e,(i=r.nodeValue!==n)&&(t=He,t!==null))switch(t.tag){case 3:rl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&rl(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[xt]=e,e.stateNode=r}return Pe(e),null;case 13:if(Y(ne),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Z&&Ke!==null&&e.mode&1&&!(e.flags&128))mh(),Bs(),e.flags|=98560,i=!1;else if(i=sl(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(I(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(I(317));i[xt]=e}else Bs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Pe(e),i=!1}else ct!==null&&(qa(ct),ct=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ne.current&1?ge===0&&(ge=3):Ru())),e.updateQueue!==null&&(e.flags|=4),Pe(e),null);case 4:return Qs(),Pa(t,e),t===null&&Li(e.stateNode.containerInfo),Pe(e),null;case 10:return wu(e.type._context),Pe(e),null;case 17:return Qe(e.type)&&Pl(),Pe(e),null;case 19:if(Y(ne),i=e.memoizedState,i===null)return Pe(e),null;if(r=(e.flags&128)!==0,l=i.rendering,l===null)if(r)ii(i,!1);else{if(ge!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=_l(t),l!==null){for(e.flags|=128,ii(i,!1),r=l.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,t=l.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return H(ne,ne.current&1|2),e.child}t=t.sibling}i.tail!==null&&ue()>zs&&(e.flags|=128,r=!0,ii(i,!1),e.lanes=4194304)}else{if(!r)if(t=_l(l),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ii(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!Z)return Pe(e),null}else 2*ue()-i.renderingStartTime>zs&&n!==1073741824&&(e.flags|=128,r=!0,ii(i,!1),e.lanes=4194304);i.isBackwards?(l.sibling=e.child,e.child=l):(n=i.last,n!==null?n.sibling=l:e.child=l,i.last=l)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ue(),e.sibling=null,n=ne.current,H(ne,r?n&1|2:n&1),e):(Pe(e),null);case 22:case 23:return ju(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ve&1073741824&&(Pe(e),e.subtreeFlags&6&&(e.flags|=8192)):Pe(e),null;case 24:return null;case 25:return null}throw Error(I(156,e.tag))}function Vm(t,e){switch(pu(e),e.tag){case 1:return Qe(e.type)&&Pl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Qs(),Y(Ue),Y(Re),Su(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Cu(e),null;case 13:if(Y(ne),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(I(340));Bs()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Y(ne),null;case 4:return Qs(),null;case 10:return wu(e.type._context),null;case 22:case 23:return ju(),null;case 24:return null;default:return null}}var ol=!1,je=!1,Km=typeof WeakSet=="function"?WeakSet:Set,R=null;function wr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){le(t,e,r)}else n.current=null}function ja(t,e,n){try{n()}catch(r){le(t,e,r)}}var Vc=!1;function Gm(t,e){if(ya=Il,t=nh(),du(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var l=0,o=-1,a=-1,u=0,c=0,m=t,h=null;t:for(;;){for(var w;m!==n||s!==0&&m.nodeType!==3||(o=l+s),m!==i||r!==0&&m.nodeType!==3||(a=l+r),m.nodeType===3&&(l+=m.nodeValue.length),(w=m.firstChild)!==null;)h=m,m=w;for(;;){if(m===t)break t;if(h===n&&++u===s&&(o=l),h===i&&++c===r&&(a=l),(w=m.nextSibling)!==null)break;m=h,h=m.parentNode}m=w}n=o===-1||a===-1?null:{start:o,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(wa={focusedElem:t,selectionRange:n},Il=!1,R=e;R!==null;)if(e=R,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,R=t;else for(;R!==null;){e=R;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var g=C.memoizedProps,v=C.memoizedState,p=e.stateNode,f=p.getSnapshotBeforeUpdate(e.elementType===e.type?g:at(e.type,g),v);p.__reactInternalSnapshotBeforeUpdate=f}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(I(163))}}catch(x){le(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,R=t;break}R=e.return}return C=Vc,Vc=!1,C}function vi(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&ja(e,n,i)}s=s.next}while(s!==r)}}function lo(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ra(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Xh(t){var e=t.alternate;e!==null&&(t.alternate=null,Xh(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[xt],delete e[ji],delete e[xa],delete e[Fm],delete e[Lm])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Zh(t){return t.tag===5||t.tag===3||t.tag===4}function Kc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Zh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Aa(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ll));else if(r!==4&&(t=t.child,t!==null))for(Aa(t,e,n),t=t.sibling;t!==null;)Aa(t,e,n),t=t.sibling}function Ma(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ma(t,e,n),t=t.sibling;t!==null;)Ma(t,e,n),t=t.sibling}var Ne=null,ut=!1;function tn(t,e,n){for(n=n.child;n!==null;)ep(t,e,n),n=n.sibling}function ep(t,e,n){if(St&&typeof St.onCommitFiberUnmount=="function")try{St.onCommitFiberUnmount(Xl,n)}catch{}switch(n.tag){case 5:je||wr(n,e);case 6:var r=Ne,s=ut;Ne=null,tn(t,e,n),Ne=r,ut=s,Ne!==null&&(ut?(t=Ne,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ne.removeChild(n.stateNode));break;case 18:Ne!==null&&(ut?(t=Ne,n=n.stateNode,t.nodeType===8?$o(t.parentNode,n):t.nodeType===1&&$o(t,n),Ii(t)):$o(Ne,n.stateNode));break;case 4:r=Ne,s=ut,Ne=n.stateNode.containerInfo,ut=!0,tn(t,e,n),Ne=r,ut=s;break;case 0:case 11:case 14:case 15:if(!je&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&ja(n,e,l),s=s.next}while(s!==r)}tn(t,e,n);break;case 1:if(!je&&(wr(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){le(n,e,o)}tn(t,e,n);break;case 21:tn(t,e,n);break;case 22:n.mode&1?(je=(r=je)||n.memoizedState!==null,tn(t,e,n),je=r):tn(t,e,n);break;default:tn(t,e,n)}}function Gc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Km),e.forEach(function(r){var s=ry.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function ot(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,l=e,o=l;e:for(;o!==null;){switch(o.tag){case 5:Ne=o.stateNode,ut=!1;break e;case 3:Ne=o.stateNode.containerInfo,ut=!0;break e;case 4:Ne=o.stateNode.containerInfo,ut=!0;break e}o=o.return}if(Ne===null)throw Error(I(160));ep(i,l,s),Ne=null,ut=!1;var a=s.alternate;a!==null&&(a.return=null),s.return=null}catch(u){le(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)tp(e,t),e=e.sibling}function tp(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ot(e,t),wt(t),r&4){try{vi(3,t,t.return),lo(3,t)}catch(g){le(t,t.return,g)}try{vi(5,t,t.return)}catch(g){le(t,t.return,g)}}break;case 1:ot(e,t),wt(t),r&512&&n!==null&&wr(n,n.return);break;case 5:if(ot(e,t),wt(t),r&512&&n!==null&&wr(n,n.return),t.flags&32){var s=t.stateNode;try{ki(s,"")}catch(g){le(t,t.return,g)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,l=n!==null?n.memoizedProps:i,o=t.type,a=t.updateQueue;if(t.updateQueue=null,a!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&Ed(s,i),la(o,l);var u=la(o,i);for(l=0;l<a.length;l+=2){var c=a[l],m=a[l+1];c==="style"?Id(s,m):c==="dangerouslySetInnerHTML"?Nd(s,m):c==="children"?ki(s,m):Xa(s,c,m,u)}switch(o){case"input":ta(s,i);break;case"textarea":kd(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var w=i.value;w!=null?vr(s,!!i.multiple,w,!1):h!==!!i.multiple&&(i.defaultValue!=null?vr(s,!!i.multiple,i.defaultValue,!0):vr(s,!!i.multiple,i.multiple?[]:"",!1))}s[ji]=i}catch(g){le(t,t.return,g)}}break;case 6:if(ot(e,t),wt(t),r&4){if(t.stateNode===null)throw Error(I(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(g){le(t,t.return,g)}}break;case 3:if(ot(e,t),wt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ii(e.containerInfo)}catch(g){le(t,t.return,g)}break;case 4:ot(e,t),wt(t);break;case 13:ot(e,t),wt(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Lu=ue())),r&4&&Gc(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(je=(u=je)||c,ot(e,t),je=u):ot(e,t),wt(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(R=t,c=t.child;c!==null;){for(m=R=c;R!==null;){switch(h=R,w=h.child,h.tag){case 0:case 11:case 14:case 15:vi(4,h,h.return);break;case 1:wr(h,h.return);var C=h.stateNode;if(typeof C.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(g){le(r,n,g)}}break;case 5:wr(h,h.return);break;case 22:if(h.memoizedState!==null){Jc(m);continue}}w!==null?(w.return=h,R=w):Jc(m)}c=c.sibling}e:for(c=null,m=t;;){if(m.tag===5){if(c===null){c=m;try{s=m.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=m.stateNode,a=m.memoizedProps.style,l=a!=null&&a.hasOwnProperty("display")?a.display:null,o.style.display=bd("display",l))}catch(g){le(t,t.return,g)}}}else if(m.tag===6){if(c===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(g){le(t,t.return,g)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;c===m&&(c=null),m=m.return}c===m&&(c=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:ot(e,t),wt(t),r&4&&Gc(t);break;case 21:break;default:ot(e,t),wt(t)}}function wt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Zh(n)){var r=n;break e}n=n.return}throw Error(I(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(ki(s,""),r.flags&=-33);var i=Kc(t);Ma(t,i,s);break;case 3:case 4:var l=r.stateNode.containerInfo,o=Kc(t);Aa(t,o,l);break;default:throw Error(I(161))}}catch(a){le(t,t.return,a)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Hm(t,e,n){R=t,np(t)}function np(t,e,n){for(var r=(t.mode&1)!==0;R!==null;){var s=R,i=s.child;if(s.tag===22&&r){var l=s.memoizedState!==null||ol;if(!l){var o=s.alternate,a=o!==null&&o.memoizedState!==null||je;o=ol;var u=je;if(ol=l,(je=a)&&!u)for(R=s;R!==null;)l=R,a=l.child,l.tag===22&&l.memoizedState!==null?Yc(s):a!==null?(a.return=l,R=a):Yc(s);for(;i!==null;)R=i,np(i),i=i.sibling;R=s,ol=o,je=u}Hc(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,R=i):Hc(t)}}function Hc(t){for(;R!==null;){var e=R;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:je||lo(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!je)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:at(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&jc(e,i,r);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}jc(e,l,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var m=c.dehydrated;m!==null&&Ii(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(I(163))}je||e.flags&512&&Ra(e)}catch(h){le(e,e.return,h)}}if(e===t){R=null;break}if(n=e.sibling,n!==null){n.return=e.return,R=n;break}R=e.return}}function Jc(t){for(;R!==null;){var e=R;if(e===t){R=null;break}var n=e.sibling;if(n!==null){n.return=e.return,R=n;break}R=e.return}}function Yc(t){for(;R!==null;){var e=R;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{lo(4,e)}catch(a){le(e,n,a)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(a){le(e,s,a)}}var i=e.return;try{Ra(e)}catch(a){le(e,i,a)}break;case 5:var l=e.return;try{Ra(e)}catch(a){le(e,l,a)}}}catch(a){le(e,e.return,a)}if(e===t){R=null;break}var o=e.sibling;if(o!==null){o.return=e.return,R=o;break}R=e.return}}var Jm=Math.ceil,Ul=en.ReactCurrentDispatcher,Ou=en.ReactCurrentOwner,rt=en.ReactCurrentBatchConfig,W=0,Ee=null,de=null,Ie=0,Ve=0,gr=Ln(0),ge=0,_i=null,Kn=0,oo=0,Fu=0,xi=null,_e=null,Lu=0,zs=1/0,Pt=null,Ql=!1,$a=null,fn=null,al=!1,an=null,Wl=0,Ci=0,Da=null,gl=-1,vl=0;function Me(){return W&6?ue():gl!==-1?gl:gl=ue()}function mn(t){return t.mode&1?W&2&&Ie!==0?Ie&-Ie:jm.transition!==null?(vl===0&&(vl=qd()),vl):(t=V,t!==0||(t=window.event,t=t===void 0?16:Kd(t.type)),t):1}function pt(t,e,n,r){if(50<Ci)throw Ci=0,Da=null,Error(I(185));Bi(t,n,r),(!(W&2)||t!==Ee)&&(t===Ee&&(!(W&2)&&(oo|=n),ge===4&&ln(t,Ie)),We(t,r),n===1&&W===0&&!(e.mode&1)&&(zs=ue()+500,ro&&Pn()))}function We(t,e){var n=t.callbackNode;jf(t,e);var r=bl(t,t===Ee?Ie:0);if(r===0)n!==null&&lc(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&lc(n),e===1)t.tag===0?Pm(Xc.bind(null,t)):hh(Xc.bind(null,t)),Im(function(){!(W&6)&&Pn()}),n=null;else{switch(Bd(r)){case 1:n=ru;break;case 4:n=Dd;break;case 16:n=Nl;break;case 536870912:n=_d;break;default:n=Nl}n=cp(n,rp.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function rp(t,e){if(gl=-1,vl=0,W&6)throw Error(I(327));var n=t.callbackNode;if(kr()&&t.callbackNode!==n)return null;var r=bl(t,t===Ee?Ie:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=zl(t,r);else{e=r;var s=W;W|=2;var i=ip();(Ee!==t||Ie!==e)&&(Pt=null,zs=ue()+500,qn(t,e));do try{Zm();break}catch(o){sp(t,o)}while(!0);yu(),Ul.current=i,W=s,de!==null?e=0:(Ee=null,Ie=0,e=ge)}if(e!==0){if(e===2&&(s=da(t),s!==0&&(r=s,e=_a(t,s))),e===1)throw n=_i,qn(t,0),ln(t,r),We(t,ue()),n;if(e===6)ln(t,r);else{if(s=t.current.alternate,!(r&30)&&!Ym(s)&&(e=zl(t,r),e===2&&(i=da(t),i!==0&&(r=i,e=_a(t,i))),e===1))throw n=_i,qn(t,0),ln(t,r),We(t,ue()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(I(345));case 2:Mn(t,_e,Pt);break;case 3:if(ln(t,r),(r&130023424)===r&&(e=Lu+500-ue(),10<e)){if(bl(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Me(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=va(Mn.bind(null,t,_e,Pt),e);break}Mn(t,_e,Pt);break;case 4:if(ln(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var l=31-ht(r);i=1<<l,l=e[l],l>s&&(s=l),r&=~i}if(r=s,r=ue()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Jm(r/1960))-r,10<r){t.timeoutHandle=va(Mn.bind(null,t,_e,Pt),r);break}Mn(t,_e,Pt);break;case 5:Mn(t,_e,Pt);break;default:throw Error(I(329))}}}return We(t,ue()),t.callbackNode===n?rp.bind(null,t):null}function _a(t,e){var n=xi;return t.current.memoizedState.isDehydrated&&(qn(t,e).flags|=256),t=zl(t,e),t!==2&&(e=_e,_e=n,e!==null&&qa(e)),t}function qa(t){_e===null?_e=t:_e.push.apply(_e,t)}function Ym(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!ft(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ln(t,e){for(e&=~Fu,e&=~oo,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ht(e),r=1<<n;t[n]=-1,e&=~r}}function Xc(t){if(W&6)throw Error(I(327));kr();var e=bl(t,0);if(!(e&1))return We(t,ue()),null;var n=zl(t,e);if(t.tag!==0&&n===2){var r=da(t);r!==0&&(e=r,n=_a(t,r))}if(n===1)throw n=_i,qn(t,0),ln(t,e),We(t,ue()),n;if(n===6)throw Error(I(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Mn(t,_e,Pt),We(t,ue()),null}function Pu(t,e){var n=W;W|=1;try{return t(e)}finally{W=n,W===0&&(zs=ue()+500,ro&&Pn())}}function Gn(t){an!==null&&an.tag===0&&!(W&6)&&kr();var e=W;W|=1;var n=rt.transition,r=V;try{if(rt.transition=null,V=1,t)return t()}finally{V=r,rt.transition=n,W=e,!(W&6)&&Pn()}}function ju(){Ve=gr.current,Y(gr)}function qn(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,bm(n)),de!==null)for(n=de.return;n!==null;){var r=n;switch(pu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Pl();break;case 3:Qs(),Y(Ue),Y(Re),Su();break;case 5:Cu(r);break;case 4:Qs();break;case 13:Y(ne);break;case 19:Y(ne);break;case 10:wu(r.type._context);break;case 22:case 23:ju()}n=n.return}if(Ee=t,de=t=yn(t.current,null),Ie=Ve=e,ge=0,_i=null,Fu=oo=Kn=0,_e=xi=null,Dn!==null){for(e=0;e<Dn.length;e++)if(n=Dn[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var l=i.next;i.next=s,r.next=l}n.pending=r}Dn=null}return t}function sp(t,e){do{var n=de;try{if(yu(),ml.current=Bl,ql){for(var r=re.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ql=!1}if(Vn=0,Ce=we=re=null,gi=!1,Mi=0,Ou.current=null,n===null||n.return===null){ge=1,_i=e,de=null;break}e:{var i=t,l=n.return,o=n,a=e;if(e=Ie,o.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,c=o,m=c.tag;if(!(c.mode&1)&&(m===0||m===11||m===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var w=_c(l);if(w!==null){w.flags&=-257,qc(w,l,o,i,e),w.mode&1&&Dc(i,u,e),e=w,a=u;var C=e.updateQueue;if(C===null){var g=new Set;g.add(a),e.updateQueue=g}else C.add(a);break e}else{if(!(e&1)){Dc(i,u,e),Ru();break e}a=Error(I(426))}}else if(Z&&o.mode&1){var v=_c(l);if(v!==null){!(v.flags&65536)&&(v.flags|=256),qc(v,l,o,i,e),fu(Ws(a,o));break e}}i=a=Ws(a,o),ge!==4&&(ge=2),xi===null?xi=[i]:xi.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var p=Bh(i,a,e);Pc(i,p);break e;case 1:o=a;var f=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof f.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(fn===null||!fn.has(y)))){i.flags|=65536,e&=-e,i.lanes|=e;var x=Uh(i,o,e);Pc(i,x);break e}}i=i.return}while(i!==null)}op(n)}catch(N){e=N,de===n&&n!==null&&(de=n=n.return);continue}break}while(!0)}function ip(){var t=Ul.current;return Ul.current=Bl,t===null?Bl:t}function Ru(){(ge===0||ge===3||ge===2)&&(ge=4),Ee===null||!(Kn&268435455)&&!(oo&268435455)||ln(Ee,Ie)}function zl(t,e){var n=W;W|=2;var r=ip();(Ee!==t||Ie!==e)&&(Pt=null,qn(t,e));do try{Xm();break}catch(s){sp(t,s)}while(!0);if(yu(),W=n,Ul.current=r,de!==null)throw Error(I(261));return Ee=null,Ie=0,ge}function Xm(){for(;de!==null;)lp(de)}function Zm(){for(;de!==null&&!kf();)lp(de)}function lp(t){var e=up(t.alternate,t,Ve);t.memoizedProps=t.pendingProps,e===null?op(t):de=e,Ou.current=null}function op(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Vm(n,e),n!==null){n.flags&=32767,de=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ge=6,de=null;return}}else if(n=zm(n,e,Ve),n!==null){de=n;return}if(e=e.sibling,e!==null){de=e;return}de=e=t}while(e!==null);ge===0&&(ge=5)}function Mn(t,e,n){var r=V,s=rt.transition;try{rt.transition=null,V=1,ey(t,e,n,r)}finally{rt.transition=s,V=r}return null}function ey(t,e,n,r){do kr();while(an!==null);if(W&6)throw Error(I(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(I(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Rf(t,i),t===Ee&&(de=Ee=null,Ie=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||al||(al=!0,cp(Nl,function(){return kr(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=rt.transition,rt.transition=null;var l=V;V=1;var o=W;W|=4,Ou.current=null,Gm(t,n),tp(n,t),xm(wa),Il=!!ya,wa=ya=null,t.current=n,Hm(n),Tf(),W=o,V=l,rt.transition=i}else t.current=n;if(al&&(al=!1,an=t,Wl=s),i=t.pendingLanes,i===0&&(fn=null),If(n.stateNode),We(t,ue()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Ql)throw Ql=!1,t=$a,$a=null,t;return Wl&1&&t.tag!==0&&kr(),i=t.pendingLanes,i&1?t===Da?Ci++:(Ci=0,Da=t):Ci=0,Pn(),null}function kr(){if(an!==null){var t=Bd(Wl),e=rt.transition,n=V;try{if(rt.transition=null,V=16>t?16:t,an===null)var r=!1;else{if(t=an,an=null,Wl=0,W&6)throw Error(I(331));var s=W;for(W|=4,R=t.current;R!==null;){var i=R,l=i.child;if(R.flags&16){var o=i.deletions;if(o!==null){for(var a=0;a<o.length;a++){var u=o[a];for(R=u;R!==null;){var c=R;switch(c.tag){case 0:case 11:case 15:vi(8,c,i)}var m=c.child;if(m!==null)m.return=c,R=m;else for(;R!==null;){c=R;var h=c.sibling,w=c.return;if(Xh(c),c===u){R=null;break}if(h!==null){h.return=w,R=h;break}R=w}}}var C=i.alternate;if(C!==null){var g=C.child;if(g!==null){C.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}R=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,R=l;else e:for(;R!==null;){if(i=R,i.flags&2048)switch(i.tag){case 0:case 11:case 15:vi(9,i,i.return)}var p=i.sibling;if(p!==null){p.return=i.return,R=p;break e}R=i.return}}var f=t.current;for(R=f;R!==null;){l=R;var y=l.child;if(l.subtreeFlags&2064&&y!==null)y.return=l,R=y;else e:for(l=f;R!==null;){if(o=R,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:lo(9,o)}}catch(N){le(o,o.return,N)}if(o===l){R=null;break e}var x=o.sibling;if(x!==null){x.return=o.return,R=x;break e}R=o.return}}if(W=s,Pn(),St&&typeof St.onPostCommitFiberRoot=="function")try{St.onPostCommitFiberRoot(Xl,t)}catch{}r=!0}return r}finally{V=n,rt.transition=e}}return!1}function Zc(t,e,n){e=Ws(n,e),e=Bh(t,e,1),t=pn(t,e,1),e=Me(),t!==null&&(Bi(t,1,e),We(t,e))}function le(t,e,n){if(t.tag===3)Zc(t,t,n);else for(;e!==null;){if(e.tag===3){Zc(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fn===null||!fn.has(r))){t=Ws(n,t),t=Uh(e,t,1),e=pn(e,t,1),t=Me(),e!==null&&(Bi(e,1,t),We(e,t));break}}e=e.return}}function ty(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Me(),t.pingedLanes|=t.suspendedLanes&n,Ee===t&&(Ie&n)===n&&(ge===4||ge===3&&(Ie&130023424)===Ie&&500>ue()-Lu?qn(t,0):Fu|=n),We(t,e)}function ap(t,e){e===0&&(t.mode&1?(e=Xi,Xi<<=1,!(Xi&130023424)&&(Xi=4194304)):e=1);var n=Me();t=Vt(t,e),t!==null&&(Bi(t,e,n),We(t,n))}function ny(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ap(t,n)}function ry(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(I(314))}r!==null&&r.delete(e),ap(t,n)}var up;up=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ue.current)Be=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Be=!1,Wm(t,e,n);Be=!!(t.flags&131072)}else Be=!1,Z&&e.flags&1048576&&ph(e,Al,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;wl(t,e),t=e.pendingProps;var s=qs(e,Re.current);Er(e,n),s=ku(null,e,r,t,s,n);var i=Tu();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(r)?(i=!0,jl(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,vu(e),s.updater=io,e.stateNode=s,s._reactInternals=e,Na(e,r,t,n),e=Oa(null,e,r,!0,i,n)):(e.tag=0,Z&&i&&hu(e),Ae(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(wl(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=iy(r),t=at(r,t),s){case 0:e=Ia(null,e,r,t,n);break e;case 1:e=Qc(null,e,r,t,n);break e;case 11:e=Bc(null,e,r,t,n);break e;case 14:e=Uc(null,e,r,at(r.type,t),n);break e}throw Error(I(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:at(r,s),Ia(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:at(r,s),Qc(t,e,r,s,n);case 3:e:{if(Vh(e),t===null)throw Error(I(387));r=e.pendingProps,i=e.memoizedState,s=i.element,vh(t,e),Dl(e,r,null,n);var l=e.memoizedState;if(r=l.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ws(Error(I(423)),e),e=Wc(t,e,r,n,s);break e}else if(r!==s){s=Ws(Error(I(424)),e),e=Wc(t,e,r,n,s);break e}else for(Ke=hn(e.stateNode.containerInfo.firstChild),He=e,Z=!0,ct=null,n=wh(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Bs(),r===s){e=Kt(t,e,n);break e}Ae(t,e,r,n)}e=e.child}return e;case 5:return xh(e),t===null&&Ea(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,l=s.children,ga(r,s)?l=null:i!==null&&ga(r,i)&&(e.flags|=32),zh(t,e),Ae(t,e,l,n),e.child;case 6:return t===null&&Ea(e),null;case 13:return Kh(t,e,n);case 4:return xu(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Us(e,null,r,n):Ae(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:at(r,s),Bc(t,e,r,s,n);case 7:return Ae(t,e,e.pendingProps,n),e.child;case 8:return Ae(t,e,e.pendingProps.children,n),e.child;case 12:return Ae(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,l=s.value,H(Ml,r._currentValue),r._currentValue=l,i!==null)if(ft(i.value,l)){if(i.children===s.children&&!Ue.current){e=Kt(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){l=i.child;for(var a=o.firstContext;a!==null;){if(a.context===r){if(i.tag===1){a=_t(-1,n&-n),a.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?a.next=a:(a.next=c.next,c.next=a),u.pending=a}}i.lanes|=n,a=i.alternate,a!==null&&(a.lanes|=n),ka(i.return,n,e),o.lanes|=n;break}a=a.next}}else if(i.tag===10)l=i.type===e.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(I(341));l.lanes|=n,o=l.alternate,o!==null&&(o.lanes|=n),ka(l,n,e),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===e){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}Ae(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Er(e,n),s=it(s),r=r(s),e.flags|=1,Ae(t,e,r,n),e.child;case 14:return r=e.type,s=at(r,e.pendingProps),s=at(r.type,s),Uc(t,e,r,s,n);case 15:return Qh(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:at(r,s),wl(t,e),e.tag=1,Qe(r)?(t=!0,jl(e)):t=!1,Er(e,n),qh(e,r,s),Na(e,r,s,n),Oa(null,e,r,!0,t,n);case 19:return Gh(t,e,n);case 22:return Wh(t,e,n)}throw Error(I(156,e.tag))};function cp(t,e){return $d(t,e)}function sy(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nt(t,e,n,r){return new sy(t,e,n,r)}function Au(t){return t=t.prototype,!(!t||!t.isReactComponent)}function iy(t){if(typeof t=="function")return Au(t)?1:0;if(t!=null){if(t=t.$$typeof,t===eu)return 11;if(t===tu)return 14}return 2}function yn(t,e){var n=t.alternate;return n===null?(n=nt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function xl(t,e,n,r,s,i){var l=2;if(r=t,typeof t=="function")Au(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case ar:return Bn(n.children,s,i,e);case Za:l=8,s|=8;break;case Jo:return t=nt(12,n,e,s|2),t.elementType=Jo,t.lanes=i,t;case Yo:return t=nt(13,n,e,s),t.elementType=Yo,t.lanes=i,t;case Xo:return t=nt(19,n,e,s),t.elementType=Xo,t.lanes=i,t;case xd:return ao(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case gd:l=10;break e;case vd:l=9;break e;case eu:l=11;break e;case tu:l=14;break e;case nn:l=16,r=null;break e}throw Error(I(130,t==null?t:typeof t,""))}return e=nt(l,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Bn(t,e,n,r){return t=nt(7,t,r,e),t.lanes=n,t}function ao(t,e,n,r){return t=nt(22,t,r,e),t.elementType=xd,t.lanes=n,t.stateNode={isHidden:!1},t}function zo(t,e,n){return t=nt(6,t,null,e),t.lanes=n,t}function Vo(t,e,n){return e=nt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function ly(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=No(0),this.expirationTimes=No(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=No(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Mu(t,e,n,r,s,i,l,o,a){return t=new ly(t,e,n,o,a),e===1?(e=1,i===!0&&(e|=8)):e=0,i=nt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},vu(i),t}function oy(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:or,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function dp(t){if(!t)return xn;t=t._reactInternals;e:{if(nr(t)!==t||t.tag!==1)throw Error(I(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(I(171))}if(t.tag===1){var n=t.type;if(Qe(n))return dh(t,n,e)}return e}function hp(t,e,n,r,s,i,l,o,a){return t=Mu(n,r,!0,t,s,i,l,o,a),t.context=dp(null),n=t.current,r=Me(),s=mn(n),i=_t(r,s),i.callback=e??null,pn(n,i,s),t.current.lanes=s,Bi(t,s,r),We(t,r),t}function uo(t,e,n,r){var s=e.current,i=Me(),l=mn(s);return n=dp(n),e.context===null?e.context=n:e.pendingContext=n,e=_t(i,l),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=pn(s,e,l),t!==null&&(pt(t,s,l,i),fl(t,s,l)),l}function Vl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ed(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function $u(t,e){ed(t,e),(t=t.alternate)&&ed(t,e)}function ay(){return null}var pp=typeof reportError=="function"?reportError:function(t){console.error(t)};function Du(t){this._internalRoot=t}co.prototype.render=Du.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(I(409));uo(t,e,null,null)};co.prototype.unmount=Du.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Gn(function(){uo(null,t,null,null)}),e[zt]=null}};function co(t){this._internalRoot=t}co.prototype.unstable_scheduleHydration=function(t){if(t){var e=Wd();t={blockedOn:null,target:t,priority:e};for(var n=0;n<sn.length&&e!==0&&e<sn[n].priority;n++);sn.splice(n,0,t),n===0&&Vd(t)}};function _u(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ho(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function td(){}function uy(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=Vl(l);i.call(u)}}var l=hp(e,r,t,0,null,!1,!1,"",td);return t._reactRootContainer=l,t[zt]=l.current,Li(t.nodeType===8?t.parentNode:t),Gn(),l}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=Vl(a);o.call(u)}}var a=Mu(t,0,!1,null,null,!1,!1,"",td);return t._reactRootContainer=a,t[zt]=a.current,Li(t.nodeType===8?t.parentNode:t),Gn(function(){uo(e,a,n,r)}),a}function po(t,e,n,r,s){var i=n._reactRootContainer;if(i){var l=i;if(typeof s=="function"){var o=s;s=function(){var a=Vl(l);o.call(a)}}uo(e,l,t,s)}else l=uy(n,e,t,s,r);return Vl(l)}Ud=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ui(e.pendingLanes);n!==0&&(su(e,n|1),We(e,ue()),!(W&6)&&(zs=ue()+500,Pn()))}break;case 13:Gn(function(){var r=Vt(t,1);if(r!==null){var s=Me();pt(r,t,1,s)}}),$u(t,1)}};iu=function(t){if(t.tag===13){var e=Vt(t,134217728);if(e!==null){var n=Me();pt(e,t,134217728,n)}$u(t,134217728)}};Qd=function(t){if(t.tag===13){var e=mn(t),n=Vt(t,e);if(n!==null){var r=Me();pt(n,t,e,r)}$u(t,e)}};Wd=function(){return V};zd=function(t,e){var n=V;try{return V=t,e()}finally{V=n}};aa=function(t,e,n){switch(e){case"input":if(ta(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=no(r);if(!s)throw Error(I(90));Sd(r),ta(r,s)}}}break;case"textarea":kd(t,n);break;case"select":e=n.value,e!=null&&vr(t,!!n.multiple,e,!1)}};Ld=Pu;Pd=Gn;var cy={usingClientEntryPoint:!1,Events:[Qi,hr,no,Od,Fd,Pu]},li={findFiberByHostInstance:$n,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},dy={bundleType:li.bundleType,version:li.version,rendererPackageName:li.rendererPackageName,rendererConfig:li.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:en.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ad(t),t===null?null:t.stateNode},findFiberByHostInstance:li.findFiberByHostInstance||ay,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ul=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ul.isDisabled&&ul.supportsFiber)try{Xl=ul.inject(dy),St=ul}catch{}}Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cy;Ye.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_u(e))throw Error(I(200));return oy(t,e,null,n)};Ye.createRoot=function(t,e){if(!_u(t))throw Error(I(299));var n=!1,r="",s=pp;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Mu(t,1,!1,null,null,n,!1,r,s),t[zt]=e.current,Li(t.nodeType===8?t.parentNode:t),new Du(e)};Ye.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(I(188)):(t=Object.keys(t).join(","),Error(I(268,t)));return t=Ad(e),t=t===null?null:t.stateNode,t};Ye.flushSync=function(t){return Gn(t)};Ye.hydrate=function(t,e,n){if(!ho(e))throw Error(I(200));return po(null,t,e,!0,n)};Ye.hydrateRoot=function(t,e,n){if(!_u(t))throw Error(I(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",l=pp;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=hp(e,null,t,1,n??null,s,!1,i,l),t[zt]=e.current,Li(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new co(e)};Ye.render=function(t,e,n){if(!ho(e))throw Error(I(200));return po(null,t,e,!1,n)};Ye.unmountComponentAtNode=function(t){if(!ho(t))throw Error(I(40));return t._reactRootContainer?(Gn(function(){po(null,null,t,!1,function(){t._reactRootContainer=null,t[zt]=null})}),!0):!1};Ye.unstable_batchedUpdates=Pu;Ye.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ho(n))throw Error(I(200));if(t==null||t._reactInternals===void 0)throw Error(I(38));return po(t,e,n,!1,r)};Ye.version="18.3.1-next-f1338f8080-20240426";function fp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fp)}catch(t){console.error(t)}}fp(),fd.exports=Ye;var hy=fd.exports,nd=hy;Go.createRoot=nd.createRoot,Go.hydrateRoot=nd.hydrateRoot;var P=class{constructor(){this.comments=null}getKind(){return this.constructor.kind}accept(t){return t.visit(this)}toSqlString(t){return this.accept(t)}},Tr,qu=(Tr=class extends P{constructor(e){super(),this.insertClause=e.insertClause,this.selectQuery=e.selectQuery??null}},Tr.kind=Symbol("InsertQuery"),Tr),Nr,Hn=(Nr=class extends P{constructor(e){super(),this.selectQuery=e}},Nr.kind=Symbol("InlineQuery"),Nr),br,ke=(br=class extends P{constructor(e){super(),this.values=e}},br.kind=Symbol("ValueList"),br),Ir,_=(Ir=class extends P{get namespaces(){return this.qualifiedName.namespaces}get column(){return this.qualifiedName.name instanceof D?this.qualifiedName.name:new D(this.qualifiedName.name.value)}constructor(e,n){super();let r=typeof n=="string"?new D(n):n;this.qualifiedName=new It(wp(e),r)}toString(){return this.qualifiedName.toString()}getNamespace(){return this.qualifiedName.namespaces?this.qualifiedName.namespaces.map(e=>e.name).join("."):""}},Ir.kind=Symbol("ColumnReference"),Ir),Or,he=(Or=class extends P{constructor(e,n,r,s,i=null){super(),this.qualifiedName=new It(e,n),this.argument=r,this.over=s,this.withinGroup=i}get namespaces(){return this.qualifiedName.namespaces}get name(){return this.qualifiedName.name}},Or.kind=Symbol("FunctionCall"),Or),mp=(t=>(t.Rows="rows",t.Range="range",t.Groups="groups",t))(mp||{}),yp=(t=>(t.UnboundedPreceding="unbounded preceding",t.UnboundedFollowing="unbounded following",t.CurrentRow="current row",t))(yp||{}),Fr,Bu=(Fr=class extends P{constructor(e){super(),this.bound=e}},Fr.kind=Symbol("WindowFrameStaticBound"),Fr),Lr,Uu=(Lr=class extends P{constructor(e,n){super(),this.value=e,this.isFollowing=n}},Lr.kind=Symbol("WindowFrameBoundary"),Lr),Pr,Vs=(Pr=class extends P{constructor(e,n,r){super(),this.frameType=e,this.startBound=n,this.endBound=r}},Pr.kind=Symbol("WindowFrameSpec"),Pr),jr,Jn=(jr=class extends P{constructor(e,n,r=null){super(),this.partition=e,this.order=n,this.frameSpec=r}},jr.kind=Symbol("WindowFrameExpression"),jr),Rr,Nt=(Rr=class extends P{constructor(e,n){super(),this.operator=new K(e),this.expression=n}},Rr.kind=Symbol("UnaryExpression"),Rr),Ar,A=(Ar=class extends P{constructor(e,n,r){super(),this.left=e,this.operator=new K(n),this.right=r}},Ar.kind=Symbol("BinaryExpression"),Ar),Mr,be=(Mr=class extends P{constructor(e,n){super(),this.value=e,this.isDollarString=n}},Mr.kind=Symbol("LiteralExpression"),Mr),$r,M=($r=class extends P{constructor(e,n=null){super(),this.name=new K(e),this.value=n,this.index=null}},$r.kind=Symbol("ParameterExpression"),$r),Dr,Cn=(Dr=class extends P{constructor(e,n=null){super(),this.cases=e,this.elseValue=n}},Dr.kind=Symbol("SwitchCaseArgument"),Dr),_r,Sn=(_r=class extends P{constructor(e,n){super(),this.key=e,this.value=n}},_r.kind=Symbol("CaseKeyValuePair"),_r),qr,K=(qr=class extends P{constructor(e){super(),this.value=e}},qr.kind=Symbol("RawString"),qr),Br,D=(Br=class extends P{constructor(e){super(),this.name=e}},Br.kind=Symbol("IdentifierString"),Br),Ur,qe=(Ur=class extends P{constructor(e){super(),this.expression=e}},Ur.kind=Symbol("ParenExpression"),Ur),Qr,Gt=(Qr=class extends P{constructor(e,n){super(),this.input=e,this.castType=n}},Qr.kind=Symbol("CastExpression"),Qr),Wr,bt=(Wr=class extends P{constructor(e,n){super(),this.condition=e,this.switchCase=n}},Wr.kind=Symbol("CaseExpression"),Wr),zr,En=(zr=class extends P{constructor(e){super(),this.expression=e}},zr.kind=Symbol("ArrayExpression"),zr),Vr,kn=(Vr=class extends P{constructor(e){super(),this.query=e}},Vr.kind=Symbol("ArrayQueryExpression"),Vr),Kr,Tn=(Kr=class extends P{constructor(e,n,r,s){super(),this.expression=e,this.lower=n,this.upper=r,this.negated=s}},Kr.kind=Symbol("BetweenExpression"),Kr),Gr,Xs=(Gr=class extends P{constructor(e,n){super(),this.specifier=new K(e),this.value=new be(n)}},Gr.kind=Symbol("StringSpecifierExpression"),Gr),Hr,Ht=(Hr=class extends P{constructor(e,n,r=null){super(),this.qualifiedName=new It(e,n),this.argument=r}get namespaces(){return this.qualifiedName.namespaces}get name(){return this.qualifiedName.name}getTypeName(){let e=this.qualifiedName.name instanceof K?this.qualifiedName.name.value:this.qualifiedName.name.name;return this.qualifiedName.namespaces&&this.qualifiedName.namespaces.length>0?this.qualifiedName.namespaces.map(n=>n.name).join(".")+"."+e:e}},Hr.kind=Symbol("TypeValue"),Hr),Jr,Jt=(Jr=class extends P{constructor(e){super(),this.values=e}},Jr.kind=Symbol("TupleExpression"),Jr),Yr,fo=(Yr=class extends P{constructor(e,n,r){super(),this.array=e,this.startIndex=n,this.endIndex=r}},Yr.kind=Symbol("ArraySliceExpression"),Yr),Xr,mo=(Xr=class extends P{constructor(e,n){super(),this.array=e,this.index=n}},Xr.kind=Symbol("ArrayIndexExpression"),Xr);function wp(t){if(t==null)return null;if(typeof t=="string")return t.trim()===""?null:[new D(t)];if(Array.isArray(t)){if(t.length===0)return null;if(typeof t[0]=="string"){let e=t.filter(n=>n.trim()!=="");return e.length===0?null:e.map(n=>new D(n))}else{let e=t.filter(n=>n.name.trim()!=="");return e.length===0?null:e}}return null}var Zr,It=(Zr=class extends P{constructor(e,n){super(),this.namespaces=wp(e),typeof n=="string"?this.name=new K(n):this.name=n}toString(){let e=this.name instanceof K?this.name.value:this.name.name;return this.namespaces&&this.namespaces.length>0?this.namespaces.map(n=>n.name).join(".")+"."+e:e}},Zr.kind=Symbol("QualifiedName"),Zr),es,ce=(es=class extends P{constructor(e,n=null){super(),this.value=e,this.identifier=n?new D(n):null}},es.kind=Symbol("SelectItem"),es),ts,Se=(ts=class extends P{constructor(e,n=null,r=[]){super(),this.items=e,this.distinct=n,this.hints=r}},ts.kind=Symbol("SelectClause"),ts),ns,gp=(ns=class extends P{constructor(){super()}},ns.kind=Symbol("Distinct"),ns),rs,vp=(rs=class extends P{constructor(e){super(),this.value=e}},rs.kind=Symbol("DistinctOn"),rs),ss,Yt=(ss=class extends P{constructor(e){super(),this.condition=e}},ss.kind=Symbol("WhereClause"),ss),is,Yn=(is=class extends P{constructor(e){super(),this.value=e}},is.kind=Symbol("PartitionByClause"),is),ls,Xn=(ls=class extends P{constructor(e,n){super(),this.name=new D(e),this.expression=n}},ls.kind=Symbol("WindowFrameClause"),ls),os,Qu=(os=class extends P{constructor(e){super(),this.windows=e}},os.kind=Symbol("WindowsClause"),os),as,Nn=(as=class extends P{constructor(e){super(),this.order=e}},as.kind=Symbol("OrderByClause"),as),us,Zn=(us=class extends P{constructor(e,n,r){super(),this.value=e,this.sortDirection=n===null?"asc":n,this.nullsPosition=r}},us.kind=Symbol("OrderByItem"),us),cs,bn=(cs=class extends P{constructor(e){super(),this.grouping=e}},cs.kind=Symbol("GroupByClause"),cs),ds,In=(ds=class extends P{constructor(e){super(),this.condition=e}},ds.kind=Symbol("HavingClause"),ds),hs,ee=(hs=class extends P{get namespaces(){return this.qualifiedName.namespaces}get table(){return this.qualifiedName.name instanceof D?this.qualifiedName.name:new D(this.qualifiedName.name.value)}get identifier(){return this.table}constructor(e,n){super();let r=typeof n=="string"?new D(n):n;this.qualifiedName=new It(e,r)}getSourceName(){return this.qualifiedName.namespaces&&this.qualifiedName.namespaces.length>0?this.qualifiedName.namespaces.map(e=>e.name).join(".")+"."+(this.qualifiedName.name instanceof K?this.qualifiedName.name.value:this.qualifiedName.name.name):this.qualifiedName.name instanceof K?this.qualifiedName.name.value:this.qualifiedName.name.name}},hs.kind=Symbol("TableSource"),hs),ps,yo=(ps=class extends P{constructor(e,n){if(super(),typeof e=="object"&&e!==null&&"name"in e){let r=e;this.qualifiedName=new It(r.namespaces,r.name)}else this.qualifiedName=new It(null,e);this.argument=n}get namespaces(){return this.qualifiedName.namespaces}get name(){return this.qualifiedName.name}},ps.kind=Symbol("FunctionSource"),ps),fs,Ks=(fs=class extends P{constructor(e){super(),this.source=e}},fs.kind=Symbol("ParenSource"),fs),ms,$e=(ms=class extends P{constructor(e){super(),this.query=e}},ms.kind=Symbol("SubQuerySource"),ms),ys,te=(ys=class extends P{constructor(e,n){super(),this.datasource=e,this.aliasExpression=n}getAliasName(){return this.aliasExpression?this.aliasExpression.table.name:this.datasource instanceof ee?this.datasource.getSourceName():null}},ys.kind=Symbol("SourceExpression"),ys),ws,On=(ws=class extends P{constructor(e){super(),this.condition=e}},ws.kind=Symbol("JoinOnClause"),ws),gs,er=(gs=class extends P{constructor(e){super(),this.condition=e}},gs.kind=Symbol("JoinUsingClause"),gs),vs,qt=(vs=class extends P{constructor(e,n,r,s){super(),this.joinType=new K(e),this.source=n,this.condition=r,this.lateral=s}getSourceAliasName(){return this.source.aliasExpression?this.source.aliasExpression.table.name:this.source instanceof ee?this.source.table.name:null}},vs.kind=Symbol("JoinItem"),vs),xs,pe=(xs=class extends P{constructor(e,n){super(),this.source=e,this.joins=n}getSourceAliasName(){return this.source.aliasExpression?this.source.aliasExpression.table.name:this.source.datasource instanceof ee?this.source.datasource.table.name:null}getSources(){let e=[this.source];if(this.joins)for(let n of this.joins)e.push(n.source);return e}},xs.kind=Symbol("FromClause"),xs),Cs,st=(Cs=class extends P{constructor(e,n,r){super(),this.query=e,this.materialized=r,typeof n=="string"?this.aliasExpression=new ze(n,null):this.aliasExpression=n}getSourceAliasName(){return this.aliasExpression.table.name}},Cs.kind=Symbol("CommonTable"),Cs),Ss,Ot=(Ss=class extends P{constructor(e,n){super(),this.recursive=e,this.tables=n}},Ss.kind=Symbol("WithClause"),Ss),Es,Xt=(Es=class extends P{constructor(e){super(),this.value=e}},Es.kind=Symbol("LimitClause"),Es),ks,zi=(ks=class extends P{constructor(e){super(),this.value=e}},ks.kind=Symbol("OffsetClause"),ks),Ts,wo=(Ts=class extends P{constructor(e){super(),this.expression=e}},Ts.kind=Symbol("FetchClause"),Ts),Ns,Ba=(Ns=class extends P{constructor(e,n,r){super(),this.type=e,this.count=n,this.unit=r}},Ns.kind=Symbol("FetchExpression"),Ns),bs,Gs=(bs=class extends P{constructor(e){super(),this.lockMode=e}},bs.kind=Symbol("ForClause"),bs),Is,ze=(Is=class extends P{constructor(e,n){super(),this.table=new D(e),this.columns=n!==null?n.map(r=>new D(r)):null}},Is.kind=Symbol("SourceAliasExpression"),Is),Os,py=(Os=class extends P{constructor(e){super(),this.columns=e.map(n=>typeof n=="string"?new D(n):n)}},Os.kind=Symbol("ReturningClause"),Os),Fs,Kl=(Fs=class extends P{constructor(e){super(),this.items=e.map(n=>n instanceof Gl?n:new Gl(n.column,n.value))}},Fs.kind=Symbol("SetClause"),Fs),Ls,Gl=(Ls=class extends P{constructor(e,n){if(super(),typeof e=="object"&&e!==null&&"column"in e){let r=e,s=typeof r.column=="string"?new D(r.column):r.column;this.qualifiedName=new It(r.namespaces,s)}else{let r=typeof e=="string"?new D(e):e;this.qualifiedName=new It(null,r)}this.value=n}get namespaces(){return this.qualifiedName.namespaces}get column(){return this.qualifiedName.name instanceof D?this.qualifiedName.name:new D(this.qualifiedName.name.value)}getFullName(){return this.qualifiedName.toString()}},Ls.kind=Symbol("SetClauseItem"),Ls),Ps,xp=(Ps=class extends P{constructor(e){super(),this.source=e}getSourceAliasName(){return this.source.aliasExpression?this.source.aliasExpression.table.name:this.source.datasource instanceof ee?this.source.datasource.table.name:null}},Ps.kind=Symbol("UpdateClause"),Ps),Cp=class extends P{constructor(t,e){super(),this.source=t,this.columns=e.map(n=>new D(n))}},Wu=(t=>(t[t.None=0]="None",t[t.Literal=1]="Literal",t[t.Operator=2]="Operator",t[t.OpenParen=4]="OpenParen",t[t.CloseParen=8]="CloseParen",t[t.Comma=16]="Comma",t[t.Dot=32]="Dot",t[t.Identifier=64]="Identifier",t[t.Command=128]="Command",t[t.Parameter=256]="Parameter",t[t.OpenBracket=512]="OpenBracket",t[t.CloseBracket=1024]="CloseBracket",t[t.Function=2048]="Function",t[t.StringSpecifier=4096]="StringSpecifier",t[t.Type=8192]="Type",t))(Wu||{}),ye=class{static isWhitespace(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e===32||e===9||e===10||e===13}static isDigit(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e>=48&&e<=57}static isHexChar(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70}static isOperatorSymbol(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e===43||e===45||e===42||e===47||e===37||e===126||e===64||e===35||e===94||e===38||e===58||e===33||e===60||e===62||e===61||e===124||e===63}static isDelimiter(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e===46||e===44||e===40||e===41||e===91||e===93||e===123||e===125||e===59||e===32||e===9||e===10||e===13?!0:e===43||e===45||e===42||e===47||e===37||e===126||e===64||e===35||e===94||e===38||e===58||e===33||e===60||e===62||e===61||e===124||e===63}static isNamedParameterPrefix(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e===64||e===58||e===36}},dt=class di{static getDebugPositionInfo(e,n){let r=Math.max(0,n-5),s=Math.min(e.length,n+5),i=e.slice(r,s),l=" ".repeat(n-r)+"^";return`${i}
${l}`}static skipWhiteSpace(e,n){let r=e.length;for(;n+4<=r&&e.slice(n,n+4)==="    ";)n+=4;for(;n<r;){let s=e.charCodeAt(n);if(s!==32&&s!==9&&s!==10&&s!==13)break;n++}return n}static readLineComment(e,n){if(n+1>=e.length)return{newPosition:n,comment:null};if(e.charCodeAt(n)===45&&e.charCodeAt(n+1)===45){let r=n;for(n+=2;n<e.length&&e.charCodeAt(n)!==10;)n++;let s=e.slice(r+2,n).trim();return{newPosition:n,comment:s}}return{newPosition:n,comment:null}}static readBlockComment(e,n){if(n+3>=e.length)return{newPosition:n,comments:null};if(e.charCodeAt(n)===47&&e.charCodeAt(n+1)===42&&e.charCodeAt(n+2)!==43){let r=n;for(n+=2;n+1<e.length;){if(e.charCodeAt(n)===42&&e.charCodeAt(n+1)===47){n+=2;let s=e.slice(r+2,n-2).replace(/\r/g,"").split(`
`);for(let i=0;i<s.length;i++)s[i]=s[i].trim();for(;s.length>0&&s[0]==="";)s.shift();for(;s.length>0&&s[s.length-1]==="";)s.pop();return{newPosition:n,comments:s}}n++}throw new Error(`Block comment is not closed. position: ${n}`)}return{newPosition:n,comments:null}}static readWhiteSpaceAndComment(e,n){let r=[],s=e.length;for(;n<s;){let i=n;if(n=di.skipWhiteSpace(e,n),n!==i)continue;let l=e.charCodeAt(n);if(l===45){let o=di.readLineComment(e,n);if(o.newPosition!==n){n=o.newPosition,o.comment&&r.push(o.comment.trim());continue}}else if(l===47){let o=di.readBlockComment(e,n);if(o.newPosition!==n){n=o.newPosition,o.comments&&r.push(...o.comments);continue}}break}return{position:n,lines:r}}static readRegularIdentifier(e,n){let r=this.tryReadRegularIdentifier(e,n);if(!r)throw new Error(`Unexpected character. position: ${n}
${di.getDebugPositionInfo(e,n)}`);return r}static tryReadRegularIdentifier(e,n){let r=n;for(;n<e.length&&!ye.isDelimiter(e[n]);)n++;if(r===n)return null;for(;n+1<e.length&&e[n]==="["&&e[n+1]==="]";){let s=e.slice(0,r).trim();if(s===""||/[)]$/.test(s)||/\b(select|from|where|and|or|set|values|insert|update|delete)\s*$/i.test(s))break;n+=2}return{identifier:e.slice(r,n),newPosition:n}}},Lt=class{constructor(t,e=0){this.input=t,this.position=e}getPosition(){return this.position}setPosition(t){this.position=t}isEndOfInput(t=0){return this.position+t>=this.input.length}canRead(t=0){return!this.isEndOfInput(t)}read(t){if(this.isEndOfInput())throw new Error(`Unexpected character. expect: ${t}, actual: EndOfInput, position: ${this.position}`);let e=this.input[this.position];if(e!==t)throw new Error(`Unexpected character. expect: ${t}, actual: ${e}, position: ${this.position}`);return this.position++,e}createLexeme(t,e,n=null,r,s){let i={type:t,value:t===128||t===2||t===2048?e.toLowerCase():e,comments:n};return r!==void 0&&s!==void 0&&(i.position={startPosition:r,endPosition:s}),i}createLexemeWithPosition(t,e,n,r=null){return this.createLexeme(t,e,r,n,n+e.length)}getDebugPositionInfo(t){return dt.getDebugPositionInfo(this.input,t)}},fy=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=this.input[this.position];if(e==="*")return this.position++,this.createLexeme(64,e);let n=dt.readRegularIdentifier(this.input,this.position);return this.position=n.newPosition,this.createLexeme(64,n.identifier)}},rr=class{constructor(t){this.trie=t}isEndOfInput(t,e,n=0){return e+n>=t.length}canParse(t,e,n=0){return!this.isEndOfInput(t,e,n)}parse(t,e){if(this.isEndOfInput(t,e))return null;this.trie.reset();let n=dt.tryReadRegularIdentifier(t,e);if(n===null)return null;let r=this.trie.pushLexeme(n.identifier.toLowerCase());if(r===0)return null;if(r===3)return{keyword:n.identifier,newPosition:n.newPosition};let s=n.identifier;if(e=dt.readWhiteSpaceAndComment(t,n.newPosition).position,this.isEndOfInput(t,e))return r===2?{keyword:s,newPosition:e}:null;for(;this.canParse(t,e);){let i=r,l=dt.tryReadRegularIdentifier(t,e);if(l!==null){if(r=this.trie.pushLexeme(l.identifier.toLowerCase()),r===0){if(i===2)break;return null}if(s+=" "+l.identifier,e=dt.readWhiteSpaceAndComment(t,l.newPosition).position,r===3)break}else{if(i===2)break;return null}}return{keyword:s,newPosition:e}}},sr=class{constructor(t){this.root=new Map,this.hasEndProperty=!1,this.hasMoreProperties=!1;for(let e of t)this.addKeyword(e);this.currentNode=this.root}addKeyword(t){let e=this.root;for(let n of t)e.has(n)||e.set(n,new Map),e=e.get(n);e.set("__end__",!0)}reset(){this.currentNode=this.root,this.hasEndProperty=!1,this.hasMoreProperties=!1}pushLexeme(t){return this.currentNode.has(t)?(this.currentNode=this.currentNode.get(t),this.hasEndProperty=this.currentNode.has("__end__"),this.hasMoreProperties=this.currentNode.size>(this.hasEndProperty?1:0),this.hasEndProperty&&!this.hasMoreProperties?3:this.hasEndProperty&&this.hasMoreProperties?2:1):0}},my=[["null"],["true"],["false"],["current_date"],["current_time"],["current_timestamp"],["localtime"],["localtimestamp"],["unbounded"],["normalized"],["nfc","normalized"],["nfd","normalized"],["nfkc","normalized"],["nfkd","normalized"],["nfc"],["nfd"],["nfkc"],["nfkd"]],yy=new sr(my),Sp=new rr(yy),wy=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=this.input[this.position],n=this.tryReadKeyword();if(n)return n;if(e==="."&&this.canRead(1)&&ye.isDigit(this.input[this.position+1]))return this.createLexeme(1,this.readDigit());if(e==="'"){let r=this.readSingleQuotedString(!1);return this.createLexeme(1,r)}if(ye.isDigit(e))return this.createLexeme(1,this.readDigit());if(e==="$"&&this.isDollarQuotedString())return this.createLexeme(1,this.readDollarQuotedString());if(e==="$"&&this.canRead(1)&&ye.isDigit(this.input[this.position+1])){let r=this.position+1,s=!1;for(;r<this.input.length&&(ye.isDigit(this.input[r])||this.input[r]===","||this.input[r]===".");){if(this.input[r]==="."||this.input[r]===","){s=!0;break}r++}if(s){this.position,this.position++;let i=this.readMoneyDigit();return this.createLexeme(1,"$"+i)}}if((e==="+"||e==="-")&&this.determineSignOrOperator(t)==="sign"){let r=e;this.position++;let s=this.position;for(;this.canRead()&&ye.isWhitespace(this.input[this.position]);)this.position++;if(this.canRead()&&(ye.isDigit(this.input[this.position])||this.input[this.position]==="."&&this.canRead(1)&&ye.isDigit(this.input[this.position+1])))return this.createLexeme(1,r==="-"?r+this.readDigit():this.readDigit());this.position=s-1}return null}tryReadKeyword(){let t=Sp.parse(this.input,this.position);return t?(this.position=t.newPosition,this.createLexeme(1,t.keyword)):null}determineSignOrOperator(t){return t===null?"sign":t.type&1||t.type&64||t.type&256||t.type&8?"operator":"sign"}readDigit(){let t=this.position,e=!1,n=!1;if(this.canRead(1)&&this.input[this.position]==="0"&&"xbo".includes(this.input[this.position+1].toLowerCase())){let r=this.input[this.position+1].toLowerCase();this.position+=2;let s=r==="x";for(;this.canRead();){let i=this.input[this.position];if(ye.isDigit(i)||s&&ye.isHexChar(i))this.position++;else break}return this.input.slice(t,this.position)}for(this.input[t]==="."&&(e=!0,this.position++);this.canRead();){let r=this.input[this.position];if(r==="."&&!e)e=!0;else if((r==="e"||r==="E")&&!n)n=!0,this.canRead(1)&&(this.input[this.position+1]==="+"||this.input[this.position+1]==="-")&&this.position++;else if(!ye.isDigit(r))break;this.position++}if(t===this.position)throw new Error(`Unexpected character. position: ${t}
${this.getDebugPositionInfo(t)}`);return this.input[t]==="."?"0"+this.input.slice(t,this.position):this.input.slice(t,this.position)}readMoneyDigit(){let t=this.position,e=!1;for(;this.canRead();){let n=this.input[this.position];if(n==="."&&!e)e=!0;else if(!(n===","&&!e)&&!ye.isDigit(n))break;this.position++}if(t===this.position)throw new Error(`Unexpected character. position: ${t}
${this.getDebugPositionInfo(t)}`);return this.input.slice(t,this.position)}readSingleQuotedString(t){let e=this.position,n=!1;for(this.read("'");this.canRead();){let r=this.input[this.position];if(this.position++,r==="\\"&&this.canRead(1)){this.position++;continue}else if(r==="'"){n=!0;break}}if(n===!1)throw new Error(`Single quote is not closed. position: ${e}
${this.getDebugPositionInfo(e)}`);return t?this.input.slice(e,this.position):this.input.slice(e+1,this.position-1)}isDollarQuotedString(){if(!this.canRead(1))return!1;if(this.input[this.position+1]==="$")return!0;let t=this.position+1;for(;t<this.input.length;){let e=this.input[t];if(e==="$")return!0;if(!this.isAlphanumeric(e)&&e!=="_")return!1;t++}return!1}readDollarQuotedString(){let t=this.position;this.position++;let e="";for(;this.canRead()&&this.input[this.position]!=="$";)e+=this.input[this.position],this.position++;if(!this.canRead())throw new Error(`Unexpected end of input while reading dollar-quoted string tag at position ${t}`);this.position++;let n="$"+e+"$",r=n,s="";for(;this.canRead();){if(this.input.substring(this.position,this.position+r.length)===r)return this.position+=r.length,n+s+r;s+=this.input[this.position],this.position++}throw new Error(`Unclosed dollar-quoted string starting at position ${t}. Expected closing tag: ${r}`)}isAlphanumeric(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}},gy=class extends Lt{constructor(t){super(t)}tryRead(t){if(this.isEndOfInput())return null;if(this.canRead(1)&&this.input[this.position]==="$"&&this.input[this.position+1]==="{"){this.position+=2;let n=this.position;for(;this.canRead()&&this.input[this.position]!=="}";)this.position++;if(this.isEndOfInput())throw new Error(`Unexpected end of input. Expected closing '}' for parameter at position ${n}`);let r=this.input.slice(n,this.position);if(r.length===0)throw new Error("Empty parameter name is not allowed: found ${} at position "+(n-2));return this.position++,this.createLexeme(256,"${"+r+"}")}let e=this.input[this.position];if(ye.isNamedParameterPrefix(e)){if(this.canRead(1)&&ye.isOperatorSymbol(this.input[this.position+1])||e===":"&&this.isInArraySliceContext()||e==="$"&&this.isDollarQuotedString())return null;if(e==="$"&&this.canRead(1)&&ye.isDigit(this.input[this.position+1])){let s=this.position+1,i=!1;for(;s<this.input.length&&(ye.isDigit(this.input[s])||this.input[s]===","||this.input[s]===".");){if(this.input[s]==="."||this.input[s]===","){i=!0;break}s++}if(i)return null}this.position++;let n=this.position;for(;this.canRead()&&!ye.isDelimiter(this.input[this.position]);)this.position++;let r=this.input.slice(n,this.position);return this.createLexeme(256,e+r)}if(e==="?"){if(this.canRead(1)){let n=this.input[this.position+1];if(n==="|"||n==="&")return null}return t&&(t.type&64||t.type&1)?null:(this.position++,this.createLexeme(256,e))}return null}isInArraySliceContext(){let t=this.position-1,e=0;for(;t>=0;){let n=this.input[t];if(n==="]")e++;else if(n==="["&&(e--,e<0)){if(t>0){let r=this.input[t-1];if(/[a-zA-Z0-9_)\]]/.test(r))return!0}if(t===0)return!1;break}t--}return!1}isDollarQuotedString(){if(!this.canRead(1))return!1;if(this.input[this.position+1]==="$")return!0;let t=this.position+1;for(;t<this.input.length;){let e=this.input[t];if(e==="$")return!0;if(!this.isAlphanumeric(e)&&e!=="_")return!1;t++}return!1}isAlphanumeric(t){if(t.length!==1)return!1;let e=t.charCodeAt(0);return e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122}},gn,vy=(gn=class extends Lt{tryRead(e){if(this.isEndOfInput())return null;let n=this.input[this.position];return n in gn.SPECIAL_SYMBOL_TOKENS?(this.position++,this.createLexeme(gn.SPECIAL_SYMBOL_TOKENS[n],n)):null}},gn.SPECIAL_SYMBOL_TOKENS={".":32,",":16,"(":4,")":8,"[":512,"]":1024},gn),xy=class{constructor(t,e=0){this.cacheHits=0,this.cacheMisses=0,this.input=t,this.position=e,this.readers=[],this.tokenCache=new Map}register(t){return this.readers.push(t),this}registerAll(t){return t.forEach(e=>this.register(e)),this}setPosition(t){this.position=t;for(let e of this.readers)e.setPosition(t)}tryRead(t,e){if(this.tokenCache.has(t))return this.cacheHits++,this.tokenCache.get(t)||null;this.cacheMisses++,this.setPosition(t);let n=null;for(let r of this.readers)if(n=r.tryRead(e),n){this.position=r.getPosition();break}for(let r of this.readers)r.setPosition(this.position);return this.tokenCache.set(t,n),n}getMaxPosition(){let t=this.position;for(let e of this.readers){let n=e.getPosition();n>t&&(t=n)}return t}getInput(){return this.input}getCacheStats(){let t=this.cacheHits+this.cacheMisses,e=t>0?this.cacheHits/t:0;return{hits:this.cacheHits,misses:this.cacheMisses,ratio:e}}},Cy=new sr([["and"],["or"],["is"],["is","not"],["is","distinct","from"],["is","not","distinct","from"],["like"],["ilike"],["in"],["exists"],["between"],["not","like"],["not","ilike"],["not","in"],["not","exists"],["not","between"],["escape"],["uescape"],["similar","to"],["not","similar","to"],["similar"],["placing"],["rlike"],["regexp"],["mod"],["xor"],["not"],["both"],["leading"],["trailing"],["both","from"],["leading","from"],["trailing","from"],["year","from"],["month","from"],["day","from"],["hour","from"],["minute","from"],["second","from"],["dow","from"],["doy","from"],["isodow","from"],["quarter","from"],["week","from"],["epoch","from"],["at","time","zone"]]),Sy=new sr([["date"],["time"],["timestamp"],["timestamptz"],["timetz"],["interval"],["boolean"],["integer"],["bigint"],["smallint"],["numeric"],["decimal"],["real"],["double","precision"],["double","precision"],["character","varying"],["time","without","time","zone"],["time","with","time","zone"],["timestamp","without","time","zone"],["timestamp","with","time","zone"]]),Ey=new rr(Cy),ky=new rr(Sy),Ty=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=this.input[this.position];if(ye.isOperatorSymbol(e)){let r=this.position;for(;this.canRead()&&ye.isOperatorSymbol(this.input[this.position]);){if(this.canRead(1)){let i=this.input[this.position];if(i==="-"&&this.input[this.position+1]==="-"||i==="/"&&this.input[this.position+1]==="*")break}this.position++}let s=this.input.slice(r,this.position);return this.createLexeme(2,s)}let n=ky.parse(this.input,this.position);return n!==null?(this.position=n.newPosition,this.createLexeme(8258,n.keyword)):(n=Ey.parse(this.input,this.position),n!==null?(this.position=n.newPosition,this.createLexeme(2,n.keyword)):null)}},Ny=new sr([["join"],["inner","join"],["cross","join"],["left","join"],["left","outer","join"],["right","join"],["right","outer","join"],["full","join"],["full","outer","join"],["natural","join"],["natural","inner","join"],["natural","left","join"],["natural","left","outer","join"],["natural","right","join"],["natural","right","outer","join"],["natural","full","join"],["natural","full","outer","join"]]),by=new sr([["with"],["recursive"],["materialized"],["not","materialized"],["select"],["from"],["distinct"],["distinct","on"],["where"],["group","by"],["having"],["order","by"],["limit"],["offset"],["fetch"],["first"],["next"],["row"],["row","only"],["rows","only"],["percent"],["percent","with","ties"],["for"],["update"],["share"],["key","share"],["no","key","update"],["union"],["union","all"],["intersect"],["intersect","all"],["except"],["except","all"],["beteen"],["window"],["over"],["partition","by"],["range"],["rows"],["groups"],["within","group"],["current","row"],["unbounded","preceding"],["unbounded","following"],["preceding"],["following"],["on"],["using"],["lateral"],["case"],["case","when"],["when"],["then"],["else"],["end"],["insert","into"],["update"],["delete","from"],["merge","into"],["matched"],["not","matched"],["update","set"],["do","nothing"],["values"],["set"],["returning"],["create","table"],["create","temporary","table"],["tablesample"],["as"],["asc"],["desc"],["nulls","first"],["nulls","last"]]),Iy=new rr(by),Ep=new rr(Ny),Oy=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=Ep.parse(this.input,this.position);if(e!==null)return this.position=e.newPosition,this.createLexeme(128,e.keyword);let n=Iy.parse(this.input,this.position);if(n!==null)return this.position=n.newPosition,this.createLexeme(128,n.keyword);if(this.canRead(2)&&this.input[this.position]==="/"&&this.input[this.position+1]==="*"&&this.input[this.position+2]==="+"){this.position+=3;let r=this.position;for(;this.position+1<this.input.length;){if(this.input[this.position]==="*"&&this.input[this.position+1]==="/")return this.position+=2,this.createLexeme(128,"/*+ "+this.input.slice(r,this.position-2).trim()+" */");this.position++}throw new Error(`Block comment is not closed. position: ${this.position}`)}return null}},Fy=new Set(["e'","E'","x'","X'","b'","B'"]),Ly=new Set(["u&'","U&'"]),Py=class extends Lt{tryRead(t){let e=this.position;return this.canRead(1)&&Fy.has(this.input.slice(e,e+2))?(this.position+=1,this.createLexeme(4096,this.input.slice(e,this.position))):this.canRead(2)&&Ly.has(this.input.slice(e,e+3))?(this.position+=2,this.createLexeme(4096,this.input.slice(e,this.position))):null}},jy=new sr([["grouping","sets"],["array"]]),Ry=new rr(jy),Ay=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=Ry.parse(this.input,this.position);if(e!==null)return this.position=e.newPosition,this.createLexeme(2048,e.keyword);let n=dt.tryReadRegularIdentifier(this.input,this.position);if(!n)return null;this.position=n.newPosition;var r=dt.readWhiteSpaceAndComment(this.input,this.position).position-this.position;return this.canRead(r)&&this.input[this.position+r]==="("?this.createLexeme(2048,n.identifier):null}},My=new sr([["double","precision"],["character","varying"],["time","without","time","zone"],["time","with","time","zone"],["timestamp","without","time","zone"],["timestamp","with","time","zone"]]),$y=new rr(My),Dy=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=$y.parse(this.input,this.position);if(e!==null)return this.position=e.newPosition,this.createLexeme(8192,e.keyword);if(t===null)return null;let n=dt.tryReadRegularIdentifier(this.input,this.position);return n?(this.position=n.newPosition,t.type&128&&t.value==="as"?this.createLexeme(8256,n.identifier):t.type&2&&t.value==="::"?this.createLexeme(8192,n.identifier):null):null}},_y=class extends Lt{tryRead(t){if(this.isEndOfInput())return null;let e=this.input[this.position];if(e==="`"){let n=this.readEscapedIdentifier("`");return this.createLexeme(64,n)}if(e==='"'){let n=this.readEscapedIdentifier('"');return this.createLexeme(64,n)}if(e==="["&&this.isSqlServerBracketIdentifier(t)){let n=this.readEscapedIdentifier("]");return this.createLexeme(64,n)}return null}isSqlServerBracketIdentifier(t){if((t==null?void 0:t.value)==="array")return!1;let e=this.position+1,n=e;for(;n<this.input.length&&this.input[n]!=="]";){let s=this.input[n];if(s===":"||s===","||s==="+"||s==="-"||s==="*"||s==="/"||s==="("||s===")")return!1;n++}if(n>=this.input.length)return!1;let r=this.input.slice(e,n).trim();return r===""?!1:/^[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z_][a-zA-Z0-9_]*)*$/.test(r)}readEscapedIdentifier(t){let e=this.position;for(this.position++;this.canRead()&&this.input[this.position]!==t;)this.position++;if(e===this.position)throw new Error(`Closing delimiter is not found. position: ${e}, delimiter: ${t}
${this.getDebugPositionInfo(e)}`);return this.position++,this.input.slice(e+1,this.position-1)}},oe=class{constructor(t){this.input=t,this.position=0,this.readerManager=new xy(t).register(new _y(t)).register(new gy(t)).register(new Py(t)).register(new wy(t)).register(new vy(t)).register(new Oy(t)).register(new Ty(t)).register(new Dy(t)).register(new Ay(t)).register(new fy(t))}isEndOfInput(t=0){return this.position+t>=this.input.length}canRead(t=0){return!this.isEndOfInput(t)}readLexmes(){let t=Math.ceil(this.input.length/8),e=new Array(t),n=0,r=this.readComment(),s=r.lines;this.position=r.position;let i=null;for(;this.canRead()&&this.input[this.position]!==";";){let l=this.readerManager.tryRead(this.position,i);if(l===null)throw new Error(`Unexpected character. actual: ${this.input[this.position]}, position: ${this.position}
${this.getDebugPositionInfo(this.position)}`);this.position=this.readerManager.getMaxPosition();let o=this.readComment();this.position=o.position,l.type&16||l.type&2?o.lines.length>0&&s.push(...o.lines):((s.length>0||o.lines.length>0)&&this.addCommentsToToken(l,s,o.lines),s=[]),e[n++]=l,i=l}if(s.length>0&&n>0){let l=e[n-1];l.comments===null&&(l.comments=[]),l.comments.push(...s)}return n===t?e:e.slice(0,n)}addPendingCommentsToLastToken(t,e){if(e.length>0&&t.length>0){let n=t[t.length-1];n.comments===null&&(n.comments=[]),n.comments.push(...e)}}addCommentsToToken(t,e,n){(e.length>0||n.length>0)&&(t.comments===null&&(t.comments=[]),e.length>0&&t.comments.unshift(...e),n.length>0&&t.comments.push(...n))}readComment(){return dt.readWhiteSpaceAndComment(this.input,this.position)}getDebugPositionInfo(t){return dt.getDebugPositionInfo(this.input,t)}},Bt=class Ua{static parseFromLexeme(e,n){let{identifiers:r,newIndex:s}=Ua.parseEscapedOrDotSeparatedIdentifiers(e,n),{namespaces:i,name:l}=Ua.extractNamespacesAndName(r),o=0;return s>n&&(o=e[s-1].type),{namespaces:i,name:new D(l),newIndex:s,lastTokenType:o}}static parse(e){let n=new oe(e).readLexmes(),r=this.parseFromLexeme(n,0);if(r.newIndex<n.length)throw new Error(`Syntax error: Unexpected token "${n[r.newIndex].value}" at position ${r.newIndex}. The name is complete but additional tokens were found.`);return{namespaces:r.namespaces,name:r.name}}static parseEscapedOrDotSeparatedIdentifiers(e,n){let r=n,s=[];for(;r<e.length;){if(e[r].type&512){if(r++,r>=e.length||!(e[r].type&64||e[r].type&128))throw new Error(`Expected identifier after '[' at position ${r}`);if(s.push(e[r].value),r++,r>=e.length||e[r].value!=="]")throw new Error(`Expected closing ']' after identifier at position ${r}`);r++}else if(e[r].type&64)s.push(e[r].value),r++;else if(e[r].type&2048)s.push(e[r].value),r++;else if(e[r].type&8192)s.push(e[r].value),r++;else if(e[r].value==="*"){s.push(e[r].value),r++;break}if(r<e.length&&e[r].type&32)r++;else break}return{identifiers:s,newIndex:r}}static extractNamespacesAndName(e){if(!e||e.length===0)throw new Error("Identifier list is empty");return e.length===1?{namespaces:null,name:e[0]}:{namespaces:e.slice(0,-1),name:e[e.length-1]}}},qy=class{static parseFromLexeme(t,e){let{namespaces:n,name:r,newIndex:s}=Bt.parseFromLexeme(t,e);return{value:new _(n,r),newIndex:s}}},rd=class{static parseFromLexeme(t,e){let n=e,r=t[n].value,s,i=Sp.parse(r.toLowerCase(),0);if(i){let l=new K(i.keyword);return n++,{value:l,newIndex:n}}if(/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(r))return s=Number(r),n++,{value:new be(s),newIndex:n};{let l=/^\$[^$]*\$[\s\S]*\$[^$]*\$$/.test(r);return l?s=r:r.startsWith("'")&&r.endsWith("'")?s=r.slice(1,-1):s=r,n++,{value:new be(s,l),newIndex:n}}}},By=class{static parseFromLexeme(t,e){let n=e;if(n+1<t.length&&t[n].type&4&&(t[n+1].value==="select"||t[n+1].value==="values"||t[n+1].value==="with")){n+=1;let r=Q.parseFromLexeme(t,n);if(n=r.newIndex,n>=t.length||t[n].type!==8)throw new Error(`Expected ')' at index ${n}, but found ${t[n].value}`);return n++,{value:new Hn(r.value),newIndex:n}}else{let r=U.parseArgument(4,8,t,e);return n=r.newIndex,{value:new qe(r.value),newIndex:n}}}},Uy=class{static parseFromLexeme(t,e){let n=e;if(n<t.length&&t[n].type&2){let r=t[n].value;if(n++,r==="*")return{value:new _(null,"*"),newIndex:n};let s=U.parseFromLexeme(t,n);return n=s.newIndex,{value:new Nt(r,s.value),newIndex:n}}throw new Error(`Invalid unary expression at index ${e}: ${t[e].value}`)}},Qy=class{static parseFromLexeme(t,e){let n=e,r=t[n].value;r.startsWith("${")&&r.endsWith("}")?r=r.slice(2,-1):r=r.slice(1);let s=new M(r);return n++,{value:s,newIndex:n}}},Wy=class{static parseFromLexeme(t,e){let n=e,r=t[n].value;if(n++,n>=t.length||t[n].type!==1)throw new Error(`Expected string literal after string specifier at index ${n}`);let s=t[n].value;return n++,{value:new Xs(r,s),newIndex:n}}},zy=class{static parseFromLexeme(t,e){let n=e,r=t[n];return r.value==="case"?(n++,this.parseCaseExpression(t,n)):r.value==="case when"?(n++,this.parseCaseWhenExpression(t,n)):this.parseModifierUnaryExpression(t,n)}static parseModifierUnaryExpression(t,e){let n=e;if(n<t.length&&t[n].type&128){let r=t[n].value;n++;let s=U.parseFromLexeme(t,n);return{value:new Nt(r,s.value),newIndex:s.newIndex}}throw new Error(`Invalid modifier unary expression at index ${n}, Lexeme: ${t[n].value}`)}static parseCaseExpression(t,e){let n=e,r=U.parseFromLexeme(t,n);n=r.newIndex;let s=this.parseSwitchCaseArgument(t,n,[]);return n=s.newIndex,{value:new bt(r.value,s.value),newIndex:n}}static parseCaseWhenExpression(t,e){let n=e,r=this.parseCaseConditionValuePair(t,n);n=r.newIndex;let s=[r.value],i=this.parseSwitchCaseArgument(t,n,s);return n=i.newIndex,{value:new bt(null,i.value),newIndex:n}}static parseSwitchCaseArgument(t,e,n){let r=e,s=[...n],i=null;for(;r<t.length&&this.isCommandWithValue(t[r],"when");){r++;let l=this.parseCaseConditionValuePair(t,r);r=l.newIndex,s.push(l.value)}if(r<t.length&&this.isCommandWithValue(t[r],"else")){r++;let l=U.parseFromLexeme(t,r);i=l.value,r=l.newIndex}if(r<t.length&&this.isCommandWithValue(t[r],"end"))r++;else throw new Error(`The CASE expression requires 'end' keyword at the end (index ${r})`);if(s.length===0)throw new Error(`The CASE expression requires at least one WHEN clause (index ${r})`);return{value:new Cn(s,i),newIndex:r}}static isCommandWithValue(t,e){return(t.type&128)!==0&&t.value===e}static parseCaseConditionValuePair(t,e){let n=e,r=U.parseFromLexeme(t,n);if(n=r.newIndex,n>=t.length||!(t[n].type&128)||t[n].value!=="then")throw new Error(`Expected 'then' after WHEN condition at index ${n}`);n++;let s=U.parseFromLexeme(t,n);return n=s.newIndex,{value:new Sn(r.value,s.value),newIndex:n}}},zu=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The ORDER BY clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="order by")throw new Error(`Syntax error at position ${n}: Expected 'ORDER BY' keyword but found "${t[n].value}". ORDER BY clauses must start with the ORDER BY keywords.`);n++;let r=[],s=this.parseItem(t,n);for(r.push(s.value),n=s.newIndex;n<t.length&&t[n].type&16;){n++;let i=this.parseItem(t,n);r.push(i.value),n=i.newIndex}if(r.length===0)throw new Error(`Syntax error at position ${e}: No ordering expressions found. The ORDER BY clause requires at least one expression to order by.`);return{value:new Nn(r),newIndex:n}}static parseItem(t,e){let n=e,r=U.parseFromLexeme(t,n),s=r.value;if(n=r.newIndex,n>=t.length)return{value:s,newIndex:n};let i=n>=t.length?null:t[n].value==="asc"?(n++,"asc"):t[n].value==="desc"?(n++,"desc"):null,l=n>=t.length?null:t[n].value==="nulls first"?(n++,"first"):t[n].value==="nulls last"?(n++,"last"):null;return i===null&&l===null?{value:s,newIndex:n}:{value:new Zn(s,i,l),newIndex:n}}},Vy=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The PARTITION BY clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="partition by")throw new Error(`Syntax error at position ${n}: Expected 'PARTITION BY' keyword but found "${t[n].value}". PARTITION BY clauses must start with the PARTITION BY keywords.`);n++;let r=[],s=U.parseFromLexeme(t,n);for(r.push(s.value),n=s.newIndex;n<t.length&&t[n].type&16;){n++;let i=U.parseFromLexeme(t,n);r.push(i.value),n=i.newIndex}if(r.length===0)throw new Error(`Syntax error at position ${e}: No partition expressions found. The PARTITION BY clause requires at least one expression to partition by.`);return r.length===1?{value:new Yn(r[0]),newIndex:n}:{value:new Yn(new ke(r)),newIndex:n}}},kp=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The window frame expression is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].type!==4)throw new Error(`Syntax error at position ${n}: Expected opening parenthesis '(' but found "${t[n].value}".`);n++;let r=null,s=null,i=null;if(n<t.length&&t[n].value==="partition by"){let l=Vy.parseFromLexeme(t,n);r=l.value,n=l.newIndex}if(n<t.length&&t[n].value==="order by"){let l=zu.parseFromLexeme(t,n);s=l.value,n=l.newIndex}if(n<t.length&&this.isFrameTypeKeyword(t[n].value)){let l=this.parseFrameSpec(t,n);i=l.value,n=l.newIndex}if(n>=t.length||t[n].type!==8)throw new Error(`Syntax error at position ${n}: Missing closing parenthesis ')' for window frame. Each opening parenthesis must have a matching closing parenthesis.`);return n++,{value:new Jn(r,s,i),newIndex:n}}static isFrameTypeKeyword(t){let e=t;return e==="rows"||e==="range"||e==="groups"}static parseFrameSpec(t,e){let n=e,r=t[n].value,s;switch(r){case"rows":s="rows";break;case"range":s="range";break;case"groups":s="groups";break;default:throw new Error(`Syntax error at position ${n}: Invalid frame type "${t[n].value}". Expected one of: ROWS, RANGE, GROUPS.`)}if(n++,n<t.length&&t[n].value==="between"){n++;let i=this.parseFrameBoundary(t,n),l=i.value;if(n=i.newIndex,n>=t.length||t[n].value!=="and")throw new Error(`Syntax error at position ${n}: Expected 'AND' keyword in BETWEEN clause.`);n++;let o=this.parseFrameBoundary(t,n),a=o.value;return n=o.newIndex,{value:new Vs(s,l,a),newIndex:n}}else{let i=this.parseFrameBoundary(t,n),l=i.value;return n=i.newIndex,{value:new Vs(s,l,null),newIndex:n}}}static parseFrameBoundary(t,e){let n=e;if(n<t.length&&t[n].type&128){let r=t[n].value,s;switch(r){case"current row":s="current row";break;case"unbounded preceding":s="unbounded preceding";break;case"unbounded following":s="unbounded following";break;default:throw new Error(`Syntax error at position ${n}: Invalid frame type "${t[n].value}". Expected one of: ROWS, RANGE, GROUPS.`)}return{value:new Bu(s),newIndex:n+1}}else if(n<t.length&&t[n].type&1){let r=U.parseFromLexeme(t,n);if(n=r.newIndex,n<t.length&&t[n].type&128){let s=t[n].value,i;if(s==="preceding")i=!1;else if(s==="following")i=!0;else throw new Error(`Syntax error at position ${n}: Expected 'preceding' or 'following' after numeric value in window frame boundary.`);return n++,{value:new Uu(r.value,i),newIndex:n}}else throw new Error(`Syntax error at position ${n}: Expected 'preceding' or 'following' after numeric value in window frame boundary.`)}throw new Error(`Syntax error at position ${n}: Expected a valid frame boundary component.`)}},sd=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The OVER expression is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="over")throw new Error(`Syntax error at position ${n}: Expected 'OVER' keyword but found "${t[n].value}". OVER expressions must start with the OVER keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'OVER' keyword. Expected either a window name or an opening parenthesis '('.");if(t[n].type&64){let r=t[n].value;return n++,{value:new D(r),newIndex:n}}if(t[n].type&4)return kp.parseFromLexeme(t,n);throw new Error(`Syntax error at position ${n}: Expected a window name or opening parenthesis '(' after OVER keyword, but found "${t[n].value}".`)}},Rt=class Tp extends Error{constructor(e,n,r){super(e),this.index=n,this.context=r,this.name="ParseError"}static fromUnparsedLexemes(e,n,r){let s=Math.max(0,n-2),i=Math.min(e.length,n+3),l=e.slice(s,i).map((a,u)=>{let c=u+s===n?">":" ",m=Wu[a.type]||a.type;return`${c} ${u+s}:${a.value} [${m}]`}).join(`
`),o=`${r} Unparsed lexeme remains at index ${n}: ${e[n].value}
Context:
${l}`;return new Tp(o,n,l)}},gt=class{static parseArrayExpression(t,e){let n=e;if(n+1<t.length&&t[n+1].type&512){n++;let r=U.parseArgument(512,1024,t,n);return n=r.newIndex,{value:new En(r.value),newIndex:n}}else if(n+1<t.length&&t[n+1].type&4){n++,n++;let r=Q.parseFromLexeme(t,n);return n=r.newIndex,n++,{value:new kn(r.value),newIndex:n}}throw new Error(`Invalid ARRAY syntax at index ${n}, expected ARRAY[... or ARRAY(...)`)}static parseFromLexeme(t,e){let n=e,r=t[n];return r.value==="array"?this.parseArrayExpression(t,n):r.value==="substring"||r.value==="overlay"?this.parseKeywordFunction(t,n,[{key:"from",required:!1},{key:"for",required:!1}]):r.value==="cast"?this.parseKeywordFunction(t,n,[{key:"as",required:!0}]):r.value==="trim"?this.parseKeywordFunction(t,n,[{key:"from",required:!1}]):this.parseFunctionCall(t,n)}static tryParseBinaryExpression(t,e,n,r=!0,s=!0){let i=e;if(i<t.length&&t[i].type&2){let l=t[i].value.toLowerCase();if(!r&&l==="and"||!s&&l==="or")return null;if(i++,l==="between")return this.parseBetweenExpression(t,i,n,!1);if(l==="not between")return this.parseBetweenExpression(t,i,n,!0);if(l==="::"){let a=this.parseTypeValue(t,i);return i=a.newIndex,{value:new Gt(n,a.value),newIndex:i}}let o=U.parseFromLexeme(t,i);return i=o.newIndex,{value:new A(n,l,o.value),newIndex:i}}return null}static parseBetweenExpression(t,e,n,r){let s=e,i=U.parseFromLexeme(t,s,!1);if(s=i.newIndex,s<t.length&&t[s].type&2&&t[s].value!=="and")throw new Error(`Expected 'and' after 'between' at index ${s}`);s++;let l=this.parseBetweenUpperBound(t,s);return s=l.newIndex,{value:new Tn(n,i.value,l.value,r),newIndex:s}}static parseBetweenUpperBound(t,e){return U.parseFromLexeme(t,e,!1,!1)}static parseFunctionCall(t,e){let n=e,r=Bt.parseFromLexeme(t,n),s=r.namespaces,i=r.name;if(n=r.newIndex,n<t.length&&t[n].type&4){let l=U.parseArgument(4,8,t,n);n=l.newIndex;let o=null;if(n<t.length&&t[n].value==="within group"){let a=this.parseWithinGroupClause(t,n);o=a.value,n=a.newIndex}if(n<t.length&&t[n].value==="over"){let a=sd.parseFromLexeme(t,n);return n=a.newIndex,{value:new he(s,i.name,l.value,a.value,o),newIndex:n}}else return{value:new he(s,i.name,l.value,null,o),newIndex:n}}else throw Rt.fromUnparsedLexemes(t,n,`Expected opening parenthesis after function name '${i.name}'.`)}static parseKeywordFunction(t,e,n){let r=e,s=Bt.parseFromLexeme(t,r),i=s.namespaces,l=s.name;if(r=s.newIndex,r<t.length&&t[r].type&4){r++;let o=U.parseFromLexeme(t,r),a=o.value;if(r=o.newIndex,r<t.length&&t[r].type&16)return this.parseFunctionCall(t,e);for(let{key:u,required:c}of n)if(r<t.length&&t[r].type&128&&t[r].value===u)if(r++,r<t.length&&t[r].type&8192){let m=this.parseTypeValue(t,r);a=new A(a,u,m.value),r=m.newIndex}else{let m=U.parseFromLexeme(t,r);a=new A(a,u,m.value),r=m.newIndex}else if(c)throw Rt.fromUnparsedLexemes(t,r,`Keyword '${u}' is required for ${l.name} function.`);if(r<t.length&&t[r].type&8){r++;let u=null;if(r<t.length&&t[r].value==="within group"){let c=this.parseWithinGroupClause(t,r);u=c.value,r=c.newIndex}if(r<t.length&&t[r].value==="over"){r++;let c=sd.parseFromLexeme(t,r);return r=c.newIndex,{value:new he(i,l.name,a,c.value,u),newIndex:r}}else return{value:new he(i,l.name,a,null,u),newIndex:r}}else throw Rt.fromUnparsedLexemes(t,r,`Missing closing parenthesis for function '${l.name}'.`)}else throw Rt.fromUnparsedLexemes(t,r,`Missing opening parenthesis for function '${l.name}'.`)}static parseTypeValue(t,e){let n=e,{namespaces:r,name:s,newIndex:i}=Bt.parseFromLexeme(t,n);if(n=i,n<t.length&&t[n].type&4){let l=U.parseArgument(4,8,t,n);return n=l.newIndex,{value:new Ht(r,new K(s.name),l.value),newIndex:n}}else return{value:new Ht(r,new K(s.name)),newIndex:n}}static parseWithinGroupClause(t,e){let n=e;if(n>=t.length||t[n].value!=="within group")throw new Error(`Expected 'WITHIN GROUP' at index ${n}`);if(n++,n>=t.length||!(t[n].type&4))throw new Error(`Expected '(' after 'WITHIN GROUP' at index ${n}`);n++;let r=zu.parseFromLexeme(t,n);if(n=r.newIndex,n>=t.length||!(t[n].type&8))throw new Error(`Expected ')' after WITHIN GROUP ORDER BY clause at index ${n}`);return n++,{value:r.value,newIndex:n}}},js,cl=(js=class{static getPrecedence(e){let n=this.precedenceMap[e.toLowerCase()];return n!==void 0?n:0}static hasHigherOrEqualPrecedence(e,n){return this.getPrecedence(e)>=this.getPrecedence(n)}static isLogicalOperator(e){let n=e.toLowerCase();return n==="and"||n==="or"}static isBetweenOperator(e){let n=e.toLowerCase();return n==="between"||n==="not between"}static isComparisonOperator(e){let n=e.toLowerCase();return["=","!=","<>","<",">","<=",">=","like","ilike","similar to","in","not in","->","->>","#>","#>>","@>","<@","?","?|","?&","~","~*","!~","!~*","rlike","regexp"].includes(n)}},js.precedenceMap={or:1,and:2,"=":10,"!=":10,"<>":10,"<":10,"<=":10,">":10,">=":10,like:10,ilike:10,"not like":10,"not ilike":10,"similar to":10,"not similar to":10,in:10,"not in":10,is:10,"is not":10,"->":10,"->>":10,"#>":10,"#>>":10,"@>":10,"<@":10,"?":10,"?|":10,"?&":10,"~":10,"~*":10,"!~":10,"!~*":10,rlike:10,regexp:10,mod:30,xor:2,between:15,"not between":15,"+":20,"-":20,"*":30,"/":30,"%":30,"^":40,"::":50,"unary+":100,"unary-":100,not:100},js),U=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw Rt.fromUnparsedLexemes(e,n.newIndex,"[ValueParser]");return n.value}static parseFromLexeme(t,e,n=!0,r=!0){return this.parseExpressionWithPrecedence(t,e,0,n,r)}static parseExpressionWithPrecedence(t,e,n,r=!0,s=!0){let i=e,l=t[i].comments,o=this.parseItem(t,i);o.value.comments=l,i=o.newIndex;let a=o.value,u=this.parseArrayAccess(t,i,a);for(a=u.value,i=u.newIndex;i<t.length&&t[i].type&2;){let c=t[i].value;if(!r&&c.toLowerCase()==="and"||!s&&c.toLowerCase()==="or")break;let m=cl.getPrecedence(c);if(m<n)break;if(i++,cl.isBetweenOperator(c)){let C=gt.parseBetweenExpression(t,i,a,c.toLowerCase().includes("not"));a=C.value,i=C.newIndex;continue}if(c==="::"){let C=gt.parseTypeValue(t,i);a=new Gt(a,C.value),i=C.newIndex;continue}let h=m+1,w=this.parseExpressionWithPrecedence(t,i,h,r,s);i=w.newIndex,a=new A(a,c,w.value)}return{value:a,newIndex:i}}static parseItem(t,e){let n=e;if(n>=t.length)throw new Error(`Unexpected end of lexemes at index ${e}`);let r=t[n];if(r.type&64&&r.type&2&&r.type&8192){if(n+1<t.length&&t[n+1].type&4)if(this.isTypeConstructor(t,n+1,r.value)){let i=gt.parseTypeValue(t,n);return{value:i.value,newIndex:i.newIndex}}else return gt.parseFromLexeme(t,n);let s=qy.parseFromLexeme(t,n);if(s.newIndex>=t.length)return s;if(t[s.newIndex].type&1){let i=rd.parseFromLexeme(t,s.newIndex);return{value:new Nt(t[n].value,i.value),newIndex:i.newIndex}}return s}else if(r.type&64){let{namespaces:s,name:i,newIndex:l}=Bt.parseFromLexeme(t,n);if(t[l-1].type&2048)return gt.parseFromLexeme(t,n);if(t[l-1].type&8192)if(l<t.length&&t[l].type&4)if(this.isTypeConstructor(t,l,i.name)){let o=gt.parseTypeValue(t,n);return{value:o.value,newIndex:o.newIndex}}else return gt.parseFromLexeme(t,n);else return{value:new Ht(s,i),newIndex:l};return{value:new _(s,i),newIndex:l}}else{if(r.type&1)return rd.parseFromLexeme(t,n);if(r.type&4)return By.parseFromLexeme(t,n);if(r.type&2048)return gt.parseFromLexeme(t,n);if(r.type&2)return Uy.parseFromLexeme(t,n);if(r.type&256)return Qy.parseFromLexeme(t,n);if(r.type&4096)return Wy.parseFromLexeme(t,n);if(r.type&128)return zy.parseFromLexeme(t,n);if(r.type&512){let{namespaces:s,name:i,newIndex:l}=Bt.parseFromLexeme(t,n);return{value:new _(s,i),newIndex:l}}else if(r.type&8192){let{namespaces:s,name:i,newIndex:l}=Bt.parseFromLexeme(t,n);if(l<t.length&&t[l].type&4)if(this.isTypeConstructor(t,l,i.name)){let o=gt.parseTypeValue(t,n);return{value:o.value,newIndex:o.newIndex}}else return gt.parseFromLexeme(t,n);else return{value:new Ht(s,i),newIndex:l}}}throw Rt.fromUnparsedLexemes(t,n,"[ValueParser] Invalid lexeme.")}static parseArgument(t,e,n,r){let s=r,i=[];if(s<n.length&&n[s].type===t){if(s++,s<n.length&&n[s].type===e)return s++,{value:new ke([]),newIndex:s};if(s<n.length&&n[s].value==="*"){let o=new _(null,"*");if(s++,s<n.length&&n[s].type===e)return s++,{value:o,newIndex:s};throw Rt.fromUnparsedLexemes(n,s,"Expected closing parenthesis after wildcard '*'.")}let l=this.parseFromLexeme(n,s);for(s=l.newIndex,i.push(l.value);s<n.length&&n[s].type&16;){s++;let o=this.parseFromLexeme(n,s);s=o.newIndex,i.push(o.value)}if(s<n.length&&n[s].type===e)return s++,i.length===1?{value:i[0],newIndex:s}:{value:new ke(i),newIndex:s};throw Rt.fromUnparsedLexemes(n,s,"Missing closing parenthesis.")}throw Rt.fromUnparsedLexemes(n,r,"Expected opening parenthesis.")}static parseArrayAccess(t,e,n){let r=e,s=n;for(;r<t.length&&t[r].type&512&&!this.isSqlServerBracketIdentifier(t,r);){if(r++,r>=t.length)throw new Error(`Expected array index or slice after '[' at index ${r-1}`);if(t[r].type&1024)throw new Error(`Empty array access brackets not supported at index ${r}`);let i=null,l=!1;if(t[r].type&2&&t[r].value===":")l=!0,r++;else{let o=cl.getPrecedence(":"),a=this.parseExpressionWithPrecedence(t,r,o+1);i=a.value,r=a.newIndex,r<t.length&&t[r].type&2&&t[r].value===":"&&(l=!0,r++)}if(l){let o=null;if(r<t.length&&!(t[r].type&1024)){let a=cl.getPrecedence(":"),u=this.parseExpressionWithPrecedence(t,r,a+1);o=u.value,r=u.newIndex}if(r>=t.length||!(t[r].type&1024))throw new Error(`Expected ']' after array slice at index ${r}`);r++,s=new fo(s,i,o)}else{if(!i){let o=this.parseFromLexeme(t,r);i=o.value,r=o.newIndex}if(r>=t.length||!(t[r].type&1024))throw new Error(`Expected ']' after array index at index ${r}`);r++,s=new mo(s,i)}}return{value:s,newIndex:r}}static isSqlServerBracketIdentifier(t,e){let n=e+1;if(n>=t.length)return!1;for(;n<t.length&&!(t[n].type&1024);){let i=t[n];if(i.type&64||i.type&2&&i.value==="."){n++;continue}return!1}if(n>=t.length)return!1;let r=n;if(r+1<t.length){let i=t[r+1];if(i.type&2&&i.value===".")return!0}n=e+1;let s=!0;for(;n<r;){let i=t[n];if(!(i.type&64||i.type&2&&i.value===".")){s=!1;break}n++}return s}static isTypeConstructor(t,e,n){let r=["NUMERIC","DECIMAL","VARCHAR","CHAR","CHARACTER","TIMESTAMP","TIME","INTERVAL"],s=n.toUpperCase();if(r.includes(s))return!0;if(s==="DATE"){let i=e+1;if(i<t.length){let l=t[i];return!(l.type&1&&typeof l.value=="string"&&isNaN(Number(l.value)))}}return!1}},mt=class{constructor(){this.commonTables=[],this.visitedNodes=new Set,this.isRootVisit=!0,this.handlers=new Map,this.handlers.set(B.kind,t=>this.visitSimpleSelectQuery(t)),this.handlers.set(fe.kind,t=>this.visitBinarySelectQuery(t)),this.handlers.set(Ft.kind,t=>this.visitValuesQuery(t)),this.handlers.set(Ot.kind,t=>this.visitWithClause(t)),this.handlers.set(st.kind,t=>this.visitCommonTable(t)),this.handlers.set(ce.kind,t=>this.visitSelectItem(t)),this.handlers.set(D.kind,t=>this.visitIdentifierString(t)),this.handlers.set(K.kind,t=>this.visitRawString(t)),this.handlers.set(_.kind,t=>this.visitColumnReference(t)),this.handlers.set(M.kind,t=>this.visitParameterExpression(t)),this.handlers.set(be.kind,t=>this.visitLiteralValue(t)),this.handlers.set(te.kind,t=>this.visitSourceExpression(t)),this.handlers.set(ee.kind,t=>this.visitTableSource(t)),this.handlers.set(yo.kind,t=>this.visitFunctionSource(t)),this.handlers.set(Ks.kind,t=>this.visitParenSource(t)),this.handlers.set($e.kind,t=>this.visitSubQuerySource(t)),this.handlers.set(Hn.kind,t=>this.visitInlineQuery(t)),this.handlers.set(pe.kind,t=>this.visitFromClause(t)),this.handlers.set(qt.kind,t=>this.visitJoinClause(t)),this.handlers.set(On.kind,t=>this.visitJoinOnClause(t)),this.handlers.set(er.kind,t=>this.visitJoinUsingClause(t)),this.handlers.set(Yt.kind,t=>this.visitWhereClause(t)),this.handlers.set(qe.kind,t=>this.visitParenExpression(t)),this.handlers.set(A.kind,t=>this.visitBinaryExpression(t)),this.handlers.set(Nt.kind,t=>this.visitUnaryExpression(t)),this.handlers.set(bt.kind,t=>this.visitCaseExpression(t)),this.handlers.set(Sn.kind,t=>this.visitCaseKeyValuePair(t)),this.handlers.set(Cn.kind,t=>this.visitSwitchCaseArgument(t)),this.handlers.set(Tn.kind,t=>this.visitBetweenExpression(t)),this.handlers.set(he.kind,t=>this.visitFunctionCall(t)),this.handlers.set(En.kind,t=>this.visitArrayExpression(t)),this.handlers.set(kn.kind,t=>this.visitArrayQueryExpression(t)),this.handlers.set(Jt.kind,t=>this.visitTupleExpression(t)),this.handlers.set(Gt.kind,t=>this.visitCastExpression(t)),this.handlers.set(Jn.kind,t=>this.visitWindowFrameExpression(t)),this.handlers.set(Vs.kind,t=>this.visitWindowFrameSpec(t)),this.handlers.set(Ht.kind,t=>this.visitTypeValue(t)),this.handlers.set(ke.kind,t=>this.visitValueList(t)),this.handlers.set(Xs.kind,t=>this.visitStringSpecifierExpression(t)),this.handlers.set(Se.kind,t=>this.visitSelectClause(t)),this.handlers.set(bn.kind,t=>this.visitGroupByClause(t)),this.handlers.set(In.kind,t=>this.visitHavingClause(t)),this.handlers.set(Nn.kind,t=>this.visitOrderByClause(t)),this.handlers.set(Xn.kind,t=>this.visitWindowFrameClause(t)),this.handlers.set(Xt.kind,t=>this.visitLimitClause(t)),this.handlers.set(Gs.kind,t=>this.visitForClause(t)),this.handlers.set(Zn.kind,t=>this.visitOrderByItem(t)),this.handlers.set(Yn.kind,t=>this.visitPartitionByClause(t))}getCommonTables(){return this.commonTables}reset(){this.commonTables=[],this.visitedNodes.clear()}collect(t){return this.visit(t),this.getCommonTables()}visit(t){if(!this.isRootVisit){this.visitNode(t);return}this.reset(),this.isRootVisit=!1;try{this.visitNode(t)}finally{this.isRootVisit=!0}}visitNode(t){var s,i;if(this.visitedNodes.has(t))return;this.visitedNodes.add(t);let e=this.handlers.get(t.getKind());if(e){e(t);return}let n=((s=t.getKind())==null?void 0:s.toString())||"unknown",r=((i=t.constructor)==null?void 0:i.name)||"unknown";throw new Error(`[CTECollector] No handler for ${r} with kind ${n}.`)}visitSimpleSelectQuery(t){if(t.fromClause&&t.fromClause.accept(this),t.whereClause&&t.whereClause.accept(this),t.groupByClause&&t.groupByClause.accept(this),t.havingClause&&t.havingClause.accept(this),t.orderByClause&&t.orderByClause.accept(this),t.windowClause)for(let e of t.windowClause.windows)e.accept(this);t.limitClause&&t.limitClause.accept(this),t.forClause&&t.forClause.accept(this),t.selectClause.accept(this),t.withClause&&t.withClause.accept(this)}visitBinarySelectQuery(t){t.left.accept(this),t.right.accept(this)}visitValuesQuery(t){for(let e of t.tuples)e.accept(this)}visitWithClause(t){for(let e=0;e<t.tables.length;e++)t.tables[e].accept(this)}visitCommonTable(t){t.query.accept(this),this.commonTables.push(t)}visitSelectClause(t){for(let e of t.items)e.accept(this)}visitSelectItem(t){t.value.accept(this)}visitFromClause(t){if(t.source.accept(this),t.joins)for(let e of t.joins)e.accept(this)}visitSourceExpression(t){t.datasource.accept(this)}visitTableSource(t){}visitFunctionSource(t){t.argument&&t.argument.accept(this)}visitParenSource(t){t.source.accept(this)}visitSubQuerySource(t){t.query.accept(this)}visitInlineQuery(t){t.selectQuery.accept(this)}visitJoinClause(t){t.source.accept(this),t.condition&&t.condition.accept(this)}visitJoinOnClause(t){t.condition.accept(this)}visitJoinUsingClause(t){t.condition.accept(this)}visitWhereClause(t){t.condition.accept(this)}visitGroupByClause(t){for(let e of t.grouping)e.accept(this)}visitHavingClause(t){t.condition.accept(this)}visitOrderByClause(t){for(let e of t.order)e.accept(this)}visitWindowFrameClause(t){t.expression.accept(this)}visitLimitClause(t){t.value.accept(this)}visitForClause(t){}visitOrderByItem(t){t.value.accept(this)}visitParenExpression(t){t.expression.accept(this)}visitBinaryExpression(t){t.left.accept(this),t.right.accept(this)}visitUnaryExpression(t){t.expression.accept(this)}visitCaseExpression(t){t.condition&&t.condition.accept(this),t.switchCase.accept(this)}visitSwitchCaseArgument(t){for(let e of t.cases)e.accept(this);t.elseValue&&t.elseValue.accept(this)}visitCaseKeyValuePair(t){t.key.accept(this),t.value.accept(this)}visitBetweenExpression(t){t.expression.accept(this),t.lower.accept(this),t.upper.accept(this)}visitFunctionCall(t){t.argument&&t.argument.accept(this),t.over&&t.over.accept(this)}visitArrayExpression(t){t.expression.accept(this)}visitArrayQueryExpression(t){t.query.accept(this)}visitTupleExpression(t){for(let e of t.values)e.accept(this)}visitCastExpression(t){t.input.accept(this),t.castType.accept(this)}visitTypeValue(t){t.argument&&t.argument.accept(this)}visitWindowFrameExpression(t){t.partition&&t.partition.accept(this),t.order&&t.order.accept(this),t.frameSpec&&t.frameSpec.accept(this)}visitWindowFrameSpec(t){}visitIdentifierString(t){}visitRawString(t){}visitColumnReference(t){}visitParameterExpression(t){}visitLiteralValue(t){}visitPartitionByClause(t){}visitValueList(t){for(let e of t.values)e.accept(this)}visitStringSpecifierExpression(t){}},Vu=class{constructor(){this.visitedNodes=new Set,this.isRootVisit=!0,this.handlers=new Map,this.handlers.set(B.kind,t=>this.visitSimpleSelectQuery(t)),this.handlers.set(fe.kind,t=>this.visitBinarySelectQuery(t)),this.handlers.set(Ft.kind,t=>this.visitValuesQuery(t)),this.handlers.set(ce.kind,t=>this.visitSelectItem(t)),this.handlers.set(D.kind,t=>this.visitIdentifierString(t)),this.handlers.set(K.kind,t=>this.visitRawString(t)),this.handlers.set(_.kind,t=>this.visitColumnReference(t)),this.handlers.set(M.kind,t=>this.visitParameterExpression(t)),this.handlers.set(be.kind,t=>this.visitLiteralValue(t)),this.handlers.set(te.kind,t=>this.visitSourceExpression(t)),this.handlers.set(ee.kind,t=>this.visitTableSource(t)),this.handlers.set(Ks.kind,t=>this.visitParenSource(t)),this.handlers.set($e.kind,t=>this.visitSubQuerySource(t)),this.handlers.set(Hn.kind,t=>this.visitInlineQuery(t)),this.handlers.set(pe.kind,t=>this.visitFromClause(t)),this.handlers.set(qt.kind,t=>this.visitJoinClause(t)),this.handlers.set(On.kind,t=>this.visitJoinOnClause(t)),this.handlers.set(er.kind,t=>this.visitJoinUsingClause(t)),this.handlers.set(Yt.kind,t=>this.visitWhereClause(t)),this.handlers.set(qe.kind,t=>this.visitParenExpression(t)),this.handlers.set(A.kind,t=>this.visitBinaryExpression(t)),this.handlers.set(Nt.kind,t=>this.visitUnaryExpression(t)),this.handlers.set(bt.kind,t=>this.visitCaseExpression(t)),this.handlers.set(Sn.kind,t=>this.visitCaseKeyValuePair(t)),this.handlers.set(Cn.kind,t=>this.visitSwitchCaseArgument(t)),this.handlers.set(Tn.kind,t=>this.visitBetweenExpression(t)),this.handlers.set(he.kind,t=>this.visitFunctionCall(t)),this.handlers.set(En.kind,t=>this.visitArrayExpression(t)),this.handlers.set(kn.kind,t=>this.visitArrayQueryExpression(t)),this.handlers.set(Jt.kind,t=>this.visitTupleExpression(t)),this.handlers.set(Gt.kind,t=>this.visitCastExpression(t)),this.handlers.set(Jn.kind,t=>this.visitWindowFrameExpression(t)),this.handlers.set(Vs.kind,t=>this.visitWindowFrameSpec(t)),this.handlers.set(Ht.kind,t=>this.visitTypeValue(t)),this.handlers.set(ke.kind,t=>this.visitValueList(t)),this.handlers.set(fo.kind,t=>this.visitArraySliceExpression(t)),this.handlers.set(mo.kind,t=>this.visitArrayIndexExpression(t)),this.handlers.set(Xs.kind,t=>this.visitStringSpecifierExpression(t)),this.handlers.set(Se.kind,t=>this.visitSelectClause(t)),this.handlers.set(bn.kind,t=>this.visitGroupByClause(t)),this.handlers.set(In.kind,t=>this.visitHavingClause(t)),this.handlers.set(Nn.kind,t=>this.visitOrderByClause(t)),this.handlers.set(Xn.kind,t=>this.visitWindowFrameClause(t)),this.handlers.set(Xt.kind,t=>this.visitLimitClause(t)),this.handlers.set(Gs.kind,t=>this.visitForClause(t)),this.handlers.set(Zn.kind,t=>this.visitOrderByItem(t)),this.handlers.set(Yn.kind,t=>this.visitPartitionByClause(t))}reset(){this.visitedNodes.clear()}execute(t){return this.reset(),this.visit(t)}visit(t){if(!this.isRootVisit)return this.visitNode(t);this.reset(),this.isRootVisit=!1;try{return this.visitNode(t)}finally{this.isRootVisit=!0}}visitNode(t){var s,i;if(this.visitedNodes.has(t))return t;this.visitedNodes.add(t);let e=this.handlers.get(t.getKind());if(e)return e(t);let n=((s=t.getKind())==null?void 0:s.toString())||"unknown",r=((i=t.constructor)==null?void 0:i.name)||"unknown";throw new Error(`[CTEDisabler] No handler for ${r} with kind ${n}.`)}visitSimpleSelectQuery(t){return t.withClause&&t.withClause.tables.forEach(e=>{this.visit(e.query)}),t.withClause=null,t.selectClause=this.visit(t.selectClause),t.fromClause=t.fromClause?this.visit(t.fromClause):null,t.whereClause=t.whereClause?this.visit(t.whereClause):null,t.groupByClause=t.groupByClause?this.visit(t.groupByClause):null,t.havingClause=t.havingClause?this.visit(t.havingClause):null,t.orderByClause=t.orderByClause?this.visit(t.orderByClause):null,t.windowClause&&(t.windowClause=new Qu(t.windowClause.windows.map(e=>this.visit(e)))),t.limitClause=t.limitClause?this.visit(t.limitClause):null,t.forClause=t.forClause?this.visit(t.forClause):null,t}visitBinarySelectQuery(t){return t.left=this.visit(t.left),t.right=this.visit(t.right),t}visitValuesQuery(t){let e=t.tuples.map(n=>this.visit(n));return new Ft(e)}visitSelectClause(t){let e=t.items.map(n=>this.visit(n));return new Se(e,t.distinct)}visitFromClause(t){let e=this.visit(t.source),n=t.joins?t.joins.map(r=>this.visit(r)):null;return new pe(e,n)}visitSubQuerySource(t){let e=this.visit(t.query);return new $e(e)}visitInlineQuery(t){let e=this.visit(t.selectQuery);return new Hn(e)}visitJoinClause(t){let e=this.visit(t.source),n=t.condition?this.visit(t.condition):null;return new qt(t.joinType.value,e,n,t.lateral)}visitJoinOnClause(t){let e=this.visit(t.condition);return new On(e)}visitJoinUsingClause(t){let e=this.visit(t.condition);return new er(e)}visitWhereClause(t){let e=this.visit(t.condition);return new Yt(e)}visitGroupByClause(t){let e=t.grouping.map(n=>this.visit(n));return new bn(e)}visitHavingClause(t){let e=this.visit(t.condition);return new In(e)}visitOrderByClause(t){let e=t.order.map(n=>this.visit(n));return new Nn(e)}visitWindowFrameClause(t){let e=this.visit(t.expression);return new Xn(t.name.name,e)}visitLimitClause(t){let e=this.visit(t.value);return new Xt(e)}visitForClause(t){return new Gs(t.lockMode)}visitParenExpression(t){let e=this.visit(t.expression);return new qe(e)}visitBinaryExpression(t){let e=this.visit(t.left),n=this.visit(t.right);return new A(e,t.operator.value,n)}visitUnaryExpression(t){let e=this.visit(t.expression);return new Nt(t.operator.value,e)}visitCaseExpression(t){let e=t.condition?this.visit(t.condition):null,n=this.visit(t.switchCase);return new bt(e,n)}visitSwitchCaseArgument(t){let e=t.cases.map(r=>this.visit(r)),n=t.elseValue?this.visit(t.elseValue):null;return new Cn(e,n)}visitCaseKeyValuePair(t){let e=this.visit(t.key),n=this.visit(t.value);return new Sn(e,n)}visitBetweenExpression(t){let e=this.visit(t.expression),n=this.visit(t.lower),r=this.visit(t.upper);return new Tn(e,n,r,t.negated)}visitFunctionCall(t){let e=t.argument?this.visit(t.argument):null,n=t.over?this.visit(t.over):null;return new he(t.namespaces,t.name,e,n)}visitArrayExpression(t){let e=this.visit(t.expression);return new En(e)}visitArrayQueryExpression(t){let e=this.visit(t.query);return new kn(e)}visitTupleExpression(t){let e=t.values.map(n=>this.visit(n));return new Jt(e)}visitCastExpression(t){let e=this.visit(t.input),n=this.visit(t.castType);return new Gt(e,n)}visitTypeValue(t){let e=t.argument?this.visit(t.argument):null;return new Ht(t.namespaces,t.name,e)}visitSelectItem(t){var n;let e=this.visit(t.value);return new ce(e,(n=t.identifier)==null?void 0:n.name)}visitIdentifierString(t){return t}visitRawString(t){return t}visitColumnReference(t){return t}visitSourceExpression(t){let e=this.visit(t.datasource),n=t.aliasExpression;return new te(e,n)}visitTableSource(t){return t}visitParenSource(t){let e=this.visit(t.source);return new Ks(e)}visitParameterExpression(t){return t}visitWindowFrameExpression(t){let e=t.partition?this.visit(t.partition):null,n=t.order?this.visit(t.order):null,r=t.frameSpec?this.visit(t.frameSpec):null;return new Jn(e,n,r)}visitWindowFrameSpec(t){return t}visitLiteralValue(t){return t}visitOrderByItem(t){let e=this.visit(t.value);return new Zn(e,t.sortDirection,t.nullsPosition)}visitValueList(t){let e=t.values.map(n=>this.visit(n));return new ke(e)}visitArraySliceExpression(t){return t}visitArrayIndexExpression(t){return t}visitStringSpecifierExpression(t){return t}visitPartitionByClause(t){let e=this.visit(t.value);return new Yn(e)}},Ku=class{constructor(t=!0){this.tableSources=[],this.visitedNodes=new Set,this.tableNameMap=new Map,this.cteNames=new Set,this.isRootVisit=!0,this.selectableOnly=t,this.handlers=new Map,this.handlers.set(B.kind,e=>this.visitSimpleSelectQuery(e)),this.handlers.set(fe.kind,e=>this.visitBinarySelectQuery(e)),this.handlers.set(Ft.kind,e=>this.visitValuesQuery(e)),this.handlers.set(Ot.kind,e=>this.visitWithClause(e)),this.handlers.set(st.kind,e=>this.visitCommonTable(e)),this.handlers.set(pe.kind,e=>this.visitFromClause(e)),this.handlers.set(qt.kind,e=>this.visitJoinClause(e)),this.handlers.set(On.kind,e=>this.visitJoinOnClause(e)),this.handlers.set(er.kind,e=>this.visitJoinUsingClause(e)),this.handlers.set(te.kind,e=>this.visitSourceExpression(e)),this.handlers.set(ee.kind,e=>this.visitTableSource(e)),this.handlers.set(yo.kind,e=>this.visitFunctionSource(e)),this.handlers.set(Ks.kind,e=>this.visitParenSource(e)),this.handlers.set($e.kind,e=>this.visitSubQuerySource(e)),this.handlers.set(Hn.kind,e=>this.visitInlineQuery(e)),t||(this.handlers.set(Yt.kind,e=>this.visitWhereClause(e)),this.handlers.set(bn.kind,e=>this.visitGroupByClause(e)),this.handlers.set(In.kind,e=>this.visitHavingClause(e)),this.handlers.set(Nn.kind,e=>this.visitOrderByClause(e)),this.handlers.set(Xn.kind,e=>this.visitWindowFrameClause(e)),this.handlers.set(Xt.kind,e=>this.visitLimitClause(e)),this.handlers.set(zi.kind,e=>this.visitOffsetClause(e)),this.handlers.set(wo.kind,e=>this.visitFetchClause(e)),this.handlers.set(Gs.kind,e=>this.visitForClause(e)),this.handlers.set(Zn.kind,e=>this.visitOrderByItem(e)),this.handlers.set(Se.kind,e=>this.visitSelectClause(e)),this.handlers.set(ce.kind,e=>this.visitSelectItem(e)),this.handlers.set(qe.kind,e=>this.visitParenExpression(e)),this.handlers.set(A.kind,e=>this.visitBinaryExpression(e)),this.handlers.set(Nt.kind,e=>this.visitUnaryExpression(e)),this.handlers.set(bt.kind,e=>this.visitCaseExpression(e)),this.handlers.set(Sn.kind,e=>this.visitCaseKeyValuePair(e)),this.handlers.set(Cn.kind,e=>this.visitSwitchCaseArgument(e)),this.handlers.set(Tn.kind,e=>this.visitBetweenExpression(e)),this.handlers.set(he.kind,e=>this.visitFunctionCall(e)),this.handlers.set(En.kind,e=>this.visitArrayExpression(e)),this.handlers.set(kn.kind,e=>this.visitArrayQueryExpression(e)),this.handlers.set(Jt.kind,e=>this.visitTupleExpression(e)),this.handlers.set(Gt.kind,e=>this.visitCastExpression(e)),this.handlers.set(ke.kind,e=>this.visitValueList(e)),this.handlers.set(Xs.kind,e=>this.visitStringSpecifierExpression(e)))}getTableSources(){return this.tableSources}reset(){this.tableSources=[],this.tableNameMap.clear(),this.visitedNodes.clear(),this.cteNames.clear()}getTableIdentifier(t){return t.qualifiedName.namespaces&&t.qualifiedName.namespaces.length>0?t.qualifiedName.namespaces.map(e=>e.name).join(".")+"."+(t.qualifiedName.name instanceof K?t.qualifiedName.name.value:t.qualifiedName.name.name):t.qualifiedName.name instanceof K?t.qualifiedName.name.value:t.qualifiedName.name.name}collect(t){return this.visit(t),this.getTableSources()}visit(t){if(!this.isRootVisit){this.visitNode(t);return}this.reset(),this.isRootVisit=!1;try{this.selectableOnly||this.collectCTEs(t),this.visitNode(t)}finally{this.isRootVisit=!0}}visitNode(t){if(this.visitedNodes.has(t))return;this.visitedNodes.add(t);let e=this.handlers.get(t.getKind());if(e){e(t);return}}collectCTEs(t){let e=new mt;e.visit(t);let n=e.getCommonTables();for(let r of n)this.cteNames.add(r.aliasExpression.table.name)}visitSimpleSelectQuery(t){if(t.fromClause&&t.fromClause.accept(this),!this.selectableOnly){if(t.withClause&&t.withClause.accept(this),t.whereClause&&t.whereClause.accept(this),t.groupByClause&&t.groupByClause.accept(this),t.havingClause&&t.havingClause.accept(this),t.orderByClause&&t.orderByClause.accept(this),t.windowClause)for(let e of t.windowClause.windows)e.accept(this);t.limitClause&&t.limitClause.accept(this),t.offsetClause&&t.offsetClause.accept(this),t.fetchClause&&t.fetchClause.accept(this),t.forClause&&t.forClause.accept(this),t.selectClause.accept(this)}}visitBinarySelectQuery(t){t.left.accept(this),t.right.accept(this)}visitValuesQuery(t){if(!this.selectableOnly)for(let e of t.tuples)e.accept(this)}visitWithClause(t){if(!this.selectableOnly)for(let e of t.tables)e.accept(this)}visitCommonTable(t){this.selectableOnly||t.query.accept(this)}visitFromClause(t){if(t.source.accept(this),t.joins)for(let e of t.joins)e.accept(this)}visitSourceExpression(t){t.datasource.accept(this)}visitTableSource(t){let e=this.getTableIdentifier(t);!this.tableNameMap.has(e)&&!this.isCTETable(t.table.name)&&(this.tableNameMap.set(e,!0),this.tableSources.push(t))}visitFunctionSource(t){t.argument&&this.visitValueComponent(t.argument)}visitValueComponent(t){t.accept(this)}isCTETable(t){return this.cteNames.has(t)}visitParenSource(t){t.source.accept(this)}visitSubQuerySource(t){this.selectableOnly||t.query.accept(this)}visitInlineQuery(t){this.selectableOnly||t.selectQuery.accept(this)}visitJoinClause(t){t.source.accept(this),!this.selectableOnly&&t.condition&&t.condition.accept(this)}visitJoinOnClause(t){this.selectableOnly||t.condition.accept(this)}visitJoinUsingClause(t){this.selectableOnly||t.condition.accept(this)}visitWhereClause(t){t.condition.accept(this)}visitGroupByClause(t){for(let e of t.grouping)e.accept(this)}visitHavingClause(t){t.condition.accept(this)}visitOrderByClause(t){for(let e of t.order)e.accept(this)}visitWindowFrameClause(t){t.expression.accept(this)}visitLimitClause(t){t.value.accept(this)}visitOffsetClause(t){t.value.accept(this)}visitFetchClause(t){t.expression.accept(this)}visitForClause(t){}visitOrderByItem(t){t.value.accept(this)}visitSelectClause(t){for(let e of t.items)e.accept(this)}visitSelectItem(t){t.value.accept(this)}visitParenExpression(t){t.expression.accept(this)}visitBinaryExpression(t){t.left.accept(this),t.right.accept(this)}visitUnaryExpression(t){t.expression.accept(this)}visitCaseExpression(t){t.condition&&t.condition.accept(this),t.switchCase.accept(this)}visitSwitchCaseArgument(t){for(let e of t.cases)e.accept(this);t.elseValue&&t.elseValue.accept(this)}visitCaseKeyValuePair(t){t.key.accept(this),t.value.accept(this)}visitBetweenExpression(t){t.expression.accept(this),t.lower.accept(this),t.upper.accept(this)}visitFunctionCall(t){t.argument&&t.argument.accept(this),t.over&&t.over.accept(this)}visitArrayExpression(t){t.expression.accept(this)}visitArrayQueryExpression(t){t.query.accept(this)}visitTupleExpression(t){for(let e of t.values)e.accept(this)}visitCastExpression(t){t.input.accept(this),t.castType.accept(this)}visitValueList(t){for(let e of t.values)e.accept(this)}visitStringSpecifierExpression(t){}},Rs,Cl=(Rs=class extends P{constructor(e){super(),this.hintContent=e}getFullHint(){return"/*+ "+this.hintContent+" */"}static isHintClause(e){let n=e.trim();return n.length>=5&&n.substring(0,3)==="/*+"&&n.substring(n.length-2)==="*/"}static extractHintContent(e){let n=e.trim();if(!this.isHintClause(n))throw new Error("Not a valid hint clause: "+e);return n.slice(3,-2).trim()}},Rs.kind=Symbol("HintClause"),Rs),k=class{constructor(t,e="",n=""){this.innerTokens=[],this.type=t,this.text=e,this.containerType=n}},Gu=class{static collect(t){let e=[];function n(r){if(!(!r||typeof r!="object")){r.constructor&&r.constructor.kind===M.kind&&e.push(r);for(let s of Object.keys(r)){let i=r[s];Array.isArray(i)?i.forEach(n):i&&typeof i=="object"&&i.constructor&&i.constructor.kind&&n(i)}}}return n(t),e}},Ky=class{constructor(t){this.start=(t==null?void 0:t.start)??'"',this.end=(t==null?void 0:t.end)??'"'}decorate(t){return t=this.start+t+this.end,t}},Gy=class{constructor(t){this.prefix=(t==null?void 0:t.prefix)??":",this.suffix=(t==null?void 0:t.suffix)??"",this.style=(t==null?void 0:t.style)??"named"}decorate(t,e){let n="";return this.style==="anonymous"?n=this.prefix:this.style==="indexed"?n=this.prefix+e:this.style==="named"&&(n=this.prefix+t+this.suffix),t=n,t}},As,Np=(As=class extends P{constructor(e){super(),this.withClause=e.withClause??null,this.updateClause=e.updateClause,this.setClause=e.setClause instanceof Kl?e.setClause:new Kl(e.setClause),this.whereClause=e.whereClause??null,this.fromClause=e.fromClause??null,this.returningClause=e.returning??null}},As.kind=Symbol("UpdateQuery"),As),Zt=class Sl{constructor(e=null,n=null){this.selectValues=[],this.visitedNodes=new Set,this.isRootVisit=!0,this.tableColumnResolver=e??null,this.commonTableCollector=new mt,this.commonTables=[],this.initialCommonTables=n,this.handlers=new Map,this.handlers.set(B.kind,r=>this.visitSimpleSelectQuery(r)),this.handlers.set(Se.kind,r=>this.visitSelectClause(r)),this.handlers.set(te.kind,r=>this.visitSourceExpression(r)),this.handlers.set(pe.kind,r=>this.visitFromClause(r))}getValues(){return this.selectValues}reset(){this.selectValues=[],this.visitedNodes.clear(),this.initialCommonTables?this.commonTables=this.initialCommonTables:this.commonTables=[]}collect(e){this.visit(e);let n=this.getValues();return this.reset(),n}visit(e){if(!this.isRootVisit){this.visitNode(e);return}this.reset(),this.isRootVisit=!1;try{this.visitNode(e)}finally{this.isRootVisit=!0}}visitNode(e){if(this.visitedNodes.has(e))return;this.visitedNodes.add(e);let n=this.handlers.get(e.getKind());if(n){n(e);return}}visitSimpleSelectQuery(e){this.commonTables.length===0&&this.initialCommonTables===null&&(this.commonTables=this.commonTableCollector.collect(e)),e.selectClause&&e.selectClause.accept(this);let n=this.selectValues.filter(s=>s.name==="*");if(n.length===0)return;if(this.selectValues.some(s=>s.value instanceof _&&s.value.namespaces===null)){e.fromClause&&this.processFromClause(e.fromClause,!0),this.selectValues=this.selectValues.filter(s=>s.name!=="*");return}let r=n.filter(s=>s.value instanceof _&&s.value.namespaces).map(s=>s.value.getNamespace());if(e.fromClause){let s=e.fromClause.getSourceAliasName();if(s&&r.includes(s)&&this.processFromClause(e.fromClause,!1),e.fromClause.joins)for(let i of e.fromClause.joins){let l=i.getSourceAliasName();l&&r.includes(l)&&this.processJoinClause(i)}}this.selectValues=this.selectValues.filter(s=>s.name!=="*")}processFromClause(e,n){if(e){let r=e.getSourceAliasName();if(this.processSourceExpression(r,e.source),e.joins&&n)for(let s of e.joins)this.processJoinClause(s)}}processJoinClause(e){let n=e.getSourceAliasName();this.processSourceExpression(n,e.source)}processSourceExpression(e,n){let r=this.commonTables.find(s=>s.aliasExpression.table.name===e);if(r){let s=this.commonTables.filter(i=>i.aliasExpression.table.name!==e);new Sl(this.tableColumnResolver,s).collect(r.query).forEach(i=>{this.addSelectValueAsUnique(i.name,new _(e?[e]:null,i.name))})}else new Sl(this.tableColumnResolver,this.commonTables).collect(n).forEach(s=>{this.addSelectValueAsUnique(s.name,new _(e?[e]:null,s.name))})}visitSelectClause(e){for(let n of e.items)this.processSelectItem(n)}processSelectItem(e){if(e.identifier)this.addSelectValueAsUnique(e.identifier.name,e.value);else if(e.value instanceof _){let n=e.value.column.name;n==="*"?this.selectValues.push({name:n,value:e.value}):this.addSelectValueAsUnique(n,e.value)}}visitSourceExpression(e){if(e.aliasExpression&&e.aliasExpression.columns){let n=e.getAliasName();e.aliasExpression.columns.forEach(r=>{this.addSelectValueAsUnique(r.name,new _(n?[n]:null,r.name))});return}else if(e.datasource instanceof ee){if(this.tableColumnResolver){let n=e.datasource.getSourceName();this.tableColumnResolver(n).forEach(r=>{this.addSelectValueAsUnique(r,new _([n],r))})}return}else if(e.datasource instanceof $e){let n=e.getAliasName();new Sl(this.tableColumnResolver,this.commonTables).collect(e.datasource.query).forEach(r=>{this.addSelectValueAsUnique(r.name,new _(n?[n]:null,r.name))});return}else if(e.datasource instanceof Ks)return this.visit(e.datasource.source)}visitFromClause(e){e&&this.processFromClause(e,!0)}addSelectValueAsUnique(e,n){this.selectValues.some(r=>r.name===e)||this.selectValues.push({name:e,value:n})}},Ms,bp=(Ms=class extends P{constructor(e){super(),this.tableName=new D(e.tableName),this.isTemporary=e.isTemporary??!1,this.asSelectQuery=e.asSelectQuery}getSelectQuery(){let e;return this.asSelectQuery?e=new Zt().collect(this.asSelectQuery).map(n=>new ce(n.value,n.name)):e=[new ce(new K("*"))],new B({selectClause:new Se(e),fromClause:new pe(new te(new ee(null,this.tableName.name),null),null)})}getCountQuery(){return new B({selectClause:new Se([new ce(new he(null,"count",new _(null,"*"),null))]),fromClause:new pe(new te(new ee(null,this.tableName.name),null),null)})}},Ms.kind=Symbol("CreateTableQuery"),Ms),Hy={mysql:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"?",parameterStyle:"anonymous"},postgres:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"$",parameterStyle:"indexed"},postgresWithNamedParams:{identifierEscape:{start:'"',end:'"'},parameterSymbol:":",parameterStyle:"named"},sqlserver:{identifierEscape:{start:"[",end:"]"},parameterSymbol:"@",parameterStyle:"named"},sqlite:{identifierEscape:{start:'"',end:'"'},parameterSymbol:":",parameterStyle:"named"},oracle:{identifierEscape:{start:'"',end:'"'},parameterSymbol:":",parameterStyle:"named"},clickhouse:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"?",parameterStyle:"anonymous"},firebird:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"?",parameterStyle:"anonymous"},db2:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"?",parameterStyle:"anonymous"},snowflake:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"?",parameterStyle:"anonymous"},cloudspanner:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"@",parameterStyle:"named"},duckdb:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"?",parameterStyle:"anonymous"},cockroachdb:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"$",parameterStyle:"indexed"},athena:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"?",parameterStyle:"anonymous"},bigquery:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"@",parameterStyle:"named"},hive:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"?",parameterStyle:"anonymous"},mariadb:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"?",parameterStyle:"anonymous"},redshift:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"$",parameterStyle:"indexed"},flinksql:{identifierEscape:{start:"`",end:"`"},parameterSymbol:"?",parameterStyle:"anonymous"},mongodb:{identifierEscape:{start:'"',end:'"'},parameterSymbol:"?",parameterStyle:"anonymous"}},S,Jy=(S=class{constructor(e){var n,r,s;this.handlers=new Map,this.index=1,e!=null&&e.preset&&(e={...e.preset,...e}),this.parameterDecorator=new Gy({prefix:typeof(e==null?void 0:e.parameterSymbol)=="string"?e.parameterSymbol:((n=e==null?void 0:e.parameterSymbol)==null?void 0:n.start)??":",suffix:typeof(e==null?void 0:e.parameterSymbol)=="object"?e.parameterSymbol.end:"",style:(e==null?void 0:e.parameterStyle)??"named"}),this.identifierDecorator=new Ky({start:((r=e==null?void 0:e.identifierEscape)==null?void 0:r.start)??'"',end:((s=e==null?void 0:e.identifierEscape)==null?void 0:s.end)??'"'}),this.handlers.set(ke.kind,i=>this.visitValueList(i)),this.handlers.set(_.kind,i=>this.visitColumnReference(i)),this.handlers.set(It.kind,i=>this.visitQualifiedName(i)),this.handlers.set(he.kind,i=>this.visitFunctionCall(i)),this.handlers.set(Nt.kind,i=>this.visitUnaryExpression(i)),this.handlers.set(A.kind,i=>this.visitBinaryExpression(i)),this.handlers.set(be.kind,i=>this.visitLiteralValue(i)),this.handlers.set(M.kind,i=>this.visitParameterExpression(i)),this.handlers.set(Cn.kind,i=>this.visitSwitchCaseArgument(i)),this.handlers.set(Sn.kind,i=>this.visitCaseKeyValuePair(i)),this.handlers.set(K.kind,i=>this.visitRawString(i)),this.handlers.set(D.kind,i=>this.visitIdentifierString(i)),this.handlers.set(qe.kind,i=>this.visitParenExpression(i)),this.handlers.set(Gt.kind,i=>this.visitCastExpression(i)),this.handlers.set(bt.kind,i=>this.visitCaseExpression(i)),this.handlers.set(En.kind,i=>this.visitArrayExpression(i)),this.handlers.set(kn.kind,i=>this.visitArrayQueryExpression(i)),this.handlers.set(fo.kind,i=>this.visitArraySliceExpression(i)),this.handlers.set(mo.kind,i=>this.visitArrayIndexExpression(i)),this.handlers.set(Tn.kind,i=>this.visitBetweenExpression(i)),this.handlers.set(Xs.kind,i=>this.visitStringSpecifierExpression(i)),this.handlers.set(Ht.kind,i=>this.visitTypeValue(i)),this.handlers.set(Jt.kind,i=>this.visitTupleExpression(i)),this.handlers.set(Hn.kind,i=>this.visitInlineQuery(i)),this.handlers.set(Jn.kind,i=>this.visitWindowFrameExpression(i)),this.handlers.set(Vs.kind,i=>this.visitWindowFrameSpec(i)),this.handlers.set(Bu.kind,i=>this.visitWindowFrameBoundStatic(i)),this.handlers.set(Uu.kind,i=>this.visitWindowFrameBoundaryValue(i)),this.handlers.set(Yn.kind,i=>this.visitPartitionByClause(i)),this.handlers.set(Nn.kind,i=>this.visitOrderByClause(i)),this.handlers.set(Zn.kind,i=>this.visitOrderByItem(i)),this.handlers.set(ce.kind,i=>this.visitSelectItem(i)),this.handlers.set(Se.kind,i=>this.visitSelectClause(i)),this.handlers.set(gp.kind,i=>this.visitDistinct(i)),this.handlers.set(vp.kind,i=>this.visitDistinctOn(i)),this.handlers.set(Cl.kind,i=>this.visitHintClause(i)),this.handlers.set(ee.kind,i=>this.visitTableSource(i)),this.handlers.set(yo.kind,i=>this.visitFunctionSource(i)),this.handlers.set(te.kind,i=>this.visitSourceExpression(i)),this.handlers.set(ze.kind,i=>this.visitSourceAliasExpression(i)),this.handlers.set(pe.kind,i=>this.visitFromClause(i)),this.handlers.set(qt.kind,i=>this.visitJoinClause(i)),this.handlers.set(On.kind,i=>this.visitJoinOnClause(i)),this.handlers.set(er.kind,i=>this.visitJoinUsingClause(i)),this.handlers.set(Yt.kind,i=>this.visitWhereClause(i)),this.handlers.set(bn.kind,i=>this.visitGroupByClause(i)),this.handlers.set(In.kind,i=>this.visitHavingClause(i)),this.handlers.set(Qu.kind,i=>this.visitWindowClause(i)),this.handlers.set(Xn.kind,i=>this.visitWindowFrameClause(i)),this.handlers.set(Xt.kind,i=>this.visitLimitClause(i)),this.handlers.set(zi.kind,i=>this.visitOffsetClause(i)),this.handlers.set(wo.kind,i=>this.visitFetchClause(i)),this.handlers.set(Ba.kind,i=>this.visitFetchExpression(i)),this.handlers.set(Gs.kind,i=>this.visitForClause(i)),this.handlers.set(Ot.kind,i=>this.visitWithClause(i)),this.handlers.set(st.kind,i=>this.visitCommonTable(i)),this.handlers.set(B.kind,i=>this.visitSimpleQuery(i)),this.handlers.set($e.kind,i=>this.visitSubQuerySource(i)),this.handlers.set(fe.kind,i=>this.visitBinarySelectQuery(i)),this.handlers.set(Ft.kind,i=>this.visitValuesQuery(i)),this.handlers.set(Jt.kind,i=>this.visitTupleExpression(i)),this.handlers.set(qu.kind,i=>this.visitInsertQuery(i)),this.handlers.set(Cp.kind,i=>this.visitInsertClause(i)),this.handlers.set(Np.kind,i=>this.visitUpdateQuery(i)),this.handlers.set(xp.kind,i=>this.visitUpdateClause(i)),this.handlers.set(Kl.kind,i=>this.visitSetClause(i)),this.handlers.set(Gl.kind,i=>this.visitSetClauseItem(i)),this.handlers.set(py.kind,i=>this.visitReturningClause(i)),this.handlers.set(bp.kind,i=>this.visitCreateTableQuery(i))}visitBinarySelectQuery(e){let n=new k(0,"");return n.innerTokens.push(this.visit(e.left)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,e.operator.value,"BinarySelectQueryOperator")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.right)),n}static commaSpaceTokens(){return[S.COMMA_TOKEN,S.SPACE_TOKEN]}static argumentCommaSpaceTokens(){return[S.ARGUMENT_SPLIT_COMMA_TOKEN,S.SPACE_TOKEN]}visitQualifiedName(e){let n=new k(0,"","QualifiedName");if(e.namespaces)for(let r=0;r<e.namespaces.length;r++)n.innerTokens.push(e.namespaces[r].accept(this)),n.innerTokens.push(S.DOT_TOKEN);return n.innerTokens.push(e.name.accept(this)),n}visitPartitionByClause(e){let n=new k(1,"partition by","PartitionByClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.value)),n}visitOrderByClause(e){let n=new k(1,"order by","OrderByClause");n.innerTokens.push(S.SPACE_TOKEN);for(let r=0;r<e.order.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(this.visit(e.order[r]));return n}visitOrderByItem(e){let n=new k(0,"","OrderByItem");return n.innerTokens.push(this.visit(e.value)),e.sortDirection&&e.sortDirection!=="asc"&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"desc"))),e.nullsPosition&&(e.nullsPosition==="first"?(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"nulls first"))):e.nullsPosition==="last"&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"nulls last")))),n}parse(e){this.index=1;let n=this.visit(e),r=Gu.collect(e).sort((i,l)=>(i.index??0)-(l.index??0)),s=this.parameterDecorator.style;if(s==="named"){let i={};for(let l of r){let o=l.name.value;if(i.hasOwnProperty(o)){if(i[o]!==l.value)throw new Error(`Duplicate parameter name '${o}' with different values detected during query composition.`);continue}i[o]=l.value}return{token:n,params:i}}else if(s==="indexed"){let i=r.map(l=>l.value);return{token:n,params:i}}else if(s==="anonymous"){let i=r.map(l=>l.value);return{token:n,params:i}}return{token:n,params:[]}}visit(e){let n=this.handlers.get(e.getKind());if(n){let r=n(e);return this.addCommentsToToken(r,e.comments),r}throw new Error(`[SqlPrintTokenParser] No handler for kind: ${e.getKind().toString()}`)}addCommentsToToken(e,n){if(!n||n.length===0)return;let r=this.createCommentBlocks(n);r.length>0&&this.insertCommentBlocksWithSpacing(e,r)}createCommentBlocks(e){let n=[];for(let r of e)r.trim()&&n.push(this.createSingleCommentBlock(r));return n}createSingleCommentBlock(e){let n=new k(0,"","CommentBlock"),r=new k(6,this.formatBlockComment(e));n.innerTokens.push(r);let s=new k(12,"");n.innerTokens.push(s);let i=new k(10," ");return n.innerTokens.push(i),n}insertCommentBlocksWithSpacing(e,n){if(e.innerTokens.unshift(...n),this.shouldAddSeparatorSpace(e.containerType)){let r=new k(10," ");e.innerTokens.splice(n.length,0,r),e.innerTokens.length>n.length+1&&e.innerTokens[n.length+1].type===10&&e.innerTokens.splice(n.length+1,1)}else e.innerTokens.length>n.length&&e.innerTokens[n.length].type===10&&e.innerTokens.splice(n.length,1)}shouldAddSeparatorSpace(e){return this.isClauseLevelContainer(e)}isClauseLevelContainer(e){switch(e){case"SelectClause":case"FromClause":case"WhereClause":case"GroupByClause":case"HavingClause":case"OrderByClause":case"LimitClause":case"OffsetClause":case"WithClause":case"SimpleSelectQuery":return!0;default:return!1}}formatBlockComment(e){return`/* ${e} */`}visitValueList(e){let n=new k(0,"","ValueList");for(let r=0;r<e.values.length;r++)r>0&&n.innerTokens.push(...S.argumentCommaSpaceTokens()),n.innerTokens.push(this.visit(e.values[r]));return n}visitColumnReference(e){let n=new k(0,"","ColumnReference");return n.innerTokens.push(e.qualifiedName.accept(this)),n}visitFunctionCall(e){let n=new k(0,"","FunctionCall");return n.innerTokens.push(e.qualifiedName.accept(this)),n.innerTokens.push(S.PAREN_OPEN_TOKEN),e.argument&&n.innerTokens.push(this.visit(e.argument)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),e.over&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"over")),e.over instanceof D?(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.over.accept(this))):(n.innerTokens.push(S.PAREN_OPEN_TOKEN),n.innerTokens.push(this.visit(e.over)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN))),n}visitUnaryExpression(e){let n=new k(0,"","UnaryExpression");return n.innerTokens.push(this.visit(e.operator)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.expression)),n}visitBinaryExpression(e){let n=new k(0,"","BinaryExpression");return n.innerTokens.push(this.visit(e.left)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(5,e.operator.value)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.right)),n}visitLiteralValue(e){let n;return typeof e.value=="string"?e.isDollarString?n=e.value:n=`'${e.value.replace(/'/g,"''")}'`:e.value===null?n="null":n=e.value.toString(),new k(2,n,"LiteralValue")}visitParameterExpression(e){e.index=this.index;let n=this.parameterDecorator.decorate(e.name.value,e.index),r=new k(7,n);return this.index++,r}visitSwitchCaseArgument(e){let n=new k(0,"","SwitchCaseArgument");for(let r of e.cases)n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(r.accept(this));return e.elseValue&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.createElseToken(e.elseValue))),n}createElseToken(e){let n=new k(0,"","ElseClause");n.innerTokens.push(new k(1,"else")),n.innerTokens.push(S.SPACE_TOKEN);let r=new k(0,"","CaseElseValue");return r.innerTokens.push(this.visit(e)),n.innerTokens.push(r),n}visitCaseKeyValuePair(e){let n=new k(0,"","CaseKeyValuePair");n.innerTokens.push(new k(1,"when")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.key)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"then")),n.innerTokens.push(S.SPACE_TOKEN);let r=new k(0,"","CaseThenValue");return r.innerTokens.push(this.visit(e.value)),n.innerTokens.push(r),n}visitRawString(e){return new k(2,e.value,"RawString")}visitIdentifierString(e){let n=e.name==="*"?e.name:this.identifierDecorator.decorate(e.name);return new k(2,n,"IdentifierString")}visitParenExpression(e){let n=new k(0,"","ParenExpression");return n.innerTokens.push(S.PAREN_OPEN_TOKEN),n.innerTokens.push(this.visit(e.expression)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitCastExpression(e){let n=new k(0,"","CastExpression");return n.innerTokens.push(this.visit(e.input)),n.innerTokens.push(new k(5,"::")),n.innerTokens.push(this.visit(e.castType)),n}visitCaseExpression(e){let n=new k(0,"","CaseExpression");return n.innerTokens.push(new k(1,"case")),e.condition&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.condition))),n.innerTokens.push(this.visit(e.switchCase)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"end")),n}visitArrayExpression(e){let n=new k(0,"","ArrayExpression");return n.innerTokens.push(new k(1,"array")),n.innerTokens.push(new k(4,"[")),n.innerTokens.push(this.visit(e.expression)),n.innerTokens.push(new k(4,"]")),n}visitArrayQueryExpression(e){let n=new k(0,"","ArrayExpression");return n.innerTokens.push(new k(1,"array")),n.innerTokens.push(new k(4,"(")),n.innerTokens.push(this.visit(e.query)),n.innerTokens.push(new k(4,")")),n}visitArraySliceExpression(e){let n=new k(0,"","ArrayExpression");return n.innerTokens.push(this.visit(e.array)),n.innerTokens.push(new k(4,"[")),e.startIndex&&n.innerTokens.push(this.visit(e.startIndex)),n.innerTokens.push(new k(5,":")),e.endIndex&&n.innerTokens.push(this.visit(e.endIndex)),n.innerTokens.push(new k(4,"]")),n}visitArrayIndexExpression(e){let n=new k(0,"","ArrayExpression");return n.innerTokens.push(this.visit(e.array)),n.innerTokens.push(new k(4,"[")),n.innerTokens.push(this.visit(e.index)),n.innerTokens.push(new k(4,"]")),n}visitBetweenExpression(e){let n=new k(0,"","BetweenExpression");return n.innerTokens.push(this.visit(e.expression)),n.innerTokens.push(S.SPACE_TOKEN),e.negated&&(n.innerTokens.push(new k(1,"not")),n.innerTokens.push(S.SPACE_TOKEN)),n.innerTokens.push(new k(1,"between")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.lower)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"and")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.upper)),n}visitStringSpecifierExpression(e){let n=e.specifier.accept(this).text,r=e.value.accept(this).text;return new k(2,n+r,"StringSpecifierExpression")}visitTypeValue(e){let n=new k(0,"","TypeValue");return n.innerTokens.push(e.qualifiedName.accept(this)),e.argument&&(n.innerTokens.push(S.PAREN_OPEN_TOKEN),n.innerTokens.push(this.visit(e.argument)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN)),n}visitTupleExpression(e){let n=new k(0,"","TupleExpression");n.innerTokens.push(S.PAREN_OPEN_TOKEN);for(let r=0;r<e.values.length;r++)r>0&&n.innerTokens.push(...S.argumentCommaSpaceTokens()),n.innerTokens.push(this.visit(e.values[r]));return n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitWindowFrameExpression(e){let n=new k(0,"","WindowFrameExpression"),r=!0;return e.partition&&(n.innerTokens.push(this.visit(e.partition)),r=!1),e.order&&(r?r=!1:n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.order))),e.frameSpec&&(r?r=!1:n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.frameSpec))),n}visitWindowFrameSpec(e){let n=new k(0,"","WindowFrameSpec");return n.innerTokens.push(new k(1,e.frameType)),e.endBound===null?(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.startBound.accept(this))):(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"between")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.startBound.accept(this)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"and")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.endBound.accept(this))),n}visitWindowFrameBoundaryValue(e){let n=new k(0,"","WindowFrameBoundaryValue");return n.innerTokens.push(e.value.accept(this)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,e.isFollowing?"following":"preceding")),n}visitWindowFrameBoundStatic(e){return new k(1,e.bound)}visitSelectItem(e){let n=new k(0,"","SelectItem");if(n.innerTokens.push(this.visit(e.value)),!e.identifier)return n;if(e.value instanceof _){let r=e.value.column.name;if(e.identifier.name===r)return n}return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"as")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.identifier)),n}visitSelectClause(e){let n=new k(1,"select","SelectClause"),r="select";for(let s of e.hints)r+=" "+this.visit(s).text;if(e.distinct){let s=e.distinct.accept(this);if(s.innerTokens&&s.innerTokens.length>0){let i=s.text;for(let l of s.innerTokens)i+=this.flattenTokenText(l);r+=" "+i}else r+=" "+s.text}n.text=r,n.innerTokens.push(S.SPACE_TOKEN);for(let s=0;s<e.items.length;s++)s>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(this.visit(e.items[s]));return n}flattenTokenText(e){let n=e.text;if(e.innerTokens)for(let r of e.innerTokens)n+=this.flattenTokenText(r);return n}visitHintClause(e){return new k(2,e.getFullHint())}visitDistinct(e){return new k(1,"distinct")}visitDistinctOn(e){let n=new k(0,"","DistinctOn");return n.innerTokens.push(new k(1,"distinct on")),n.innerTokens.push(S.PAREN_OPEN_TOKEN),n.innerTokens.push(e.value.accept(this)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitTableSource(e){let n="";Array.isArray(e.namespaces)&&e.namespaces.length>0&&(n=e.namespaces.map(s=>s.accept(this).text).join(".")+"."),n+=e.table.accept(this).text;let r=new k(2,n);return e.identifier&&(e.identifier.name,e.table.name),r}visitSourceExpression(e){let n=new k(0,"","SourceExpression");if(n.innerTokens.push(e.datasource.accept(this)),!e.aliasExpression)return n;if(e.datasource instanceof ee){let r=e.datasource.table.name;return e.aliasExpression.table.name===r||(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"as")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.aliasExpression.accept(this))),n}else return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"as")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.aliasExpression.accept(this)),n}visitFromClause(e){let n=new k(1,"from","FromClause");if(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.source)),e.joins)for(let r=0;r<e.joins.length;r++)n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.joins[r]));return n}visitJoinClause(e){let n=new k(0,"","JoinClause");return n.innerTokens.push(new k(1,e.joinType.value)),e.lateral&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"lateral"))),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.source)),e.condition&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.condition))),n}visitJoinOnClause(e){let n=new k(0,"","JoinOnClause");return n.innerTokens.push(new k(1,"on")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.condition)),n}visitJoinUsingClause(e){let n=new k(0,"","JoinUsingClause");return n.innerTokens.push(new k(1,"using")),n.innerTokens.push(S.PAREN_OPEN_TOKEN),n.innerTokens.push(this.visit(e.condition)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitFunctionSource(e){let n=new k(0,"","FunctionSource");return n.innerTokens.push(e.qualifiedName.accept(this)),n.innerTokens.push(S.PAREN_OPEN_TOKEN),e.argument&&n.innerTokens.push(this.visit(e.argument)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitSourceAliasExpression(e){let n=new k(0,"","SourceAliasExpression");if(n.innerTokens.push(this.visit(e.table)),e.columns){n.innerTokens.push(S.PAREN_OPEN_TOKEN);for(let r=0;r<e.columns.length;r++)r>0&&n.innerTokens.push(...S.argumentCommaSpaceTokens()),n.innerTokens.push(this.visit(e.columns[r]));n.innerTokens.push(S.PAREN_CLOSE_TOKEN)}return n}visitWhereClause(e){let n=new k(1,"where","WhereClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.condition)),n}visitGroupByClause(e){let n=new k(1,"group by","GroupByClause");n.innerTokens.push(S.SPACE_TOKEN);for(let r=0;r<e.grouping.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(this.visit(e.grouping[r]));return n}visitHavingClause(e){let n=new k(1,"having","HavingClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.condition)),n}visitWindowClause(e){let n=new k(1,"window","WindowClause");n.innerTokens.push(S.SPACE_TOKEN);for(let r=0;r<e.windows.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(this.visit(e.windows[r]));return n}visitWindowFrameClause(e){let n=new k(0,"","WindowFrameClause");return n.innerTokens.push(e.name.accept(this)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"as")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(S.PAREN_OPEN_TOKEN),n.innerTokens.push(this.visit(e.expression)),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitLimitClause(e){let n=new k(1,"limit","LimitClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.value)),n}visitOffsetClause(e){let n=new k(1,"offset","OffsetClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.value)),n}visitFetchClause(e){let n=new k(1,"fetch","FetchClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.expression)),n}visitFetchExpression(e){let n=new k(0,"","FetchExpression");return n.innerTokens.push(new k(1,e.type)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.count.accept(this)),e.unit&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,e.unit))),n}visitForClause(e){let n=new k(1,"for","ForClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,e.lockMode)),n}visitWithClause(e){let n=new k(1,"with","WithClause");n.innerTokens.push(S.SPACE_TOKEN),e.recursive&&(n.innerTokens.push(new k(1,"recursive")),n.innerTokens.push(S.SPACE_TOKEN));for(let r=0;r<e.tables.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(e.tables[r].accept(this));return n.innerTokens.push(S.SPACE_TOKEN),n}visitCommonTable(e){let n=new k(0,"","CommonTable");n.innerTokens.push(e.aliasExpression.accept(this)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"as")),n.innerTokens.push(S.SPACE_TOKEN),e.materialized!==null&&(e.materialized?n.innerTokens.push(new k(1,"materialized")):n.innerTokens.push(new k(1,"not materialized")),n.innerTokens.push(S.SPACE_TOKEN)),n.innerTokens.push(S.PAREN_OPEN_TOKEN);let r=new k(0,"","SubQuerySource");return r.innerTokens.push(e.query.accept(this)),n.innerTokens.push(r),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitSimpleQuery(e){let n=new k(0,"","SimpleSelectQuery");return e.withClause&&n.innerTokens.push(e.withClause.accept(this)),n.innerTokens.push(e.selectClause.accept(this)),e.fromClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.fromClause.accept(this)),e.whereClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.whereClause.accept(this))),e.groupByClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.groupByClause.accept(this))),e.havingClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.havingClause.accept(this))),e.orderByClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.orderByClause.accept(this))),e.windowClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.windowClause.accept(this))),e.limitClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.limitClause.accept(this))),e.offsetClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.offsetClause.accept(this))),e.fetchClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.fetchClause.accept(this))),e.forClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.forClause.accept(this)))),n}visitSubQuerySource(e){let n=new k(0,"");n.innerTokens.push(S.PAREN_OPEN_TOKEN);let r=new k(0,"","SubQuerySource");return r.innerTokens.push(e.query.accept(this)),n.innerTokens.push(r),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitValuesQuery(e){let n=new k(1,"values","ValuesQuery");n.innerTokens.push(S.SPACE_TOKEN);let r=new k(0,"","Values");for(let s=0;s<e.tuples.length;s++)s>0&&r.innerTokens.push(...S.commaSpaceTokens()),r.innerTokens.push(e.tuples[s].accept(this));return n.innerTokens.push(r),n}visitInlineQuery(e){let n=new k(0,"");n.innerTokens.push(S.PAREN_OPEN_TOKEN);let r=new k(0,"","InlineQuery");return r.innerTokens.push(e.selectQuery.accept(this)),n.innerTokens.push(r),n.innerTokens.push(S.PAREN_CLOSE_TOKEN),n}visitInsertQuery(e){let n=new k(0,"","InsertQuery");return n.innerTokens.push(this.visit(e.insertClause)),e.selectQuery&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(this.visit(e.selectQuery))),n}visitInsertClause(e){let n=new k(0,"");if(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"insert into")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.source.accept(this)),e.columns.length>0){n.innerTokens.push(S.PAREN_OPEN_TOKEN);for(let r=0;r<e.columns.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(e.columns[r].accept(this));n.innerTokens.push(S.PAREN_CLOSE_TOKEN)}return n}visitUpdateQuery(e){let n=new k(0,"","UpdateQuery");return e.withClause&&n.innerTokens.push(e.withClause.accept(this)),n.innerTokens.push(e.updateClause.accept(this)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.setClause.accept(this)),e.fromClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.fromClause.accept(this))),e.whereClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.whereClause.accept(this))),e.returningClause&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.returningClause.accept(this))),n}visitUpdateClause(e){let n=new k(1,"update","UpdateClause");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.source.accept(this)),n}visitSetClause(e){let n=new k(1,"set","SelectClause");n.innerTokens.push(S.SPACE_TOKEN);for(let r=0;r<e.items.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(this.visit(e.items[r]));return n}visitSetClauseItem(e){let n=new k(0,"","SetClauseItem");return n.innerTokens.push(e.column.accept(this)),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(5,"=")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.value.accept(this)),n}visitReturningClause(e){let n=new k(1,"returning","ReturningClause");n.innerTokens.push(S.SPACE_TOKEN);for(let r=0;r<e.columns.length;r++)r>0&&n.innerTokens.push(...S.commaSpaceTokens()),n.innerTokens.push(this.visit(e.columns[r]));return n}visitCreateTableQuery(e){let n=new k(1,e.isTemporary?"create temporary table":"create table","CreateTableQuery");return n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.tableName.accept(this)),e.asSelectQuery&&(n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(new k(1,"as")),n.innerTokens.push(S.SPACE_TOKEN),n.innerTokens.push(e.asSelectQuery.accept(this))),n}},S.SPACE_TOKEN=new k(10," "),S.COMMA_TOKEN=new k(3,","),S.ARGUMENT_SPLIT_COMMA_TOKEN=new k(11,","),S.PAREN_OPEN_TOKEN=new k(4,"("),S.PAREN_CLOSE_TOKEN=new k(4,")"),S.DOT_TOKEN=new k(8,"."),S),id=class{constructor(t=" ",e=0,n=`\r
`){this.indentChar=t,this.indentSize=e,this.newline=n,this.lines=[],this.appendNewline(0)}print(){let t="";for(let e of this.lines)e.text!==""&&(t+=this.indent(e.level)+e.text);return t.trimEnd()}indent(t){return this.indentChar.repeat(this.indentSize*t)}appendNewline(t){if(this.lines.length>0){let e=this.lines[this.lines.length-1];e.text!==""&&(e.text=e.text.trimEnd()+this.newline)}this.lines.push(new Yy(t,""))}appendText(t){if(this.lines.length>0){let e=this.lines.length-1,n=this.lines[e];t===" "&&n.text===""||(n.text+=t)}else throw new Error("No tokens to append to.")}getCurrentLine(){if(this.lines.length>0)return this.lines[this.lines.length-1];throw new Error("No tokens to get current line from.")}},Yy=class{constructor(t,e){this.level=t,this.text=e}},Xy=class Ip{constructor(e){this.insideWithClause=!1,this.indentChar=(e==null?void 0:e.indentChar)??"",this.indentSize=(e==null?void 0:e.indentSize)??0,this.newline=(e==null?void 0:e.newline)??" ",this.commaBreak=(e==null?void 0:e.commaBreak)??"none",this.andBreak=(e==null?void 0:e.andBreak)??"none",this.keywordCase=(e==null?void 0:e.keywordCase)??"none",this.exportComment=(e==null?void 0:e.exportComment)??!1,this.strictCommentPlacement=(e==null?void 0:e.strictCommentPlacement)??!1,this.withClauseStyle=(e==null?void 0:e.withClauseStyle)??"standard",this.linePrinter=new id(this.indentChar,this.indentSize,this.newline),this.indentIncrementContainers=new Set((e==null?void 0:e.indentIncrementContainerTypes)??["SelectClause","FromClause","WhereClause","GroupByClause","HavingClause","WindowFrameExpression","PartitionByClause","OrderByClause","WindowClause","LimitClause","OffsetClause","SubQuerySource","BinarySelectQueryOperator","Values","WithClause","SwitchCaseArgument","CaseKeyValuePair","CaseThenValue","ElseClause","CaseElseValue","SimpleSelectQuery"])}print(e,n=0){return this.linePrinter=new id(this.indentChar,this.indentSize,this.newline),this.insideWithClause=!1,this.linePrinter.lines.length>0&&n!==this.linePrinter.lines[0].level&&(this.linePrinter.lines[0].level=n),this.appendToken(e,n,void 0),this.linePrinter.print()}appendToken(e,n,r){if(this.insideWithClause,e.containerType==="WithClause"&&this.withClauseStyle==="full-oneline"&&(this.insideWithClause=!0),this.shouldSkipToken(e))return;let s=this.linePrinter.getCurrentLine();if(e.type===1)this.handleKeywordToken(e,n);else if(e.type===3)this.handleCommaToken(e,n,r);else if(e.type===5&&e.text.toLowerCase()==="and")this.handleAndOperatorToken(e,n);else if(e.containerType==="JoinClause")this.handleJoinClauseToken(e,n);else if(e.type===6)this.exportComment&&this.linePrinter.appendText(e.text);else if(e.type===10)this.handleSpaceToken(e,r);else if(e.type===12)this.handleCommentNewlineToken(e,n);else if(e.containerType==="CommonTable"&&this.withClauseStyle==="cte-oneline"){this.handleCteOnelineToken(e,n);return}else this.linePrinter.appendText(e.text);if(e.keywordTokens&&e.keywordTokens.length>0)for(let l=0;l<e.keywordTokens.length;l++){let o=e.keywordTokens[l];this.appendToken(o,n,e.containerType)}let i=n;!this.isOnelineMode()&&s.text!==""&&this.indentIncrementContainers.has(e.containerType)&&(this.insideWithClause&&this.withClauseStyle==="full-oneline"||(i++,this.linePrinter.appendNewline(i)));for(let l=0;l<e.innerTokens.length;l++){let o=e.innerTokens[l];this.appendToken(o,i,e.containerType)}if(e.containerType==="WithClause"&&this.withClauseStyle==="full-oneline"){this.insideWithClause=!1,this.linePrinter.appendNewline(n);return}i!==n&&(this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.linePrinter.appendNewline(n))}shouldSkipToken(e){return e.type===12?!1:(!e.innerTokens||e.innerTokens.length===0)&&e.text===""}applyKeywordCase(e){return this.keywordCase==="upper"?e.toUpperCase():this.keywordCase==="lower"?e.toLowerCase():e}handleKeywordToken(e,n){let r=this.applyKeywordCase(e.text);this.linePrinter.appendText(r)}handleCommaToken(e,n,r){let s=e.text;this.insideWithClause&&this.withClauseStyle==="full-oneline"?this.linePrinter.appendText(s):this.withClauseStyle==="cte-oneline"&&r==="WithClause"?(this.linePrinter.appendText(s),this.linePrinter.appendNewline(n)):this.commaBreak==="before"?(this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.linePrinter.appendNewline(n),this.linePrinter.appendText(s)):this.commaBreak==="after"?(this.linePrinter.appendText(s),this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.linePrinter.appendNewline(n)):this.linePrinter.appendText(s)}handleAndOperatorToken(e,n){let r=this.applyKeywordCase(e.text);this.andBreak==="before"?(this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.linePrinter.appendNewline(n),this.linePrinter.appendText(r)):this.andBreak==="after"?(this.linePrinter.appendText(r),this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.linePrinter.appendNewline(n)):this.linePrinter.appendText(r)}handleJoinClauseToken(e,n){let r=this.applyKeywordCase(e.text);this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.linePrinter.appendNewline(n),this.linePrinter.appendText(r)}handleSpaceToken(e,n){this.shouldSkipCommentBlockSpace(n)||this.linePrinter.appendText(e.text)}shouldSkipCommentBlockSpace(e){return e==="CommentBlock"&&this.insideWithClause&&this.withClauseStyle==="full-oneline"}handleCommentNewlineToken(e,n){this.shouldSkipCommentNewline()||this.isOnelineMode()||this.linePrinter.appendNewline(n)}shouldSkipCommentNewline(){return this.insideWithClause&&this.withClauseStyle==="full-oneline"||this.withClauseStyle==="cte-oneline"}isOnelineMode(){return this.newline===" "}handleCteOnelineToken(e,n){let r=this.createCteOnelinePrinter().print(e,n),s=this.cleanDuplicateSpaces(r);this.linePrinter.appendText(s)}createCteOnelinePrinter(){return new Ip({indentChar:"",indentSize:0,newline:" ",commaBreak:this.commaBreak,andBreak:this.andBreak,keywordCase:this.keywordCase,exportComment:this.exportComment,strictCommentPlacement:this.strictCommentPlacement,withClauseStyle:"standard"})}cleanDuplicateSpaces(e){return e.replace(/\s{2,}/g," ")}},Ut=class{constructor(t={}){let e=t.preset?Hy[t.preset]:void 0;if(t.preset&&!e)throw new Error(`Invalid preset: ${t.preset}`);let n={...e,identifierEscape:t.identifierEscape??(e==null?void 0:e.identifierEscape),parameterSymbol:t.parameterSymbol??(e==null?void 0:e.parameterSymbol),parameterStyle:t.parameterStyle??(e==null?void 0:e.parameterStyle)};this.parser=new Jy(n),this.printer=new Xy(t)}format(t){let{token:e,params:n}=this.parser.parse(t);return{formattedSql:this.printer.print(e),params:n}}},Si=class{constructor(){this.sqlFormatter=new Ut({identifierEscape:{start:'"',end:'"'},parameterSymbol:":",parameterStyle:"named"})}format(t,e=null){return e&&(this.sqlFormatter=new Ut(e)),this.sqlFormatter.format(t).formattedSql}formatWithParameters(t,e=null){e&&(this.sqlFormatter=new Ut(e));let n=this.sqlFormatter.format(t);return{sql:n.formattedSql,params:n.params}}visit(t){return this.format(t)}},Zy=class{constructor(){this.sourceCollector=new Ku(!0),this.cteCollector=new mt,this.formatter=new Si}build(t){if(t.length===0)return new Ot(!1,t);let e=this.resolveDuplicateNames(t),{tableMap:n,recursiveCTEs:r,dependencies:s}=this.buildDependencyGraph(e),i=this.sortCommonTables(e,n,r,s);return new Ot(r.size>0,i)}resolveDuplicateNames(t){let e=new Map;for(let r of t){let s=r.aliasExpression.table.name;e.has(s)||e.set(s,[]),e.get(s).push(r)}let n=[];for(let[r,s]of e.entries()){if(s.length===1){n.push(s[0]);continue}let i=s.map(l=>this.formatter.format(l.query));if(new Set(i).size===1)n.push(s[0]);else throw new Error(`CTE name conflict detected: '${r}' has multiple different definitions`)}return n}buildDependencyGraph(t){let e=new Map;for(let i of t)e.set(i.aliasExpression.table.name,i);let n=new Set,r=new Map,s=new Map;for(let i of t){let l=i.aliasExpression.table.name,o=this.sourceCollector.collect(i.query);for(let u of o)if(u.table.name===l){n.add(l);break}r.has(l)||r.set(l,new Set);let a=this.cteCollector.collect(i.query);for(let u of a){let c=u.aliasExpression.table.name;e.has(c)&&(r.get(l).add(c),s.has(c)||s.set(c,new Set),s.get(c).add(l))}}return{tableMap:e,recursiveCTEs:n,dependencies:r}}sortCommonTables(t,e,n,r){let s=[],i=[],l=new Set,o=new Set,a=u=>{if(l.has(u))return;if(o.has(u))throw new Error(`Circular reference detected in CTE: ${u}`);o.add(u);let c=r.get(u)||new Set;for(let m of c)a(m);o.delete(u),l.add(u),n.has(u)?s.push(e.get(u)):i.push(e.get(u))};for(let u of t){let c=u.aliasExpression.table.name;l.has(c)||a(c)}return[...s,...i]}},ew=class{constructor(){this.nameConflictResolver=new Zy,this.cteCollector=new mt}inject(t,e){if(e.length===0)return t;e.push(...this.cteCollector.collect(t));let n=this.nameConflictResolver.build(e);if(t instanceof B)return this.injectIntoSimpleQuery(t,n);if(t instanceof fe)return this.injectIntoBinaryQuery(t,n);throw new Error("Unsupported query type")}injectIntoSimpleQuery(t,e){if(t.withClause)throw new Error("The query already has a WITH clause. Please remove it before injecting new CTEs.");return t.withClause=e,t}injectIntoBinaryQuery(t,e){if(t.left instanceof B)return this.injectIntoSimpleQuery(t.left,e),t;if(t.left instanceof fe)return this.injectIntoBinaryQuery(t.left,e),t;throw new Error("Unsupported query type for BinarySelectQuery left side")}},Hs=class{constructor(){}static normalize(t){let e=new mt().collect(t);return e.length===0?t:(new Vu().execute(t),new ew().inject(t,e))}},Hu=(t=>(t.ColumnNameOnly="columnNameOnly",t.FullName="fullName",t))(Hu||{}),kt=class Op{constructor(e,n=!1,r="columnNameOnly",s){this.selectValues=[],this.visitedNodes=new Set,this.uniqueKeys=new Set,this.isRootVisit=!0,this.tableColumnResolver=null,this.commonTables=[],this.initializeProperties(e,n,r,s),this.initializeHandlers()}initializeProperties(e,n,r,s){this.tableColumnResolver=e??null,this.includeWildCard=n,this.commonTableCollector=new mt,this.commonTables=[],this.duplicateDetection=r,this.options=s||{}}initializeHandlers(){this.handlers=new Map,this.handlers.set(B.kind,e=>this.visitSimpleSelectQuery(e)),this.handlers.set(fe.kind,e=>this.visitBinarySelectQuery(e)),this.initializeClauseHandlers(),this.initializeValueComponentHandlers()}initializeClauseHandlers(){this.handlers.set(Se.kind,e=>this.visitSelectClause(e)),this.handlers.set(pe.kind,e=>this.visitFromClause(e)),this.handlers.set(Yt.kind,e=>this.visitWhereClause(e)),this.handlers.set(bn.kind,e=>this.visitGroupByClause(e)),this.handlers.set(In.kind,e=>this.visitHavingClause(e)),this.handlers.set(Nn.kind,e=>this.visitOrderByClause(e)),this.handlers.set(Xn.kind,e=>this.visitWindowFrameClause(e)),this.handlers.set(Xt.kind,e=>this.visitLimitClause(e)),this.handlers.set(zi.kind,e=>this.offsetClause(e)),this.handlers.set(wo.kind,e=>this.visitFetchClause(e)),this.handlers.set(On.kind,e=>this.visitJoinOnClause(e)),this.handlers.set(er.kind,e=>this.visitJoinUsingClause(e))}initializeValueComponentHandlers(){this.handlers.set(_.kind,e=>this.visitColumnReference(e)),this.handlers.set(A.kind,e=>this.visitBinaryExpression(e)),this.handlers.set(Nt.kind,e=>this.visitUnaryExpression(e)),this.handlers.set(he.kind,e=>this.visitFunctionCall(e)),this.handlers.set(qe.kind,e=>this.visitParenExpression(e)),this.handlers.set(bt.kind,e=>this.visitCaseExpression(e)),this.handlers.set(Gt.kind,e=>this.visitCastExpression(e)),this.handlers.set(Tn.kind,e=>this.visitBetweenExpression(e)),this.handlers.set(En.kind,e=>this.visitArrayExpression(e)),this.handlers.set(kn.kind,e=>this.visitArrayQueryExpression(e)),this.handlers.set(ke.kind,e=>this.visitValueList(e)),this.handlers.set(Jn.kind,e=>this.visitWindowFrameExpression(e)),this.handlers.set(Yn.kind,e=>this.visitPartitionByClause(e))}getValues(){return this.selectValues}collect(e){if(!e)throw new Error("Input argument cannot be null or undefined");this.visit(e);let n=this.getValues();return this.reset(),n}reset(){this.selectValues=[],this.visitedNodes.clear(),this.uniqueKeys.clear(),this.commonTables=[]}addSelectValueAsUnique(e,n){let r=this.generateUniqueKey(e,n);this.uniqueKeys.has(r)||(this.uniqueKeys.add(r),this.selectValues.push({name:e,value:n}))}generateUniqueKey(e,n){if(this.duplicateDetection==="columnNameOnly")return this.normalizeColumnName(e);{let r="";n&&typeof n.getNamespace=="function"&&(r=n.getNamespace()||"");let s=r?r+"."+e:e;return this.normalizeColumnName(s)}}normalizeColumnName(e){if(typeof e!="string")throw new Error("Column name must be a string");return this.options.ignoreCaseAndUnderscore?e.toLowerCase().replace(/_/g,""):e}visit(e){if(!this.isRootVisit){this.visitNode(e);return}if(!(e instanceof B||e instanceof fe))throw new Error("Root visit requires a SimpleSelectQuery or BinarySelectQuery.");this.reset(),this.isRootVisit=!1,this.commonTables=this.commonTableCollector.collect(e);try{this.visitNode(e)}finally{this.isRootVisit=!0}}visitNode(e){if(!this.visitedNodes.has(e)){this.visitedNodes.add(e);try{let n=this.handlers.get(e.getKind());n&&n(e)}catch(n){let r=n instanceof Error?n.message:String(n);throw new Error(`Error processing SQL component of type ${e.getKind().toString()}: ${r}`)}}}visitSimpleSelectQuery(e){if(e.selectClause&&e.selectClause.accept(this),e.fromClause&&e.fromClause.accept(this),e.whereClause&&e.whereClause.accept(this),e.groupByClause&&e.groupByClause.accept(this),e.havingClause&&e.havingClause.accept(this),e.windowClause)for(let n of e.windowClause.windows)n.accept(this);e.orderByClause&&e.orderByClause.accept(this),e.limitClause&&e.limitClause.accept(this),e.offsetClause&&e.offsetClause.accept(this),e.fetchClause&&e.fetchClause.accept(this),e.forClause&&e.forClause.accept(this)}visitBinarySelectQuery(e){e.left instanceof B?this.visitSimpleSelectQuery(e.left):e.left instanceof fe&&this.visitBinarySelectQuery(e.left),e.right instanceof B?this.visitSimpleSelectQuery(e.right):e.right instanceof fe&&this.visitBinarySelectQuery(e.right)}visitSelectClause(e){for(let n of e.items)n.identifier&&this.addSelectValueAsUnique(n.identifier.name,n.value),n.value.accept(this)}visitFromClause(e){let n=new Zt(this.tableColumnResolver,this.commonTables).collect(e);for(let r of n)this.addSelectValueAsUnique(r.name,r.value);if(this.options.upstream&&this.collectUpstreamColumns(e),e.joins)for(let r of e.joins)r.condition&&r.condition.accept(this)}visitWhereClause(e){e.condition&&e.condition.accept(this)}visitGroupByClause(e){if(e.grouping)for(let n of e.grouping)n.accept(this)}visitHavingClause(e){e.condition&&e.condition.accept(this)}visitOrderByClause(e){if(e.order)for(let n of e.order)n.accept(this)}visitWindowFrameClause(e){e.expression.accept(this)}visitWindowFrameExpression(e){e.partition&&e.partition.accept(this),e.order&&e.order.accept(this),e.frameSpec&&e.frameSpec.accept(this)}visitLimitClause(e){e.value&&e.value.accept(this)}offsetClause(e){e.value&&e.value.accept(this)}visitFetchClause(e){e.expression&&e.expression.accept(this)}visitJoinOnClause(e){e.condition&&e.condition.accept(this)}visitJoinUsingClause(e){e.condition&&e.condition.accept(this)}visitColumnReference(e){if(e.column.name!=="*")this.addSelectValueAsUnique(e.column.name,e);else if(this.includeWildCard)this.addSelectValueAsUnique(e.column.name,e);else return}visitBinaryExpression(e){e.left&&e.left.accept(this),e.right&&e.right.accept(this)}visitUnaryExpression(e){e.expression&&e.expression.accept(this)}visitFunctionCall(e){e.argument&&e.argument.accept(this),e.over&&e.over.accept(this)}visitParenExpression(e){e.expression&&e.expression.accept(this)}visitCaseExpression(e){e.condition&&e.condition.accept(this),e.switchCase&&e.switchCase.accept(this)}visitCastExpression(e){e.input&&e.input.accept(this)}visitBetweenExpression(e){e.expression&&e.expression.accept(this),e.lower&&e.lower.accept(this),e.upper&&e.upper.accept(this)}visitArrayExpression(e){e.expression&&e.expression.accept(this)}visitArrayQueryExpression(e){e.query.accept(this)}visitValueList(e){if(e.values)for(let n of e.values)n.accept(this)}visitPartitionByClause(e){e.value.accept(this)}collectUpstreamColumns(e){if(this.collectUpstreamColumnsFromSource(e.source),e.joins)for(let n of e.joins)this.collectUpstreamColumnsFromSource(n.source)}collectUpstreamColumnsFromSource(e){if(e.datasource instanceof ee){let n=this.findCTEByName(e.datasource.table.name);n?this.collectUpstreamColumnsFromCTE(n):this.collectUpstreamColumnsFromTable(e.datasource)}else e.datasource instanceof $e?this.collectUpstreamColumnsFromSubquery(e.datasource):e.datasource instanceof Ks&&this.collectUpstreamColumnsFromSource(new te(e.datasource.source,null))}collectUpstreamColumnsFromTable(e){if(this.tableColumnResolver){let n=e.table.name,r=this.tableColumnResolver(n);for(let s of r){let i=new _(e.table.name,s);this.addSelectValueAsUnique(s,i)}}}collectUpstreamColumnsFromSubquery(e){if(e.query instanceof B){let n=new Op(this.tableColumnResolver,this.includeWildCard,this.duplicateDetection,{...this.options,upstream:!0}).collect(e.query);for(let r of n)this.addSelectValueAsUnique(r.name,r.value)}}collectUpstreamColumnsFromCTE(e){if(e.query instanceof B){let n=new Zt(this.tableColumnResolver,this.commonTables).collect(e.query.selectClause);for(let r of n)this.addSelectValueAsUnique(r.name,r.value)}}findCTEByName(e){return this.commonTables.find(n=>n.getSourceAliasName()===e)||null}},Qa=class Wa{static parse(e){let n=new oe(e).readLexmes(),r=this.parseFromLexeme(n,0);if(r.newIndex<n.length)throw new Error(`Syntax error: Unexpected token "${n[r.newIndex].value}" at position ${r.newIndex}. The source component is complete but there are additional tokens.`);return r.value}static parseTableSourceFromLexemes(e,n){let r=Bt.parseFromLexeme(e,n);return this.parseTableSource(r)}static parseFromLexeme(e,n){let r=n;if(r<e.length&&e[r].type&4)return this.parseParenSource(e,r);let s=Bt.parseFromLexeme(e,r);return s.lastTokenType&2048?Wa.parseFunctionSource(e,s):Wa.parseTableSource(s)}static parseTableSource(e){let{namespaces:n,name:r,newIndex:s}=e;return{value:new ee(n,r.name),newIndex:s}}static parseFunctionSource(e,n){let r=n.newIndex,{namespaces:s,name:i}=n,l=U.parseArgument(4,8,e,r);r=l.newIndex;let o=i.name;return{value:new yo({namespaces:s,name:o},l.value),newIndex:r}}static parseParenSource(e,n){let r=n;if(r++,r>=e.length)throw new Error(`Syntax error: Unexpected end of input at position ${r}. Expected a subquery or nested expression after opening parenthesis.`);let s=e[r].value;if(s==="select"||s==="values"||s==="with"){let i=this.parseSubQuerySource(e,r);if(r=i.newIndex,r<e.length&&e[r].type==8)r++;else throw new Error(`Syntax error at position ${r}: Missing closing parenthesis. Each opening parenthesis must have a matching closing parenthesis.`);return{value:i.value,newIndex:r}}else if(e[r].type==4){let i=this.parseParenSource(e,r);if(r=i.newIndex,r<e.length&&e[r].type==8)r++;else throw new Error(`Syntax error at position ${r}: Missing closing parenthesis. Each opening parenthesis must have a matching closing parenthesis.`);return{value:i.value,newIndex:r}}throw new Error(`Syntax error at position ${r}: Expected 'SELECT' keyword, 'VALUES' keyword, or opening parenthesis '(' but found "${e[r].value}".`)}static parseSubQuerySource(e,n){let r=n,{value:s,newIndex:i}=Q.parseFromLexeme(e,r);return r=i,{value:new $e(s),newIndex:r}}},Fp=class extends Error{constructor(t){super(`CTE '${t}' already exists in the query`),this.cteName=t,this.name="DuplicateCTEError"}},za=class extends Error{constructor(t,e){super(`Invalid CTE name '${t}': ${e}`),this.cteName=t,this.name="InvalidCTENameError"}},Lp=class extends Error{constructor(t){super(`CTE '${t}' not found in the query`),this.cteName=t,this.name="CTENotFoundError"}},Ju=class{constructor(t,e){this.options=e||{},this.tableColumnResolver=t,this.columnCollector=new kt(this.tableColumnResolver)}find(t,e){let n=typeof e=="string"?[e]:e,r=new mt().collect(t),s=new Map;for(let i of r)s.set(i.getSourceAliasName(),i);return this.findUpstream(t,n,s)}handleTableSource(t,e,n){let r=n.get(t.table.name);if(r){let s=new Map(n);s.delete(t.table.name);let i=this.findUpstream(r.query,e,s);return i.length===0?null:i}return null}handleSubQuerySource(t,e,n){let r=this.findUpstream(t.query,e,n);return r.length===0?null:r}processFromClauseBranches(t,e,n){let r=t.getSources();if(r.length===0)return null;let s=[],i=!0,l=0;for(let o of r){let a=o.datasource,u=null;if(a instanceof ee)u=this.handleTableSource(a,e,n),l++;else if(a instanceof $e)u=this.handleSubQuerySource(a,e,n),l++;else{if(a instanceof Ft)continue;i=!1;break}if(u===null){i=!1;break}s.push(u)}return i&&s.length===l?s.flat():null}findUpstream(t,e,n){if(t instanceof B){let r=t.fromClause;if(r){let a=this.processFromClauseBranches(r,e,n);if(a&&a.length>0)return a}let s=this.columnCollector.collect(t).map(a=>a.name),i=this.collectCTEColumns(t,n),l=[...s,...i],o=a=>this.options.ignoreCaseAndUnderscore?a.toLowerCase().replace(/_/g,""):a;return e.every(a=>l.some(u=>o(u)===o(a)))?[t]:[]}else if(t instanceof fe){let r=this.findUpstream(t.left,e,n),s=this.findUpstream(t.right,e,n);return[...r,...s]}return[]}collectCTEColumns(t,e){let n=[];if(t.withClause)for(let r of t.withClause.tables){let s=this.collectColumnsFromSelectQuery(r.query);n.push(...s)}return n}collectColumnsFromSelectQuery(t){if(t instanceof B)try{return this.columnCollector.collect(t).map(e=>e.name)}catch(e){return console.warn("Failed to collect columns from SimpleSelectQuery:",e),[]}else if(t instanceof fe)return this.collectColumnsFromSelectQuery(t.left);return[]}},Va=class{static parseFromLexeme(t,e){var r;let n=e;if(n<t.length&&(t[n].type&64||t[n].type&2048)){let s=t[n].value;if(n++,n<t.length&&t[n].type&4){let i=[];for(n++;n<t.length&&t[n].type&64&&(i.push(t[n].value),n++,n<t.length&&t[n].type&16);)n++;if(t[n].type&8)n++;else throw new Error(`Syntax error at position ${n}: Missing closing parenthesis ')' for column alias list. Each opening parenthesis must have a matching closing parenthesis.`);if(i.length===0)throw new Error(`Syntax error at position ${e}: No column aliases found. Column alias declarations must contain at least one column name.`);return{value:new ze(s,i),newIndex:n}}return{value:new ze(s,null),newIndex:n}}throw new Error(`Syntax error at position ${e}: Expected an identifier for table alias but found "${((r=t[e])==null?void 0:r.value)||"end of input"}".`)}},Hl=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The source expression is complete but there are additional tokens.`);return n.value}static parseTableSourceFromLexemes(t,e){let n=Qa.parseTableSourceFromLexemes(t,e);return{value:new te(n.value,null),newIndex:n.newIndex}}static parseFromLexeme(t,e){let n=e,r=Qa.parseFromLexeme(t,n);if(n=r.newIndex,n<t.length){if(t[n].value==="as"){n++;let s=Va.parseFromLexeme(t,n);return n=s.newIndex,{value:new te(r.value,s.value),newIndex:n}}if(n<t.length&&this.isTokenTypeAliasCandidate(t[n].type)){let s=Va.parseFromLexeme(t,n);return n=s.newIndex,{value:new te(r.value,s.value),newIndex:n}}}return{value:new te(r.value,null),newIndex:n}}static isTokenTypeAliasCandidate(t){return(t&64)!==0||(t&2048)!==0}},$t=class hi{static buildBinaryQuery(e,n){if(!e||e.length===0)throw new Error("No queries provided to combine.");if(e.length===1)throw new Error("At least two queries are required to create a BinarySelectQuery.");let r=i=>i instanceof Ft?hi.buildSimpleQuery(i):i,s=new fe(r(e[0]),n,r(e[1]));Hs.normalize(s);for(let i=2;i<e.length;i++)s.appendSelectQuery(n,r(e[i]));return s}constructor(){}static buildSimpleQuery(e){if(e instanceof B)return e;if(e instanceof fe)return hi.buildSimpleBinaryQuery(e);if(e instanceof Ft)return hi.buildSimpleValuesQuery(e);throw new Error("Unsupported query type for buildSimpleQuery")}static buildSimpleBinaryQuery(e){let n=new $e(e),r=new te(n,new ze("bq",null)),s=new pe(r,null),i=hi.createSelectAllClause(),l=new B({selectClause:i,fromClause:s});return Hs.normalize(l)}static buildSimpleValuesQuery(e){let n=e.tuples.length>0?e.tuples[0].values.length:0;if(e.tuples.length===0)throw new Error("Empty VALUES clause cannot be converted to a SimpleSelectQuery");if(!e.columnAliases)throw new Error("Column aliases are required to convert a VALUES clause to SimpleSelectQuery. Please specify column aliases.");if(e.columnAliases.length!==n)throw new Error(`The number of column aliases (${e.columnAliases.length}) does not match the number of columns in the first tuple (${n}).`);let r=new $e(e),s=new te(r,new ze("vq",e.columnAliases)),i=new pe(s,null),l=e.columnAliases.map(a=>new ce(new _("vq",a),a)),o=new Se(l,null);return new B({selectClause:o,fromClause:i})}static createSelectAllClause(){let e=new _(null,"*"),n=new ce(e,"*");return new Se([n],null)}static buildCreateTableQuery(e,n,r=!1){return new bp({tableName:n,isTemporary:r,asSelectQuery:e})}static buildInsertQuery(e,n){let r,s=e.selectClause.items.length;if(r=new Zt().collect(e).map(l=>l.name),!r.length||s!==r.length)throw new Error(`Columns cannot be inferred from the selectQuery. Make sure you are not using wildcards or unnamed columns.
Select clause column count: ${s}, Columns with valid names: ${r.length}
Detected column names: [${r.join(", ")}]`);let i=Hl.parse(n);return new qu({insertClause:new Cp(i,r),selectQuery:e})}static buildUpdateQuery(e,n,r,s){let i=new xp(Hl.parse(r)),l=Array.isArray(s)?s:[s],o=new Zt().collect(e),a=new mt().collect(e);new Vu().execute(e);for(let g of l)if(!o.some(v=>v.name===g))throw new Error(`Primary key column '${g}' is not present in selectQuery select list.`);let u=i.getSourceAliasName();if(!u)throw new Error("Source expression does not have an alias. Please provide an alias for the source expression.");let c=o.filter(g=>!l.includes(g.name)).map(g=>new Gl(g.name,new _(u,g.name))),m=new Kl(c),h=new pe(e.toSource(n),null),w=null;for(let g of l){let v=new A(new _(u,g),"=",new _(n,g));w=w?new A(w,"and",v):v}let C=new Yt(w);return new Np({updateClause:i,setClause:m,fromClause:h,whereClause:C,withClause:a.length>0?new Ot(!1,a):void 0})}},go=class{static set(t,e,n){let r=Gu.collect(t),s=!1;for(let i of r)i.name.value===e&&(i.value=n,s=!0);if(!s)throw new Error(`Parameter '${e}' not found in query.`)}},$s,B=($s=class extends P{constructor(e){super(),this.cteNameCache=new Set,this.withClause=e.withClause??null,this.selectClause=e.selectClause,this.fromClause=e.fromClause??null,this.whereClause=e.whereClause??null,this.groupByClause=e.groupByClause??null,this.havingClause=e.havingClause??null,this.orderByClause=e.orderByClause??null,this.windowClause=e.windowClause??null,this.limitClause=e.limitClause??null,this.offsetClause=e.offsetClause??null,this.fetchClause=e.fetchClause??null,this.forClause=e.forClause??null,this.initializeCTECache()}initializeCTECache(){var e;if(this.cteNameCache.clear(),(e=this.withClause)==null?void 0:e.tables)for(let n of this.withClause.tables)this.cteNameCache.add(n.aliasExpression.table.name)}toUnion(e){return this.toBinaryQuery("union",e)}toUnionAll(e){return this.toBinaryQuery("union all",e)}toIntersect(e){return this.toBinaryQuery("intersect",e)}toIntersectAll(e){return this.toBinaryQuery("intersect all",e)}toExcept(e){return this.toBinaryQuery("except",e)}toExceptAll(e){return this.toBinaryQuery("except all",e)}toBinaryQuery(e,n){return $t.buildBinaryQuery([this,n],e)}appendWhereRaw(e){let n=U.parse(e);this.appendWhere(n)}appendWhere(e){this.whereClause?this.whereClause.condition=new A(this.whereClause.condition,"and",e):this.whereClause=new Yt(e)}appendHavingRaw(e){let n=U.parse(e);this.appendHaving(n)}appendHaving(e){this.havingClause?this.havingClause.condition=new A(this.havingClause.condition,"and",e):this.havingClause=new In(e)}innerJoinRaw(e,n,r,s=null){this.joinSourceRaw("inner join",e,n,r,s)}leftJoinRaw(e,n,r,s=null){this.joinSourceRaw("left join",e,n,r,s)}rightJoinRaw(e,n,r,s=null){this.joinSourceRaw("right join",e,n,r,s)}innerJoin(e,n,r=null){this.joinSource("inner join",e,n,r)}leftJoin(e,n,r=null){this.joinSource("left join",e,n,r)}rightJoin(e,n,r=null){this.joinSource("right join",e,n,r)}joinSourceRaw(e,n,r,s,i=null){let l=Qa.parse(n),o=new te(l,new ze(r,null));this.joinSource(e,o,s,i)}joinSource(e,n,r,s=null){if(!this.fromClause)throw new Error("A FROM clause is required to add a JOIN condition.");let i=Array.isArray(r)?r:[r],l=new kt(s).collect(this),o=null,a=0,u=n.getAliasName();if(!u)throw new Error("An alias is required for the source expression to add a JOIN condition.");for(let h of l)if(i.some(w=>w==h.name)){let w=new A(h.value,"=",new _([u],h.name));o?o=new A(o,"and",w):o=w,a++}if(!o||a!==i.length)throw new Error(`Invalid JOIN condition. The specified columns were not found: ${i.join(", ")}`);let c=new On(o),m=new qt(e,n,c,!1);this.fromClause&&(this.fromClause.joins?this.fromClause.joins.push(m):this.fromClause.joins=[m]),Hs.normalize(this)}toSource(e){if(!e||e.trim()==="")throw new Error("Alias is required for toSource(). Please specify a non-empty alias name.");return new te(new $e(this),new ze(e,null))}appendWith(e){let n=Array.isArray(e)?e:[e];this.withClause?this.withClause.tables.push(...n):this.withClause=new Ot(!1,n),Hs.normalize(this)}appendWithRaw(e,n){let r=Q.parse(e),s=new st(r,n,null);this.appendWith(s)}overrideSelectItemExpr(e,n){let r=this.selectClause.items.filter(o=>{var a;return((a=o.identifier)==null?void 0:a.name)===e});if(r.length===0)throw new Error(`Column ${e} not found in the query`);if(r.length>1)throw new Error(`Duplicate column name ${e} found in the query`);let s=r[0],i=new Si().visit(s.value),l=n(i);s.value=U.parse(l)}appendWhereExpr(e,n,r){if(r&&r.upstream){let s=new Ju().find(this,[e]),i=new kt,l=new Si;for(let o of s){let a=i.collect(o).filter(c=>c.name===e).map(c=>c.value);if(a.length!==1)throw new Error(`Expected exactly one expression for column '${e}'`);let u=l.format(a[0]);o.appendWhereRaw(n(u))}}else{let s=new kt,i=new Si,l=s.collect(this).filter(a=>a.name===e).map(a=>a.value);if(l.length!==1)throw new Error(`Expected exactly one expression for column '${e}'`);let o=i.format(l[0]);this.appendWhereRaw(n(o))}}setParameter(e,n){return go.set(this,e,n),this}toSimpleQuery(){return this}addCTE(e,n,r){if(!e||e.trim()==="")throw new za(e,"name cannot be empty or whitespace-only");if(this.hasCTE(e))throw new Fp(e);let s=(r==null?void 0:r.materialized)??null,i=new st(n,e,s);return this.appendWith(i),this.cteNameCache.add(e),this}removeCTE(e){if(!this.hasCTE(e))throw new Lp(e);return this.withClause&&(this.withClause.tables=this.withClause.tables.filter(n=>n.aliasExpression.table.name!==e),this.withClause.tables.length===0&&(this.withClause=null)),this.cteNameCache.delete(e),this}hasCTE(e){return this.cteNameCache.has(e)}getCTENames(){var e;return((e=this.withClause)==null?void 0:e.tables.map(n=>n.aliasExpression.table.name))??[]}replaceCTE(e,n,r){if(!e||e.trim()==="")throw new za(e,"name cannot be empty or whitespace-only");this.hasCTE(e)&&this.removeCTE(e);let s=(r==null?void 0:r.materialized)??null,i=new st(n,e,s);return this.appendWith(i),this.cteNameCache.add(e),this}},$s.kind=Symbol("SelectQuery"),$s),Un,fe=(Un=class extends P{constructor(e,n,r){super(),this.left=e,this.operator=new K(n),this.right=r}union(e){return this.appendSelectQuery("union",e)}unionAll(e){return this.appendSelectQuery("union all",e)}intersect(e){return this.appendSelectQuery("intersect",e)}intersectAll(e){return this.appendSelectQuery("intersect all",e)}except(e){return this.appendSelectQuery("except",e)}exceptAll(e){return this.appendSelectQuery("except all",e)}appendSelectQuery(e,n){return this.left=new Un(this.left,this.operator.value,this.right),this.operator=new K(e),this.right=n,Hs.normalize(this),this}unionRaw(e){let n=Q.parse(e);return this.union(n)}unionAllRaw(e){let n=Q.parse(e);return this.unionAll(n)}intersectRaw(e){let n=Q.parse(e);return this.intersect(n)}intersectAllRaw(e){let n=Q.parse(e);return this.intersectAll(n)}exceptRaw(e){let n=Q.parse(e);return this.except(n)}exceptAllRaw(e){let n=Q.parse(e);return this.exceptAll(n)}toSource(e="subq"){return new te(new $e(this),new ze(e,null))}setParameter(e,n){return go.set(this,e,n),this}toSimpleQuery(){return $t.buildSimpleQuery(this)}},Un.kind=Symbol("BinarySelectQuery"),Un),Ds,Ft=(Ds=class extends P{constructor(e,n=null){super(),this.tuples=e,this.columnAliases=n}toSimpleQuery(){return $t.buildSimpleQuery(this)}setParameter(e,n){return go.set(this,e,n),this}},Ds.kind=Symbol("ValuesQuery"),Ds),tw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The SELECT clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e,r=null,s=n<t.length?t[n].comments:null;if(t[n].value!=="select")throw new Error(`Syntax error at position ${n}: Expected 'SELECT' keyword but found "${t[n].value}". SELECT clauses must start with the SELECT keyword.`);n++;let i=[];for(;n<t.length&&Cl.isHintClause(t[n].value);){let a=Cl.extractHintContent(t[n].value);i.push(new Cl(a)),n++}if(n<t.length&&t[n].value==="distinct")n++,r=new gp;else if(n<t.length&&t[n].value==="distinct on"){n++;let a=U.parseArgument(4,8,t,n);r=new vp(a.value),n=a.newIndex}let l=[],o=ld.parseItem(t,n);for(l.push(o.value),n=o.newIndex;n<t.length&&t[n].type&16;){n++;let a=ld.parseItem(t,n);l.push(a.value),n=a.newIndex}if(l.length===0)throw new Error(`Syntax error at position ${e}: No select items found. The SELECT clause requires at least one expression to select.`);{let a=new Se(l,r,i);return a.comments=s,{value:a,newIndex:n}}}},ld=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseItem(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The select item is complete but there are additional tokens.`);return n.value}static parseItem(t,e){let n=e,r=U.parseFromLexeme(t,n),s=r.value;if(n=r.newIndex,n<t.length&&t[n].value==="as"&&n++,n<t.length&&t[n].type&64){let i=t[n].value;return n++,{value:new ce(s,i),newIndex:n}}else if(s instanceof _&&s.column.name!=="*")return{value:new ce(s,s.column.name),newIndex:n};return{value:new ce(s),newIndex:n}}},nw=class{static tryParse(t,e){let n=e;if(n<t.length&&t[n].value==="on"){n++;let r=U.parseFromLexeme(t,n);return n=r.newIndex,{value:new On(r.value),newIndex:n}}return null}},rw=class{static tryParse(t,e){let n=e;if(n<t.length&&t[n].value==="using"){n++;let r=U.parseArgument(4,8,t,n),s=r.value;return n=r.newIndex,{value:new er(s),newIndex:n}}return null}},sw=class{static tryParse(t,e){let n=e,r=[];for(;this.isJoinCommand(t,n);){let s=this.parseJoinClause(t,n);r.push(s.value),n=s.newIndex}return r.length>0?{value:r,newIndex:n}:null}static isJoinKeyword(t){return!!Ep.parse(t,0)}static parseLateral(t,e){let n=e;return n<t.length&&t[n].value==="lateral"?(n++,{value:!0,newIndex:n}):{value:!1,newIndex:n}}static isJoinCommand(t,e){return e>=t.length?!1:!!(t[e].type&16||this.isJoinKeyword(t[e].value)===!0)}static parseJoinClause(t,e){let n=e,r=t[n].value===","?"cross join":t[n].value;n++;let s=this.parseLateral(t,n),i=s.value;n=s.newIndex;let l=Hl.parseFromLexeme(t,n);if(n=l.newIndex,n<t.length){let o=nw.tryParse(t,n);if(o)return{value:new qt(r,l.value,o.value,i),newIndex:o.newIndex};let a=rw.tryParse(t,n);if(a)return{value:new qt(r,l.value,a.value,i),newIndex:a.newIndex}}return{value:new qt(r,l.value,null,i),newIndex:n}}},Pp=class{static collectClauseComments(t,e,n){if(e>=t.length||t[e].value.toLowerCase()!==n.toLowerCase())return null;let r=[];t[e].comments&&r.push(...t[e].comments);let s=e-1;for(;s>=0;){let i=t[s];if(i.comments&&i.comments.length>0){let l=i.comments.filter(o=>{let a=o.toLowerCase();return a.includes(n.toLowerCase())||a.includes("")||a.includes("")});l.length>0&&(r.unshift(...l),i.comments=i.comments.filter(o=>!l.includes(o)),i.comments.length===0&&(i.comments=null));break}if(this.isSignificantSqlKeyword(i.value))break;s--}return r.length>0?r:null}static isSignificantSqlKeyword(t){return new Set(["select","from","where","group by","having","order by","limit","offset"]).has(t.toLowerCase())}},iw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The FROM clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e,r=Pp.collectClauseComments(t,n,"from");if(t[n].value!=="from")throw new Error(`Syntax error at position ${n}: Expected 'FROM' keyword but found "${t[n].value}". FROM clauses must start with the FROM keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'FROM' keyword. The FROM clause requires a table reference.");let s=Hl.parseFromLexeme(t,n);n=s.newIndex;let i=sw.tryParse(t,n);if(n=(i==null?void 0:i.newIndex)||n,i!==null){let l=new pe(s.value,i.value);return l.comments=r,{value:l,newIndex:n}}else{let l=new pe(s.value,null);return l.comments=r,{value:l,newIndex:n}}}},lw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The WHERE clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e,r=Pp.collectClauseComments(t,n,"where");if(t[n].value!=="where")throw new Error(`Syntax error at position ${n}: Expected 'WHERE' keyword but found "${t[n].value}". WHERE clauses must start with the WHERE keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'WHERE' keyword. The WHERE clause requires a condition expression.");let s=U.parseFromLexeme(t,n),i=new Yt(s.value);return i.comments=r,{value:i,newIndex:s.newIndex}}},ow=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The GROUP BY clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="group by")throw new Error(`Syntax error at position ${n}: Expected 'GROUP BY' keyword but found "${t[n].value}". GROUP BY clauses must start with the GROUP BY keywords.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'GROUP BY' keyword. The GROUP BY clause requires at least one expression to group by.");let r=[],s=this.parseItem(t,n);for(r.push(s.value),n=s.newIndex;n<t.length&&t[n].type&16;){n++;let i=this.parseItem(t,n);r.push(i.value),n=i.newIndex}if(r.length===0)throw new Error(`Syntax error at position ${e}: No grouping expressions found. The GROUP BY clause requires at least one expression to group by.`);return{value:new bn(r),newIndex:n}}static parseItem(t,e){let n=e,r=U.parseFromLexeme(t,n),s=r.value;return n=r.newIndex,{value:s,newIndex:n}}},aw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The HAVING clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="having")throw new Error(`Syntax error at position ${n}: Expected 'HAVING' keyword but found "${t[n].value}". HAVING clauses must start with the HAVING keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'HAVING' keyword. The HAVING clause requires a condition expression.");let r=U.parseFromLexeme(t,n);return{value:new In(r.value),newIndex:r.newIndex}}},uw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The WINDOW clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="window")throw new Error(`Syntax error at position ${n}: Expected 'WINDOW' keyword but found "${t[n].value}". WINDOW clauses must start with the WINDOW keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'WINDOW' keyword. The WINDOW clause requires at least one window definition.");let r=[];for(;n<t.length;){if(n>=t.length||t[n].type!==64)throw new Error("Syntax error: Expected window name after 'WINDOW' keyword.");let s=t[n].value;if(n++,n>=t.length||t[n].value!=="as")throw new Error(`Syntax error at position ${n}: Expected 'AS' keyword after window name.`);n++;let i=kp.parseFromLexeme(t,n);if(n=i.newIndex,r.push(new Xn(s,i.value)),n<t.length&&t[n].type&16)n++;else break}if(r.length===0)throw new Error("At least one WINDOW clause is required after WINDOW keyword.");return{value:new Qu(r),newIndex:n}}},cw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The LIMIT clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="limit")throw new Error(`Syntax error at position ${n}: Expected 'LIMIT' keyword but found "${t[n].value}". LIMIT clauses must start with the LIMIT keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'LIMIT' keyword. The LIMIT clause requires a numeric expression.");let r=U.parseFromLexeme(t,n);return n=r.newIndex,{value:new Xt(r.value),newIndex:n}}},dw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The FOR clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value.toLowerCase()!=="for")throw new Error(`Syntax error at position ${n}: Expected 'FOR' keyword but found "${t[n].value}". FOR clauses must start with the FOR keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'FOR' keyword. The FOR clause requires a lock mode specification.");let r=t[n].value,s;switch(r){case"update":s="update",n++;break;case"share":s="share",n++;break;case"key share":s="key share",n++;break;case"no key update":s="no key update",n++;break;default:throw new Error(`Syntax error at position ${n}: Invalid lock mode "${r}". Valid lock modes are: UPDATE, SHARE, KEY SHARE, NO KEY UPDATE.`)}return{value:new Gs(s),newIndex:n}}},od=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The CommonTable definition is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e,r=n<t.length?t[n].comments:null,s=Va.parseFromLexeme(t,n);if(n=s.newIndex,n<t.length&&t[n].value!=="as")throw new Error(`Syntax error at position ${n}: Expected 'AS' keyword after CTE name but found "${t[n].value}".`);n++;let i=null;if(n<t.length){let u=t[n].value;u==="materialized"?(i=!0,n++):u==="not materialized"&&(i=!1,n++)}if(n<t.length&&t[n].type!==4)throw new Error(`Syntax error at position ${n}: Expected '(' after CTE name but found "${t[n].value}".`);let l=t[n].comments;n++;let o=Q.parseFromLexeme(t,n);if(n=o.newIndex,l&&l.length>0&&(o.value.comments?o.value.comments=[...l,...o.value.comments]:o.value.comments=l),n<t.length&&t[n].type!==8)throw new Error(`Syntax error at position ${n}: Expected ')' after CTE query but found "${t[n].value}".`);n++;let a=new st(o.value,s.value,i);return a.comments=r,{value:a,newIndex:n}}},Jl=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The WITH clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e,r=n<t.length?t[n].comments:null;if(n<t.length&&t[n].value.toLowerCase()==="with")n++;else throw new Error(`Syntax error at position ${n}: Expected WITH keyword.`);let s=n<t.length&&t[n].value.toLowerCase()==="recursive";s&&n++;let i=[],l=od.parseFromLexeme(t,n);for(i.push(l.value),n=l.newIndex;n<t.length&&t[n].type&16;){n++;let a=od.parseFromLexeme(t,n);i.push(a.value),n=a.newIndex}let o=new Ot(s,i);return o.comments=r,{value:o,newIndex:n}}},hw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The VALUES clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value.toLowerCase()!=="values")throw new Error(`Syntax error at position ${n}: Expected 'VALUES' keyword but found "${t[n].value}". VALUES clauses must start with the VALUES keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'VALUES' keyword. The VALUES clause requires at least one tuple expression.");let r=[],s=this.parseTuple(t,n);for(r.push(s.value),n=s.newIndex;n<t.length&&t[n].type&16;){n++;let i=this.parseTuple(t,n);r.push(i.value),n=i.newIndex}return{value:new Ft(r),newIndex:n}}static parseTuple(t,e){let n=e;if(n>=t.length||t[n].type!==4)throw new Error(`Syntax error at position ${n}: Expected opening parenthesis but found "${n<t.length?t[n].value:"end of input"}". Tuple expressions in VALUES clause must be enclosed in parentheses.`);n++;let r=[];if(n>=t.length)throw new Error("Syntax error: Unexpected end of input after opening parenthesis in tuple expression.");if(t[n].type&8)return n++,{value:new Jt([]),newIndex:n};let s=U.parseFromLexeme(t,n);for(r.push(s.value),n=s.newIndex;n<t.length&&t[n].type&16;){if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after comma in tuple expression.");let i=U.parseFromLexeme(t,n);r.push(i.value),n=i.newIndex}if(n>=t.length||t[n].type!==8)throw new Error(`Syntax error at position ${n}: Expected closing parenthesis but found "${n<t.length?t[n].value:"end of input"}". Tuple expressions in VALUES clause must be enclosed in parentheses.`);return n++,{value:new Jt(r),newIndex:n}}},pw=class{static parseFromLexeme(t,e){let n=e;if(t[n].value!=="fetch")throw new Error(`Syntax error at position ${n}: Expected 'FETCH' keyword but found "${t[n].value}".`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'FETCH' keyword.");let r=fw.parseFromLexeme(t,n),s=r.value;return n=r.newIndex,{value:new wo(s),newIndex:n}}},fw=class{static parseFromLexeme(t,e){let n=e,r,s=t[n].value;if(s==="first")r="first";else if(s==="next")r="next";else throw new Error(`Syntax error at position ${n}: Expected 'FIRST' or 'NEXT' after 'FETCH' but found "${t[n].value}".`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'FETCH FIRST|NEXT'.");let i=null,l=null;if(t[n].value==="row only"||t[n].value==="rows only")return i=new be(1),l="rows only",n++,{value:new Ba(r,i,l),newIndex:n};let o=U.parseFromLexeme(t,n);if(i=o.value,n=o.newIndex,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'FETCH FIRST|NEXT <count>'.");if(t[n].value==="rows only"?(l="rows only",n++):t[n].value==="percent"?(l="percent",n++):t[n].value==="percent with ties"&&(l="percent with ties",n++),!l)throw new Error("Syntax error: Expected 'ROWS ONLY', 'PERCENT', or 'PERCENT WITH TIES' after 'FETCH FIRST|NEXT <count>'.");return{value:new Ba(r,i,l),newIndex:n}}},mw=class{static parse(t){let e=new oe(t).readLexmes(),n=this.parseFromLexeme(e,0);if(n.newIndex<e.length)throw new Error(`Syntax error: Unexpected token "${e[n.newIndex].value}" at position ${n.newIndex}. The OFFSET clause is complete but there are additional tokens.`);return n.value}static parseFromLexeme(t,e){let n=e;if(t[n].value!=="offset")throw new Error(`Syntax error at position ${n}: Expected 'OFFSET' keyword but found "${t[n].value}". OFFSET clauses must start with the OFFSET keyword.`);if(n++,n>=t.length)throw new Error("Syntax error: Unexpected end of input after 'OFFSET' keyword. The OFFSET clause requires a numeric expression.");let r=U.parseFromLexeme(t,n);return n=r.newIndex,n<t.length&&(t[n].value==="row"||t[n].value==="rows")&&n++,{value:new zi(r.value),newIndex:n}}},Qn,Q=(Qn=class{static parse(e){let n=new oe(e).readLexmes(),r=this.parseFromLexeme(n,0);if(r.newIndex<n.length)throw new Error(`[SelectQueryParser] Syntax error: Unexpected token "${n[r.newIndex].value}" at position ${r.newIndex}. The SELECT query is complete but there are additional tokens.`);return r.value}static async parseAsync(e){return Promise.resolve(this.parse(e))}static parseFromLexeme(e,n){let r=n;if(r>=e.length)throw new Error(`Syntax error: Unexpected end of input at position ${n}.`);let s=e[r].value;if(!this.selectCommandSet.has(s)&&s!=="values")throw new Error(`Syntax error at position ${r}: Expected 'SELECT' or 'VALUES' keyword but found "${e[r].value}".`);let i=this.selectCommandSet.has(s)?this.parseSimpleSelectQuery(e,r):this.parseValuesQuery(e,r),l=i.value;for(r=i.newIndex;r<e.length&&this.unionCommandSet.has(e[r].value.toLowerCase());){let o=e[r].value.toLowerCase();if(r++,r>=e.length)throw new Error(`Syntax error at position ${r}: Expected a query after '${o.toUpperCase()}' but found end of input.`);let a=e[r].value.toLowerCase();if(this.selectCommandSet.has(a)){let u=this.parseSimpleSelectQuery(e,r);l=new fe(l,o,u.value),r=u.newIndex}else if(a==="values"){let u=this.parseValuesQuery(e,r);l=new fe(l,o,u.value),r=u.newIndex}else throw new Error(`Syntax error at position ${r}: Expected 'SELECT' or 'VALUES' after '${o.toUpperCase()}' but found "${e[r].value}".`)}return{value:l,newIndex:r}}static parseSimpleSelectQuery(e,n){let r=n,s=null;r<e.length&&e[r].value==="with"&&(s=Jl.parseFromLexeme(e,r),r=s.newIndex);let i=r<e.length?e[r].comments:null;if(r>=e.length||e[r].value!=="select")throw new Error(`Syntax error at position ${r}: Expected 'SELECT' keyword but found "${r<e.length?e[r].value:"end of input"}". SELECT queries must start with the SELECT keyword.`);let l=tw.parseFromLexeme(e,r);r=l.newIndex,i&&l.value.comments&&JSON.stringify(i)===JSON.stringify(l.value.comments)&&(l.value.comments=null);let o=null;r<e.length&&e[r].value==="from"&&(o=iw.parseFromLexeme(e,r),r=o.newIndex);let a=null;r<e.length&&e[r].value==="where"&&(a=lw.parseFromLexeme(e,r),r=a.newIndex);let u=null;r<e.length&&e[r].value==="group by"&&(u=ow.parseFromLexeme(e,r),r=u.newIndex);let c=null;r<e.length&&e[r].value==="having"&&(c=aw.parseFromLexeme(e,r),r=c.newIndex);let m=null;r<e.length&&e[r].value==="window"&&(m=uw.parseFromLexeme(e,r),r=m.newIndex);let h=null;r<e.length&&e[r].value==="order by"&&(h=zu.parseFromLexeme(e,r),r=h.newIndex);let w=null;r<e.length&&e[r].value==="limit"&&(w=cw.parseFromLexeme(e,r),r=w.newIndex);let C=null;r<e.length&&e[r].value==="offset"&&(C=mw.parseFromLexeme(e,r),r=C.newIndex);let g=null;r<e.length&&e[r].value==="fetch"&&(g=pw.parseFromLexeme(e,r),r=g.newIndex);let v=null;r<e.length&&e[r].value.toLowerCase()==="for"&&(v=dw.parseFromLexeme(e,r),r=v.newIndex);let p=new B({withClause:s?s.value:null,selectClause:l.value,fromClause:o?o.value:null,whereClause:a?a.value:null,groupByClause:u?u.value:null,havingClause:c?c.value:null,orderByClause:h?h.value:null,windowClause:m?m.value:null,limitClause:w?w.value:null,offsetClause:C?C.value:null,fetchClause:g?g.value:null,forClause:v?v.value:null});return p.comments=i,{value:p,newIndex:r}}static parseValuesQuery(e,n){let r=hw.parseFromLexeme(e,n);return{value:r.value,newIndex:r.newIndex}}},Qn.unionCommandSet=new Set(["union","union all","intersect","intersect all","except","except all"]),Qn.selectCommandSet=new Set(["with","select"]),Qn),X,Ka=(X=class{constructor(){this.dependencyGraph=null,this.cteMap=new Map,this.sourceCollector=new Ku(!0),this.cteCollector=new mt}analyzeDependencies(e){let n=this.cteCollector.collect(e);return this.buildCTEMap(n),this.dependencyGraph=this.buildDependencyGraph(n,e),this.dependencyGraph}getDependencies(e){this.ensureAnalyzed();let n=this.findNodeByName(e);return n?[...n.dependencies]:[]}getDependents(e){this.ensureAnalyzed();let n=this.findNodeByName(e);return n?[...n.dependents]:[]}getMainQueryDependencies(){this.ensureAnalyzed();let e=this.findNodeByName(X.MAIN_QUERY_NAME);return e?[...e.dependencies]:[]}getNodesByType(e){return this.ensureAnalyzed(),this.dependencyGraph.nodes.filter(n=>n.type===e)}getMainQueryNode(){return this.ensureAnalyzed(),this.findNodeByName(X.MAIN_QUERY_NAME)}hasCircularDependency(){this.ensureAnalyzed();try{return this.getExecutionOrder(),!1}catch(e){if(e instanceof Error&&e.message.includes(X.ERROR_MESSAGES.CIRCULAR_REFERENCE))return!0;throw e}}getExecutionOrder(){this.ensureAnalyzed();let e=new Set,n=new Set,r=[],s=new Map;for(let l of this.dependencyGraph.nodes)s.set(l.name,new Set(l.dependencies));let i=l=>{if(e.has(l))return;if(n.has(l))throw new Error(`${X.ERROR_MESSAGES.CIRCULAR_REFERENCE}: ${l}`);n.add(l);let o=s.get(l)||new Set;for(let a of o)i(a);n.delete(l),e.add(l),r.push(l)};for(let l of this.dependencyGraph.nodes)e.has(l.name)||i(l.name);return r}buildDependencyGraph(e,n){let r=[],s=[],i=new Map,l=new Map;for(let a of e){let u=X.getCTEName(a);i.set(u,new Set),l.set(u,new Set)}i.set(X.MAIN_QUERY_NAME,new Set),l.set(X.MAIN_QUERY_NAME,new Set);for(let a of e){let u=X.getCTEName(a),c=this.sourceCollector.collect(a.query);for(let m of c){let h=m.table.name;this.cteMap.has(h)&&h!==u&&(i.get(u).add(h),l.get(h).add(u),s.push({from:u,to:h}))}}let o=this.getMainQueryWithoutCTE(n);if(o){let a=this.sourceCollector.collect(o);for(let u of a){let c=u.table.name;this.cteMap.has(c)&&(i.get(X.MAIN_QUERY_NAME).add(c),l.get(c).add(X.MAIN_QUERY_NAME),s.push({from:X.MAIN_QUERY_NAME,to:c}))}}for(let a of e){let u=X.getCTEName(a);r.push({name:u,type:"CTE",cte:a,dependencies:Array.from(i.get(u)||new Set),dependents:Array.from(l.get(u)||new Set)})}return r.push({name:X.MAIN_QUERY_NAME,type:"ROOT",cte:null,dependencies:Array.from(i.get(X.MAIN_QUERY_NAME)||new Set),dependents:Array.from(l.get(X.MAIN_QUERY_NAME)||new Set)}),{nodes:r,edges:s}}ensureAnalyzed(){if(!this.dependencyGraph)throw new Error(X.ERROR_MESSAGES.NOT_ANALYZED)}buildCTEMap(e){this.cteMap.clear();for(let n of e){let r=X.getCTEName(n);this.cteMap.set(r,n)}}findNodeByName(e){var n;return(n=this.dependencyGraph)==null?void 0:n.nodes.find(r=>r.name===e)}getMainQueryWithoutCTE(e){return e.withClause?new B({selectClause:e.selectClause,fromClause:e.fromClause,whereClause:e.whereClause,groupByClause:e.groupByClause,havingClause:e.havingClause,orderByClause:e.orderByClause,limitClause:e.limitClause,offsetClause:e.offsetClause,fetchClause:e.fetchClause,forClause:e.forClause,windowClause:e.windowClause}):e}static getCTEName(e){return e.aliasExpression.table.name}},X.ERROR_MESSAGES={NOT_ANALYZED:"Must call analyzeDependencies first",CIRCULAR_REFERENCE:"Circular reference detected in CTE"},X.MAIN_QUERY_NAME="MAIN_QUERY",X),Ga=class{constructor(t,e){this.name=t,this.columns=e}},jp=class{constructor(t=null,e=!1){this.tableColumnResolver=t,this.allowWildcardWithoutResolver=e,this.tableSchemas=[],this.visitedNodes=new Set,this.commonTables=[],this.running=!1,this.handlers=new Map,this.handlers.set(B.kind,n=>this.visitSimpleSelectQuery(n)),this.handlers.set(fe.kind,n=>this.visitBinarySelectQuery(n))}collect(t){return this.visit(t),this.tableSchemas}visit(t){if(this.running){this.visitNode(t);return}this.reset(),this.running=!0;try{if(!(t instanceof B||t instanceof fe))throw new Error(`Unsupported SQL component type for schema collection. Received: ${t.constructor.name}. Expected: SimpleSelectQuery or BinarySelectQuery.`);let e=new mt;this.commonTables=e.collect(t),this.visitNode(t),this.consolidateTableSchemas()}finally{this.running=!1}}visitNode(t){if(this.visitedNodes.has(t))return;this.visitedNodes.add(t);let e=this.handlers.get(t.getKind());if(e){e(t);return}}reset(){this.tableSchemas=[],this.visitedNodes=new Set,this.commonTables=[]}consolidateTableSchemas(){let t=new Map;for(let e of this.tableSchemas)if(!t.has(e.name))t.set(e.name,new Set(e.columns));else{let n=t.get(e.name);e.columns.forEach(r=>n==null?void 0:n.add(r))}this.tableSchemas=Array.from(t.entries()).sort(([e],[n])=>e.localeCompare(n)).map(([e,n])=>new Ga(e,Array.from(n).sort()))}handleTableSource(t,e,n){if(t.datasource instanceof ee){let r=t.datasource.getSourceName(),s=this.commonTables.filter(i=>i.getSourceAliasName()===r);if(s.length>0)s[0].query.accept(this);else{let i=t.getAliasName()??r;this.processCollectTableSchema(r,i,e,n)}}else throw new Error("Datasource is not an instance of TableSource")}visitSimpleSelectQuery(t){var r;if(t.fromClause===null)return;let e=new kt(this.tableColumnResolver,!0,"fullName").collect(t),n;if(this.allowWildcardWithoutResolver){let s=this.getSelectClauseColumns(t);n=e.filter(i=>i.value instanceof _).map(i=>i.value).filter(i=>{let l=i.getNamespace(),o=i.column.name;return s.some(a=>{if(a.value instanceof _){let u=a.value.getNamespace(),c=a.value.column.name;if(u===l&&c===o)return!0;if(c==="*"){if(this.allowWildcardWithoutResolver&&this.tableColumnResolver===null)return!1;if(u===""||u===l)return!0}}return!1})}).map(i=>({table:i.getNamespace(),column:i.column.name}))}else n=e.filter(s=>s.value instanceof _).map(s=>s.value).map(s=>({table:s.getNamespace(),column:s.column.name}));if(t.fromClause.joins!==null&&t.fromClause.joins.length>0){let s=n.filter(i=>i.table==="").map(i=>i.column);if(s.length>0)throw new Error(`Column reference(s) without table name found in query: ${s.join(", ")}`)}if(t.fromClause.source.datasource instanceof ee?this.handleTableSource(t.fromClause.source,n,!0):t.fromClause.source.datasource instanceof $e&&t.fromClause.source.datasource.query.accept(this),(r=t.fromClause)==null?void 0:r.joins)for(let s of t.fromClause.joins)s.source.datasource instanceof ee?this.handleTableSource(s.source,n,!1):s.source.datasource instanceof $e&&s.source.datasource.query.accept(this)}visitBinarySelectQuery(t){this.visitNode(t.left),this.visitNode(t.right)}getSelectClauseColumns(t){if(!t.selectClause)return[];let e=[];for(let n of t.selectClause.items)if(n.value instanceof _){let r=n.value.column.name;e.push({name:r,value:n.value})}return e}processCollectTableSchema(t,e,n,r=!1){if(this.tableColumnResolver===null&&n.filter(l=>l.table===e||r&&l.table==="").filter(l=>l.column==="*").length>0&&!this.allowWildcardWithoutResolver){let l=t?`Wildcard (*) is used. A TableColumnResolver is required to resolve wildcards. Target table: ${t}`:"Wildcard (*) is used. A TableColumnResolver is required to resolve wildcards.";throw new Error(l)}let s=n.filter(l=>l.column!=="*").filter(l=>l.table===e||r&&l.table==="").map(l=>l.column),i=new Ga(t,s);this.tableSchemas.push(i)}},Dt,yw=(Dt=class{constructor(){this.jsonColumnCounter=0,this.entityToJsonColumnMap=new Map,this.columnMappings=[]}buildObjectEntityCtes(e,n,r){this.jsonColumnCounter=0,this.entityToJsonColumnMap.clear(),this.columnMappings=[];let s=[e],i=e.aliasExpression.table.name,l=this.collectAndSortObjectEntities(r,n),o=this.groupEntitiesByDepth(l),a=Array.from(o.keys()).sort((u,c)=>c-u);for(let u of a){let c=o.get(u),m=`${Dt.CTE_OBJECT_PREFIX}${u}`,h=this.buildDepthCte(c,i,m,r,n);s.push(h),i=m}return{ctes:s,lastCteAlias:i,columnMappings:this.columnMappings}}generateUniqueJsonColumnName(e,n,r){this.jsonColumnCounter++;let s=`${e.toLowerCase()}_json_${this.jsonColumnCounter}`;return this.columnMappings.push({entityId:n,entityName:e,generatedColumnName:s,depth:r}),s}collectAndSortObjectEntities(e,n){let r=[],s=i=>{let l=n.get(i);if(!l)throw new Error(`Entity ${i} not found for depth calculation.`);if(l.isRoot)return 0;if(!l.parentId)return 1;let o=l.parentId,a=0,u=new Set;for(u.add(i);o;){if(u.has(o))throw new Error(`Circular dependency detected: ${o} already visited in path for ${i}`);u.add(o);let c=n.get(o);if(!c)throw new Error(`Parent entity ${o} not found during depth calculation for ${i}`);let m=!1;if(c.isRoot)m=!0;else{let h=e.nestedEntities.find(w=>w.id===o);if(h)h.relationshipType==="object"&&(m=!0);else throw new Error(`Parent entity ${o} (ancestor of ${i}) has no definition in mapping.nestedEntities and is not root.`)}if(m&&a++,c.isRoot)break;o=c.parentId}return a};return e.nestedEntities.forEach(i=>{if(i.relationshipType==="object"){let l=n.get(i.id);l&&!l.isRoot&&r.push({entity:l,depth:s(i.id)})}}),r}groupEntitiesByDepth(e){let n=new Map;return e.forEach(r=>{let s=r.depth;n.has(s)||n.set(s,[]),n.get(s).push(r)}),n}buildDepthCte(e,n,r,s,i){let l=[new ce(new _(null,new D(Dt.WILDCARD_COLUMN)))];for(let{entity:a}of e){let u=this.buildEntityJsonColumn(a,s,i);l.push(u)}let o=new B({selectClause:new Se(l),fromClause:new pe(new te(new ee(null,new D(n)),null),null)});return new st(o,new ze(r,null),null)}buildEntityJsonColumn(e,n,r){let{jsonObjectArgs:s,nullChecks:i}=this.prepareEntityColumns(e);this.addChildObjectRelationships(e,s,n,r);let l=this.createJsonObject(s),o=this.buildNullCondition(i),a=this.createCaseExpression(o,l),u=this.calculateApproximateDepth(e,n),c=this.generateUniqueJsonColumnName(e.name,e.id,u);return this.entityToJsonColumnMap.set(e.id,c),new ce(a,c)}calculateApproximateDepth(e,n){if(e.isRoot)return 0;if(!e.parentId)return 1;let r=1,s=e.parentId;for(;s&&s!==n.rootEntity.id;){let i=n.nestedEntities.find(l=>l.id===s);if(!i)break;r++,s=i.parentId}return r}prepareEntityColumns(e){let n=[],r=[];return Object.entries(e.columns).forEach(([s,i])=>{n.push(new be(s)),n.push(new _(null,new D(i))),r.push(new A(new _(null,new D(i)),"is",new be(null)))}),{jsonObjectArgs:n,nullChecks:r}}addChildObjectRelationships(e,n,r,s){r.nestedEntities.filter(i=>i.parentId===e.id&&i.relationshipType==="object").forEach(i=>{let l=s.get(i.id);if(l){n.push(new be(i.propertyName));let o=this.entityToJsonColumnMap.get(l.id);if(!o)throw new Error(`JSON column name not found for child entity: ${l.id}`);n.push(new _(null,new D(o)))}})}createJsonObject(e){let n="jsonb_build_object";return new he(null,new K(n),new ke(e),null)}buildNullCondition(e){return e.reduce((n,r)=>n?new A(n,"and",r):r)}createCaseExpression(e,n){return new bt(null,new Cn([new Sn(e,new be(null))],n))}},Dt.CTE_OBJECT_PREFIX="cte_object_depth_",Dt.WILDCARD_COLUMN="*",Dt),Ct,ww=(Ct=class{buildArrayEntityCtes(e,n,r,s,i){let l=[...e],o=n,a=this.collectAndSortArrayEntities(s,r);if(a.length===0)return{updatedCtes:l,lastCteAlias:o};let u=this.groupEntitiesByDepth(a),c=Array.from(u.keys()).sort((m,h)=>h-m);for(let m of c){let h=u.get(m),{cte:w,newCteAlias:C}=this.buildDepthCte(h,o,l,m,s,i);l.push(w),o=C}return{updatedCtes:l,lastCteAlias:o}}collectAndSortArrayEntities(e,n){let r=[],s=i=>{let l=n.get(i);return!l||l.isRoot?0:l.parentId?1+s(l.parentId):1};return e.nestedEntities.forEach(i=>{if(i.relationshipType==="array"){let l=n.get(i.id),o=n.get(i.parentId);if(!l||!o)throw new Error(`Configuration error: Array entity '${i.id}' or its parent '${i.parentId}' not found.`);let a=Object.values(o.columns);if(a.length===0)throw new Error(`Configuration error: Parent entity '${o.name}' (ID: ${o.id}) must have at least one column defined to serve as a linking key for child array '${i.name}'.`);let u=a[0];r.push({entity:l,parentEntity:o,parentIdColumnSqlName:u,depth:s(i.id)})}}),r.sort((i,l)=>l.depth-i.depth),r}groupEntitiesByDepth(e){let n=new Map;return e.forEach(r=>{let s=r.depth;n.has(s)||n.set(s,[]),n.get(s).push(r)}),n}buildDepthCte(e,n,r,s,i,l){var p;let o=new Set;e.forEach(f=>{Object.values(f.entity.columns).forEach(x=>o.add(x));let y=x=>{i.nestedEntities.filter(N=>N.parentId===x).forEach(N=>{Object.values(N.columns).forEach(b=>{let E=typeof b=="string"?b:b.column;o.add(E)}),y(N.id)})};y(f.entity.id)});let a=(p=r.find(f=>f.aliasExpression.table.name===n))==null?void 0:p.query;if(!a)throw new Error(`CTE not found: ${n}`);let u=new Zt(null,r).collect(a),c=[],m=[],h=new Set;e.forEach(f=>{Object.values(f.entity.columns).forEach(y=>h.add(y))});let w=this.collectArrayEntityColumnsByDepth(i,s),C=new Set;l&&e.forEach(f=>{i.nestedEntities.filter(y=>y.parentId===f.entity.id&&y.relationshipType==="object").forEach(y=>{let x=l.find(N=>N.entityId===y.id);x&&C.add(x.generatedColumnName)})}),this.processSelectVariablesForGroupBy(u,o,w,s,m,c,C);for(let f of e){let y=this.buildAggregationDetailsForArrayEntity(f.entity,i.nestedEntities,new Map,l);m.push(new ce(y.jsonAgg,f.entity.propertyName))}let g=`${Ct.CTE_ARRAY_PREFIX}${s}`,v=new B({selectClause:new Se(m),fromClause:new pe(new te(new ee(null,new D(n)),null),null),groupByClause:c.length>0?new bn(c):null});return{cte:new st(v,new ze(g,null),null),newCteAlias:g}}buildAggregationDetailsForArrayEntity(e,n,r,s){let i=Ct.JSON_FUNCTIONS.BUILD_OBJECT,l=[];Object.entries(e.columns).forEach(([u,c])=>{l.push(new be(u)),l.push(new _(null,new D(c)))}),n.filter(u=>u.parentId===e.id).forEach(u=>{let c=u.originalPropertyName||u.propertyName;if(l.push(new be(c)),u.relationshipType==="object"){if(!s)throw new Error(` PostgresArrayEntityCteBuilder Error: Column mappings not provided

 Details:
  - Entity ID: ${u.id}
  - Entity Name: ${u.name||"unknown"}
  - Property Name: ${u.propertyName}
  - Relationship Type: ${u.relationshipType}

 Solution:
  Column mappings are required for hybrid JSON column naming.
  This error indicates that PostgresObjectEntityCteBuilder did not
  pass column mappings to PostgresArrayEntityCteBuilder.

 Check:
  1. Ensure PostgresJsonQueryBuilder.buildJsonWithCteStrategy() passes columnMappings
  2. Verify PostgresObjectEntityCteBuilder.buildObjectEntityCtes() returns columnMappings
  3. Check that Model-driven mapping conversion generates unique entity IDs`);let m=s.find(h=>h.entityId===u.id);if(!m){let h=s.map(w=>`${w.entityId}  ${w.generatedColumnName}`).join(", ");throw new Error(` PostgresArrayEntityCteBuilder Error: Column mapping not found

 Details:
  - Looking for Entity ID: ${u.id}
  - Entity Name: ${u.name||"unknown"}
  - Property Name: ${u.propertyName}
  - Relationship Type: ${u.relationshipType}

 Available Mappings:
  ${h||"None"}

 Solution:
  Entity IDs must match between mapping generation and usage.
  This suggests a mismatch in entity ID generation or processing.

 Check:
  1. Model-driven mapping conversion generates consistent entity IDs
  2. PostgresObjectEntityCteBuilder processes all entities correctly
  3. Entity hierarchy and parentId relationships are correct`)}l.push(new _(null,new D(m.generatedColumnName)))}else u.relationshipType==="array"&&l.push(new _(null,new D(u.propertyName)))});let o=new he(null,new K(i),new ke(l),null),a=Ct.JSON_FUNCTIONS.AGGREGATE;return Object.values(e.columns)[0],{jsonAgg:new he(null,new K(a),new ke([o]),null)}}collectArrayEntityColumnsByDepth(e,n){let r=new Map,s=Math.max(n+3,5);for(let i=n;i<=s;i++)r.set(i,new Set);return e.nestedEntities.filter(i=>i.relationshipType==="array").forEach(i=>{let l=this.calculateEntityDepth(i,e);r.has(l)||r.set(l,new Set),this.addEntityColumnsToDepthSet(i,l,r),this.collectDescendantColumns(i.id,l,e,r)}),r}calculateEntityDepth(e,n){let r=0,s=e;for(;s.parentId&&s.parentId!==n.rootEntity.id;)r++,s=n.nestedEntities.find(i=>i.id===s.parentId)||s;return r}addEntityColumnsToDepthSet(e,n,r){Object.values(e.columns).forEach(s=>{let i=typeof s=="string"?s:s.column;r.get(n).add(i)})}collectDescendantColumns(e,n,r,s){r.nestedEntities.filter(i=>i.parentId===e).forEach(i=>{this.addEntityColumnsToDepthSet(i,n,s),this.collectDescendantColumns(i.id,n,r,s)})}processSelectVariablesForGroupBy(e,n,r,s,i,l,o){e.forEach(a=>{if(!n.has(a.name)){if(o&&o.has(a.name))return;this.shouldIncludeColumnInGroupBy(a.name,r,s)&&(i.push(new ce(new _(null,new D(a.name)),a.name)),a.name.endsWith("_json")||l.push(new _(null,new D(a.name))))}})}shouldIncludeColumnInGroupBy(e,n,r){let s=e.endsWith("_json"),i=!0;for(let[l,o]of n.entries())if(l>=r&&o.has(e)){i=!1;break}return s&&e.startsWith("entity_")&&(i=this.shouldIncludeJsonColumn(e,r)),i}shouldIncludeJsonColumn(e,n){let r=e.match(/entity_(\d+)_json/);return r&&n>0?parseInt(r[1])<=2:!0}},Ct.CTE_ARRAY_PREFIX="cte_array_depth_",Ct.JSON_FUNCTIONS={BUILD_OBJECT:"jsonb_build_object",AGGREGATE:"jsonb_agg"},Ct),Rp=class{constructor(){this.selectValueCollector=new Zt(null),this.objectEntityCteBuilder=new yw,this.arrayEntityCteBuilder=new ww}validateMapping(t,e){var o,a;let n=new Zt().collect(t),r=new Set(n.map(u=>u.name));for(let u in e.rootEntity.columns){let c=e.rootEntity.columns[u],m=typeof c=="string"?c:c.column;if(!r.has(m))throw new Error(`Validation Error: Column "${m}" for JSON key "${u}" in root entity "${e.rootEntity.name}" not found in the query's select list.`)}let s=new Set([e.rootEntity.id]),i=new Map;e.nestedEntities.forEach(u=>{s.add(u.id),i.has(u.parentId)||i.set(u.parentId,[]),i.get(u.parentId).push(u.id)});for(let u of e.nestedEntities){if(!s.has(u.parentId))throw new Error(`Validation Error: Parent entity with ID "${u.parentId}" for nested entity "${u.name}" (ID: ${u.id}) not found.`);for(let c in u.columns){let m=u.columns[c],h=typeof m=="string"?m:m.column;if(!r.has(h))throw new Error(`Validation Error: Column "${h}" for JSON key "${c}" in nested entity "${u.name}" (ID: ${u.id}) not found in the query's select list.`)}}let l=new Set([e.rootEntity.id,...e.nestedEntities.map(u=>u.parentId)]);for(let u of l){let c=e.nestedEntities.filter(h=>h.parentId===u);if(c.filter(h=>h.relationshipType==="array").length>1){let h=u===e.rootEntity.id?e.rootEntity.name:(o=e.nestedEntities.find(w=>w.id===u))==null?void 0:o.name;throw new Error(`Validation Error: Parent entity "${h}" (ID: ${u}) has multiple direct array children. This is not supported.`)}let m=new Set;for(let h of c){if(m.has(h.propertyName)){let w=u===e.rootEntity.id?e.rootEntity.name:(a=e.nestedEntities.find(C=>C.id===u))==null?void 0:a.name;throw new Error(`Validation Error: Parent entity "${w}" (ID: ${u}) has duplicate property name "${h.propertyName}" for its children.`)}m.add(h.propertyName)}}}buildJsonQuery(t,e,n){if((n==null?void 0:n.jsonb)===!1)throw new Error("JSONB must be enabled for PostgreSQL GROUP BY compatibility. JSON type cannot be used in GROUP BY clauses. Please set jsonb: true or omit the jsonb option (defaults to true).");let r=t instanceof B?t:$t.buildSimpleQuery(t);return this.buildJsonWithCteStrategy(r,e)}buildJson(t,e){return console.warn("buildJson is deprecated. Use buildJsonQuery instead."),this.buildJsonQuery(t,e)}buildJsonWithCteStrategy(t,e){this.validateMapping(t,e);let{initialCte:n,initialCteAlias:r}=this.createInitialCte(t),s=[n],i=r,l=new Map;l.set(e.rootEntity.id,{...e.rootEntity,isRoot:!0,propertyName:e.rootName}),e.nestedEntities.forEach(c=>l.set(c.id,{...c,isRoot:!1,propertyName:c.propertyName}));let o=this.objectEntityCteBuilder.buildObjectEntityCtes(n,l,e);s=o.ctes,i=o.lastCteAlias;let a=o.columnMappings,u=this.arrayEntityCteBuilder.buildArrayEntityCtes(s,i,l,e,a);return s=u.updatedCtes,i=u.lastCteAlias,this.buildFinalSelectQuery(s,i,l,e,a)}createInitialCte(t){let e="origin_query";return{initialCte:new st(t,new ze(e,null),null),initialCteAlias:e}}buildFinalSelectQuery(t,e,n,r,s){let i=[...t],l=`cte_root_${r.rootName.toLowerCase().replace(/[^a-z0-9_]/g,"_")}`,o=n.get(r.rootEntity.id);if(!o)throw new Error(`Root entity ${r.rootEntity.id} not found`);if(r.resultFormat==="array"||!r.resultFormat){let a=this.buildEntityJsonObject(o,null,r.nestedEntities,n,s),u=new ce(a,r.rootName),c=new st(new B({selectClause:new Se([u]),fromClause:new pe(new te(new ee(null,new D(e)),null),null)}),new ze(l,null),null);i.push(c);let m="jsonb_agg",h=new he(null,new K(m),new ke([new _(null,new D(r.rootName))]),null);return new B({withClause:new Ot(!1,i),selectClause:new Se([new ce(h,`${r.rootName}_array`)]),fromClause:new pe(new te(new ee(null,new D(l)),null),null)})}else{let a=this.buildEntityJsonObject(o,null,r.nestedEntities,n,s),u=new ce(a,r.rootName),c=new st(new B({selectClause:new Se([u]),fromClause:new pe(new te(new ee(null,new D(e)),null),null)}),new ze(l,null),null);return i.push(c),new B({withClause:new Ot(!1,i),selectClause:new Se([new ce(new _(null,new D(r.rootName)),r.rootName)]),fromClause:new pe(new te(new ee(null,new D(l)),null),null),limitClause:new Xt(new be(1))})}}buildEntityJsonObject(t,e,n,r,s){let i="jsonb_build_object",l=[];return Object.entries(t.columns).forEach(([o,a])=>{let u=typeof a=="string"?a:a.column;l.push(new be(o)),l.push(new _(null,new D(u)))}),n.filter(o=>o.parentId===t.id).forEach(o=>{let a=r.get(o.id);if(a)if(l.push(new be(o.propertyName)),o.relationshipType==="object"){let u=s.find(c=>c.entityId===a.id);if(!u)throw new Error(`Column mapping not found for entity: ${a.id}`);l.push(new _(null,new D(u.generatedColumnName)))}else o.relationshipType==="array"&&l.push(new _(null,new D(o.propertyName)))}),new he(null,new K(i),new ke(l),null)}},Ap=class{constructor(t,e){typeof t=="function"?(this.tableColumnResolver=t,this.options=e||{}):(this.tableColumnResolver=void 0,this.options=t||{})}inject(t,e){typeof t=="string"&&(t=Q.parse(t));let n=new Ju(this.tableColumnResolver,this.options),r=new kt(this.tableColumnResolver),s=h=>this.options.ignoreCaseAndUnderscore?h.toLowerCase().replace(/_/g,""):h,i=["min","max","like","ilike","in","any","=","<",">","!=","<>","<=",">=","or","and","column"],l=Object.values(e);if(l.length>0&&l.every(h=>h===void 0)&&!this.options.allowAllUndefined)throw new Error("All parameters are undefined. This would result in fetching all records. Use allowAllUndefined: true option to explicitly allow this behavior.");for(let[h,w]of Object.entries(e))w!==void 0&&this.processStateParameter(h,w,t,n,r,s,i,a,o,c,m,u);function o(h,w,C,g,v,p){for(let f=0;f<C.length;f++){let y=C[f],x=y.column||w,N=v.find(E=>g(E.name)===g(x));if(!N)throw new Error(`Column '${x}' not found in query for AND condition`);let b=N.value;if("="in y&&y["="]!==void 0){let E=`${w}_and_${f}_eq`,T=new M(E,y["="]);h.appendWhere(new A(b,"=",T))}if("min"in y&&y.min!==void 0){let E=`${w}_and_${f}_min`,T=new M(E,y.min);h.appendWhere(new A(b,">=",T))}if("max"in y&&y.max!==void 0){let E=`${w}_and_${f}_max`,T=new M(E,y.max);h.appendWhere(new A(b,"<=",T))}if("like"in y&&y.like!==void 0){let E=`${w}_and_${f}_like`,T=new M(E,y.like);h.appendWhere(new A(b,"like",T))}if("ilike"in y&&y.ilike!==void 0){let E=`${w}_and_${f}_ilike`,T=new M(E,y.ilike);h.appendWhere(new A(b,"ilike",T))}if("in"in y&&y.in!==void 0){let E=y.in.map((T,j)=>new M(`${w}_and_${f}_in_${j}`,T));h.appendWhere(new A(b,"in",new qe(new ke(E))))}if("any"in y&&y.any!==void 0){let E=`${w}_and_${f}_any`,T=new M(E,y.any);h.appendWhere(new A(b,"=",new he(null,"any",T,null)))}if("<"in y&&y["<"]!==void 0){let E=`${w}_and_${f}_lt`,T=new M(E,y["<"]);h.appendWhere(new A(b,"<",T))}if(">"in y&&y[">"]!==void 0){let E=`${w}_and_${f}_gt`,T=new M(E,y[">"]);h.appendWhere(new A(b,">",T))}if("!="in y&&y["!="]!==void 0){let E=`${w}_and_${f}_neq`,T=new M(E,y["!="]);h.appendWhere(new A(b,"!=",T))}if("<>"in y&&y["<>"]!==void 0){let E=`${w}_and_${f}_ne`,T=new M(E,y["<>"]);h.appendWhere(new A(b,"<>",T))}if("<="in y&&y["<="]!==void 0){let E=`${w}_and_${f}_le`,T=new M(E,y["<="]);h.appendWhere(new A(b,"<=",T))}if(">="in y&&y[">="]!==void 0){let E=`${w}_and_${f}_ge`,T=new M(E,y[">="]);h.appendWhere(new A(b,">=",T))}}}function a(h,w,C,g,v,p){let f=[];for(let y=0;y<C.length;y++){let x=C[y],N=x.column||w,b=v.find(j=>g(j.name)===g(N));if(!b)throw new Error(`Column '${N}' not found in query for OR condition`);let E=b.value,T=[];if("="in x&&x["="]!==void 0){let j=`${w}_or_${y}_eq`,F=new M(j,x["="]);T.push(new A(E,"=",F))}if("min"in x&&x.min!==void 0){let j=`${w}_or_${y}_min`,F=new M(j,x.min);T.push(new A(E,">=",F))}if("max"in x&&x.max!==void 0){let j=`${w}_or_${y}_max`,F=new M(j,x.max);T.push(new A(E,"<=",F))}if("like"in x&&x.like!==void 0){let j=`${w}_or_${y}_like`,F=new M(j,x.like);T.push(new A(E,"like",F))}if("ilike"in x&&x.ilike!==void 0){let j=`${w}_or_${y}_ilike`,F=new M(j,x.ilike);T.push(new A(E,"ilike",F))}if("in"in x&&x.in!==void 0){let j=x.in.map((F,ve)=>new M(`${w}_or_${y}_in_${ve}`,F));T.push(new A(E,"in",new qe(new ke(j))))}if("any"in x&&x.any!==void 0){let j=`${w}_or_${y}_any`,F=new M(j,x.any);T.push(new A(E,"=",new he(null,"any",F,null)))}if("<"in x&&x["<"]!==void 0){let j=`${w}_or_${y}_lt`,F=new M(j,x["<"]);T.push(new A(E,"<",F))}if(">"in x&&x[">"]!==void 0){let j=`${w}_or_${y}_gt`,F=new M(j,x[">"]);T.push(new A(E,">",F))}if("!="in x&&x["!="]!==void 0){let j=`${w}_or_${y}_neq`,F=new M(j,x["!="]);T.push(new A(E,"!=",F))}if("<>"in x&&x["<>"]!==void 0){let j=`${w}_or_${y}_ne`,F=new M(j,x["<>"]);T.push(new A(E,"<>",F))}if("<="in x&&x["<="]!==void 0){let j=`${w}_or_${y}_le`,F=new M(j,x["<="]);T.push(new A(E,"<=",F))}if(">="in x&&x[">="]!==void 0){let j=`${w}_or_${y}_ge`,F=new M(j,x[">="]);T.push(new A(E,">=",F))}if(T.length>0){let j=T[0];for(let F=1;F<T.length;F++)j=new A(j,"and",T[F]);T.length>1?f.push(new qe(j)):f.push(j)}}if(f.length>0){let y=f[0];for(let x=1;x<f.length;x++)y=new A(y,"or",f[x]);h.appendWhere(new qe(y))}}function u(h,w,C){Object.keys(h).forEach(g=>{if(!w.includes(g))throw new Error(`Unsupported operator '${g}' for state key '${C}'`)})}function c(h,w,C,g){let v=new M(C,g);h.appendWhere(new A(w,"=",v))}function m(h,w,C,g){let v=[];if("="in g){let p=new M(C,g["="]);v.push(new A(w,"=",p))}if("min"in g){let p=new M(C+"_min",g.min);v.push(new A(w,">=",p))}if("max"in g){let p=new M(C+"_max",g.max);v.push(new A(w,"<=",p))}if("like"in g){let p=new M(C+"_like",g.like);v.push(new A(w,"like",p))}if("ilike"in g){let p=new M(C+"_ilike",g.ilike);v.push(new A(w,"ilike",p))}if("in"in g){let p=g.in.map((f,y)=>new M(`${C}_in_${y}`,f));v.push(new A(w,"in",new qe(new ke(p))))}if("any"in g){let p=new M(C+"_any",g.any);v.push(new A(w,"=",new he(null,"any",p,null)))}if("<"in g){let p=new M(C+"_lt",g["<"]);v.push(new A(w,"<",p))}if(">"in g){let p=new M(C+"_gt",g[">"]);v.push(new A(w,">",p))}if("!="in g){let p=new M(C+"_neq",g["!="]);v.push(new A(w,"!=",p))}if("<>"in g){let p=new M(C+"_ne",g["<>"]);v.push(new A(w,"<>",p))}if("<="in g){let p=new M(C+"_le",g["<="]);v.push(new A(w,"<=",p))}if(">="in g){let p=new M(C+"_ge",g[">="]);v.push(new A(w,">=",p))}if(v.length===1)h.appendWhere(v[0]);else if(v.length>1){let p=v[0];for(let f=1;f<v.length;f++)p=new A(p,"and",v[f]);h.appendWhere(new qe(p))}}return t}isOrCondition(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"or"in t}isAndCondition(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"and"in t}isExplicitColumnMapping(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"column"in t&&!("or"in t)}isValidatableObject(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&Object.getPrototypeOf(t)===Object.prototype}hasColumnMapping(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&"column"in t}isSimpleValue(t){return t===null||typeof t!="object"||Array.isArray(t)||t instanceof Date}processStateParameter(t,e,n,r,s,i,l,o,a,u,c,m){if(this.isOrCondition(e)){let h=e.or;if(h&&h.length>0){let w=this.findTargetQueryForLogicalCondition(r,n,t,h),C=this.getAllAvailableColumns(w,s);o(w,t,h,i,C,s);return}}if(this.isAndCondition(e)){let h=e.and;if(h&&h.length>0){let w=this.findTargetQueryForLogicalCondition(r,n,t,h),C=this.getAllAvailableColumns(w,s);a(w,t,h,i,C,s);return}}if(this.isExplicitColumnMapping(e)){let h=e.column;if(h){let w=r.find(n,h);if(w.length===0)throw new Error(`Explicit column '${h}' not found in query`);for(let C of w){let g=this.getAllAvailableColumns(C,s).find(v=>i(v.name)===i(h));if(!g)throw new Error(`Explicit column '${h}' not found in query`);this.isValidatableObject(e)&&m(e,l,t),c(C,g.value,t,e)}return}}this.processRegularColumnCondition(t,e,n,r,s,i,l,u,c,m)}processRegularColumnCondition(t,e,n,r,s,i,l,o,a,u){let c=r.find(n,t);if(c.length===0)throw new Error(`Column '${t}' not found in query`);for(let m of c){let h=this.getAllAvailableColumns(m,s),w=h.find(p=>i(p.name)===i(t));if(!w)throw new Error(`Column '${t}' not found in query`);let C=w.value;this.isValidatableObject(e)&&u(e,l,t);let g=C,v=t;if(this.hasColumnMapping(e)){let p=e.column;if(p){let f=h.find(y=>i(y.name)===i(p));f&&(g=f.value,v=p)}}this.isSimpleValue(e)?o(m,g,v,e):a(m,g,v,e)}}findTargetQueryForLogicalCondition(t,e,n,r){let s=r.map(l=>l.column||n).filter((l,o,a)=>a.indexOf(l)===o);for(let l of s){let o=t.find(e,l);if(o.length>0)return o[0]}let i=r===r.or?"OR":"AND";throw new Error(`None of the ${i} condition columns [${s.join(", ")}] found in query`)}getAllAvailableColumns(t,e){let n=e.collect(t),r=this.collectCTEColumns(t);return[...n,...r]}collectCTEColumns(t){let e=[];if(t.withClause)for(let n of t.withClause.tables)try{let r=this.collectColumnsFromSelectQuery(n.query);e.push(...r)}catch(r){console.warn(`Failed to collect columns from CTE '${n.getSourceAliasName()}':`,r)}return e}collectColumnsFromSelectQuery(t){return t instanceof B?new kt(this.tableColumnResolver).collect(t):t instanceof fe?this.collectColumnsFromSelectQuery(t.left):[]}},Mp=class{constructor(t){this.tableColumnResolver=t}static removeOrderBy(t){if(typeof t=="string"&&(t=Q.parse(t)),!(t instanceof B))throw new Error("Complex queries are not supported for ORDER BY removal");return new B({withClause:t.withClause,selectClause:t.selectClause,fromClause:t.fromClause,whereClause:t.whereClause,groupByClause:t.groupByClause,havingClause:t.havingClause,orderByClause:null,windowClause:t.windowClause,limitClause:t.limitClause,offsetClause:t.offsetClause,fetchClause:t.fetchClause,forClause:t.forClause})}inject(t,e){if(typeof t=="string"&&(t=Q.parse(t)),!(t instanceof B))throw new Error("Complex queries are not supported for sorting");let n=new kt(this.tableColumnResolver).collect(t);for(let l of Object.keys(e))if(!n.find(o=>o.name===l))throw new Error(`Column or alias '${l}' not found in current query`);let r=[];for(let[l,o]of Object.entries(e)){let a=n.find(w=>w.name===l);if(!a)continue;let u=a.value;this.validateSortCondition(l,o);let c;o.desc?c="desc":c="asc";let m=null;o.nullsFirst?m="first":o.nullsLast&&(m="last");let h=new Zn(u,c,m);r.push(h)}let s=[];t.orderByClause?s=[...t.orderByClause.order,...r]:s=r;let i=s.length>0?new Nn(s):null;return new B({withClause:t.withClause,selectClause:t.selectClause,fromClause:t.fromClause,whereClause:t.whereClause,groupByClause:t.groupByClause,havingClause:t.havingClause,orderByClause:i,windowClause:t.windowClause,limitClause:t.limitClause,offsetClause:t.offsetClause,fetchClause:t.fetchClause,forClause:t.forClause})}validateSortCondition(t,e){if(e.asc&&e.desc)throw new Error(`Conflicting sort directions for column '${t}': both asc and desc specified`);if(e.nullsFirst&&e.nullsLast)throw new Error(`Conflicting nulls positions for column '${t}': both nullsFirst and nullsLast specified`);if(!e.asc&&!e.desc&&!e.nullsFirst&&!e.nullsLast)throw new Error(`Empty sort condition for column '${t}': at least one sort option must be specified`)}},$p=class{inject(t,e){if(this.validatePaginationOptions(e),typeof t=="string"&&(t=Q.parse(t)),!(t instanceof B))throw new Error("Complex queries are not supported for pagination");if(t.limitClause||t.offsetClause)throw new Error("Query already contains LIMIT or OFFSET clause. Use removePagination() first if you want to override existing pagination.");let n=(e.page-1)*e.pageSize,r=new Xt(new M("paging_limit",e.pageSize)),s=new zi(new M("paging_offset",n));return new B({withClause:t.withClause,selectClause:t.selectClause,fromClause:t.fromClause,whereClause:t.whereClause,groupByClause:t.groupByClause,havingClause:t.havingClause,orderByClause:t.orderByClause,windowClause:t.windowClause,limitClause:r,offsetClause:s,fetchClause:t.fetchClause,forClause:t.forClause})}static removePagination(t){if(typeof t=="string"&&(t=Q.parse(t)),!(t instanceof B))throw new Error("Complex queries are not supported for pagination removal");return new B({withClause:t.withClause,selectClause:t.selectClause,fromClause:t.fromClause,whereClause:t.whereClause,groupByClause:t.groupByClause,havingClause:t.havingClause,orderByClause:t.orderByClause,windowClause:t.windowClause,limitClause:null,offsetClause:null,fetchClause:t.fetchClause,forClause:t.forClause})}validatePaginationOptions(t){if(!t)throw new Error("Pagination options are required");if(typeof t.page!="number"||t.page<1)throw new Error("Page number must be a positive integer (1 or greater)");if(typeof t.pageSize!="number"||t.pageSize<1)throw new Error("Page size must be a positive integer (1 or greater)");if(t.pageSize>1e3)throw new Error("Page size cannot exceed 1000 items")}},Dp=class{static extractParameterNames(t){return Gu.collect(t).map(e=>e.name.value)}static hasParameter(t,e){return this.extractParameterNames(t).includes(e)}static separateFilters(t,e){let n=this.extractParameterNames(t),r={},s={};for(let[i,l]of Object.entries(e))n.includes(i)?r[i]=l:s[i]=l;return{hardcodedParams:r,dynamicFilters:s}}},gw=class{constructor(t={}){this.options={requireAllParameters:!0,...t}}bind(t,e){let n=t,r=Dp.extractParameterNames(n);if(this.options.requireAllParameters){let s=r.filter(i=>!(i in e)||e[i]===void 0);if(s.length>0)throw new Error(`Missing values for required parameters: ${s.join(", ")}`)}for(let[s,i]of Object.entries(e))if(r.includes(s))try{go.set(n,s,i)}catch(l){throw new Error(`Failed to bind parameter '${s}': ${l instanceof Error?l.message:"Unknown error"}`)}return n}bindToSimpleQuery(t,e){return this.bind(t,e)}},_p=class{constructor(t){this.tableColumnResolver=t}buildQuery(t,e={}){let n;try{n=Q.parse(t)}catch(s){throw new Error(`Failed to parse SQL: ${s instanceof Error?s.message:"Unknown error"}`)}let r=n;if(e.filter&&Object.keys(e.filter).length>0){let{hardcodedParams:s,dynamicFilters:i}=Dp.separateFilters(r,e.filter);if(Object.keys(s).length>0&&(r=new gw({requireAllParameters:!1}).bind(r,s)),Object.keys(i).length>0){let l=new Ap(this.tableColumnResolver),o=$t.buildSimpleQuery(r);r=l.inject(o,i)}}if(e.sort&&Object.keys(e.sort).length>0){let s=new Mp(this.tableColumnResolver),i=$t.buildSimpleQuery(r);r=s.inject(i,e.sort)}if(e.paging){let{page:s=1,pageSize:i}=e.paging;if(i!==void 0){let l=new $p,o={page:s,pageSize:i},a=$t.buildSimpleQuery(r);r=l.inject(a,o)}}if(e.serialize&&typeof e.serialize=="object"){let s=new Rp,i=$t.buildSimpleQuery(r);r=s.buildJsonQuery(i,e.serialize)}return r}buildFilteredQuery(t,e){return this.buildQuery(t,{filter:e})}buildSortedQuery(t,e){return this.buildQuery(t,{sort:e})}buildPaginatedQuery(t,e){return this.buildQuery(t,{paging:e})}buildSerializedQuery(t,e){return this.buildQuery(t,{serialize:e})}validateSql(t){try{return Q.parse(t),!0}catch(e){throw new Error(`Invalid SQL: ${e instanceof Error?e.message:"Unknown error"}`)}}};const vw=Object.freeze(Object.defineProperty({__proto__:null,ArrayExpression:En,ArrayIndexExpression:mo,ArrayQueryExpression:kn,ArraySliceExpression:fo,BetweenExpression:Tn,BinaryExpression:A,BinarySelectQuery:fe,CTECollector:mt,CTEDependencyAnalyzer:Ka,CTEDisabler:Vu,CTENormalizer:Hs,CTENotFoundError:Lp,CaseExpression:bt,CaseKeyValuePair:Sn,CastExpression:Gt,ColumnReference:_,DuplicateCTEError:Fp,DuplicateDetectionMode:Hu,DynamicQueryBuilder:_p,Formatter:Si,FunctionCall:he,IdentifierString:D,InlineQuery:Hn,InsertQuery:qu,InvalidCTENameError:za,LiteralValue:be,ParameterExpression:M,ParenExpression:qe,PostgresJsonQueryBuilder:Rp,QualifiedName:It,QueryBuilder:$t,RawString:K,SchemaCollector:jp,SelectQueryParser:Q,SelectValueCollector:Zt,SelectableColumnCollector:kt,SimpleSelectQuery:B,SqlFormatter:Ut,SqlPaginationInjector:$p,SqlParamInjector:Ap,SqlSortInjector:Mp,StringSpecifierExpression:Xs,SwitchCaseArgument:Cn,TableSchema:Ga,TableSourceCollector:Ku,TokenType:Wu,TupleExpression:Jt,TypeValue:Ht,UnaryExpression:Nt,UpstreamSelectQueryFinder:Ju,ValueList:ke,ValuesQuery:Ft,WindowFrameBound:yp,WindowFrameBoundStatic:Bu,WindowFrameBoundaryValue:Uu,WindowFrameExpression:Jn,WindowFrameSpec:Vs,WindowFrameType:mp,WithClauseParser:Jl},Symbol.toStringTag,{value:"Module"}));class Qt{constructor(e){this.withClause=e}getWithClause(){try{const e=this.withClause.trim().startsWith("WITH ")?`${this.withClause} SELECT 1`:`WITH ${this.withClause} SELECT 1`;return Q.parse(e).toSimpleQuery().withClause||null}catch(e){return console.warn("Failed to parse WITH clause:",e),null}}getString(e){if(this.getWithClause()){const r=this.withClause.trim().startsWith("WITH ")?`${this.withClause} SELECT 1`:`WITH ${this.withClause} SELECT 1`,s=Q.parse(r);return e.format(s).formattedSql}return this.withClause}get displayString(){return this.withClause}toString(){return this.withClause}hasCte(e){var r;const n=this.getWithClause();return((r=n==null?void 0:n.tables)==null?void 0:r.some(s=>{var i,l;return((l=(i=s.aliasExpression)==null?void 0:i.table)==null?void 0:l.name)===e}))||!1}getCteNames(){var n;const e=this.getWithClause();return((n=e==null?void 0:e.tables)==null?void 0:n.map(r=>{var s,i;return(i=(s=r.aliasExpression)==null?void 0:s.table)==null?void 0:i.name}).filter(r=>r!==void 0))||[]}clone(){return new Qt(this.withClause)}toJSON(){return{withClause:this.withClause}}}class xw{constructor(){G(this,"formatter");this.formatter=new Ut({withClauseStyle:"full-oneline"})}compose(e,n){if(!n||n.trim()==="")return e;const r=Q.parse(e).toSimpleQuery(),s=this.prepareForWithClauseParser(n),i=Jl.parse(s);if(r.withClause){const o=r.withClause.tables||[],a=i.tables||[];r.withClause.tables=[...a,...o]}else r.withClause=i;const l=this.formatter.format(r);return typeof l=="string"?l:l.formattedSql}prepareForWithClauseParser(e){let n=e.trim();return n.replace(/^\s*--.*$/gm,"").trim().toLowerCase().startsWith("with")||(n=`WITH ${n}`),n}countCtes(e){var s;if(!e||e.trim()==="")return 0;const n=this.prepareForWithClauseParser(e);return((s=Jl.parse(n).tables)==null?void 0:s.length)||0}}class wn{constructor(e,n,r,s=[],i,l,o){G(this,"_queryResult",null);this.type=e,this.name=n,this.sqlWithoutCte=r,this.dependents=s,this.columns=i,this.originalSql=l,this._formatter=o}dependsOn(e){return this.dependents.some(n=>n.name===e)}addDependency(e){this.dependents.some(n=>n.name===e.name)||this.dependents.push(e)}removeDependency(e){this.dependents=this.dependents.filter(n=>n.name!==e)}getDependentNames(){return this.dependents.map(e=>e.name)}async getFullSql(e,n,r=!1){return(await this.getDynamicSql(e,n,r)).formattedSql}async getDynamicSql(e,n,r=!1){var s;try{console.log("[DEBUG] getDynamicSql called with:",{testValuesType:e?typeof e:"undefined",testValuesWithClause:e&&typeof e=="object"&&"withClause"in e?e.withClause.substring(0,100)+"...":"N/A",dependentsCount:this.dependents.length,sqlWithoutCteLength:this.sqlWithoutCte.length});let i=this.sqlWithoutCte;if(e||this.dependents.length>0){const m=[];if(e)if(e instanceof Qt){const w=e.toString();w.trim()&&m.push(w.trim())}else typeof e=="string"&&e.trim()&&m.push(e.trim());const h=this.collectAllDependencies();console.log("[DEBUG] CTE dependencies:",{dependenciesCount:h.length,dependencyNames:h.map(w=>w.name)});for(const w of h){const C=(s=w.columns)!=null&&s.length?`(${w.columns.join(", ")})`:"",g=`${w.name}${C} AS (
${w.sqlWithoutCte}
)`;console.log("[DEBUG] Adding CTE definition:",w.name,"length:",g.length),m.push(g)}if(m.length>0){const w=new xw,C=m.join(`,
`);i=w.compose(i,C)}}const{SelectQueryParser:l}=await cd(async()=>{const{SelectQueryParser:m}=await Promise.resolve().then(()=>vw);return{SelectQueryParser:m}},void 0);let o=l.parse(i);if(n){const m=n.getFilterConditions();m&&Object.keys(m).length>0&&(o=new _p().buildFilteredQuery(i,m))}const a=new Ut({preset:"postgres",parameterStyle:r?"indexed":"named",keywordCase:"lower",identifierEscape:{start:'"',end:'"'}}),{formattedSql:u,params:c}=a.format(o);return{query:o,formattedSql:u,params:Array.isArray(c)?c:Object.values(c||{})}}catch(i){throw console.error("Error in getDynamicSql:",i),console.error("Error stack:",i instanceof Error?i.stack:"No stack"),console.error("Error details:",{errorMessage:i instanceof Error?i.message:String(i),baseSql:this.sqlWithoutCte.substring(0,200)+"...",dependentsCount:this.dependents.length,dependentNames:this.dependents.map(l=>l.name),hasTestValues:!!e,hasFilterConditions:!!n}),i instanceof Error?new Error(`Failed to generate dynamic SQL: ${i.message}
Stack: ${i.stack}`):new Error("Failed to generate dynamic SQL")}}collectAllDependencies(){const e=new Set,n=[],r=s=>{if(!e.has(s.name)){e.add(s.name);for(const i of s.dependents)r(i);s.type==="cte"&&n.push(s)}};for(const s of this.dependents)r(s);return n}toJSON(){return{type:this.type,name:this.name,sqlWithoutCte:this.sqlWithoutCte,dependents:this.dependents.map(e=>e.name),...this.columns&&{columns:[...this.columns]},...this.originalSql&&{originalSql:this.originalSql}}}static fromJSON(e,n){return new wn(e.type,e.name,e.sqlWithoutCte,[],e.columns,e.originalSql,n)}clone(){return new wn(this.type,this.name,this.sqlWithoutCte,[...this.dependents],this.columns?[...this.columns]:void 0,this.originalSql,this._formatter)}setDependents(e){this.dependents=e}setQueryResult(e){this._queryResult=e}getQueryResult(){return this._queryResult}hasQueryResult(){return this._queryResult!==null}clearQueryResult(){this._queryResult=null}get queryResult(){return this._queryResult}}class tt{constructor(e="undefined"){this.conditions=e}getFilterConditions(){if(this.conditions!=="undefined")try{return JSON.parse(this.conditions)}catch(e){return console.warn("Failed to parse filter conditions:",e),{}}}setFilterConditions(e){if(e===void 0){this.conditions="undefined";return}try{this.conditions=JSON.stringify(e,null,2)}catch(n){console.warn("Failed to stringify filter conditions:",n),this.conditions="undefined"}}static generateTemplate(e){try{console.log("[DEBUG] generateTemplate called with sqlModels:",e.length),e.forEach((o,a)=>{var u;console.log(`[DEBUG] sqlModel[${a}]:`,{type:o.type,name:o.name,hasOriginalSql:!!o.originalSql,originalSql:((u=o.originalSql)==null?void 0:u.substring(0,100))+"..."})});const n=e.find(o=>o.type==="main"&&o.originalSql);if(console.log("[DEBUG] Found mainModel:",!!n,n==null?void 0:n.name),!n||!n.originalSql)return console.log("[DEBUG] No main model with originalSql found, using default template"),tt.getDefaultTemplate();const r=Q.parse(n.originalSql),i=new kt(null,!1,Hu.ColumnNameOnly,{upstream:!0}).collect(r),l={};for(const o of i){const a=o.name;console.log("[DEBUG] Processing column:",a),a.includes("id")||a.includes("Id")?(console.log("[DEBUG] ID column detected:",a),l[a]={},console.log("[DEBUG] Set ID conditions for",a)):a.includes("name")||a.includes("title")||a.includes("description")?l[a]={}:a.includes("date")||a.includes("time")||a.includes("created")||a.includes("updated")?l[a]={}:l[a]={}}return JSON.stringify(l,null,2)}catch(n){return console.warn("Failed to generate template from SQL models:",n),tt.getDefaultTemplate()}}static getDefaultTemplate(){return JSON.stringify({id:{},name:{},created_at:{},status:{}},null,2)}initializeFromModels(e){this.conditions=tt.generateTemplate(e)}reset(){this.conditions=tt.getDefaultTemplate()}isValid(){try{return JSON.parse(this.conditions),!0}catch{return!1}}getFormattedString(){try{const e=JSON.parse(this.conditions);return JSON.stringify(e,null,2)}catch{return this.conditions}}clone(){return new tt(this.conditions)}toJSON(){return{conditions:this.conditions}}static fromJSON(e){return new tt(e.conditions||"{}")}get displayString(){return this.conditions}set displayString(e){this.conditions=e}toString(){return this.conditions}}const lr={identifierEscape:{start:"",end:""},parameterSymbol:":",parameterStyle:"named",indentSize:4,indentChar:" ",newline:`
`,keywordCase:"lower",commaBreak:"before",andBreak:"before",exportComment:!0};class Tt{constructor(e=JSON.stringify(lr,null,2)){this.config=e}getSqlFormatter(){try{const e=JSON.parse(this.config);return new Ut(e)}catch(e){return console.warn("Failed to parse formatter config, using default:",e),new Ut(lr)}}setFormatterConfig(e){try{this.config=JSON.stringify(e,null,2)}catch(n){console.warn("Failed to stringify formatter config:",n),this.config=JSON.stringify(lr,null,2)}}reset(){this.config=JSON.stringify(lr,null,2)}isValid(){try{return JSON.parse(this.config),!0}catch{return!1}}getFormattedString(){try{const e=JSON.parse(this.config);return JSON.stringify(e,null,2)}catch{return this.config}}clone(){return new Tt(this.config)}toJSON(){return{config:this.config}}static fromJSON(e){return new Tt(e.config||JSON.stringify(lr,null,2))}get displayString(){return this.config}set displayString(e){this.config=e}toString(){return this.config}static getDefaultTemplate(){return JSON.stringify(lr,null,2)}initializeDefault(){this.config=Tt.getDefaultTemplate()}}class Ge{constructor(e,n,r,s=[],i=new Qt(""),l=new Tt,o=new tt,a={},u=new Date().toISOString(),c=new Date().toISOString()){G(this,"_openedObjects",[]);G(this,"_activeObjectId","");G(this,"_layoutState",{leftSidebarVisible:!0,rightSidebarVisible:!0,resultsVisible:!1});this.id=e,this.name=n,this.originalFilePath=r,this.sqlModels=s,this.testValues=i,this.formatter=l,this.filterConditions=o,this.modelFilterConditions=a,this.created=u,this.lastModified=c}get openedObjects(){return this._openedObjects}get activeObjectId(){return this._activeObjectId}get activeObject(){return this._openedObjects.find(e=>e.id===this._activeObjectId)||null}openObject(e){const n=this._openedObjects.findIndex(r=>r.id===e.id);n!==-1?this._openedObjects[n]=e:this._openedObjects.push(e),this._activeObjectId=e.id,this.updateModified()}closeObject(e){this._openedObjects=this._openedObjects.filter(n=>n.id!==e),this._activeObjectId===e&&this._openedObjects.length>0?this._activeObjectId=this._openedObjects[0].id:this._openedObjects.length===0&&(this._activeObjectId=""),this.updateModified()}setActiveObject(e){this._openedObjects.find(n=>n.id===e)&&(this._activeObjectId=e,this.updateModified())}updateObjectContent(e,n){const r=this._openedObjects.find(s=>s.id===e);r&&(r.content=n,r.isDirty=!0,this.updateModified())}clearAllObjects(){this._openedObjects=[],this._activeObjectId="",this.updateModified()}get layoutState(){return{...this._layoutState}}setLeftSidebarVisible(e){this._layoutState.leftSidebarVisible=e,this.updateModified()}setRightSidebarVisible(e){this._layoutState.rightSidebarVisible=e,this.updateModified()}setResultsVisible(e){this._layoutState.resultsVisible=e,this.updateModified()}updateLayoutState(e){this._layoutState={...this._layoutState,...e},this.updateModified()}openValuesTab(){const e=this.testValues.toString();this.openObject({id:"values",title:"Values & Test Data",type:"values",content:e,isDirty:!1})}openFormatterTab(){const e=this.formatter.displayString;this.openObject({id:"formatter",title:"SQL Formatter Config",type:"formatter",content:e,isDirty:!1})}openConditionTab(){const e=this.filterConditions.displayString;this.openObject({id:"condition",title:"Filter Conditions",type:"condition",content:e,isDirty:!1})}openSqlModelTab(e){this.openObject({id:e.name,title:e.name,type:e.type,content:e.sqlWithoutCte,isDirty:!1,modelEntity:e})}static createFromFile(e,n,r){const s=new Ge(Ge.generateId(),e,n,[],new Qt(""),new Tt,new tt,{});for(const i of r)s.addSqlModel(i);return s.filterConditions.initializeFromModels(r),s}addSqlModel(e){const n=this.sqlModels.findIndex(r=>r.name===e.name&&r.type===e.type);n>=0?this.sqlModels[n]=e:this.sqlModels.push(e),this.updateModified()}removeSqlModel(e,n){const r=this.sqlModels.length;return this.sqlModels=this.sqlModels.filter(s=>!(s.name===e&&s.type===n)),this.sqlModels.length<r?(this.updateModified(),!0):!1}getSqlModel(e,n){return this.sqlModels.find(r=>r.name===e&&r.type===n)||null}getMainModels(){return this.sqlModels.filter(e=>e.type==="main")}getCteModels(){return this.sqlModels.filter(e=>e.type==="cte")}getFilteredModels(){let e=[...this.sqlModels];if(this.modelFilterConditions.showMainOnly?e=e.filter(n=>n.type==="main"):this.modelFilterConditions.showCtesOnly&&(e=e.filter(n=>n.type==="cte")),this.modelFilterConditions.nameFilter){const n=this.modelFilterConditions.nameFilter.toLowerCase();e=e.filter(r=>r.name.toLowerCase().includes(n))}return this.modelFilterConditions.minDependencies!==void 0&&(e=e.filter(n=>n.dependents.length>=this.modelFilterConditions.minDependencies)),this.modelFilterConditions.minColumns!==void 0&&(e=e.filter(n=>{var r;return(((r=n.columns)==null?void 0:r.length)||0)>=this.modelFilterConditions.minColumns})),this.modelFilterConditions.dependsOn&&this.modelFilterConditions.dependsOn.length>0&&(e=e.filter(n=>this.modelFilterConditions.dependsOn.some(r=>n.dependents.some(s=>s.name===r)))),e}updateTestValues(e){this.testValues=e,this.updateModified()}updateFormatter(e){this.formatter=e,this.updateModified()}updateFilterConditions(e){this.filterConditions=e,this.updateModified()}updateModelFilterConditions(e){this.modelFilterConditions={...this.modelFilterConditions,...e},this.updateModified()}clearFilterConditions(){this.filterConditions.reset(),this.modelFilterConditions={},this.updateModified()}getStatistics(){const e=this.getMainModels().length,n=this.getCteModels().length,r=this.sqlModels.reduce((i,l)=>{var o;return i+(((o=l.columns)==null?void 0:o.length)||0)},0),s=this.calculateMaxDependencyDepth();return{totalModels:this.sqlModels.length,mainQueries:e,ctes:n,maxDependencyDepth:s,totalColumns:r}}calculateMaxDependencyDepth(){const e=new Map(this.sqlModels.map(i=>[i.name,i])),n=new Map,r=(i,l=new Set)=>{if(n.has(i))return n.get(i);if(l.has(i))return 0;l.add(i);const o=e.get(i);if(!o||o.dependents.length===0)return n.set(i,0),0;const u=1+Math.max(...o.dependents.filter(c=>e.has(c.name)).map(c=>r(c.name,new Set(l))));return n.set(i,u),u};let s=0;for(const i of this.sqlModels)s=Math.max(s,r(i.name));return s}clone(){return new Ge(this.id,this.name,this.originalFilePath,this.sqlModels.map(e=>e.clone()),this.testValues.clone(),this.formatter.clone(),this.filterConditions.clone(),{...this.modelFilterConditions},this.created,this.lastModified)}toJSON(){return{id:this.id,name:this.name,originalFilePath:this.originalFilePath,sqlModels:this.sqlModels.map(e=>e.toJSON()),testValues:this.testValues.toJSON(),formatter:this.formatter.toJSON(),filterConditions:this.filterConditions.toJSON(),modelFilterConditions:this.modelFilterConditions,openedObjects:this._openedObjects,activeObjectId:this._activeObjectId,layoutState:this._layoutState,created:this.created,lastModified:this.lastModified}}static fromJSON(e){var r;const n=new Ge(e.id,e.name,e.originalFilePath,[],new Qt(((r=e.testValues)==null?void 0:r.withClause)||""),Tt.fromJSON(e.formatter||{}),tt.fromJSON(e.filterConditions||{}),e.modelFilterConditions||{},e.created,e.lastModified);if(e.sqlModels&&Array.isArray(e.sqlModels)){const s=new Map,i=new Map;for(const l of e.sqlModels){const o=wn.fromJSON(l,n.formatter.getSqlFormatter());s.set(o.name,o),i.set(o.name,l.dependents||[]),n.addSqlModel(o)}for(const[l,o]of i){const a=s.get(l);if(a){const u=o.map(c=>s.get(c)).filter(c=>c!==void 0);a.setDependents(u)}}}return e.openedObjects&&Array.isArray(e.openedObjects)&&(n._openedObjects=e.openedObjects.map(s=>({...s,modelEntity:s.modelEntity?n.sqlModels.find(i=>i.name===s.modelEntity.name):void 0}))),e.activeObjectId&&(n._activeObjectId=e.activeObjectId),e.layoutState&&(n._layoutState={...n._layoutState,...e.layoutState}),n}updateModified(){this.lastModified=new Date().toISOString()}static generateId(){return`ws_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}class qp{constructor(e,n){this.parser=e,this._dependencyAnalyzer=n,this._dependencyAnalyzer}async decomposeSql(e,n,r){const s=await this.parser.extractCTEs(e);if(s.length===0){const h=await this.parser.extractMainQuery(e);let w=h;if(r)try{const g=r.getSqlFormatter();console.log("[DEBUG] Attempting to parse and format:",h);const v=Q.parse(h);console.log("[DEBUG] Parse successful, query type:",v.constructor.name),w=g.format(v).formattedSql,console.log("[DEBUG] Format successful:",w)}catch(g){console.error("[DEBUG] rawsql-ts error:",g),console.error("[DEBUG] Error details:",{type:g.constructor.name,message:g.message,sql:h})}return[new wn("main",n,w,[],void 0,e,r==null?void 0:r.getSqlFormatter())]}const i=new Map;for(const h of s){let w=h.query;if(r)try{const g=r.getSqlFormatter();console.log(`[DEBUG] Attempting to parse and format CTE ${h.name}:`,h.query);const v=Q.parse(h.query);console.log(`[DEBUG] CTE ${h.name} parse successful, query type:`,v.constructor.name),w=g.format(v).formattedSql,console.log(`[DEBUG] CTE ${h.name} format successful:`,w)}catch(g){console.error(`[DEBUG] rawsql-ts error for CTE ${h.name}:`,g),console.error("[DEBUG] Error details:",{type:g.constructor.name,message:g.message,sql:h.query})}const C=new wn("cte",h.name,w,[],h.getColumnNames(),void 0,r==null?void 0:r.getSqlFormatter());i.set(h.name,C)}const l=await this.parser.extractMainQuery(e);let o=l;if(r)try{const h=r.getSqlFormatter();console.log("[DEBUG] Attempting to parse and format main query:",l);const w=Q.parse(l);console.log("[DEBUG] Main query parse successful, query type:",w.constructor.name),o=h.format(w).formattedSql,console.log("[DEBUG] Main query format successful:",o)}catch(h){console.error("[DEBUG] rawsql-ts error for main query:",h),console.error("[DEBUG] Error details:",{type:h.constructor.name,message:h.message,sql:l})}const a=new wn("main",n,o,[],void 0,e,r==null?void 0:r.getSqlFormatter());i.set(n,a);const u={};s.forEach(h=>{u[h.name]=h});for(const h of s){const w=i.get(h.name);for(const C of h.dependencies){const g=i.get(C);g&&w.addDependency(g)}}const c=await this.parser.extractDependencies(l),m=new Set(s.map(h=>h.name));for(const h of c)if(m.has(h)){const w=i.get(h);w&&a.addDependency(w)}return Array.from(i.values())}async reconstructSql(e,n){const r=e.find(s=>s.type==="main"&&s.name===n);if(!r)throw new Error(`Main model "${n}" not found`);return r.getFullSql()}getExecutionOrder(e){const n=e.filter(l=>l.type==="cte"),r=new Set,s=[],i=l=>{r.has(l.name)||(r.add(l.name),l.dependents.forEach(o=>{o.type==="cte"&&i(o)}),s.push(l.name))};return n.forEach(l=>i(l)),s}}class qi{constructor(e,n,r=[],s=[],i){this.name=e,this.query=n,this.dependencies=r,this.columns=s,this.description=i,this.validateName()}validateName(){if(!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(this.name))throw new Error(`Invalid CTE name: ${this.name}. Must start with letter and contain only letters, numbers, and underscores.`)}static create(e){return new qi(e.name,e.query,[],[],e.description)}updateQuery(e){this.query=e,this.dependencies=[]}addDependency(e){this.dependencies.includes(e)||this.dependencies.push(e)}removeDependency(e){this.dependencies=this.dependencies.filter(n=>n!==e)}setDependencies(e){this.dependencies=[...e]}hasDependency(e){return this.dependencies.includes(e)}setColumns(e){this.columns=[...e]}getColumnNames(){return this.columns.map(e=>e.name)}updateDescription(e){this.description=e}clone(){return new qi(this.name,this.query,[...this.dependencies],[...this.columns],this.description)}}class Bp{async extractCTEs(e){var n,r,s,i,l;try{const a=Q.parse(e).toSimpleQuery(),u=[];if((n=a.withClause)!=null&&n.tables){const c=new Ka;c.analyzeDependencies(a);for(const m of a.withClause.tables){const h=(s=(r=m.aliasExpression)==null?void 0:r.table)==null?void 0:s.name;if(!h)continue;const w=this.extractCTEQueryString(m),C=c.getDependencies(h)||[],g=((l=(i=m.aliasExpression)==null?void 0:i.columns)==null?void 0:l.map(p=>p.name))||[],v=new qi(h,w,C,g.map(p=>({name:p,type:"unknown"})));u.push(v)}}return u}catch(o){throw new Error(`CTE extraction failed: ${o instanceof Error?o.message:"Unknown error"}`)}}async extractMainQuery(e){try{const r=Q.parse(e).toSimpleQuery();return this.reconstructMainQuery(e,r)}catch{return this.extractMainQueryManually(e)}}async extractDependencies(e){const n=new Set;try{const r=Q.parse(e),s=r.toSimpleQuery();try{const l=new Ka;l.analyzeDependencies(s);const o=l.getMainQueryDependencies();if(o&&o.length>0)return o}catch{}const i=r;i.left!==void 0&&i.right!==void 0&&i.operator!==void 0?this.extractDependenciesFromBinaryQuery(r,n):this.extractDependenciesFromSimpleQuery(s,n)}catch{(e.match(/\b(?:FROM|JOIN)\s+([a-zA-Z_][a-zA-Z0-9_]*)/gi)||[]).forEach(i=>{const l=i.replace(/^(?:FROM|JOIN)\s+/i,"").trim();l&&/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(l)&&n.add(l)})}return Array.from(n)}extractDependenciesFromBinaryQuery(e,n){if(e.left)if(e.left.left!==void 0&&e.left.right!==void 0&&e.left.operator!==void 0)this.extractDependenciesFromBinaryQuery(e.left,n);else{const r=e.left.toSimpleQuery();this.extractDependenciesFromSimpleQuery(r,n)}if(e.right)if(e.right.left!==void 0&&e.right.right!==void 0&&e.right.operator!==void 0)this.extractDependenciesFromBinaryQuery(e.right,n);else{const r=e.right.toSimpleQuery();this.extractDependenciesFromSimpleQuery(r,n)}}extractDependenciesFromSimpleQuery(e,n){var r,s;if(this.extractFromSource((r=e.fromClause)==null?void 0:r.source,n),(s=e.fromClause)!=null&&s.joins)for(const i of e.fromClause.joins)this.extractFromSource(i.source,n)}extractCTEQueryString(e){if(!e.query)throw new Error("CTE object does not have a query property");try{return new Ut().format(e.query).formattedSql}catch(n){throw console.error("Failed to format CTE query:",n),n}}reconstructMainQuery(e,n){if(!n.withClause||!e.match(/^WITH\s+(?:RECURSIVE\s+)?/i))return e;const s=e.match(/\)\s*(SELECT|INSERT|UPDATE|DELETE)/is);if(s&&s.index!==void 0){const i=s.index+s[0].indexOf(s[1]);return e.substring(i).trim()}return e}extractMainQueryManually(e){if(e=e.trim(),!e.match(/^WITH\s+/i))return e;let n=0,r=!1,s="",i=-1,l=!1;for(let o=0;o<e.length;o++){const a=e[o],u=o>0?e[o-1]:"";if((a==="'"||a==='"')&&u!=="\\"){r?a===s&&(r=!1):(r=!0,s=a);continue}r||(a==="("?(n++,l=!0):a===")"&&(n--,n===0&&l&&(i=o)))}return i!==-1?e.substring(i+1).trim().replace(/^,?\s*/,""):e}extractFromSource(e,n){var r,s,i;e&&((s=(r=e.datasource)==null?void 0:r.table)!=null&&s.name&&n.add(e.datasource.table.name),(i=e.datasource)!=null&&i.query)}}class Up{resolveDependencies(e,n){const r=n[e];if(!r)throw new Error(`CTE not found: ${e}`);const s=new Set,i=new Set,l=[],o=u=>{if(s.has(u))return;if(i.has(u))throw new Error("Circular dependency detected");i.add(u);const c=n[u];if(c&&c.dependencies)for(const m of c.dependencies)n[m]&&o(m);i.delete(u),s.add(u),l.push(u)};return o(e),l.length===1&&l[0]===e?r.query:`WITH ${l.map(u=>{const c=n[u];return`${u} AS (
    ${c.query.replace(/\n/g,`
    `)}
)`}).join(`,
`)}
SELECT * FROM ${e}`}validateNoCycles(e){try{const n=new Set,r=new Set,s=i=>{if(n.has(i))return;if(r.has(i))throw new Error("Circular dependency detected");r.add(i);const l=e[i];if(l&&l.dependencies)for(const o of l.dependencies)e[o]&&s(o);r.delete(i),n.add(i)};for(const i of Object.keys(e))n.has(i)||s(i);return!0}catch{return!1}}getExecutionOrder(e){const n=new Set,r=new Set,s=[],i=l=>{if(n.has(l))return;if(r.has(l))throw new Error("Circular dependency detected");r.add(l);const o=e[l];if(o&&o.dependencies)for(const a of o.dependencies)e[a]&&i(a);r.delete(l),n.add(l),s.push(l)};for(const l of Object.keys(e))n.has(l)||i(l);return s}findDependents(e,n){const r=[];for(const[s,i]of Object.entries(n))i.dependencies.includes(e)&&r.push(s);return r}getDependencyGraph(e){const n={};for(const[r,s]of Object.entries(e))n[r]=[...s.dependencies];return n}}class Qp{constructor(){G(this,"resolver");this.resolver=new Up}findDependents(e,n){const r={};for(const[s,i]of Object.entries(n))r[s]={name:i.name,query:i.query,dependencies:i.dependencies,columns:i.columns,description:i.description};return this.resolver.findDependents(e,r)}getDependencyGraph(e){const n={};for(const[r,s]of Object.entries(e))n[r]={name:s.name,query:s.query,dependencies:s.dependencies,columns:s.columns,description:s.description};return this.resolver.getDependencyGraph(n)}}class Wp{constructor(e,n){G(this,"decomposer");this.name=e,this.sql=n;const r=new Bp,s=new Qp;this.decomposer=new qp(r,s)}canExecute(){return this.name.trim().length>0&&this.sql.trim().length>0}async execute(){const e=this.name.trim(),n=this.sql.trim();if(!e)throw new Error("Workspace name is required");if(!n)throw new Error("SQL query is required");try{const r=await this.decomposer.decomposeSql(n,`${e}.sql`,new Tt),s=new Ge(Ge.generateId(),e,`${e}.sql`,r,new Qt(""),new Tt,new tt,{});s.filterConditions.initializeFromModels(r);const i=r.find(l=>l.type==="main");return i&&s.openSqlModelTab(i),s}catch(r){throw r instanceof Error?new Error(`SQL parsing failed: ${r.message}`):new Error("Failed to create workspace")}}}class zp{constructor(){G(this,"_listeners",[])}subscribe(e){return this._listeners.push(e),()=>{const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}}notifyChange(e,n){this._listeners.forEach(r=>r(e,n))}dispose(){this._listeners.length=0}}class Cw extends zp{constructor(){super(...arguments);G(this,"_name","");G(this,"_sql","");G(this,"_isLoading",!1);G(this,"_error",null);G(this,"onWorkspaceCreated")}get name(){return this._name}set name(n){this._name!==n&&(this._name=n,this.notifyChange("name",n))}get sql(){return this._sql}set sql(n){this._sql!==n&&(this._sql=n,this.notifyChange("sql",n))}get isLoading(){return this._isLoading}set isLoading(n){this._isLoading!==n&&(this._isLoading=n,this.notifyChange("isLoading",n))}get error(){return this._error}set error(n){this._error!==n&&(this._error=n,this.notifyChange("error",n))}get canExecute(){return!this._isLoading&&this._name.trim().length>0&&this._sql.trim().length>0}async executeCreateWorkspace(){var n;if(this.canExecute){this.isLoading=!0,this.error=null;try{const s=await this.createCommand().execute();(n=this.onWorkspaceCreated)==null||n.call(this,s),this.resetForm()}catch(r){this.error=r instanceof Error?r.message:"Unknown error occurred"}finally{this.isLoading=!1}}}clearError(){this.error=null}dispose(){super.dispose()}createCommand(){return new Wp(this._name,this._sql)}resetForm(){this.name="",this.sql="",this.error=null}}function Vp(t){const[,e]=O.useState({}),n=O.useRef(null);return O.useEffect(()=>(n.current=t.subscribe((r,s)=>{e({})}),()=>{n.current&&n.current()}),[t]),t}const Sw=({isOpen:t,onClose:e,onWorkspaceCreated:n})=>{const r=O.useRef(null);r.current||(r.current=new Cw);const s=Vp(r.current);O.useEffect(()=>{s&&(s.onWorkspaceCreated=l=>{n==null||n(l),e()})},[s,n,e]),O.useEffect(()=>()=>{r.current&&r.current.dispose()},[]);const i=async l=>{l.preventDefault(),await s.executeCreateWorkspace()};return t?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-dark-secondary border border-dark-border-primary rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border-primary",children:[d.jsx("h2",{className:"text-lg font-semibold text-dark-text-white",children:"Create New Workspace"}),d.jsx("button",{onClick:e,className:"text-dark-text-secondary hover:text-dark-text-primary",disabled:s.isLoading,children:""})]}),d.jsxs("form",{onSubmit:i,className:"flex-1 flex flex-col overflow-hidden",children:[d.jsxs("div",{className:"p-4 space-y-4",children:[s.error&&d.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 rounded p-3 text-red-400 text-sm",children:[s.error,d.jsx("button",{onClick:()=>s.clearError(),className:"ml-2 text-red-300 hover:text-red-200",children:""})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"workspace-name",className:"block text-sm font-medium text-dark-text-white mb-2",children:"Workspace Name"}),d.jsx("input",{id:"workspace-name",type:"text",value:s.name,onChange:l=>s.name=l.target.value,placeholder:"Enter workspace name...",className:"w-full px-3 py-2 bg-dark-primary border border-dark-border-primary rounded text-dark-text-primary placeholder-dark-text-muted focus:outline-none focus:border-primary-600 transition-colors duration-200 autofill-dark",disabled:s.isLoading,required:!0})]}),d.jsxs("div",{className:"flex-1 flex flex-col",children:[d.jsx("label",{htmlFor:"sql-query",className:"block text-sm font-medium text-dark-text-white mb-2",children:"SQL Query"}),d.jsx("textarea",{id:"sql-query",value:s.sql,onChange:l=>s.sql=l.target.value,placeholder:"Paste your SQL query with CTEs here...",className:"w-full h-64 px-3 py-2 bg-dark-primary border border-dark-border-primary rounded text-dark-text-primary placeholder-dark-text-muted font-mono text-sm resize-none focus:outline-none focus:border-primary-600 transition-colors duration-200",disabled:s.isLoading,required:!0})]})]}),d.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-dark-border-primary",children:[d.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-dark-text-primary hover:bg-dark-hover rounded transition-colors",disabled:s.isLoading,children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!s.canExecute,children:s.isLoading?"Creating...":"Create Workspace"})]})]})]})}):null};class Ew{constructor(e,n,r){this.workspaceRepository=e,this.sqlParser=n,this.cteResolver=r}async createWorkspace(e){try{await this.sqlParser.parseQuery(e.sql);const n=await this.sqlParser.extractCTEs(e.sql),r=await this.sqlParser.formatQuery(e.sql,{withClauseStyle:"full-oneline",keywordCase:"lower",indentSize:4}),s=new Ge(Ge.generateId(),e.name,e.originalFilePath||null,[]);return console.log(`[WORKSPACE] Extracted ${n.length} CTEs`),s.originalQuery=e.sql,s.decomposedQuery=r,await this.workspaceRepository.save(s),{success:!0,data:s,message:"Workspace created successfully"}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Failed to create workspace"}}}async loadWorkspace(){try{return{success:!0,data:await this.workspaceRepository.findById("current")}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to load workspace"}}}async updateCTE(e){try{const n=await this.workspaceRepository.findById("current");if(!n)return{success:!1,error:"No active workspace found"};const r=new Ge(n.id,n.name,n.originalFilePath||null,[]);return console.log(`[WORKSPACE] Would update CTE ${e.cteName}`),r.privateCtes=n.privateCtes,await this.workspaceRepository.save(r),{success:!0,message:`CTE ${e.cteName} updated successfully`}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Failed to update CTE"}}}async generateExecutableCTE(e){try{const n=await this.workspaceRepository.findById("current");return n?n.privateCtes[e]?{success:!0,data:this.cteResolver.resolveDependencies(e,n.privateCtes)}:{success:!1,error:`CTE not found: ${e}`}:{success:!1,error:"No active workspace found"}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Failed to generate executable CTE"}}}async validateWorkspace(){try{const e=await this.workspaceRepository.findById("current");if(!e)return{success:!1,error:"No active workspace found"};const n=[];try{this.cteResolver.validateNoCycles(e.privateCtes)||n.push("Circular dependency detected in CTEs")}catch(r){n.push(`Dependency validation error: ${r instanceof Error?r.message:"Unknown error"}`)}for(const[r,s]of Object.entries(e.privateCtes))try{await this.sqlParser.parseQuery(s.query)}catch(i){n.push(`Invalid SQL syntax in CTE '${r}': ${i instanceof Error?i.message:"Unknown error"}`)}return{success:!0,data:{isValid:n.length===0,errors:n}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to validate workspace"}}}async clearWorkspace(){try{return await this.workspaceRepository.clear(),{success:!0,message:"Workspace cleared successfully"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to clear workspace"}}}}class kw{constructor(){G(this,"STORAGE_KEY","zosql_workspace_v2");G(this,"VERSION","2.0.0")}async findById(e){try{const n=localStorage.getItem(this.STORAGE_KEY);if(!n)return null;const r=JSON.parse(n);return r.version!==this.VERSION?(console.warn("Version mismatch, clearing old workspace data"),await this.clear(),null):r.workspace||null}catch(n){return console.error("Failed to load workspace from localStorage:",n),null}}async save(e){try{const n={version:this.VERSION,workspace:e,lastSaved:new Date().toISOString()};localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}catch(n){throw new Error(`Failed to save workspace: ${n instanceof Error?n.message:"Unknown error"}`)}}async clear(){try{localStorage.removeItem(this.STORAGE_KEY)}catch(e){throw new Error(`Failed to clear workspace: ${e instanceof Error?e.message:"Unknown error"}`)}}getStorageInfo(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return{size:0};const n=JSON.parse(e);return{size:e.length,lastSaved:n.lastSaved}}catch{return{size:0}}}static isAvailable(){try{const e="__zosql_storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}}class Tw{async parseQuery(e){try{return{type:"simple",withClause:Q.parse(e).toSimpleQuery().withClause?{tables:[]}:void 0,ctes:[]}}catch(n){throw new Error(`SQL parsing failed: ${n instanceof Error?n.message:"Unknown error"}`)}}async extractCTEs(e){var n,r;try{const i=Q.parse(e).toSimpleQuery(),l=[];if(i.withClause&&i.withClause.tables)for(const o of i.withClause.tables){const a=((r=(n=o.aliasExpression)==null?void 0:n.table)==null?void 0:r.name)||"unknown",u=await this.extractCTEQuery(o),c=await this.extractCTEDependencies(o),m=new qi(a,u,c,[],`Extracted CTE: ${a}`);l.push(m)}return l}catch(s){throw new Error(`CTE extraction failed: ${s instanceof Error?s.message:"Unknown error"}`)}}async formatQuery(e,n={}){try{return e}catch(r){throw new Error(`SQL formatting failed: ${r instanceof Error?r.message:"Unknown error"}`)}}async extractCTEQuery(e){if(!e||!e.query)return"";try{return typeof e.query.toSqlString=="function"?e.query.toSqlString():""}catch(n){return console.warn(`Failed to extract CTE query: ${n}`),`-- CTE extraction failed: ${n instanceof Error?n.message:"Unknown error"}`}}async extractCTEDependencies(e){const n=[];if(!e||!e.query)return n;try{const r=await this.extractCTEQuery(e);if(r){const s=r.match(/\b(?:FROM|JOIN)\s+([a-zA-Z][a-zA-Z0-9_]*)/gi);s&&s.forEach(i=>{const l=i.replace(/^(?:FROM|JOIN)\s+/i,"").trim();l&&/^[a-zA-Z][a-zA-Z0-9_]*$/.test(l)&&n.push(l)})}}catch(r){console.warn(`Failed to extract CTE dependencies: ${r}`)}return[...new Set(n)]}}const Kp=O.createContext(void 0),Gp=()=>{const t=O.useContext(Kp);if(!t)throw new Error("useWorkspace must be used within a WorkspaceProvider");return t},Nw=({children:t})=>{const[e,n]=O.useState(null),[r,s]=O.useState(!1),[i,l]=O.useState(null),o=new Ew(new kw,new Tw,new Up),a=v=>{if(!v.success)throw new Error(v.error||"Unknown error");return v.data},u=async v=>{s(!0),l(null);try{const p=await o.createWorkspace(v),f=a(p);n(f)}catch(p){const f=p instanceof Error?p.message:"Failed to create workspace";throw l(f),p}finally{s(!1)}},c=async()=>{s(!0),l(null);try{const v=await o.loadWorkspace(),p=a(v);n(p)}catch(v){const p=v instanceof Error?v.message:"Failed to load workspace";l(p)}finally{s(!1)}},m=async(v,p,f)=>{l(null);try{const y=await o.updateCTE({cteName:v,query:p,description:f});a(y),await c()}catch(y){const x=y instanceof Error?y.message:"Failed to update CTE";throw l(x),y}},h=async v=>{l(null);try{const p=await o.generateExecutableCTE(v);return a(p)}catch(p){const f=p instanceof Error?p.message:"Failed to generate executable CTE";throw l(f),p}},w=async()=>{l(null);try{const v=await o.clearWorkspace();a(v),n(null)}catch(v){const p=v instanceof Error?v.message:"Failed to clear workspace";throw l(p),v}},C=async()=>{l(null);try{const v=await o.validateWorkspace();return a(v)}catch(v){const p=v instanceof Error?v.message:"Failed to validate workspace";throw l(p),v}};O.useEffect(()=>{c()},[]);const g={workspace:e,isLoading:r,error:i,createWorkspace:u,loadWorkspace:c,updateCTE:m,generateExecutableCTE:h,clearWorkspace:w,validateWorkspace:C};return d.jsx(Kp.Provider,{value:g,children:t})},bw=({isOpen:t,onClose:e,onFileOpen:n})=>{const[r,s]=O.useState(null),[i,l]=O.useState(""),[o,a]=O.useState(""),[u,c]=O.useState(!1),[m,h]=O.useState(!1),w=O.useRef(null),{createWorkspace:C}=Gp(),g=E=>{if(!E.name.toLowerCase().endsWith(".sql")){alert("Please select a .sql file");return}s(E),a(E.name.replace(".sql",""));const T=new FileReader;T.onload=j=>{var ve;const F=(ve=j.target)==null?void 0:ve.result;l(F)},T.readAsText(E)},v=E=>{var j;const T=(j=E.target.files)==null?void 0:j[0];T&&g(T)},p=E=>{E.preventDefault(),h(!0)},f=E=>{E.preventDefault(),h(!1)},y=E=>{E.preventDefault(),h(!1);const T=E.dataTransfer.files;T.length>0&&g(T[0])},x=async E=>{if(E.preventDefault(),!(!r||!i.trim()||!o.trim())){c(!0);try{n?await n(r):await C({name:o.trim(),sql:i.trim(),originalFilePath:r.name}),s(null),l(""),a(""),e()}catch(T){console.error("Failed to process file:",T)}finally{c(!1)}}},N=()=>{s(null),l(""),a(""),h(!1),w.current&&(w.current.value="")},b=()=>{N(),e()};return t?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:d.jsxs("div",{className:"bg-dark-secondary border border-dark-border-primary rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-border-primary",children:[d.jsx("h2",{className:"text-lg font-semibold text-dark-text-white",children:"Open SQL File"}),d.jsx("button",{onClick:b,className:"text-dark-text-secondary hover:text-dark-text-primary",disabled:u,children:""})]}),d.jsxs("form",{onSubmit:x,className:"flex-1 flex flex-col overflow-hidden",children:[d.jsxs("div",{className:"p-4 space-y-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-dark-text-white mb-2",children:"Select SQL File"}),r?d.jsx("div",{className:"w-full p-3 border border-dark-border-primary rounded-lg bg-dark-primary",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-lg",children:""}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm font-medium text-dark-text-white",children:r.name}),d.jsxs("div",{className:"text-xs text-dark-text-secondary",children:[(r.size/1024).toFixed(1)," KB"]})]})]}),d.jsx("button",{type:"button",onClick:N,className:"text-dark-text-secondary hover:text-dark-text-primary text-sm",disabled:u,children:"Change"})]})}):d.jsx("div",{className:`
                    w-full h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center cursor-pointer transition-colors
                    ${m?"border-primary-600 bg-primary-600 bg-opacity-10":"border-dark-border-primary hover:border-dark-border-accent"}
                  `,onDragOver:p,onDragLeave:f,onDrop:y,onClick:()=>{var E;return(E=w.current)==null?void 0:E.click()},children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl mb-2",children:""}),d.jsx("div",{className:"text-sm text-dark-text-primary",children:"Drop SQL file here or click to browse"}),d.jsx("div",{className:"text-xs text-dark-text-secondary mt-1",children:"Supports .sql files"})]})}),d.jsx("input",{ref:w,type:"file",accept:".sql",onChange:v,className:"hidden",disabled:u})]}),r&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"workspace-name",className:"block text-sm font-medium text-dark-text-white mb-2",children:"Workspace Name"}),d.jsx("input",{id:"workspace-name",type:"text",value:o,onChange:E=>a(E.target.value),placeholder:"Enter workspace name...",className:"w-full px-3 py-2 bg-dark-primary border border-dark-border-primary rounded text-dark-text-primary placeholder-dark-text-muted focus:outline-none focus:border-primary-600",disabled:u,required:!0})]}),i&&d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-dark-text-white mb-2",children:"File Preview"}),d.jsx("div",{className:"w-full h-48 bg-dark-primary border border-dark-border-primary rounded overflow-hidden",children:d.jsxs("pre",{className:"w-full h-full p-3 text-xs text-dark-text-primary font-mono overflow-auto",children:[i.substring(0,2e3),i.length>2e3&&`
... (truncated)`]})}),d.jsxs("div",{className:"text-xs text-dark-text-secondary mt-1",children:[i.split(`
`).length," lines, ",i.length," characters"]})]})]}),d.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-dark-border-primary",children:[d.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-dark-text-primary hover:bg-dark-hover rounded transition-colors",disabled:u,children:"Cancel"}),d.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u||!r||!o.trim(),children:u?"Opening...":"Open File"})]})]})]})}):null},Iw=({onToggleLeftSidebar:t,onToggleRightSidebar:e,leftSidebarVisible:n,rightSidebarVisible:r,onFileOpen:s,onWorkspaceCreated:i,workspaceName:l})=>{const[o,a]=O.useState(!1),[u,c]=O.useState(!1);return d.jsxs("header",{className:"bg-dark-tertiary border-b border-dark-border-primary px-4 py-3 flex items-center justify-between h-header",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:t,className:"px-2 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm",title:"Toggle Left Sidebar",children:n?"":""}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("h1",{className:"text-lg font-bold text-dark-text-white",children:"zosql"}),d.jsx("span",{className:"text-xs text-dark-text-secondary",children:"v2.0"})]})]}),d.jsx("div",{className:"flex items-center gap-4",children:l&&d.jsxs("div",{className:"flex items-center gap-2 text-dark-text-primary",children:[d.jsx("span",{className:"text-sm",children:"Workspace:"}),d.jsx("span",{className:"text-sm font-medium text-dark-text-white",children:l})]})}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("div",{className:"flex items-center bg-dark-hover rounded",children:[d.jsx("button",{onClick:()=>a(!0),className:"px-3 py-1 bg-primary-600 text-white rounded-l hover:bg-primary-700 transition-colors text-sm font-medium",title:"New Workspace",children:"New"}),d.jsx("button",{onClick:()=>c(!0),className:"px-3 py-1 bg-primary-600 text-white rounded-r hover:bg-primary-700 transition-colors text-sm font-medium border-l border-primary-700",title:"Open SQL File",children:"Open"})]}),d.jsx("button",{className:"px-3 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm",title:"Save Workspace",children:"Save"}),d.jsx("div",{className:"w-px h-6 bg-dark-border-primary mx-2"}),d.jsx("button",{onClick:e,className:"px-2 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm",title:"Toggle Right Sidebar",children:r?"":""})]}),d.jsx(Sw,{isOpen:o,onClose:()=>a(!1),onWorkspaceCreated:i}),d.jsx(bw,{isOpen:u,onClose:()=>c(!1),onFileOpen:s})]})},Ow=({models:t,onModelClick:e,selectedModelName:n,onOpenValuesTab:r})=>{if(!t||t.length===0)return d.jsx("div",{className:"text-sm text-dark-text-primary opacity-75",children:"No SQL models loaded"});const s=t.filter(l=>l.type==="main"),i=t.filter(l=>l.type==="cte");return d.jsxs("div",{className:"space-y-4",children:[s.length>0&&d.jsxs("div",{children:[d.jsx("h4",{className:"text-xs font-medium text-dark-text-secondary uppercase mb-2",children:"Main Query"}),d.jsx("div",{className:"space-y-1",children:s.map(l=>d.jsx("div",{onClick:()=>e==null?void 0:e(l),className:`
                  p-2 cursor-pointer transition-all relative
                  ${n===l.name?"bg-dark-hover text-dark-text-white border-l-2 border-primary-600":"hover:bg-dark-hover text-dark-text-primary"}
                `,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-xs",children:""}),d.jsx("span",{className:"text-sm font-medium",children:"*root"})]}),l.dependents.length>0&&d.jsxs("span",{className:`text-xs ${n===l.name?"text-primary-400":"text-dark-text-secondary"}`,children:[l.dependents.length," deps"]})]})},l.name))}),d.jsx("div",{className:"mt-2",children:d.jsx("div",{onClick:()=>r==null?void 0:r(),className:"p-2 cursor-pointer transition-all relative hover:bg-dark-hover text-dark-text-primary",children:d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-xs",children:""}),d.jsx("span",{className:"text-sm font-medium",children:"*data"})]})})})]}),i.length>0&&d.jsxs("div",{children:[d.jsxs("h4",{className:"text-xs font-medium text-dark-text-secondary uppercase mb-2",children:["CTEs (",i.length,")"]}),d.jsx("div",{className:"space-y-1",children:i.map(l=>d.jsxs("div",{onClick:()=>e==null?void 0:e(l),className:`
                  p-2 cursor-pointer transition-all relative
                  ${n===l.name?"bg-dark-hover text-dark-text-white border-l-2 border-primary-600":"hover:bg-dark-hover text-dark-text-primary"}
                `,children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-xs",children:""}),d.jsx("span",{className:"text-sm font-medium",children:l.name})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[l.columns&&l.columns.length>0&&d.jsxs("span",{className:`text-xs ${n===l.name?"text-primary-400":"text-dark-text-secondary"}`,children:[l.columns.length," cols"]}),l.dependents.length>0&&d.jsxs("span",{className:`text-xs ${n===l.name?"text-primary-400":"text-dark-text-secondary"}`,children:[l.dependents.length," deps"]})]})]}),l.columns&&l.columns.length>0&&d.jsxs("div",{className:`text-xs mt-1 ${n===l.name?"text-dark-text-primary opacity-90":"text-dark-text-primary opacity-75"}`,children:["Columns: ",l.columns.join(", ")]})]},l.name))})]}),i.length>0&&d.jsxs("div",{className:"mt-4 pt-4 border-t border-dark-border-primary",children:[d.jsx("h4",{className:"text-xs font-medium text-dark-text-secondary uppercase mb-2",children:"Dependency Summary"}),d.jsxs("div",{className:"text-xs text-dark-text-primary opacity-75 space-y-1",children:[d.jsxs("div",{children:["Total models: ",t.length]}),d.jsxs("div",{children:["Main query: ",s.length]}),d.jsxs("div",{children:["CTEs: ",i.length]}),i.length>0&&d.jsxs("div",{children:["Max depth: ",Fw(t)]})]})]})]})};function Fw(t){const e=new Map(t.map(i=>[i.name,i])),n=new Map;function r(i,l=new Set){if(n.has(i))return n.get(i);if(l.has(i))return 0;l.add(i);const o=e.get(i);if(!o||o.dependents.length===0)return n.set(i,0),0;const u=1+Math.max(...o.dependents.filter(c=>e.has(c.name)).map(c=>r(c.name,new Set(l))));return n.set(i,u),u}let s=0;for(const i of t)s=Math.max(s,r(i.name));return s}const Lw=({onOpenValuesTab:t,sqlModels:e=[],onModelClick:n,selectedModelName:r,onDecomposeQuery:s,isDecomposing:i,workspace:l})=>{const{isLoading:o,validateWorkspace:a}=Gp(),[u,c]=O.useState(!1),m=async()=>{if(l){c(!0);try{const h=await a();console.log("Validation result:",h)}catch(h){console.error("Validation failed:",h)}finally{c(!1)}}};return d.jsxs("aside",{className:"w-sidebar bg-dark-secondary border-r border-dark-border-primary p-3 overflow-y-auto flex-shrink-0",children:[d.jsxs("div",{className:"mb-6",children:[d.jsx("h3",{className:"text-sm font-medium text-dark-text-white mb-3 border-b border-dark-border-primary pb-2",children:"Workspace"}),o&&d.jsx("div",{className:"text-sm text-dark-text-secondary",children:"Loading workspace..."}),!o&&!l&&e.length===0&&d.jsx("div",{className:"text-sm text-dark-text-primary opacity-75",children:"No workspace loaded"}),l&&d.jsxs("div",{className:"space-y-2 text-sm",children:[d.jsxs("div",{className:"text-dark-text-primary",children:[d.jsx("span",{className:"text-dark-text-secondary",children:"Name:"})," ",l.name]}),d.jsxs("div",{className:"text-dark-text-primary",children:[d.jsx("span",{className:"text-dark-text-secondary",children:"CTEs:"})," ",e.filter(h=>h.type==="cte").length]}),d.jsxs("div",{className:"text-dark-text-primary",children:[d.jsx("span",{className:"text-dark-text-secondary",children:"Models:"})," ",e.length]}),d.jsxs("div",{className:"text-dark-text-primary",children:[d.jsx("span",{className:"text-dark-text-secondary",children:"Modified:"})," ",new Date(l.lastModified).toLocaleDateString()]})]}),!l&&e.length>0&&d.jsxs("div",{className:"space-y-2 text-sm",children:[d.jsxs("div",{className:"text-dark-text-primary",children:[d.jsx("span",{className:"text-dark-text-secondary",children:"CTEs:"})," ",e.filter(h=>h.type==="cte").length]}),d.jsxs("div",{className:"text-dark-text-primary",children:[d.jsx("span",{className:"text-dark-text-secondary",children:"Models:"})," ",e.length]}),d.jsx("div",{className:"text-dark-text-primary opacity-75",children:"File opened (no workspace saved)"})]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h3",{className:"text-sm font-medium text-dark-text-white mb-3 border-b border-dark-border-primary pb-2",children:"SQL Models"}),d.jsx(Ow,{models:e,onModelClick:n,selectedModelName:r,onOpenValuesTab:t})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("h3",{className:"text-sm font-medium text-dark-text-white mb-3 border-b border-dark-border-primary pb-2",children:"Actions"}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("button",{onClick:s,className:"w-full px-3 py-2 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!0,title:"Decompose current query into CTEs (temporarily disabled)",children:[d.jsx("span",{children:""}),"Decompose"]}),d.jsxs("button",{onClick:m,className:"w-full px-3 py-2 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!0,title:"Validate schema and dependencies (temporarily disabled)",children:[d.jsx("span",{children:""}),"Validate Schema"]})]})]}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-sm font-medium text-dark-text-white mb-3 border-b border-dark-border-primary pb-2",children:"System"}),d.jsxs("div",{className:"space-y-1 text-xs text-dark-text-secondary",children:[d.jsx("div",{children:" LocalStorage Available"}),d.jsx("div",{children:" rawsql-ts Parser Ready"}),d.jsx("div",{children:" Monaco Editor Loaded"})]})]})]})},Hp=O.createContext(void 0),Pw=()=>{const t=O.useContext(Hp);if(!t)throw new Error("useEditor must be used within an EditorProvider");return t},jw=({children:t})=>{const[e,n]=O.useState(null),l={insertAtCursor:o=>{if(!e)return;const u=e.getSelection()||{startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1};e.executeEdits("insert-values",[{range:u,text:o,forceMoveMarkers:!0}]);const c=o.split(`
`),m=u.startLineNumber+c.length-1,h=c.length===1?u.startColumn+c[0].length:c[c.length-1].length+1;e.setPosition({lineNumber:m,column:h}),e.focus()},replaceContent:o=>{e&&(e.setValue(o),e.focus())},getCurrentContent:()=>e?e.getValue():"",setEditorRef:n};return d.jsx(Hp.Provider,{value:l,children:t})};let ad=!1;const vo=({value:t,onChange:e,language:n="sql",readOnly:r=!1,height:s="100%",onMount:i,isMainEditor:l=!1,options:o={},onKeyDown:a,workspace:u,refreshTrigger:c=0})=>{const m=O.useRef(null),h=O.useRef(null),{setEditorRef:w}=Pw();O.useEffect(()=>(console.log("[DEBUG] MonacoEditor component mounted/updated with language:",n,"isMainEditor:",l),()=>{console.log("[DEBUG] MonacoEditor component unmounting, language:",n,"isMainEditor:",l)}),[]);const C=()=>{if(!u)return 2;try{const x=JSON.parse(u.formatter.config),N=(x==null?void 0:x.indentSize)||2;return typeof N=="number"?N:2}catch(x){return console.warn("[DEBUG] Failed to get indent size from formatter:",x),console.log("[DEBUG] Formatter config string:",u.formatter.config),2}},g=(x,N)=>{if(m.current=x,h.current=N,l&&w(x),console.log("[DEBUG] Monaco Editor mounted with language:",n),console.log("[DEBUG] Monaco Editor readOnly prop:",r),console.log("[DEBUG] Monaco Editor options:",o),ad||(console.log("[DEBUG] Initializing zosql-dark theme globally"),N.editor.defineTheme("zosql-dark",{base:"vs-dark",inherit:!0,rules:[{token:"keyword",foreground:"569cd6"},{token:"keyword.uppercase",foreground:"569cd6"},{token:"string",foreground:"ce9178"},{token:"comment",foreground:"6a9955"},{token:"number",foreground:"b5cea8"},{token:"operator",foreground:"d4d4d4"},{token:"delimiter",foreground:"d4d4d4"}],colors:{"editor.background":"#1e1e1e","editor.foreground":"#cccccc","editor.lineHighlightBackground":"#2d2d30","editor.selectionBackground":"#264f78","editor.inactiveSelectionBackground":"#3a3d41","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#404040","editorLineNumber.foreground":"#858585","editorLineNumber.activeForeground":"#c6c6c6"}}),ad=!0,console.log("[DEBUG] zosql-dark theme defined globally")),N.editor.setTheme("zosql-dark"),n==="sql"){console.log("[DEBUG] Setting SQL language configuration and tokens"),N.languages.setLanguageConfiguration("sql",{comments:{lineComment:"--",blockComment:["/*","*/"]},brackets:[["(",")"],["[","]"]],autoClosingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"'",close:"'"},{open:'"',close:'"'}]}),N.languages.setMonarchTokensProvider("sql",{keywords:["SELECT","FROM","WHERE","JOIN","INNER","LEFT","RIGHT","FULL","OUTER","ON","AS","WITH","CTE","UNION","INTERSECT","EXCEPT","ORDER","BY","GROUP","HAVING","INSERT","UPDATE","DELETE","CREATE","DROP","ALTER","TABLE","VIEW","INDEX","DATABASE","SCHEMA","AND","OR","NOT","IN","EXISTS","BETWEEN","LIKE","IS","NULL","DISTINCT","COUNT","SUM","AVG","MIN","MAX","CASE","WHEN","THEN","ELSE","END","ROW_NUMBER","PARTITION","CURRENT_DATE","CURRENT_TIMESTAMP","INTERVAL","OVER","select","from","where","join","inner","left","right","full","outer","on","as","with","cte","union","intersect","except","order","by","group","having","insert","update","delete","create","drop","alter","table","view","index","database","schema","and","or","not","in","exists","between","like","is","null","distinct","count","sum","avg","min","max","case","when","then","else","end","row_number","partition","current_date","current_timestamp","interval","over"],operators:["=",">","<","!","~","?",":","==","<=",">=","!=","&&","||","++","--","+","-","*","/","&","|","^","%","<<",">>",">>>","+=","-=","*=","/=","&=","|=","^=","%=","<<=",">>=",">>>="],symbols:/[=><!~?:&|+\-*\/\^%]+/,tokenizer:{root:[[/[a-zA-Z_$][\w$]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/\d*\.\d+([eE][\-+]?\d+)?/,"number.float"],[/0[xX][0-9a-fA-F]+/,"number.hex"],[/\d+/,"number"],[/[;,.]/,"delimiter"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,{token:"string.quote",bracket:"@open",next:"@string"}],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@dblstring"}]],comment:[[/[^\/*]+/,"comment"],[/\/\*/,"comment","@push"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],string:[[/[^\\']+/,"string"],[/\\./,"string.escape.invalid"],[/'/,{token:"string.quote",bracket:"@close",next:"@pop"}]],dblstring:[[/[^\\"]+/,"string"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/--.*$/,"comment"]]}}),console.log("[DEBUG] SQL Monarch tokenizer configured with keywords including:",["select","from","where"].every(E=>N.languages.getLanguages().find(T=>T.id==="sql"))?"SQL language found":"SQL language not found");const b=x.getModel();if(b){const E=b.getLanguageId();E!=="sql"?(N.editor.setModelLanguage(b,"sql"),console.log("[DEBUG] Set model language to SQL, was:",E)):console.log("[DEBUG] Model language already set to SQL, skipping re-tokenization")}}a&&(x.addAction({id:"execute-query",label:"Execute Query",keybindings:[N.KeyMod.CtrlCmd|N.KeyCode.Enter],run:()=>{const b=document.querySelector('button[title="Run Query (Ctrl+Enter)"]');if(b&&!b.disabled)b.click();else{const E=new KeyboardEvent("keydown",{ctrlKey:!0,key:"Enter"});a(E)}}}),x.addAction({id:"format-sql",label:"Format SQL",keybindings:[N.KeyMod.CtrlCmd|N.KeyMod.Shift|N.KeyCode.KeyF],run:()=>{const E=Array.from(document.querySelectorAll("button")).find(T=>{var j;return((j=T.textContent)==null?void 0:j.trim())==="Format"});if(E&&!E.disabled)console.log("[DEBUG] Executing format via Ctrl+Shift+F Monaco action"),E.click();else{const T=new KeyboardEvent("keydown",{ctrlKey:!0,shiftKey:!0,key:"F"});a(T)}}}),x.onKeyDown(b=>{if(b.ctrlKey&&b.code==="Enter"||b.ctrlKey&&b.shiftKey&&b.code==="KeyF")return;const E=new KeyboardEvent("keydown",{ctrlKey:b.ctrlKey,shiftKey:b.shiftKey,altKey:b.altKey,metaKey:b.metaKey,key:b.code==="Enter"?"Enter":b.browserEvent.key});a(E)})),i&&i(x,N)},v=x=>{x!==void 0&&e(x)};O.useEffect(()=>{if(n==="sql"&&m.current&&h.current){const x=m.current.getModel();if(x){const N=x.getLanguageId();console.log("[DEBUG] Language prop changed to:",n,"Current model language:",N),N!=="sql"&&(h.current.editor.setModelLanguage(x,"sql"),console.log("[DEBUG] Forced language change to SQL"))}}},[n]);const p=u==null?void 0:u.formatter.config;O.useEffect(()=>{if(m.current&&n==="sql"&&p){const x=C();console.log("[DEBUG] Updating Monaco editor indent settings, indentSize:",x),m.current.updateOptions({tabSize:x,insertSpaces:!0}),console.log("[DEBUG] Updated Monaco editor with tabSize:",x)}},[p,n]),O.useEffect(()=>{if(m.current){const x=m.current.getValue();x!==t&&(console.log("[DEBUG] Syncing editor value, current:",x.length,"new:",t.length),m.current.setValue(t))}},[t]);const f=C(),y={theme:"zosql-dark",fontSize:14,fontFamily:"Consolas, Monaco, Courier New, monospace",lineNumbers:"on",roundedSelection:!1,scrollBeyondLastLine:!1,readOnly:r,minimap:{enabled:!1},folding:!0,lineDecorationsWidth:10,lineNumbersMinChars:3,glyphMargin:!1,automaticLayout:!0,tabSize:f,insertSpaces:!0,wordWrap:"off",contextmenu:!0,mouseWheelZoom:!0,smoothScrolling:!0,cursorSmoothCaretAnimation:"on",renderLineHighlight:"line",selectionHighlight:!0,occurrencesHighlight:"singleFile",suggest:{showKeywords:!0,showSnippets:!0,showFunctions:!0},quickSuggestions:{other:!0,comments:!1,strings:!1},parameterHints:{enabled:!0},acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilitySupport:"auto",...o};return d.jsx("div",{className:"h-full w-full",children:d.jsx(ef,{height:s,language:n,value:t,onChange:v,onMount:g,options:y})})},Rw=({result:t,isVisible:e,onClose:n})=>{var i;if(!e)return null;const r=()=>{if(!(t!=null&&t.success)||!t.data||t.data.length===0)return d.jsx("div",{className:"text-center text-dark-text-muted py-8",children:t!=null&&t.success?"No data returned from query":"Query execution failed"});const l=Object.keys(t.data[0]);return d.jsx("div",{className:"overflow-auto",children:d.jsxs("table",{className:"text-sm table-auto",children:[d.jsx("thead",{className:"bg-dark-tertiary sticky top-0",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-2 py-2 text-left border-r border-dark-border-primary text-dark-text-secondary whitespace-nowrap",children:"#"}),l.map((o,a)=>d.jsx("th",{className:`px-3 py-2 text-left text-dark-text-white font-medium whitespace-nowrap ${a<l.length-1?"border-r border-dark-border-primary":""}`,children:o},o))]})}),d.jsx("tbody",{children:t.data.map((o,a)=>d.jsxs("tr",{className:`border-b border-dark-border-primary hover:bg-dark-hover ${a%2===0?"bg-dark-primary":"bg-dark-secondary"}`,children:[d.jsx("td",{className:"px-2 py-2 text-dark-text-secondary border-r border-dark-border-primary whitespace-nowrap",children:a+1}),l.map((u,c)=>d.jsx("td",{className:`px-3 py-2 text-dark-text-primary ${c<l.length-1?"border-r border-dark-border-primary":""}`,children:d.jsx("div",{className:"min-w-0",title:String(o[u]),children:o[u]===null?d.jsx("span",{className:"text-dark-text-muted italic",children:"NULL"}):o[u]===""?d.jsx("span",{className:"text-dark-text-muted italic",children:"(empty)"}):String(o[u])})},u))]},a))})]})})},s=()=>{if(!(t!=null&&t.error))return null;const l=()=>{navigator.clipboard.writeText(t.error||"").then(()=>{console.log("Error message copied to clipboard")}).catch(o=>{console.error("Failed to copy error:",o)})};return d.jsxs("div",{className:"p-4 bg-error bg-opacity-10 border border-error border-opacity-30 rounded m-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("h4",{className:"text-error font-medium",children:"Query Error"}),d.jsx("button",{onClick:l,className:"text-xs px-2 py-1 bg-dark-tertiary hover:bg-dark-hover text-dark-text-primary rounded border border-dark-border-primary transition-colors",title:"Copy error message",children:"Copy Error"})]}),d.jsx("textarea",{readOnly:!0,value:t.error,className:"w-full text-sm text-dark-text-primary font-mono bg-dark-primary border border-dark-border-primary rounded p-3 resize-none",style:{minHeight:"200px",height:"auto"},rows:t.error.split(`
`).length+1,onClick:o=>{o.currentTarget.select()}})]})};return d.jsxs("div",{className:"border-t border-dark-border-primary bg-dark-secondary flex flex-col",style:{minHeight:"300px",height:"40vh"},children:[d.jsxs("div",{className:"bg-dark-tertiary border-b border-dark-border-primary px-4 py-2 flex items-center justify-between flex-shrink-0",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("span",{className:"text-sm font-medium text-dark-text-white",children:"Query Results"}),(t==null?void 0:t.success)&&d.jsxs("span",{className:"flex items-center gap-1 text-xs text-success",children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Success"})]}),(t==null?void 0:t.success)===!1&&d.jsxs("span",{className:"flex items-center gap-1 text-xs text-error",children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Error"})]})]}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"flex items-center gap-4 text-xs text-dark-text-secondary",children:(t==null?void 0:t.success)&&d.jsxs(d.Fragment,{children:[d.jsxs("span",{children:["Rows: ",t.rowCount??((i=t.data)==null?void 0:i.length)??0]}),d.jsxs("span",{children:["Time: ",t.executionTime??0,"ms"]})]})}),d.jsx("button",{onClick:n,className:"text-dark-text-secondary hover:text-dark-text-primary",title:"Hide Results",children:""})]})]}),d.jsx("div",{className:"flex-1 overflow-hidden",children:t!=null&&t.error?s():r()})]})};class Jp{constructor(e){this.description=e}canExecute(){return!0}}function Aw(t){if(!t||typeof t!="object")return!1;const e=t;return typeof e.setQueryResult=="function"&&typeof e.getQueryResult=="function"&&typeof e.hasQueryResult=="function"&&typeof e.clearQueryResult=="function"}function Mw(){return`exec_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}class $w{constructor(e){G(this,"result",{});this.result.sql=e,this.result.context={startTime:new Date,executionId:Mw()},this.result.errors=[],this.result.warnings=[]}setStatus(e){return this.result.status=e,this}setRows(e){return this.result.rows=e,this}setColumns(e){return this.result.columns=e,this}setStats(e){var n;return this.result.stats={rowsAffected:0,rowsReturned:((n=this.result.rows)==null?void 0:n.length)||0,executionTimeMs:0,...e},this}addError(e){return this.result.errors=[...this.result.errors||[],e],this}addWarning(e){return this.result.warnings=[...this.result.warnings||[],e],this}setEndTime(e=new Date){return this.result.context&&(this.result.context={...this.result.context,endTime:e,duration:e.getTime()-this.result.context.startTime.getTime()}),this}build(){var r,s;const e=this.result.status||"completed",n=this.result.stats||{rowsAffected:0,rowsReturned:((r=this.result.rows)==null?void 0:r.length)||0,executionTimeMs:((s=this.result.context)==null?void 0:s.duration)||0};return{status:e,context:this.result.context,columns:this.result.columns,rows:this.result.rows,stats:n,errors:this.result.errors||[],warnings:this.result.warnings||[],sql:this.result.sql,formattedSql:this.result.formattedSql}}}class Dw extends Jp{constructor(e){super("Execute SQL Query"),this.context=e}canExecute(){return this.context.tabContent.trim().length>0}async execute(){var r,s,i,l,o;const e=performance.now();let n=null;try{if(console.log("[DEBUG] ExecuteQueryCommand context:",{hasSqlModel:!!this.context.sqlModel,sqlModelName:(r=this.context.sqlModel)==null?void 0:r.name,sqlModelType:(s=this.context.sqlModel)==null?void 0:s.type,tabType:this.context.tabType,hasWorkspace:!!this.context.workspace}),this.context.sqlModel){console.log("[DEBUG] Using sqlModel path for execution"),this.context.sqlModel.sqlWithoutCte=this.context.tabContent;const m=this.getTestValues(),h=(i=this.context.workspace)==null?void 0:i.filterConditions;console.log("[DEBUG] Test values:",!!m,"Filter conditions:",!!h),n=await this.context.sqlModel.getDynamicSql(m,h,!0),console.log("[DEBUG] Generated dynamic SQL length:",n.formattedSql.length)}else if(this.context.tabType==="main"&&this.context.workspace){console.log("[DEBUG] Using fallback main model path for execution");const m=this.context.workspace.sqlModels.find(h=>h.type==="main");if(m){console.log("[DEBUG] Found main model:",m.name),m.sqlWithoutCte=this.context.tabContent;const h=this.context.workspace.testValues,w=this.context.workspace.filterConditions;console.log("[DEBUG] Fallback - Test values:",!!h,"Filter conditions:",!!w),n=await m.getDynamicSql(h,w,!0),console.log("[DEBUG] Fallback generated dynamic SQL length:",n.formattedSql.length)}else console.log("[DEBUG] No main model found in workspace")}else console.log("[DEBUG] No SQL model or workspace available, using plain SQL");if(!n)throw new Error("Unable to generate SQL with proper CTE composition. Please ensure all dependencies are available.");console.log("[DEBUG] Final SQL to execute:",n.formattedSql.substring(0,200)+"..."),console.log("[DEBUG] SQL includes WITH clause?",n.formattedSql.toLowerCase().includes("with"));const a=await this.executeSqlWithPGlite(n.formattedSql,n.params),u=Math.round(performance.now()-e),c={success:!0,data:a.rows,executionTime:u,rowCount:((l=a.rows)==null?void 0:l.length)||0,executedSql:n.formattedSql};if(this.context.sqlModel&&Aw(this.context.sqlModel)){const m=new $w(n.formattedSql).setStatus("completed").setRows(a.rows||[]).setStats({rowsAffected:0,rowsReturned:((o=a.rows)==null?void 0:o.length)||0,executionTimeMs:u}).build();this.context.sqlModel.setQueryResult(m)}return c}catch(a){const u=Math.round(performance.now()-e),c=a instanceof Error?a.message:"SQL execution failed",m=(n==null?void 0:n.formattedSql)||this.context.tabContent;return{success:!1,error:`${c}

Executed SQL:
${m}`,executionTime:u,executedSql:m}}}getTestValues(){var e;if((e=this.context.workspace)!=null&&e.testValues)return console.log("[DEBUG] getTestValues - Found test values:",this.context.workspace.testValues.withClause),this.context.workspace.testValues;console.log("[DEBUG] getTestValues - No test values found")}async executeSqlWithPGlite(e,n=[]){const{PGlite:r}=await cd(async()=>{const{PGlite:i}=await import("./index-BCePGpr6.js").then(l=>l.i);return{PGlite:i}},__vite__mapDeps([0,1,2])),s=new r;return n.length>0?(console.log("[DEBUG] Executing SQL with parameters:",{sql:e,params:n}),await s.query(e,n)):(console.log("[DEBUG] Executing SQL without parameters:",e),await s.query(e))}}class _w extends Jp{constructor(e){super("Format SQL Query"),this.context=e}canExecute(){return this.context.sql.trim().length>0}async execute(){try{const e=Q.parse(this.context.sql),r=this.context.formatter.getSqlFormatter().format(e);return typeof r=="string"?r:r.formattedSql}catch(e){return console.warn("Failed to format SQL:",e),this.context.sql}}}class qw{async execute(e){if(!e.canExecute())throw new Error(`Command cannot be executed: ${e.description||"Unknown command"}`);const n=performance.now();try{console.log(`[CommandExecutor] Executing: ${e.description||"Unknown command"}`);const r=await e.execute(),s=Math.round(performance.now()-n);return console.log(`[CommandExecutor] Completed in ${s}ms`),r}catch(r){const s=Math.round(performance.now()-n);throw console.error(`[CommandExecutor] Failed after ${s}ms:`,r),r}}async executeWithResult(e){const n=performance.now();try{if(!e.canExecute())return{success:!1,error:`Command cannot be executed: ${e.description||"Unknown command"}`,executionTime:0};const r=await e.execute(),s=Math.round(performance.now()-n);return{success:!0,data:r,executionTime:s}}catch(r){const s=Math.round(performance.now()-n);return{success:!1,error:r instanceof Error?r.message:"Command execution failed",executionTime:s}}}}const Ha=new qw;class Bw{constructor(e){this.sqlParser=e}async generatePrompt(e,n){if(!e||!e.trim())throw new Error("No SQL query provided");if(!n.useSchemaCollector)return this.generateBasicPrompt(e);try{return await this.generateSchemaAwarePrompt(e)}catch(r){console.error("Schema analysis failed:",r);let s="Failed to analyze SQL schema. Schema collector is enabled but analysis failed";r instanceof Error&&(s+=`: ${r.message}`);const i=new Error(s);throw r instanceof Error&&(i.stack=r.stack),i}}generateBasicPrompt(e){return`I want to run this SQL without database dependencies.
Please provide only WITH clauses that define the required tables as mock tables using VALUES statements.

Example response:
with users(user_id, user_name) as (values (1, 'alice'), (2, 'bob'))

\`\`\`sql
${e}
\`\`\``}async generateSchemaAwarePrompt(e){if(!this.sqlParser)throw new Error("SQL parser not available for schema analysis");const n=await this.sqlParser.extractSchema(e);return n.length===0?this.generateBasicPrompt(e):`I want to run this SQL without database dependencies.
Please provide only WITH clauses that define the required tables as mock tables using VALUES statements.
The schema information being used is as follows:
\`\`\`schema
${JSON.stringify(n,null,2)}
\`\`\`

Example response:
with users(user_id, user_name) as (values (1, 'alice'), (2, 'bob'))

\`\`\`sql
${e}
\`\`\``}}class Uw{async extractSchema(e){try{const n=Q.parse(e).toSimpleQuery();return new jp().collect(n).map(l=>{const o=l.name,a=l.columns||[];return a.length>0?`${o}(${a.join(", ")})`:o})}catch(n){throw console.error("Schema extraction failed:",n),new Error(`Failed to extract schema from SQL: ${n instanceof Error?n.message:String(n)}`)}}}class Qw extends zp{constructor(){super(...arguments);G(this,"_tabs",[]);G(this,"_activeTabId","");G(this,"_isExecuting",!1);G(this,"_queryResult",null);G(this,"_resultsVisible",!1);G(this,"_workspace",null);G(this,"_tabModelMap",new Map);G(this,"_useSchemaCollector",!0);G(this,"_onSqlExecuted")}get tabs(){return this._tabs}set tabs(n){this._tabs=n,this.notifyChange("tabs",n)}get activeTabId(){return this._activeTabId}set activeTabId(n){this._activeTabId!==n&&(this._activeTabId=n,this.notifyChange("activeTabId",n),this.notifyChange("activeTab",this.activeTab),this.notifyChange("canExecute",this.canExecute))}get activeTab(){return this._tabs.find(n=>n.id===this._activeTabId)||null}get isExecuting(){return this._isExecuting}set isExecuting(n){this._isExecuting!==n&&(this._isExecuting=n,this.notifyChange("isExecuting",n),this.notifyChange("canExecute",this.canExecute))}get queryResult(){return this._queryResult}set queryResult(n){this._queryResult=n,this.notifyChange("queryResult",n)}get resultsVisible(){return this._resultsVisible}set resultsVisible(n){this._resultsVisible!==n&&(this._resultsVisible=n,this.notifyChange("resultsVisible",n))}get workspace(){return this._workspace}set workspace(n){this._workspace=n,this.notifyChange("workspace",n)}get tabModelMap(){return this._tabModelMap}set tabModelMap(n){this._tabModelMap=n,this.notifyChange("tabModelMap",n)}get canExecute(){return!this.isExecuting&&this.activeTab!==null&&this.activeTab.content.trim().length>0}get canFormat(){return this.activeTab!==null&&this.activeTab.content.trim().length>0}get canSave(){return this.activeTab!==null&&this.activeTab.isDirty}get useSchemaCollector(){return this._useSchemaCollector}set useSchemaCollector(n){this._useSchemaCollector!==n&&(this._useSchemaCollector=n,this.notifyChange("useSchemaCollector",n))}setOnSqlExecuted(n){this._onSqlExecuted=n}async executeQuery(){var n,r,s,i,l,o,a,u,c,m,h;if(!(!this.canExecute||!this.activeTab)){this.isExecuting=!0,this.resultsVisible=!0;try{const w={workspace:this.workspace,sqlModel:this.tabModelMap.get(this.activeTab.id)||null,tabContent:this.activeTab.content,tabType:this.activeTab.type};console.log("[DEBUG] Execute query context:",{hasWorkspace:!!w.workspace,hasSqlModel:!!w.sqlModel,sqlModelName:(n=w.sqlModel)==null?void 0:n.name,sqlModelType:(r=w.sqlModel)==null?void 0:r.type,tabType:w.tabType,tabId:this.activeTab.id,tabContent:w.tabContent.substring(0,100)+"...",workspaceTestValues:((l=(i=(s=w.workspace)==null?void 0:s.testValues)==null?void 0:i.withClause)==null?void 0:l.substring(0,100))+"...",workspaceSqlModelsCount:(a=(o=w.workspace)==null?void 0:o.sqlModels)==null?void 0:a.length,sqlModelDependentsCount:(c=(u=w.sqlModel)==null?void 0:u.dependents)==null?void 0:c.length,sqlModelDependentNames:(h=(m=w.sqlModel)==null?void 0:m.dependents)==null?void 0:h.map(p=>p.name)});const C=new Dw(w),g=await Ha.execute(C);this.queryResult=g,g.executedSql&&this._onSqlExecuted&&this._onSqlExecuted(g.executedSql);const v=this.tabModelMap.get(this.activeTab.id);v&&"setQueryResult"in v&&typeof v.setQueryResult=="function"&&v.setQueryResult(g)}catch(w){const C=w instanceof Error?w.message:"Unknown error occurred";this.queryResult={success:!1,error:C,executionTime:0},this.notifyChange("errorWithDetails",{message:"Run failed",details:C,stack:w instanceof Error?w.stack:void 0})}finally{this.isExecuting=!1}}}async formatQuery(){if(!(!this.canFormat||!this.activeTab||!this.workspace))try{const n=new _w({sql:this.activeTab.content,formatter:this.workspace.formatter}),r=await Ha.execute(n);this.updateTabContent(this.activeTab.id,r)}catch(n){console.error("Failed to format SQL:",n),this.notifyChange("errorWithDetails",{message:"Format failed",details:n instanceof Error?n.message:"Unknown formatting error",stack:n instanceof Error?n.stack:void 0})}}toggleResultsVisibility(){this.resultsVisible=!this.resultsVisible}closeResults(){this.resultsVisible=!1}async copyPrompt(){var n;if(!(!this.activeTab||this.activeTab.type!=="values"||!this.workspace))try{const r=this.workspace.sqlModels.find(a=>a.type==="main");if(console.log("[DEBUG] Copy Prompt - Looking for main model:",{hasWorkspace:!!this.workspace,sqlModelsCount:(n=this.workspace)==null?void 0:n.sqlModels.length,mainModel:r?{name:r.name,type:r.type}:null}),!r){console.error("No main SQL model found for prompt generation"),this.notifyChange("copyPromptError","Copy Prompt failed"),this.notifyChange("errorWithDetails",{message:"Copy Prompt failed",details:"No main SQL model found. Please ensure a workspace is loaded with a main query.",stack:void 0});return}console.log("[DEBUG] Creating PromptGenerator and generating prompt"),console.log("[DEBUG] Copy Prompt - Before getFullSql, mainModel.sqlWithoutCte:",r.sqlWithoutCte.substring(0,100)+"...");const s=await r.getFullSql(void 0,void 0,!1);console.log("[DEBUG] Copy Prompt - Got full SQL from root model:",{fullSqlLength:s.length,fullSqlPreview:s.substring(0,100)+"..."});const i=new Uw,o=await new Bw(i).generatePrompt(s,{useSchemaCollector:this._useSchemaCollector});console.log("[DEBUG] Generated prompt length:",o.length),await navigator.clipboard.writeText(o),console.log("[DEBUG] AI prompt copied to clipboard"),console.log("[DEBUG] Notifying copyPromptSuccess"),this.notifyChange("copyPromptSuccess","Copy Prompt succeeded")}catch(r){console.error("Failed to copy prompt - full error:",r);let s="Failed to copy prompt";r instanceof Error?(s=r.message,console.error("Error stack:",r.stack),"cause"in r&&r.cause&&(s+=` (Caused by: ${r.cause})`)):s=`Failed to copy prompt: ${String(r)}`,this.notifyChange("copyPromptError","Copy Prompt failed"),console.log("[DEBUG] Sending error to error panel:",s),this.notifyChange("errorWithDetails",{message:"Copy Prompt failed",details:s,stack:r instanceof Error?r.stack:void 0})}}updateTabContent(n,r){const s=this._tabs.findIndex(i=>i.id===n);if(s!==-1){const i=[...this._tabs];i[s]={...i[s],content:r,isDirty:!0},this.tabs=i}}saveTab(n){const r=this._tabs.find(i=>i.id===n);if(!r||!r.isDirty)return;this.syncTabContentToWorkspace(r,r.content);const s=this._tabs.findIndex(i=>i.id===n);if(s!==-1){const i=[...this._tabs];i[s]={...i[s],isDirty:!1},this.tabs=i}console.log("[DEBUG] Tab saved:",n)}closeTab(n){const r=this._tabs.filter(s=>s.id!==n);this.tabs=r,this._tabModelMap.delete(n),this.notifyChange("tabModelMap",this._tabModelMap),this.activeTabId===n&&r.length>0&&(this.activeTabId=r[0].id)}addTab(n){console.log("[DEBUG] MainContentViewModel.addTab called with:",n.id,n.title);const r=this._tabs.find(s=>s.id===n.id);if(r){console.log("[DEBUG] Tab already exists, making it active:",r.id),this.activeTabId=n.id;return}console.log("[DEBUG] Adding new tab:",n.id,"current tabs count:",this._tabs.length),this.tabs=[...this._tabs,n],this.activeTabId=n.id,console.log("[DEBUG] New tabs count:",this._tabs.length)}setTabModel(n,r){this._tabModelMap.set(n,r),this.notifyChange("tabModelMap",this._tabModelMap)}syncTabContentToWorkspace(n,r){if(!this.workspace){console.log("[DEBUG] No workspace available for sync");return}switch(console.log("[DEBUG] syncTabContentToWorkspace called:",{tabType:n.type,tabId:n.id,contentLength:r.length}),n.type){case"main":const s=this.workspace.sqlModels.find(l=>l.type==="main");console.log("[DEBUG] Found main model:",{hasMainModel:!!s,mainModelName:s==null?void 0:s.name,tabId:n.id,nameMatches:(s==null?void 0:s.name)===n.id}),s?(console.log("[DEBUG] Syncing main tab content to model:",n.id,"content length:",r.length),console.log("[DEBUG] Before update - mainModel.sqlWithoutCte:",s.sqlWithoutCte.substring(0,100)+"..."),s.sqlWithoutCte=r,console.log("[DEBUG] After update - mainModel.sqlWithoutCte:",s.sqlWithoutCte.substring(0,100)+"...")):console.log("[DEBUG] No main model found");break;case"cte":const i=this.workspace.sqlModels.find(l=>l.type==="cte"&&l.name===n.id);i&&(console.log("[DEBUG] Syncing CTE tab content to model:",n.id),i.sqlWithoutCte=r);break;case"values":try{const l=new Qt(r);this.workspace.testValues=l}catch(l){console.warn("Failed to update workspace test values:",l)}break;case"formatter":try{const l=JSON.parse(r);this.workspace.formatter.setFormatterConfig(l)}catch(l){console.warn("Failed to update workspace formatter config:",l),this.workspace.formatter.config=r}break;case"condition":this.workspace.filterConditions.displayString=r;break}}}let Ko=null;const Ww=O.forwardRef(({workspace:t,onWorkspaceChange:e,onActiveTabChange:n,onSqlExecuted:r,showSuccess:s,showError:i,showErrorWithDetails:l},o)=>{const a=O.useRef(null),u=O.useRef(null);a.current||(Ko||(console.log("[DEBUG] Creating new MainContentViewModel instance"),Ko=new Qw),a.current=Ko);const c=Vp(a.current),m=()=>{t&&(c.workspace=t)};O.useEffect(()=>{m()},[t,c]),O.useEffect(()=>{r&&c.setOnSqlExecuted(r)},[r,c]),O.useEffect(()=>{const v=p=>{p.ctrlKey&&p.key==="s"?(p.preventDefault(),p.stopPropagation(),c.canSave&&c.saveTab(c.activeTabId)):p.ctrlKey&&p.key==="Enter"&&(p.preventDefault(),p.stopPropagation(),c.executeQuery())};return document.addEventListener("keydown",v),()=>{document.removeEventListener("keydown",v)}},[c]),O.useEffect(()=>{if(console.log("[DEBUG] MainContentMvvm useEffect: tabs.length=",c.tabs.length,"workspace=",!!t),c.tabs.length===0&&t){const v=t.sqlModels.find(p=>p.type==="main");v&&(console.log("[DEBUG] Opening main model from workspace:",v.name),c.addTab({id:v.name,title:v.name,type:"main",content:v.sqlWithoutCte,isDirty:!1}),c.setTabModel(v.name,v))}else c.tabs.length===0&&!t&&(console.log("[DEBUG] Adding default main tab"),c.addTab({id:"main.sql",title:"main.sql",type:"main",content:"SELECT user_id, name FROM users;",isDirty:!1}))},[t]),O.useEffect(()=>{if(n==null||n(c.activeTabId),c.activeTabId&&u.current){const v=u.current,p=v.querySelector(`[data-tab-id="${c.activeTabId}"]`);if(p){const f=v.getBoundingClientRect(),y=p.getBoundingClientRect();if(y.left<f.left||y.right>f.right){const x=p.offsetLeft-v.clientWidth/2+p.clientWidth/2;v.scrollTo({left:Math.max(0,x),behavior:"smooth"})}}}},[c.activeTabId,n]),O.useEffect(()=>{const v=(p,f)=>{console.log("[DEBUG] Property change received:",p,f),p==="copyPromptSuccess"?(console.log("[DEBUG] Showing success toast:",f),s==null||s(f)):p==="copyPromptError"?(console.log("[DEBUG] Showing error toast:",f),i==null||i(f)):p==="errorWithDetails"&&(console.log("[DEBUG] Showing error with details:",f),l&&f&&l(f.message,f.details,f.stack))};if(a.current&&(s||i||l))return console.log("[DEBUG] Subscribing to ViewModel property changes"),a.current.subscribe(v)},[s,i,l]),O.useEffect(()=>()=>{a.current&&a.current.dispose()},[]),O.useImperativeHandle(o,()=>({openValuesTab:()=>{if(t){const v=c.tabs.find(p=>p.type==="values");if(v){c.activeTabId=v.id;return}c.addTab({id:"values",title:"values",type:"values",content:t.testValues.withClause,isDirty:!1})}},openFormatterTab:()=>{if(t){const v=c.tabs.find(p=>p.type==="formatter");if(v){c.activeTabId=v.id;return}c.addTab({id:"formatter",title:"formatter",type:"formatter",content:JSON.stringify(t.formatter.toJSON(),null,2),isDirty:!1})}},openConditionTab:()=>{if(t){const v=c.tabs.find(p=>p.type==="condition");if(v){c.activeTabId=v.id;return}c.addTab({id:"condition",title:"condition",type:"condition",content:JSON.stringify(t.filterConditions.toJSON(),null,2),isDirty:!1})}},getCurrentSql:()=>{var v;return((v=c.activeTab)==null?void 0:v.content)||""},openSqlModel:(v,p,f,y)=>{const x=c.tabs.find(N=>N.id===v);if(x){c.activeTabId=x.id;return}c.addTab({id:v,title:v,type:f,content:p,isDirty:!1}),y&&c.setTabModel(v,y)},setCurrentModelEntity:v=>{c.activeTab&&c.setTabModel(c.activeTab.id,v)},clearAllTabs:()=>{c.tabs=[],c.activeTabId=""}}),[c,t]);const h=v=>{v.ctrlKey&&v.key==="Enter"?(v.preventDefault(),c.executeQuery()):v.ctrlKey&&v.key==="s"&&(v.preventDefault(),c.canSave&&c.saveTab(c.activeTabId))},w=v=>{const p=v.currentTarget;v.deltaY!==0&&(v.preventDefault(),p.scrollLeft+=v.deltaY)},C=v=>{switch(v){case"main":return"";case"cte":return"";case"values":return"";case"formatter":return"";case"condition":return"";default:return""}},g=v=>{switch(v.type){case"main":return"*root";case"values":return"*data";default:return v.title}};return d.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden",children:[d.jsx("div",{ref:u,className:"bg-dark-secondary border-b border-dark-border-primary flex items-center overflow-x-auto relative tab-container flex-shrink-0",onWheel:w,children:d.jsx("div",{className:"flex min-w-max",children:c.tabs.map(v=>d.jsxs("div",{"data-tab-id":v.id,className:`
                flex items-center gap-2 px-4 py-2 cursor-pointer relative flex-shrink-0
                ${c.activeTabId===v.id?"bg-dark-primary text-dark-text-white border-r border-dark-border-primary z-10":"bg-dark-secondary text-dark-text-primary hover:bg-dark-hover border-r border-dark-border-primary"}
              `,onClick:()=>c.activeTabId=v.id,children:[c.activeTabId===v.id&&d.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-600"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"text-xs",children:C(v.type)}),d.jsx("span",{className:"text-sm",children:g(v)})]}),v.isDirty&&d.jsx("span",{className:"text-xs text-primary-400",children:""}),c.tabs.length>1&&d.jsx("button",{onClick:p=>{p.stopPropagation(),c.closeTab(v.id)},className:"text-dark-text-secondary hover:text-dark-text-primary ml-1",children:""})]},v.id))})}),d.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[c.activeTab&&c.activeTab.type==="values"?d.jsxs("div",{className:"bg-dark-secondary border-b border-dark-border-primary px-4 py-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{className:"flex items-center gap-4",children:d.jsx("div",{className:"flex items-center gap-2",children:d.jsxs("label",{className:"flex items-center gap-2 text-sm text-dark-text-primary cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:c.useSchemaCollector,onChange:v=>c.useSchemaCollector=v.target.checked,className:"w-4 h-4 text-primary-600 bg-dark-primary border-dark-border-primary rounded focus:ring-primary-500 focus:ring-2"}),"use schema collector"]})})}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>c.copyPrompt(),className:"px-3 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors text-sm",title:"Copy AI prompt to clipboard for generating test data",children:"Copy Prompt"}),d.jsx("button",{onClick:()=>c.formatQuery(),disabled:!c.canFormat,className:"px-3 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Format"})]})]}),d.jsx("div",{className:"mt-2 text-xs text-dark-text-secondary",children:'Generate AI prompts to create WITH clauses with mock data for your SQL queries. Enable "use schema collector" for table structure analysis.'})]}):d.jsx("div",{className:"bg-dark-secondary border-b border-dark-border-primary px-4 py-2",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("div",{})," ",d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:()=>c.executeQuery(),disabled:!c.canExecute,className:"px-3 py-1 bg-success text-white rounded hover:bg-green-600 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Run Query (Ctrl+Enter)",children:c.isExecuting?"Running...":"Run"}),d.jsx("button",{onClick:()=>c.saveTab(c.activeTabId),disabled:!c.canSave,className:"px-3 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Save changes to model (Ctrl+S)",children:"Save"}),d.jsx("button",{onClick:()=>c.formatQuery(),disabled:!c.canFormat,className:"px-3 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Format"}),d.jsx("button",{onClick:()=>c.toggleResultsVisibility(),className:"px-3 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active transition-colors text-sm",children:c.resultsVisible?"Hide Results":"Show Results"})]})]})}),d.jsx("div",{className:"flex-1 overflow-hidden",children:c.activeTab&&d.jsxs("div",{className:c.activeTab.type!=="values"&&c.resultsVisible&&c.queryResult?"h-full flex flex-col":"h-full",children:[d.jsx("div",{className:c.activeTab.type!=="values"&&c.resultsVisible&&c.queryResult?"flex-1 bg-dark-primary overflow-hidden":"h-full bg-dark-primary overflow-hidden",style:c.activeTab.type!=="values"&&c.resultsVisible&&c.queryResult?{minHeight:"200px"}:{},children:d.jsx(vo,{value:c.activeTab.content,onChange:v=>{console.log("[DEBUG] Monaco onChange for tab:",c.activeTab.id,"type:",c.activeTab.type),c.updateTabContent(c.activeTab.id,v)},language:c.activeTab.type==="values"?"sql":c.activeTab.type==="formatter"||c.activeTab.type==="condition"?"json":"sql",height:"100%",isMainEditor:!0,onKeyDown:h,workspace:t,options:c.activeTab.type==="values"?{wordWrap:"off",wrappingStrategy:"simple",scrollBeyondLastLine:!1,minimap:{enabled:!1},folding:!0}:c.activeTab.type==="formatter"||c.activeTab.type==="condition"?{wordWrap:"off",formatOnType:!0,formatOnPaste:!0,minimap:{enabled:!1},readOnly:!1}:{wordWrap:"off",minimap:{enabled:!1},folding:!0}},"main-editor-unified")}),c.activeTab.type!=="values"&&c.resultsVisible&&c.queryResult&&d.jsx("div",{className:"flex-shrink-0",children:d.jsx(Rw,{result:c.queryResult,isVisible:c.resultsVisible,onClose:()=>c.closeResults()})})]})})]})]})}),zw=O.memo(Ww,(t,e)=>t.workspace===e.workspace?!0:!t.workspace||!e.workspace?!1:t.workspace.name===e.workspace.name&&t.workspace.activeObjectId===e.workspace.activeObjectId&&t.workspace.openedObjects.length===e.workspace.openedObjects.length),xo=()=>{const[t,e]=O.useState(null),n=O.useCallback((o,a="info")=>{e({message:o,type:a})},[]),r=O.useCallback(()=>{e(null)},[]),s=O.useCallback(o=>{n(o,"success")},[n]),i=O.useCallback(o=>{n(o,"error")},[n]),l=O.useCallback(o=>{n(o,"info")},[n]);return{toast:t,showToast:n,hideToast:r,showSuccess:s,showError:i,showInfo:l}},Yp=({message:t,type:e="info",duration:n=3e3,onClose:r})=>{O.useEffect(()=>{const l=setTimeout(r,n);return()=>clearTimeout(l)},[n,r]);const s={success:"bg-green-600",error:"bg-red-600",info:"bg-blue-600"}[e],i={success:"",error:"",info:""}[e];return d.jsxs("div",{className:`
        fixed bottom-4 right-4 z-50
        flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg
        ${s} text-white
        animate-slide-in-bottom
      `,children:[d.jsx("span",{className:"text-lg",children:i}),d.jsx("span",{className:"text-sm font-medium",children:t}),d.jsx("button",{onClick:r,className:"ml-2 text-white/80 hover:text-white",children:""})]})},Vw=({workspace:t,lastExecutedSql:e})=>d.jsxs("div",{className:"p-4 h-full flex flex-col",children:[d.jsx("div",{className:"flex items-center justify-between mb-3",children:d.jsx("h4",{className:"text-sm font-medium text-dark-text-white",children:"Last Executed SQL"})}),d.jsx("div",{className:"text-xs text-dark-text-primary opacity-75 mb-2",children:"This shows the most recent SQL query that was executed"}),d.jsx("div",{className:"flex-1 min-h-0",children:d.jsx(vo,{value:e||"-- No SQL has been executed yet",onChange:()=>{},language:"sql",height:"100%",readOnly:!0,workspace:t,options:{fontSize:12,wordWrap:"on",formatOnType:!1,formatOnPaste:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!0,selectOnLineNumbers:!1,lineNumbers:"on"}},"executed-sql-viewer")}),d.jsxs("div",{className:"mt-3 space-y-2",children:[d.jsxs("div",{className:"text-xs text-dark-text-secondary",children:["Status: ",e?d.jsx("span",{className:"text-green-400",children:" SQL Available"}):d.jsx("span",{className:"text-gray-400",children:"No execution yet"})]}),d.jsx("div",{className:"text-xs text-dark-text-primary opacity-75",children:" This SQL reflects what was actually executed, including composed CTEs and filters."})]})]}),Kw=({workspace:t,filterConditionsJson:e,refreshTrigger:n,onConditionsChange:r,onRefreshTrigger:s})=>{const{showSuccess:i,showError:l}=xo();console.log("[DEBUG] ConditionTab rendering with refreshTrigger:",n);const o=()=>{if(console.log("[DEBUG] ReGenerate button clicked!"),!t){console.log("[DEBUG] No workspace available"),l("No workspace available");return}try{console.log("[DEBUG] ReGenerate clicked, sqlModels:",t.sqlModels.length);const c=t.filterConditions.displayString;console.log("[DEBUG] Original conditions:",c),t.filterConditions.initializeFromModels(t.sqlModels);const m=t.filterConditions.displayString;console.log("[DEBUG] New conditions:",m),s(),i(c!==m?"Filter conditions regenerated successfully":"Filter conditions regenerated (no changes)")}catch(c){console.error("[DEBUG] ReGenerate failed:",c),l(`ReGenerate failed: ${c instanceof Error?c.message:"Unknown error"}`)}},a=()=>{if(t){console.log("[DEBUG] Format JSON clicked, original:",t.filterConditions.displayString);try{const c=JSON.parse(t.filterConditions.displayString),m=JSON.stringify(c,null,2);t.filterConditions.displayString=m,console.log("[DEBUG] JSON formatted successfully"),s()}catch(c){console.warn("[DEBUG] JSON format failed:",c)}}},u=c=>{if(c.ctrlKey&&c.key==="Enter"){c.preventDefault();const m=document.querySelector('button[title="Run Query (Ctrl+Enter)"]');m&&!m.disabled&&(console.log("[DEBUG] Executing query from Condition tab via Ctrl+Enter"),m.click())}};return d.jsxs("div",{className:"p-4 h-full flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsx("h4",{className:"text-sm font-medium text-dark-text-white",children:"Filter Conditions"}),d.jsx("div",{className:"flex gap-2",children:d.jsx("button",{onClick:o,className:"text-xs text-primary-400 hover:text-primary-300",title:"ReGenerate filter conditions from current SQL query",children:"ReGenerate"})})]}),d.jsx("div",{className:"text-xs text-dark-text-primary opacity-75 mb-2",children:"rawsql-ts FilterConditions - Edit values only, structure is auto-generated from SQL"}),d.jsx("div",{className:"flex-1 min-h-0",children:d.jsx(vo,{value:e,onChange:r,language:"json",height:"100%",readOnly:!1,workspace:t,onKeyDown:u,options:{fontSize:12,wordWrap:"off",formatOnType:!0,formatOnPaste:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!1}},"condition-editor")}),d.jsxs("div",{className:"mt-3 space-y-2",children:[d.jsx("div",{className:"flex gap-2",children:d.jsx("button",{onClick:a,className:"px-3 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors text-xs",title:"Format JSON",children:"Format JSON"})}),d.jsxs("div",{className:"text-xs text-dark-text-secondary",children:["JSON validation: ",t!=null&&t.filterConditions.isValid()?d.jsx("span",{className:"text-green-400",children:" Valid"}):d.jsx("span",{className:"text-red-400",children:" Invalid"})]}),d.jsx("div",{className:"text-xs text-dark-text-primary opacity-75",children:" Generated from SQL columns. Edit values (undefined  actual values)."})]})]})},Gw=({workspace:t,sqlFormatterJson:e,refreshTrigger:n,onFormatterChange:r,onRefreshTrigger:s})=>{const{showSuccess:i,showError:l}=xo();console.log("[DEBUG] FormatterTab rendering with refreshTrigger:",n);const o=()=>{if(console.log("[DEBUG] Reset Formatter button clicked!"),!t){console.log("[DEBUG] No workspace available"),l("No workspace available");return}try{console.log("[DEBUG] Original formatter:",t.formatter.displayString),t.formatter.reset(),console.log("[DEBUG] After reset:",t.formatter.displayString),s(),i("Formatter configuration reset to default")}catch(c){console.error("[DEBUG] Reset failed:",c),l(`Reset failed: ${c instanceof Error?c.message:"Unknown error"}`)}},a=()=>{if(t){console.log("[DEBUG] Format JSON clicked, original:",t.formatter.displayString);try{const c=JSON.parse(t.formatter.displayString),m=JSON.stringify(c,null,2);t.formatter.displayString=m,console.log("[DEBUG] JSON formatted successfully"),s()}catch(c){console.warn("[DEBUG] JSON format failed:",c)}}},u=c=>{if(c.ctrlKey&&c.shiftKey&&c.key==="F"){c.preventDefault();const h=Array.from(document.querySelectorAll("button")).find(w=>{var C;return((C=w.textContent)==null?void 0:C.trim())==="Format"});h&&!h.disabled&&(console.log("[DEBUG] Executing format from Formatter tab via Ctrl+Shift+F"),h.click())}};return d.jsxs("div",{className:"p-4 h-full flex flex-col",children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsx("h4",{className:"text-sm font-medium text-dark-text-white",children:"SQL Formatter Config"}),d.jsx("div",{className:"flex gap-2",children:d.jsx("button",{onClick:o,className:"text-xs text-primary-400 hover:text-primary-300",title:"Reset formatter configuration to default values",children:"Reset"})})]}),d.jsx("div",{className:"text-xs text-dark-text-primary opacity-75 mb-2",children:"rawsql-ts SqlFormatter configuration - Adjust formatting preferences"}),d.jsx("div",{className:"flex-1 min-h-0",children:d.jsx(vo,{value:e,onChange:r,language:"json",height:"100%",readOnly:!1,workspace:t,onKeyDown:u,options:{fontSize:12,wordWrap:"off",formatOnType:!0,formatOnPaste:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!1}},"formatter-editor")}),d.jsxs("div",{className:"mt-3 space-y-2",children:[d.jsx("div",{className:"flex gap-2",children:d.jsx("button",{onClick:a,className:"px-3 py-1 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors text-xs",title:"Format JSON",children:"Format JSON"})}),d.jsxs("div",{className:"text-xs text-dark-text-secondary",children:["JSON validation: ",(()=>{try{return JSON.parse(e),d.jsx("span",{className:"text-green-400",children:" Valid"})}catch{return d.jsx("span",{className:"text-red-400",children:" Invalid"})}})()]}),d.jsx("div",{className:"text-xs text-dark-text-primary opacity-75",children:" Modify formatting options like keywordCase, indentSize, withClauseStyle, etc."})]})]})},Hw=({workspace:t,lastExecutedSql:e})=>{const[n,r]=O.useState("sql"),[s,i]=O.useState(0),[l,o]=O.useState("{}"),[a,u]=O.useState("{}"),{toast:c,hideToast:m}=xo();O.useEffect(()=>{if(console.log("[DEBUG] RightSidebar useEffect triggered, workspace changed:",!!t,"refreshTrigger:",s),console.log("[DEBUG] Workspace object reference:",t),t){console.log("[DEBUG] Workspace ID:",t.id,"Name:",t.name);const g=t.filterConditions.displayString||"{}",v=t.formatter.displayString||"{}";o(p=>g!==p?(console.log("[DEBUG] Updating filterConditionsJson:",g),g):p),u(p=>v!==p?(console.log("[DEBUG] Updating sqlFormatterJson:",v),v):p)}},[t,s]);const h=g=>{t&&(t.filterConditions.displayString=g,o(g))},w=g=>{t&&(t.formatter.displayString=g,u(g))},C=()=>{i(g=>g+1)};return d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"w-80 bg-dark-sidebar border-l border-dark-border flex flex-col h-full",children:[d.jsxs("div",{className:"flex border-b border-dark-border",children:[d.jsx("button",{onClick:()=>r("sql"),className:`flex-1 px-4 py-2 text-xs font-medium transition-colors ${n==="sql"?"text-primary-400 border-b-2 border-primary-400 bg-dark-hover":"text-dark-text-secondary hover:text-dark-text-primary"}`,children:"SQL"}),d.jsx("button",{onClick:()=>r("condition"),className:`flex-1 px-4 py-2 text-xs font-medium transition-colors ${n==="condition"?"text-primary-400 border-b-2 border-primary-400 bg-dark-hover":"text-dark-text-secondary hover:text-dark-text-primary"}`,children:"Condition"}),d.jsx("button",{onClick:()=>r("formatter"),className:`flex-1 px-4 py-2 text-xs font-medium transition-colors ${n==="formatter"?"text-primary-400 border-b-2 border-primary-400 bg-dark-hover":"text-dark-text-secondary hover:text-dark-text-primary"}`,children:"Formatter"})]}),d.jsxs("div",{className:"flex-1 overflow-hidden relative",children:[d.jsx("div",{className:`absolute inset-0 ${n==="sql"?"block":"hidden"}`,children:d.jsx(Vw,{workspace:t,lastExecutedSql:e})}),d.jsx("div",{className:`absolute inset-0 ${n==="condition"?"block":"hidden"}`,children:d.jsx(Kw,{workspace:t,filterConditionsJson:l,refreshTrigger:s,onConditionsChange:h,onRefreshTrigger:C})}),d.jsx("div",{className:`absolute inset-0 ${n==="formatter"?"block":"hidden"}`,children:d.jsx(Gw,{workspace:t,sqlFormatterJson:a,refreshTrigger:s,onFormatterChange:w,onRefreshTrigger:C})})]})]}),c&&d.jsx(Yp,{message:c.message,type:c.type,onClose:m})]})},Jw=dd.memo(Hw,(t,e)=>{var o,a,u,c,m,h,w,C,g,v,p,f;const n=(o=t.workspace)==null?void 0:o.id,r=(a=e.workspace)==null?void 0:a.id,s=(((c=(u=t.workspace)==null?void 0:u.formatter)==null?void 0:c.displayString)||"")+(((h=(m=t.workspace)==null?void 0:m.filterConditions)==null?void 0:h.displayString)||""),i=(((C=(w=e.workspace)==null?void 0:w.formatter)==null?void 0:C.displayString)||"")+(((v=(g=e.workspace)==null?void 0:g.filterConditions)==null?void 0:v.displayString)||""),l=n===r&&s===i&&t.lastExecutedSql===e.lastExecutedSql;return console.log("[DEBUG] RightSidebar React.memo comparison:",{prevWorkspaceId:n,nextWorkspaceId:r,workspaceIdSame:n===r,prevWorkspaceModified:s.substring(0,50)+"...",nextWorkspaceModified:i.substring(0,50)+"...",workspaceModifiedSame:s===i,prevLastExecutedSql:((p=t.lastExecutedSql)==null?void 0:p.substring(0,30))+"...",nextLastExecutedSql:((f=e.lastExecutedSql)==null?void 0:f.substring(0,30))+"...",lastExecutedSqlSame:t.lastExecutedSql===e.lastExecutedSql,shouldSkipRerender:l}),l}),Yw=({errors:t,onClearError:e,onClearAll:n})=>{const[r,s]=O.useState(!1),[i,l]=O.useState(null),[o,a]=O.useState({x:window.innerWidth-320,y:window.innerHeight-100}),[u,c]=O.useState(!1),[m,h]=O.useState({x:0,y:0});O.useEffect(()=>{t.length>0&&!r&&(s(!0),l(t[t.length-1].id))},[t.length]);const w=g=>{g.target.closest(".panel-header")&&(c(!0),h({x:g.clientX-o.x,y:g.clientY-o.y}))};if(O.useEffect(()=>{const g=p=>{u&&a({x:p.clientX-m.x,y:p.clientY-m.y})},v=()=>{c(!1)};return u&&(document.addEventListener("mousemove",g),document.addEventListener("mouseup",v)),()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",v)}},[u,m]),t.length===0)return null;const C=t.find(g=>g.id===i);return d.jsxs(d.Fragment,{children:[!r&&d.jsx("div",{className:"fixed z-50 bg-red-600 text-white rounded-full w-12 h-12 flex items-center justify-center cursor-pointer shadow-lg hover:bg-red-700 transition-colors",style:{right:"20px",bottom:"20px"},onClick:()=>s(!0),title:`${t.length} error(s)`,children:d.jsx("span",{className:"text-sm font-bold",children:t.length})}),r&&d.jsxs("div",{className:"fixed z-50 bg-dark-secondary border border-dark-border-primary rounded-lg shadow-2xl",style:{left:`${o.x}px`,top:`${o.y}px`,width:"400px",maxHeight:"500px",display:"flex",flexDirection:"column"},onMouseDown:w,children:[d.jsx("div",{className:"panel-header bg-dark-primary border-b border-dark-border-primary px-4 py-2 rounded-t-lg cursor-move",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("h3",{className:"text-sm font-semibold text-dark-text-primary",children:["Errors (",t.length,")"]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:n,className:"text-xs text-dark-text-secondary hover:text-dark-text-primary",title:"Clear all errors",children:"Clear All"}),d.jsx("button",{onClick:()=>s(!1),className:"text-dark-text-secondary hover:text-dark-text-primary",title:"Minimize",children:"_"}),d.jsx("button",{onClick:()=>{s(!1),n()},className:"text-dark-text-secondary hover:text-dark-text-primary",title:"Close",children:""})]})]})}),d.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[d.jsx("div",{className:"w-1/3 border-r border-dark-border-primary overflow-y-auto",children:t.map(g=>d.jsx("div",{className:`px-3 py-2 cursor-pointer border-b border-dark-border-primary ${i===g.id?"bg-dark-hover":"hover:bg-dark-hover"}`,onClick:()=>l(g.id),children:d.jsxs("div",{className:"flex items-start justify-between",children:[d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsx("div",{className:"text-xs text-dark-text-secondary",children:g.timestamp.toLocaleTimeString()}),d.jsx("div",{className:"text-sm text-red-400 truncate",children:g.message})]}),d.jsx("button",{onClick:v=>{v.stopPropagation(),e(g.id)},className:"text-dark-text-secondary hover:text-dark-text-primary ml-2",children:""})]})},g.id))}),d.jsx("div",{className:"flex-1 p-4 overflow-y-auto",children:C?d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsx("h4",{className:"text-xs font-semibold text-dark-text-secondary mb-1",children:"Error Message"}),d.jsx("div",{className:"text-sm text-red-400 break-words",children:C.message})]}),C.details&&d.jsxs("div",{children:[d.jsx("h4",{className:"text-xs font-semibold text-dark-text-secondary mb-1",children:"Details"}),d.jsx("div",{className:"text-xs text-dark-text-primary bg-dark-primary p-2 rounded break-words",children:C.details})]}),C.stack&&d.jsxs("details",{className:"cursor-pointer",children:[d.jsx("summary",{className:"text-xs font-semibold text-dark-text-secondary hover:text-dark-text-primary",children:"Stack Trace"}),d.jsx("pre",{className:"text-xs text-dark-text-primary bg-dark-primary p-2 rounded mt-1 overflow-x-auto",children:C.stack})]}),d.jsx("div",{className:"flex gap-2 mt-4",children:d.jsx("button",{onClick:()=>{navigator.clipboard.writeText(`Error: ${C.message}

Details: ${C.details||"N/A"}

Stack: ${C.stack||"N/A"}`)},className:"text-xs px-2 py-1 bg-dark-hover text-dark-text-primary rounded hover:bg-dark-active",children:"Copy Error"})})]}):d.jsx("div",{className:"text-sm text-dark-text-secondary",children:"Select an error to view details"})})]})]})]})},Xw=()=>{const[t,e]=O.useState(!1),[n,r]=O.useState(null),[s,i]=O.useState([]),l=O.useMemo(()=>{const c=new Bp,m=new Qp;return new qp(c,m)},[]),o=O.useCallback(async(c,m,h)=>{e(!0),r(null);try{const w=await l.decomposeSql(c,m,h);return i(w),w}catch(w){const C=w instanceof Error?w.message:"Failed to decompose SQL";throw r(C),new Error(C)}finally{e(!1)}},[l]),a=O.useCallback(async(c,m)=>{try{return await l.reconstructSql(c,m)}catch(h){const w=h instanceof Error?h.message:"Failed to reconstruct SQL";throw r(w),new Error(w)}},[l]),u=O.useCallback(()=>{i([]),r(null)},[]);return{decomposeSql:o,reconstructSql:a,isDecomposing:t,error:n,models:s,clearModels:u}},Zw=()=>{const[t,e]=O.useState([]),n=O.useCallback((i,l,o)=>{const a={id:`error-${Date.now()}-${Math.random()}`,timestamp:new Date,message:i,details:l,stack:o,type:"error"};e(u=>[...u,a])},[]),r=O.useCallback(i=>{e(l=>l.filter(o=>o.id!==i))},[]),s=O.useCallback(()=>{e([])},[]);return{errors:t,addError:n,clearError:r,clearAllErrors:s}};function eg(t={}){const e="SELECT user_id, name FROM users;",n=`-- Define test data CTEs here
-- Write WITH clauses, SELECT clauses can be omitted (they will be ignored if written)
-- Example:
with users(user_id, name) as (
  values
    (1::bigint, 'alice'::text),
    (2::bigint, 'bob'::text)
)`,{id:r=Ge.generateId(),mainSql:s=e,testValues:i=n}=t,l=new Ge(r,"demoworkspace","main.sql",[],new Qt(i),new Tt,new tt,{}),o=new wn("main","main.sql",s,[],void 0,s);return l.addSqlModel(o),l.filterConditions.initializeFromModels([o]),l.openSqlModelTab(o),l}function tg(t){const e=[];if(t.name!=="demoworkspace"&&e.push(`Expected name 'demoworkspace', got '${t.name}'`),t.originalFilePath!=="main.sql"&&e.push(`Expected originalFilePath 'main.sql', got '${t.originalFilePath}'`),t.sqlModels.length!==1)e.push(`Expected 1 SQL model, got ${t.sqlModels.length}`);else{const n=t.sqlModels[0];n.type!=="main"&&e.push(`Expected main model type 'main', got '${n.type}'`),n.name!=="main.sql"&&e.push(`Expected main model name 'main.sql', got '${n.name}'`),(!n.originalSql||n.originalSql.length===0)&&e.push("Main model originalSql is missing or empty"),(!n.sqlWithoutCte||n.sqlWithoutCte.length===0)&&e.push("Main model sqlWithoutCte is missing or empty")}if(!t.testValues)e.push("TestValuesModel is missing");else{const n=t.testValues.toString();(n==="undefined"||n==="")&&e.push("TestValuesModel has invalid content"),n.includes("users")||e.push('TestValuesModel does not contain expected "users" table')}if(!t.formatter)e.push("SqlFormatterEntity is missing");else{const n=t.formatter.displayString;(n==="undefined"||n==="")&&e.push("SqlFormatterEntity has invalid content"),n.includes("identifierEscape")||e.push("SqlFormatterEntity does not contain expected configuration")}if(!t.filterConditions)e.push("FilterConditionsEntity is missing");else{const n=t.filterConditions.displayString;n==="undefined"&&e.push("FilterConditionsEntity has undefined content - initialization failed"),n==="{}"&&e.push("FilterConditionsEntity has empty content - columns not detected");try{const r=JSON.parse(n);t.sqlModels.length>0&&((t.sqlModels[0].originalSql||t.sqlModels[0].sqlWithoutCte)==="SELECT user_id, name FROM users;"?(r.user_id||e.push("FilterConditions missing user_id column"),r.name||e.push("FilterConditions missing name column")):Object.keys(r).length===0&&e.push("FilterConditions has no columns - SQL analysis may have failed"))}catch(r){e.push(`FilterConditions JSON is invalid: ${r instanceof Error?r.message:"Unknown error"}`)}}return{isValid:e.length===0,errors:e}}function ud(t={}){const e=eg(t),n=tg(e);if(!n.isValid)throw new Error(`Demo workspace validation failed:
${n.errors.join(`
`)}`);return e}function ng(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=s=>{var l;const i=(l=s.target)==null?void 0:l.result;typeof i=="string"?e(i):n(new Error("Failed to read file as text"))},r.onerror=()=>{n(new Error("Failed to read file"))},r.readAsText(t)})}const rg=()=>{const[t,e]=O.useState(!0),[n,r]=O.useState(!0),[s,i]=O.useState(),[l,o]=O.useState(null),[a,u]=O.useState(!1),[c,m]=O.useState(""),h=O.useRef(!1),w=O.useRef(null),{decomposeSql:C,isDecomposing:g,error:v}=Xw(),{toast:p,showSuccess:f,showError:y,hideToast:x}=xo(),{errors:N,addError:b,clearError:E,clearAllErrors:T}=Zw(),j=z=>{var ie;i(z.name),(ie=w.current)==null||ie.openSqlModel(z.name,z.sqlWithoutCte,z.type,z)},F=async()=>{var ie;const z=(ie=w.current)==null?void 0:ie.getCurrentSql();if(!z){y("No SQL content to decompose");return}try{const me=await C(z,"main.sql");f(`Decomposed into ${me.length} SQL models`)}catch(Te){y(Te instanceof Error?Te.message:"Failed to decompose SQL")}},ve=async z=>{var ie,Te;try{(ie=w.current)==null||ie.clearAllTabs();const me=await ng(z),Fe=z.name.replace(/\.sql$/i,""),yt=new Wp(Fe,me),L=await Ha.execute(yt);o(L);try{localStorage.setItem("zosql_workspace_v3",JSON.stringify(L.toJSON()))}catch(q){console.warn("Failed to save workspace to localStorage:",q)}const $=L.sqlModels.find(q=>q.type==="main");$&&((Te=w.current)==null||Te.openSqlModel($.name,$.sqlWithoutCte,"main",$)),f(`Opened ${z.name} with ${L.sqlModels.length} models`)}catch(me){y(me instanceof Error?me.message:"Failed to open file")}};return O.useEffect(()=>{(async()=>{var ie;if(!(a||h.current)){h.current=!0,u(!0);try{const Te=localStorage.getItem("zosql_workspace_v3");if(console.log("[DEBUG] Loading saved workspace from localStorage:",Te?"found":"not found"),Te){const Fe=JSON.parse(Te);if(console.log("[DEBUG] Saved workspace data:",Fe),Fe.name==="syokiworkspace"||!((ie=Fe.testValues)!=null&&ie.withClause)||!Fe.openedObjects||!Fe.layoutState)console.log("[DEBUG] Old workspace detected (missing openedObjects/layoutState), creating new demoworkspace"),localStorage.removeItem("zosql_workspace_v3");else{const yt=Ge.fromJSON(Fe);console.log("[DEBUG] Loaded workspace:",yt.name,"testValues:",yt.testValues.withClause),o(yt),console.log("[DEBUG] Loaded workspace with opened objects:",yt.openedObjects.length),u(!1);return}}console.log("[DEBUG] Creating new demoworkspace using factory");let me;try{me=ud(),console.log("[DEBUG] Created workspace with testValues:",me.testValues.withClause),console.log("[DEBUG] Initialized FilterConditions:",me.filterConditions.displayString),o(me),console.log("[DEBUG] Created workspace with opened objects:",me.openedObjects.length)}catch(Fe){console.error("[ERROR] Failed to create demo workspace:",Fe),y("Failed to create initial workspace");return}try{localStorage.setItem("zosql_workspace_v3",JSON.stringify(me.toJSON())),console.log("[DEBUG] Saved new workspace to localStorage")}catch(Fe){console.warn("Failed to save initial workspace to localStorage:",Fe)}}catch(Te){console.warn("Failed to load saved workspace:",Te),console.log("[DEBUG] Creating fallback workspace using factory");const me=ud();console.log("[DEBUG] Fallback workspace created with FilterConditions:",me.filterConditions.displayString),o(me),console.log("[DEBUG] Created fallback workspace with opened objects:",me.openedObjects.length)}finally{u(!1)}}})()},[]),O.useEffect(()=>{v&&y(v)},[v,y]),d.jsxs("div",{className:"h-screen w-screen overflow-hidden flex flex-col",children:[d.jsx(Iw,{onToggleLeftSidebar:()=>e(!t),onToggleRightSidebar:()=>r(!n),leftSidebarVisible:t,rightSidebarVisible:n,onFileOpen:ve,onWorkspaceCreated:z=>{o(z);try{localStorage.setItem("zosql_workspace_v3",JSON.stringify(z.toJSON()))}catch(ie){console.warn("Failed to save workspace to localStorage:",ie)}},workspaceName:l==null?void 0:l.name}),d.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[t&&d.jsx(Lw,{onOpenValuesTab:()=>{var z;return(z=w.current)==null?void 0:z.openValuesTab()},sqlModels:(l==null?void 0:l.sqlModels)||[],onModelClick:j,selectedModelName:s,onDecomposeQuery:F,isDecomposing:g,workspace:l}),d.jsx(zw,{ref:w,workspace:l,showSuccess:f,showError:y,showErrorWithDetails:b,onActiveTabChange:z=>{if(z&&l){const ie=l.sqlModels.find(Te=>Te.name===z);i(ie?ie.name:void 0)}else i(void 0)},onSqlExecuted:z=>m(z)}),n&&d.jsx(Jw,{lastExecutedSql:c,workspace:l})]}),p&&d.jsx(Yp,{message:p.message,type:p.type,onClose:x}),d.jsx(Yw,{errors:N,onClearError:E,onClearAll:T})]})},sg=()=>d.jsx(Nw,{children:d.jsx(jw,{children:d.jsx("div",{className:"h-screen w-screen overflow-hidden bg-dark-primary text-dark-text-primary",children:d.jsx(rg,{})})})});Go.createRoot(document.getElementById("root")).render(d.jsx(dd.StrictMode,{children:d.jsx(sg,{})}));

# CTEリソース管理・インポート機能

## 基本コンセプト（仕様化済み）
- zosqlフォルダはチーム開発のリソースとしてバージョン管理対象
- CTEを再利用可能なリソースとして管理
- プロジェクト内でのCTE共有機能

## フォルダ構成（更新済み）
```
/zosql
  zosql.config            # フォーマッターなどの設定
  /resources              # リソース置き場（構成は自由）
    /{category}/          # カテゴリ別分類（将来実装）
      {resource_name}.sql
  /develop                # 開発用フォルダ（バージョン管理対象）
    /{group}
      /{feature}.sql/     # フォルダ
         main.sql         # rootクエリ
         /cte
           {ctename}.sql  # CTE単体
```

## 依存関係コメント形式（決定済み）
```sql
/* Auto-generated CTE block - do not edit manually */
/* Dependencies: */
/* /develop/{group}/{feature}.sql/cte/user_stats.sql */
/* /resources/common/date_utils.sql */
with user_stats as (...), date_utils as (...) select ...
```

## 実装方針（Phase 1）
1. **単純な分解機能**: オリジナルSQL → zosql/develop形式
2. **WITH句ワンライナー整形**: rawsql-tsのfull-onelineスタイル
3. **絶対パス形式のコメント**: AI・人間双方にとって明確
4. **リソース機能は後回し**: まずは基本的な分解・合成から

## 検討すべき質問・課題

### CTEライブラリ管理
21. CTEライブラリの構造はどうするか？（カテゴリ分け、命名規則）
22. CTEのバージョニングはどう管理するか？
23. 古いCTEの廃止（deprecation）プロセスは？
24. CTEの説明・ドキュメントはどこに記載するか？

### インポート仕様
25. インポート構文はコメントベースか、SQL拡張か？
26. エイリアス（AS句）をサポートするか？
27. 部分インポート（特定のCTEのみ）は可能か？
28. インポート時のパラメータ化はサポートするか？

### 依存関係管理
29. CTEが他のCTEに依存している場合の解決順序は？
30. 外部プロジェクトのCTEインポートはサポートするか？
31. インポートされたCTEの変更通知機能は必要か？
32. 依存関係の可視化ツールは提供するか？

### チーム開発・運用
33. CTEの品質管理プロセスは？（レビュー、テスト）
34. CTEライブラリの検索・発見機能は？
35. 使用統計（どのCTEが多く使われているか）の収集は？
36. CTEの破壊的変更時の影響範囲分析は？

### パフォーマンス・最適化
37. 大量のCTEインポート時のコンパイル速度は？
38. 不要なCTEの自動除去機能は？
39. CTEの実行計画最適化への影響は？
40. キャッシュ機能は必要か？